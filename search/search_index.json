{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u9996\u9875","text":"<p>\u672c\u7cfb\u5217\u6559\u7a0b\u4e3b\u8981\u5199\u81ea\u4e8e\u4e2a\u4eba\u5728\u5236\u4f5c\u851a\u84dd CodeMod \u7684\u4e00\u4e9b\u7ecf\u9a8c \u672c\u7f51\u7ad9\u5185\u5bb9\u5f00\u6e90\u5728: github.com/Saplonily/CelesteModTutorial \u5341\u5206\u6b22\u8fce\u6765\u63d0 pr \u548c issue \u4ee5\u4fee\u590d\u5404\u79cd\u8bed\u6cd5\u9519\u8bef, \u7528\u8bcd\u9519\u8bef\u548c\u5185\u5bb9\u9519\u8bef\u4ee5\u53ca\u5efa\u8bae_(:\u0437\u300d\u2220)_  </p> <p>\u5927\u90e8\u5206\u6587\u7ae0\u53ef\u80fd\u4f1a\u5199\u7684\u4e0d\u660e\u4e0d\u767d\u4ee5\u81f3\u4e8e\u9700\u8981\u9891\u7e41\u4fee\u6539, \u5982\u679c\u4f60\u6709\u66f4\u597d\u7684\u4fee\u6539\u5efa\u8bae\u7684\u8bdd\u6b22\u8fce\u6765\u63d0 issue.  </p> <p>\u90a3\u4e48\u4e00\u5207\u5c31\u7eea, \u53ef\u4ee5\u5f00\u59cb\u9605\u8bfb \u5165\u95e8-\u7b2c\u4e00\u8282 \u4e86:</p> <p>\u5f00\u59cb - Celeste Everest MonoMod</p> <p>\u987a\u4fbf\u611f\u8c22\u4e00\u4e9b\u4e3a\u672c\u6559\u7a0b\u8d21\u732e\u7684\u4eba:</p> <ul> <li>AppleSheep - \u5728\u5199\u4f5c\u521d\u671f\u63d0\u4f9b\u4e86\u5927\u91cf\u4fee\u6539\u5efa\u8bae \u76ee\u524d\u6b63\u5728\u91cd\u6784\u6574\u4e2a\u6559\u7a0b(Bilibili)</li> <li>\u591c\u8c37\u7d2b\u5e7d - \u4e3a\u914d\u7f6e\u73af\u5883\u8282\u63d0\u4f9b\u4e86\u4f7f\u7528\u6a21\u677f\u7684\u5efa\u8bae (Bilibili)</li> <li>\u7535\u7bb1 - \u5236\u4f5c\u4e86\u5305\u542b\u57fa\u7840 Loenn \u4f7f\u7528\u6559\u7a0b\u7684\u4f5c\u56fe\u6559\u7a0b (Bilibili)</li> <li>Lucky boy - Settings, Session, SaveData \u8282\u7684\u4e00\u4e9b\u8865\u5145, \u4ee5\u53ca\u94a9\u53d6 Helper \u65b9\u6cd5, debug, tracker, flag, tag \u8282\u7684\u4f5c\u8005 (GitHub)</li> </ul> <p>\u4ee5\u53ca\u6211\u81ea\u5df1 :D</p> <ul> <li>Saplonily (Bilibili, Outlook)</li> </ul> <p>\u4ee5\u53ca\u6559\u7a0b\u5927\u90e8\u5206\u5185\u5bb9\u7684\u6765\u6e90:</p> <ul> <li>Everest Wiki</li> </ul> <p>\u548c\u4e00\u5207\u7684\u57fa\u7840:</p> <ul> <li>Celeste</li> <li>Everest API</li> </ul> <p>\u5728\u7f51\u7ad9\u4e2d\u7684\u4ee3\u7801\u5757\u4e2d\u7684\u4e00\u4e9b\u9ad8\u4eae\u5728\u6a2a\u5411\u6eda\u52a8\u65f6\u4f1a\u53d1\u751f\u622a\u65ad, \u5373\u9ad8\u4eae\u5e76\u6ca1\u6709\u8986\u76d6\u6574\u884c, \u8fd9\u4e2a\u662f <code>mkdocs-material</code> \u81ea\u8eab\u7684 bug, \u800c\u4e14\u770b\u4e0a\u53bb\u8bf4\u662f\u4fee\u590d\u8d77\u6765\u5f88\u56f0\u96be, issue \u94fe\u63a5: mkdocs-material issue #452.  </p> <p>bug \u4e8e\u4e0b: <pre><code>t11ntpj808mbc1gu4lx7n9d8tj5q3ck3t1c0aclc    Liquorice oat cake carrot cake. Halvah lemon drops bear claw fruitcake. Marshmallow danish jelly-o toffee.\njqlksiohper0brg9x2ajcm7ajjf8ptjxprqstvda    Apple pie cake jelly-o sugar plum.\nx3mjly0wn48wy7lgf2bfymbykommv8dbyp7an1n8    Toffee candy brownie carrot cake jujubes sweet roll chocolate gingerbread.\nq0b5pj6eacuwj3t1i4jv7yxf00mi6osc0h5etcfz    Cupcake tiramisu danish brownie danish jujubes gingerbread toffee gummi bears.\nu25qzla31ahqxd2x6b2wgpbxvw88h5w6mujoqtuq    Fruitcake jelly beans candy canes icing pastry liquorice. Bear claw tart chocolate sweet souffl\u00e9 sweet roll marshmallow ice cream liquorice.\n9xcjy4nvh1jinka64lkdr1nhagm8odp0frr56nks    Bear claw tootsie roll toffee biscuit cotton candy macaroon. \n5rmcwguz3jzws8w1hh2jbfdau74jip3f8rbu10oy    Pudding caramels carrot cake sweet roll danish oat cake.\ns50wqctf9059ets5ezp4oeq7p6pfr24ntww2d15v    Oat cake macaroon pastry cheesecake. Dessert topping chocolate bar. \nvue3y73jcwsg5um4pw8aqhuv3njgtg9iq0ortx5p    Sesame snaps candy canes muffin lollipop wafer. \n1o6edje4xcb7vtcvct4ghawafdvmvgkx4r0scny5    Macaroon pudding gingerbread. \n</code></pre></p> <p>\u672c\u7cfb\u5217\u5185\u5bb9\u4f9d\u636eCC BY-SA 4.0\u8bb8\u53ef\u8bc1\u8fdb\u884c\u6388\u6743</p>"},{"location":"advanced/cross_mod_interactions/","title":"\u8de8 Mod \u4ea4\u4e92","text":"<p>\u6709\u65f6\u6211\u4eec\u4f1a\u5e0c\u671b\u4f7f\u7528\u5176\u4ed6 Mod \u6216\u63d0\u4f9b\u81ea\u5df1 Mod \u7684\u529f\u80fd, \u8fd9\u4e00\u8282\u5c06\u4ecb\u7ecd <code>ModInterop</code> \u7684\u4f7f\u7528\u53ca\u4e00\u4e9b\u5e38\u89c1\u7684\u4ea4\u4e92\u65b9\u6cd5.</p>"},{"location":"advanced/cross_mod_interactions/#_1","title":"\u4f9d\u8d56\u7ba1\u7406","text":"<p>\u5728\u4e0e\u5176\u4ed6 Mod \u4ea4\u4e92\u524d, \u6211\u4eec\u9700\u8981\u5728 <code>everest.yaml</code> \u4e2d\u6dfb\u52a0\u76f8\u5e94\u7684\u4f9d\u8d56. \u8fd9\u91cc\u6211\u4eec\u4ee5 <code>GravityHelper</code> \u4e3a\u4f8b:</p> everest.yaml<pre><code>- Name: MyCelesteMod\n  Version: 0.1.0\n  DLL: MyCelesteMod.dll\n  Dependencies:\n    - Name: EverestCore\n      Version: 1.4465.0\n  OptionalDependencies:\n    - Name: GravityHelper\n      Version: 1.2.20\n</code></pre> <p><code>everest.yaml</code> \u4e2d\u7684\u4f9d\u8d56\u5206\u4e3a\u4ee5\u4e0b\u4e24\u79cd:</p> <ul> <li><code>Dependencies</code> \u5fc5\u9700\u4f9d\u8d56: \u4f1a\u5728\u4f60\u7684 Mod \u52a0\u8f7d\u524d\u5b8c\u6210\u52a0\u8f7d.</li> <li><code>OptionalDependencies</code> \u53ef\u9009\u4f9d\u8d56: \u53ea\u6709\u5728\u88ab\u542f\u7528\u65f6\u52a0\u8f7d, \u672a\u542f\u7528\u5219\u4f1a\u5ffd\u7565.</li> </ul> <p>\u901a\u5e38\u4e3a\u4e86\u4fdd\u6301 Mod \u7684\u8f7b\u91cf\u6027\u4e0e\u7075\u6d3b\u6027, \u5efa\u8bae\u5c3d\u53ef\u80fd\u51cf\u5c11\u5fc5\u9700\u4f9d\u8d56\u7684\u6570\u91cf. \u5982\u679c\u4e00\u4e2a\u4f9d\u8d56\u662f\u53ef\u9009\u7684, \u6211\u4eec\u5e94\u8be5\u5728\u4f7f\u7528\u88ab\u4f9d\u8d56\u7684\u529f\u80fd\u524d\u68c0\u67e5\u5b83\u662f\u5426\u88ab\u6210\u529f\u52a0\u8f7d.</p> <p>\u4e00\u4e2a\u53ef\u80fd\u7684\u5b9e\u73b0\u5982\u4e0b:</p> MyCelesteModModule.cs<pre><code>public static bool GravityHelperLoaded;\n\npublic override void Load()\n{\n    // \u83b7\u53d6 GravityHelperModule \u7684\u5143\u6570\u636e\n    EverestModuleMetadata gravityHelperMetadata = new()\n    {\n        Name = \"GravityHelper\",\n        Version = new Version(1, 2, 20)\n    };\n\n    // \u5224\u65ad GravityHelper \u662f\u5426\u6210\u529f\u52a0\u8f7d\n    GravityHelperLoaded = Everest.Loader.DependencyLoaded(gravityHelperMetadata);\n}\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5728\u4f7f\u7528\u88ab\u4f9d\u8d56\u7684\u529f\u80fd\u524d\u68c0\u67e5 <code>GravityHelperLoaded</code> \u4ee5\u786e\u4fdd\u88ab\u4f9d\u8d56\u7684 Mod \u6210\u529f\u52a0\u8f7d.</p>"},{"location":"advanced/cross_mod_interactions/#modinterop","title":"ModInterop","text":"<p><code>ModInterop</code> \u662f <code>MonoMod</code> \u7684\u4e00\u9879\u5341\u5206\u5f3a\u5927\u7684\u529f\u80fd, \u5176\u63d0\u4f9b\u4e86\u4e00\u79cd\u6807\u51c6\u5316\u7684\u65b9\u5f0f\u4ee5\u5b9e\u73b0\u4e0d\u540c Mod \u95f4\u7684\u4ea4\u4e92, \u51e0\u4e4e\u53ef\u4ee5\u89c6\u4e3a\u6211\u4eec\u62e5\u6709\u7684\u6700\u63a5\u8fd1 \"\u5b98\u65b9\" \u7684 API.</p> <p>\u4e00\u4e2a Mod \u53ef\u4ee5\u901a\u8fc7 <code>ModExportName</code> \u7279\u6027\u5bfc\u51fa\u4e00\u7ec4\u65b9\u6cd5, \u800c\u5176\u4ed6\u7684 Mod \u53ef\u4ee5\u901a\u8fc7 <code>ModImportName</code> \u7279\u6027\u5bfc\u5165\u8fd9\u4e9b\u65b9\u6cd5\u4f5c\u4e3a\u59d4\u6258\u4ee5\u8c03\u7528.</p> <p>Info</p> <p>\u5982\u679c\u88ab\u4f9d\u8d56\u7684 Mod \u88ab\u7981\u7528, \u5176\u901a\u8fc7 <code>ModExportName</code> \u5bfc\u51fa\u7684\u59d4\u6258\u5c06\u4f1a\u662f <code>null</code>, \u8c03\u7528\u5b83\u4eec\u5c06\u5bfc\u81f4\u6e38\u620f\u5d29\u6e83. \u6211\u4eec\u5e94\u8be5\u68c0\u67e5\u88ab\u4f9d\u8d56\u7684 Mod \u662f\u5426\u542f\u7528\u4ee5\u51b3\u5b9a\u662f\u5426\u8c03\u7528.</p> <p>\u4e0b\u9762\u6211\u4eec\u5c06\u4ecb\u7ecd\u8fd9\u4e24\u79cd\u7279\u6027\u7684\u4f7f\u7528.</p>"},{"location":"advanced/cross_mod_interactions/#modexportnameattribute","title":"ModExportNameAttribute","text":"<p><code>ModExportNameAttribute(string name)</code> \u7279\u6027\u7528\u4e8e\u5bfc\u51fa\u6211\u4eec\u5e0c\u671b\u63d0\u4f9b\u7684\u65b9\u6cd5, <code>name</code> \u53c2\u6570\u662f\u6211\u4eec\u63d0\u4f9b\u7684\u4e00\u7cfb\u5217 API \u7684\u552f\u4e00\u6807\u8bc6\u7b26, \u7528\u4e8e\u5728\u5176\u4ed6 Mod \u4e2d\u5f15\u7528\u6b64 API.</p> <p>\u4e0b\u9762\u6211\u4eec\u65b0\u5efa\u4e00\u4e2a <code>MyCelesteModExports</code> \u7c7b\u8fdb\u884c\u793a\u4f8b: MyCelesteModExports.cs<pre><code>using MonoMod.ModInterop;\n\n// \u5b9a\u4e49\u6211\u4eec\u5e0c\u671b\u5bfc\u51fa\u7684 ModInterop API\n[ModExportName(\"MyCelesteMod\")]\npublic static class MyCelesteModExports\n{\n    // \u6dfb\u52a0\u4e8e 2.0.2 \u7248\u672c\n    public static int GetNumber() =&gt; 202;\n    // \u6dfb\u52a0\u4e8e 1.0.1 \u7248\u672c\n    public static int MultiplyByTwo(int num) =&gt; num * 2;\n    // \u6dfb\u52a0\u4e8e 1.0.0 \u7248\u672c\n    public static void LogStuff() =&gt; Logger.Log(LogLevel.Info, \"MyCelesteMod\", \"Someone is calling this method!\");\n    // \u6dfb\u52a0\u4e8e 1.0.0 \u7248\u672c\n    public static bool TryDoubleIfEven(int number, out int? doubledNumber)\n    {\n        if (number % 2 == 0)\n        {\n            doubledNumber = number * 2;\n            return true;\n        }\n        else\n        {\n            doubledNumber = null;\n            return false;\n        }\n    }\n}\n</code></pre></p> <p>Info</p> <p>\u8bf7\u8bb0\u4f4f, API \u662f\u4e00\u79cd\u5951\u7ea6. \u4f7f\u7528\u4f60\u7684 API \u7684 Mod \u4f5c\u8005\u4f1a\u671f\u671b\u5b83\u81f3\u5c11\u80fd\u5728\u4f60\u7684 API \u4e0b\u4e00\u4e2a\u4e3b\u8981\u7248\u672c\u524d\u4fdd\u6301\u7a33\u5b9a. \u56e0\u6b64, \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f60\u8bb0\u5f55\u6bcf\u4e2a\u7248\u672c API \u7684\u4fee\u6539, \u81f3\u5c11\u5305\u62ec\u6bcf\u4e2a\u65b9\u6cd5\u7684\u6dfb\u52a0\u7248\u672c. \u8fd9\u6837\u53ef\u4ee5\u5e2e\u52a9\u5176\u4ed6 Mod \u4f5c\u8005\u4e86\u89e3\u54ea\u4e9b API \u662f\u65b0\u589e\u7684, \u54ea\u4e9b\u662f\u66f4\u6539\u8fc7\u7684, \u5c3d\u53ef\u80fd\u907f\u514d\u56e0\u63a5\u53e3\u53d8\u52a8\u800c\u5bfc\u81f4\u7684\u95ee\u9898.</p> <p>\u5728\u5b8c\u6210\u4e86\u4e0a\u9762\u8fd9\u4e9b\u540e, \u6211\u4eec\u8fd8\u9700\u8981\u5728 Mod \u7684 <code>Module</code> \u4e2d\u6ce8\u518c\u5bfc\u51fa\u7684 <code>ModInterop</code> API: MyCelesteModModule.cs<pre><code>using MonoMod.ModInterop;\n\npublic override void Load()\n{\n    // \u6ce8\u518c ModInterop API\n    typeof(MyCelesteModExports).ModInterop();\n}\n</code></pre></p> <p>\u8fd9\u6837, \u6211\u4eec\u5c31\u5b8c\u6210 <code>ModInterop</code> API \u7684\u5bfc\u51fa.</p>"},{"location":"advanced/cross_mod_interactions/#modimportnameattribute","title":"ModImportNameAttribute","text":"<p><code>ModImportNameAttribute(string name)</code> \u7279\u6027\u7528\u4e8e\u5728\u4f60\u7684 Mod \u4e2d\u5f15\u5165\u5176\u4ed6 Mod \u5bfc\u51fa\u7684 API, <code>name</code> \u53c2\u6570\u662f\u6211\u4eec\u5bfc\u5165 API \u7684\u552f\u4e00\u6807\u8bc6\u7b26, \u7528\u4e8e\u6307\u5b9a\u6211\u4eec\u9700\u8981\u5bfc\u5165\u7684 API.</p> <p>\u4e0b\u9762\u6211\u4eec\u65b0\u5efa\u53e6\u4e00\u4e2a Mod <code>AnotherCelesteMod</code> \u5bfc\u5165 <code>MyCelesteMod</code> \u63d0\u4f9b\u7684 API:</p> <p>Info</p> <p>\u5728\u5bfc\u5165\u524d\u8bb0\u5f97\u5728 <code>everest.yaml</code> \u4e2d\u6dfb\u52a0 <code>MyCelesteMod</code> \u7684\u53ef\u9009\u4f9d\u8d56.</p> MyCelesteModAPI.cs<pre><code>using MonoMod.ModInterop;\n\n// \u5bfc\u5165\u6211\u4eec\u5e0c\u671b\u4f7f\u7528\u7684 ModInterop API\n// ModImportName \u7684\u53c2\u6570\u5fc5\u987b\u4e0e\u5bf9\u5e94\u7684 ModExportName \u7684\u53c2\u6570\u5339\u914d\n[ModImportName(\"MyCelesteMod\")]\npublic static class MyCelesteModAPI\n{\n    // \u5bfc\u51fa\u7684\u65b9\u6cd5\u5982\u679c\u6709\u8fd4\u56de\u503c\u4f7f\u7528 Func\n    public static Func&lt;int&gt; GetNumber;\n    public static Func&lt;int, int&gt; MultiplyByTwo;\n\n    // \u5982\u679c\u6ca1\u6709\u8fd4\u56de\u503c, \u4e5f\u5c31\u662f\u8fd4\u56de\u503c\u662f void \u5219\u4f7f\u7528 Action\n    public static Action LogStuff;\n\n    // \u5982\u679c\u5bfc\u51fa\u7684\u65b9\u6cd5\u53c2\u6570\u4e2d\u6709 out \u6216 ref \u9700\u8981\u5b9a\u4e49\u81ea\u5b9a\u4e49\u59d4\u6258\u7c7b\u578b\u4ee5\u8fdb\u884c\u5bfc\u5165\n    // Func \u5e76\u4e0d\u652f\u6301\u53c2\u6570\u4e2d\u5e26\u6709 out \u6216 ref \u7684\u60c5\u51b5\n    public static TryDoubleIfEvenDelegate TryDoubleIfEven;\n    public delegate bool TryDoubleIfEvenDelegate(int number, out int? doubledNumber);\n}\n</code></pre> <p>\u522b\u5fd8\u4e86\u5728 <code>Module</code> \u4e2d\u6ce8\u518c\u6211\u4eec\u5bfc\u5165\u7684 API: AnotherCelesteModModule.cs<pre><code>using MonoMod.ModInterop;\n\npublic override void Load()\n{\n    // \u6ce8\u518c ModInterop API\n    typeof(MyCelesteModAPI).ModInterop();\n}\n</code></pre></p> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>MyCelesteModAPI</code> \u4e2d\u5bfc\u5165\u7684\u59d4\u6258\u4ee5\u8c03\u7528\u6211\u4eec\u5e0c\u671b\u4f7f\u7528\u7684\u529f\u80fd: <pre><code>int myNumber = MyCelesteModAPI.GetNumber();\n\nif (MyCelesteModAPI.MultiplyByTwo(myNumber) &gt; 400)\n{\n    MyCelesteModAPI.LogStuff();\n}\n\nint myDoubledNumber;\n\nif (MyCelesteModAPI.TryDoubleIfEven(myNumber, out int? doubledNumber))\n{\n    myDoubledNumber = doubledNumber;\n}\n</code></pre></p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f, \u6211\u4eec\u53ef\u4ee5\u5728\u81ea\u5df1\u7684 Mod \u4e2d\u8bbf\u95ee\u5e76\u8c03\u7528\u5176\u4ed6 Mod \u63d0\u4f9b\u7684\u529f\u80fd, \u800c\u4e0d\u9700\u8981\u76f4\u63a5\u4f9d\u8d56\u8be5 Mod \u7684\u7a0b\u5e8f\u96c6.</p>"},{"location":"advanced/cross_mod_interactions/#_2","title":"\u76f4\u63a5\u7a0b\u5e8f\u96c6\u5f15\u7528","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u76f4\u63a5\u4f7f\u7528\u76ee\u6807Mod\u4e2d\u7684\u7c7b\u578b\u548c\u65b9\u6cd5, \u4f46\u76ee\u6807 Mod \u5e76\u6ca1\u6709\u5b9e\u73b0 <code>ModInterop</code> API. \u8fd9\u79cd\u60c5\u51b5\u4e0b, \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u5176\u4ed6 Mod \u7684\u7a0b\u5e8f\u96c6.</p> <p>\u4e0b\u9762\u6211\u4eec\u4ecb\u7ecd\u4e24\u79cd\u65b9\u6cd5:</p>"},{"location":"advanced/cross_mod_interactions/#cache","title":"Cache","text":"<p>Everest \u4f1a\u5c06\u6240\u6709 Code Mod \u7684\u7a0b\u5e8f\u96c6\u4f7f\u7528 MonoMod \u8fdb\u884c patch \u5904\u7406\u540e\u653e\u7f6e\u5230 <code>Celeste/Mods/Cache/&lt;mod\u540d&gt;.&lt;\u7a0b\u5e8f\u96c6\u540d&gt;.dll</code> \u4e2d.    \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6a21\u677f\u7684 <code>.csporj</code> \u6587\u4ef6\u4ee5\u76f4\u63a5\u5f15\u7528\u5b83\u4eec:</p> MyCelesteMod.csproj<pre><code>&lt;Project Sdk=\"Microsoft.NET.Sdk\"&gt;\n  &lt;Import Project=\"CelesteMod.props\" /&gt;\n\n  &lt;PropertyGroup&gt;\n    &lt;RootNamespace&gt;Celeste.Mod.MyCelesteMod&lt;/RootNamespace&gt;\n    &lt;LangVersion&gt;latest&lt;/LangVersion&gt;\n    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;\n  &lt;/PropertyGroup&gt;\n\n  &lt;ItemGroup&gt;\n    &lt;None Include=\"CelesteMod.props\"&gt;\n      &lt;Visible&gt;false&lt;/Visible&gt;\n    &lt;/None&gt;\n    &lt;None Include=\"CelesteMod.targets\"&gt;\n      &lt;Visible&gt;false&lt;/Visible&gt;\n    &lt;/None&gt;\n  &lt;/ItemGroup&gt;\n\n&lt;ItemGroup&gt;\n    &lt;CelesteModReference Include=\"GravityHelper\" /&gt;\n    &lt;CelesteModReference Include=\"ExtendedVariantMode\" /&gt;\n    &lt;CelesteModReference Include=\"FrostHelper\" AssemblyName=\"FrostTempleHelper\" /&gt;\n&lt;/ItemGroup&gt;\n\n  &lt;Import Project=\"CelesteMod.targets\" /&gt;\n&lt;/Project&gt;\n</code></pre> <p>Info</p> <p>\u5728\u5f15\u7528\u4e4b\u524d\u6211\u4eec\u9700\u8981\u786e\u8ba4\u76ee\u6807 Mod \u5728 <code>Cache</code> \u4e2d\u662f\u5426\u5b58\u5728, \u4ee5\u4e0a\u9762\u5f15\u7528\u7684 Mod \u4e3a\u4f8b. <code>Cache</code> \u4e2d\u5e94\u8be5\u5b58\u5728:</p> <ul> <li>GravityHelper.GravityHelper.dll</li> <li>ExtendedVariantMode.ExtendedVariantMode.dll ` FrostHelper.FrostTempleHelper.dll</li> </ul> <p>\u6211\u4eec\u586b\u5199\u76ee\u6807 Mod \u5728 <code>Cache</code> \u4e2d\u540d\u79f0\u7684\u524d\u534a\u6bb5\u5c31\u884c.</p>"},{"location":"advanced/cross_mod_interactions/#lib-stripped","title":"lib-stripped","text":"<p><code>lib-stripped</code> \u662f\u6307\u5265\u79bb\u4e86\u6240\u6709\u65b9\u6cd5\u5b9e\u73b0\u7684\u7a0b\u5e8f\u96c6, \u4ec5\u4fdd\u7559\u7c7b\u578b\u548c\u65b9\u6cd5\u7b7e\u540d.     \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>NStrip</code> \u6216 <code>BepInEx.AssemblyPublicizer</code> \u7684 <code>strip-only</code> \u6a21\u5f0f\u7b49\u5de5\u5177\u5bf9\u76ee\u6807\u7a0b\u5e8f\u96c6\u8fdb\u884c\u5265\u79bb.    \u5b8c\u6210\u540e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u88ab\u5265\u79bb\u7684\u7a0b\u5e8f\u96c6.</p>"},{"location":"advanced/cross_mod_interactions/#everestmodule","title":"\u901a\u8fc7 EverestModule \u53cd\u5c04\u83b7\u53d6\u7a0b\u5e8f\u96c6","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>EverestModule</code> \u53cd\u5c04\u52a8\u6001\u5730\u8bbf\u95ee\u6211\u4eec\u5e0c\u671b\u4ea4\u4e92\u7684 Mod \u7684\u7a0b\u5e8f\u96c6, \u800c\u65e0\u9700\u76f4\u63a5\u5f15\u7528\u76ee\u6807 Mod \u7684\u7a0b\u5e8f\u96c6.</p> <p>\u4e0b\u9762\u6211\u4eec\u4ee5 <code>GravityHelper</code> \u4e3a\u4f8b: MyCelesteModModule.cs<pre><code>public static bool GravityHelperLoaded;\n\npublic static PropertyInfo PlayerGravityComponentProperty;\npublic static PropertyInfo IsPlayerInvertedProperty;\npublic static MethodInfo SetPlayerGravityMethod;\n\npublic override void Load()\n{\n    // \u83b7\u53d6 GravityHelperModule \u7684\u5143\u6570\u636e\n    EverestModuleMetadata gravityHelperMetadata = new()\n    {\n        Name = \"GravityHelper\",\n        Version = new Version(1, 2, 20)\n    };\n\n    GravityHelperLoaded = Everest.Loader.DependencyLoaded(gravityHelper);\n\n    // \u901a\u8fc7 EverestModule \u53cd\u5c04\u83b7\u53d6 GravityHelper \u7684\u7a0b\u5e8f\u96c6\n    if (Everest.Loader.TryGetDependency(gravityHelperMetadata, out var gravityModule))\n    {\n        // \u53cd\u5c04\u83b7\u53d6 Celeste.Mod.GravityHelper.GravityHelperModule \u7c7b\u578b\n        Assembly gravityAssembly = gravityModule.GetType().Assembly;\n        Type gravityHelperModuleType = gravityAssembly.GetType(\"Celeste.Mod.GravityHelper.GravityHelperModule\");\n\n        // \u53cd\u5c04\u83b7\u53d6 GravityHelper.GravityHelperModule.PlayerComponent \u5c5e\u6027\n        PlayerGravityComponentProperty = gravityHelperModuleType?.GetProperty(\"PlayerComponent\", BindingFlags.NonPublic | BindingFlags.Static);\n\n        // \u53cd\u5c04\u83b7\u53d6 GravityHelper.Components.SetPlayerGravity \u65b9\u6cd5\n        SetPlayerGravityMethod = PlayerGravityComponentProperty?.GetValue(null)?.GetType().GetMethod(\"SetGravity\", BindingFlags.Public | BindingFlags.Instance);\n\n        // \u53cd\u5c04\u83b7\u53d6 GravityHelper.GravityHelperModule.ShouldInvertPlayer \u5c5e\u6027\n        IsPlayerInvertedProperty = gravityHelperModuleType?.GetProperty(\"ShouldInvertPlayer\", BindingFlags.Public | BindingFlags.Static);\n    }\n}\n</code></pre></p> <p>Info</p> <p>\u5982\u679c\u9700\u8981\u53cd\u5c04\u83b7\u53d6\u7684\u5185\u5bb9\u8f83\u591a\u5efa\u8bae\u8054\u7cfb Mod \u4f5c\u8005, \u8ba9 Mod \u4f5c\u8005\u6dfb\u52a0\u76f8\u5e94\u7684 <code>ModInterop</code> API.</p> <p>\u5b8c\u6210\u8fd9\u4e9b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8bbf\u95ee\u548c\u8c03\u7528\u8fd9\u4e9b\u4e1c\u897f\u4e86: SampleTrigger.cs<pre><code>[CustomEntity(\"MyCelesteMod/SampleTrigger\")]\npublic class SampleTrigger : Trigger\n{\n    public SampleTrigger(EntityData data, Vector2 offset)\n        : base(data, offset)\n    {\n        // \u5224\u65ad GravityHelper \u662f\u5426\u6210\u529f\u52a0\u8f7d\n        if (!MyCelesteModModule.GravityHelperLoaded)\n        {\n            throw new Exception(\"SampleTrigger requires GravityHelper as a dependency!\")\n        }\n    }\n\n    public override void OnEnter(Player player)\n    {\n        base.OnEnter(player);\n\n        // \u8bbe\u7f6e\u73a9\u5bb6\u91cd\u529b\n        object[] parameters = [2, 1f, false];\n        MyCelesteModModule.SetPlayerGravityMethod.Invoke(MyCelesteModModule.PlayerGravityComponentProperty.GetValue(null), parameters);\n\n        // \u83b7\u53d6\u73a9\u5bb6\u662f\u5426\u5728\u53cd\u91cd\u529b\u72b6\u6001\u4e0b\n        bool isPlayerInverted = (bool)MyCelesteModModule.IsPlayerInvertedProperty.GetValue(null);\n        Logger.Log(LogLevel.Info, \"MyCelesteMod\", $\"isPlayerInverted is {isPlayerInverted}!\");\n    }\n}\n</code></pre></p> <p>\u8fd9\u79cd\u65b9\u5f0f\u548c <code>ModInterop</code> \u7c7b\u4f3c, \u53ef\u4ee5\u5728\u4e0d\u76f4\u63a5\u5f15\u7528\u76ee\u6807 Mod \u7684\u7a0b\u5e8f\u96c6\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u4ea4\u4e92. \u4e0d\u8fc7\u4ee3\u7801\u4f1a\u53d8\u5f97\u66f4\u590d\u6742, \u66f4\u8106\u5f31, \u53ef\u8bfb\u6027\u4e5f\u4f1a\u964d\u4f4e. \u6b64\u5916, \u76ee\u6807 Mod \u7684\u4e00\u4e9b\u6539\u52a8\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f60\u7684 Mod \u4e0d\u80fd\u6309\u9884\u671f\u5de5\u4f5c, \u4ece\u800c\u5bfc\u81f4\u5d29\u6e83.</p> <p>\u6211\u4eec\u53ea\u5efa\u8bae\u53ea\u9700\u8981\u8f7b\u5ea6\u4ea4\u4e92\u65f6\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f, \u5982\u679c\u76ee\u6807 Mod \u6709 <code>ModInterop</code> API \u65f6\u66f4\u63a8\u8350\u53bb\u4f7f\u7528 <code>ModInterop</code> API.</p>"},{"location":"advanced/cross_mod_interactions/#mod_1","title":"\u8de8 Mod \u94a9\u5b50","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e3a\u53e6\u4e00\u4e2a Mod \u6dfb\u52a0 IL \u94a9\u5b50, \u53c2\u8003 IL \u94a9\u5b50.</p> <p>\u4e0d\u8fc7, \u4e00\u822c\u4e0d\u9f13\u52b1\u50cf\u8fd9\u6837\u6539\u53d8\u53e6\u4e00\u4e2a Mod \u7684\u884c\u4e3a. \u5b89\u88c5 Mod \u7684\u7528\u6237\u901a\u5e38\u5e0c\u671b\u5b83\u7684\u884c\u4e3a\u4e0e\u63cf\u8ff0\u4e00\u81f4, \u56e0\u6b64\u4efb\u4f55\u5916\u90e8\u66f4\u6539\u90fd\u5e94\u5c3d\u91cf\u5c11\u505a. \u6b64\u5916, \u8fd9\u79cd\u65b9\u6cd5\u6bd4\u4f7f\u7528\u53cd\u5c04\u8c03\u7528\u65b9\u6cd5\u66f4\u52a0\u8106\u5f31, \u56e0\u4e3a\u5b83\u4f9d\u8d56\u4e8e\u7b7e\u540d\u548c IL \u7684\u76f8\u5bf9\u7a33\u5b9a.</p>"},{"location":"arc/basic_env/","title":"\u57fa\u7840\u73af\u5883\u914d\u7f6e - \u65e7","text":""},{"location":"arc/basic_env/#_1","title":"\u9879\u76ee\u521b\u5efa","text":"<p>\u5728vs\u521b\u5efa\u9879\u76ee\u9875\u9762\u4e2d\u6211\u4eec\u9700\u8981\u9009\u62e9\u8fd9\u4e2a:  </p> <p> \u6ce8\u610f\u8981\u9009\u5e26 <code>.NET Framework</code> \u5b57\u6837\u7684, \u851a\u84dd\u7684\u5e95\u5c42\u6846\u67b6\u76f8\u5bf9\u4e8e\u76ee\u524d\u7684 <code>.NET</code> \u5df2\u7ecf\u5f88\u53e4\u8001\u4e86, \u6240\u4ee5\u53ef\u80fd\u4f1a\u88ab\u7a0d\u5fae\u7279\u6b8a\u70b9\u5bf9\u5f85(, \u4e4b\u540e\u5728\u4e3a\u9879\u76ee\u547d\u540d\u7684\u7a97\u53e3\u4e2d\u7684\u9879\u76ee\u6846\u67b6\u8bb0\u5f97\u7cbe\u786e\u9009\u62e9 <code>.NET Framework 4.5.2</code>.  </p> <p> \u5982\u679c\u4f60\u6ca1\u6709 <code>.NET Framework 4.5.2</code> \u7684\u9009\u9879\u8bf7\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u4e86\u6b64\u6846\u67b6, \u5e76\u4e14\u4f60\u9009\u62e9\u7684\u662f\u5e26 <code>.NET Framework</code> \u5b57\u6837\u7684\u7c7b\u5e93\u9879\u76ee.</p> <p>\u5f53\u4f60\u521b\u5efa\u5b8c\u9879\u76ee\u540e, \u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a\u4ee3\u7801\u6587\u4ef6 <code>Class1.cs</code>, \u5b83\u770b\u8d77\u6765\u50cf: Class1.cs<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\n\nnamespace MyCelesteMod\n{\n    public class Class1\n    {\n\n    }\n}\n</code></pre></p>"},{"location":"arc/basic_env/#_2","title":"\u6dfb\u52a0\u5bf9\u851a\u84dd\u7684\u5f15\u7528","text":"<p>\u56e0\u4e3a\u6211\u4eec\u662f\u851a\u84dd mod \u561b, \u6240\u4ee5\u80af\u5b9a\u5f97\u4f9d\u8d56\u4e00\u4e9b\u851a\u84dd\u7684\u4e1c\u897f, \u5373\u4f9d\u8d56\u4e8e\u851a\u84dd\u7684\u7a0b\u5e8f\u96c6. \u5177\u4f53\u64cd\u4f5c\u6765\u8bf4:</p> <ul> <li>\u5728\u89e3\u51b3\u65b9\u6848\u89c6\u56fe\u7a97\u53e3\u4f60\u7684\u9879\u76ee\u4e0b\u7684<code>\u5f15\u7528</code>\u4e0a\u53f3\u51fb</li> <li>\u9009\u62e9<code>\u6dfb\u52a0\u5f15\u7528</code></li> <li>\u5728\u65b0\u7684\u7a97\u53e3\u9009\u62e9\u5de6\u4fa7\u7684<code>\u6d4f\u89c8</code></li> <li>\u70b9\u51fb\u7a97\u53e3\u53f3\u4e0b\u89d2\u7684<code>\u6d4f\u89c8</code> </li> <li>\u5b8c\u6210\u540e\u5728\u5f39\u51fa\u7684\u6587\u4ef6\u9009\u62e9\u6846\u4e2d\u9009\u62e9\u4ee5\u4e0b\u51e0\u4e2a\u5728\u851a\u84dd\u6839\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6:<ul> <li><code>Celeste.exe</code></li> <li><code>FNA.dll</code></li> <li><code>MMHOOK_Celeste.dll</code></li> <li><code>YamlDotNet.dll</code></li> </ul> </li> </ul> <p>\u5bf9\u4e8e steam \u7248\u851a\u84dd\u7684\u76ee\u5f55\u901a\u5e38\u4f1a\u5728 <code>C:\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste</code></p> <p>\u53e6\u5916\u4e3a\u4e86\u4fdd\u8bc1\u4f60\u7684 mod \u7684\u8de8\u5e73\u53f0\u6027, \u4f60\u7684\u5f15\u7528\u5217\u8868\u91cc <code>System</code> \u5f00\u5934\u7684\u53ea\u80fd\u5305\u542b:</p> <ul> <li><code>System</code></li> <li><code>System.Configuration</code></li> <li><code>System.Core</code></li> <li><code>System.Data</code></li> <li><code>System.Drawing</code></li> <li><code>System.Runtime.Serialization</code></li> <li><code>System.Security</code></li> <li><code>System.Xml</code></li> <li><code>System.Xml.Linq</code></li> </ul> <p>\u5982\u679c\u4f60\u7684\u9879\u76ee\u5f15\u7528\u6709\u5176\u4ed6 <code>System</code> \u5f00\u5934\u7cfb\u5217\u7684\u5f15\u7528, \u5e76\u4e14\u5b83\u4eec\u4e0d\u5728\u4e0a\u8ff0\u5217\u8868\u4e0a, \u4f60\u9700\u8981\u5c06\u5176\u79fb\u9664(\u53f3\u952e-&gt;\u79fb\u9664).</p>"},{"location":"arc/basic_env/#module","title":"\u6dfb\u52a0 Module \u7c7b","text":"<p>ok\u5728\u6211\u4eec\u4e00\u756a\u6298\u817e\u4e0b\u6211\u4eec\u7ec8\u4e8e\u53ef\u4ee5\u5f00\u59cb\u6765\u5199\u4ee3\u7801\u4e86, \u90a3\u4e48\u9996\u5148\u628a\u4f60\u7684 <code>Class1.cs</code> \u91cd\u547d\u540d\u6210 <code>(\u4f60\u7684mod\u540d)Module.cs</code>, \u6bd4\u5982\u8fd9\u91cc\u6211\u7684 mod \u540d\u53eb <code>MyCelesteMod</code>, \u90a3\u4e48\u8fd9\u4e2a\u6587\u4ef6\u6700\u597d\u53eb\u505a <code>MyCelesteModModule.cs</code>, \u8fd9\u662f\u4e3a\u4e86\u65b9\u4fbf\u65e5\u540e\u5f00\u53d1\u80fd\u4e00\u773c\u8bc6\u522b\u51fa\u8fd9\u662f\u6211\u4eec\u6700\u65e9\u671f\u521b\u5efa\u7684\u90a3\u4e2a\u5173\u952e\u7c7b.</p> <p>\u5982\u679c\u4f60\u7684 vs \u63d0\u793a\u4f60\u662f\u5426\u91cd\u547d\u540d\u6807\u8bc6\u7b26, \u4f60\u53ef\u4ee5\u9009\u662f, \u8fd9\u6837\u90a3\u4e2a\u6587\u4ef6\u91cc\u7684 <code>Class1</code> \u7c7b\u540d\u4e5f\u4f1a\u5e2e\u4f60\u91cd\u547d\u540d</p> <p>\u90a3\u4e48\u540c\u6837\u5730\u5bf9\u8fd9\u4e2a\u6587\u4ef6\u91cc\u7684\u7c7b\u7684\u540d\u5b57\u4e5f\u91cd\u547d\u540d, \u7136\u540e\u6211\u4eec\u8ba9\u8fd9\u4e2a\u7c7b\u7ee7\u627f\u4e8e <code>EverestModule</code>.</p> <p>\u5982\u679c\u51fa\u73b0\u4e86\u672a\u547d\u540d\u6807\u8bc6\u7b26\u7684\u9519\u8bef, \u8bf7\u68c0\u67e5\u4f60\u662f\u5426\u6b63\u786e\u5f15\u7528\u4e86 <code>Celeste.exe</code> \u5e76\u4e14 using \u4e86 <code>Celeste.Mod</code> \u547d\u540d\u7a7a\u95f4</p> <p><code>EverestModule</code> \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b ,\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u9700\u8981\u52a0\u5165\u4e24\u4e2a\u65b9\u6cd5\u4ee5\u5b9e\u73b0\u5b83, \u540c\u65f6\u8ba9vs\u95ed\u5634. MyCelesteMod.cs<pre><code>public override void Load()\n{\n}\n\npublic override void Unload()\n{\n}\n</code></pre></p> <p><code>Load</code> \u65b9\u6cd5\u4f1a\u5728 Everest \u52a0\u8f7d\u4f60\u7684 Mod \u65f6\u88ab\u8c03\u7528 <code>Unload</code> \u65b9\u6cd5\u4f1a\u5728 Everest \u5378\u8f7d\u4f60\u7684 Mod \u65f6\u88ab\u8c03\u7528 \u5728\u8fd9\u91cc\u6211\u4eec\u4f1a\u5199\u4e2a\u7c7b\u4f3c Hello world \u7684\u4e1c\u897f, \u5373\u5728 <code>Load</code> \u91cc\u6253\u5370\u4e9b\u8bdd. em, \u53ef\u80fd\u4e0d\u662f\u4f60\u671f\u671b\u7684 <code>Console.WriteLine</code> \u800c\u662f <code>Logger.Log</code>, \u5c31\u50cf\u8fd9\u6837:</p> <pre><code>Logger.Log(LogLevel.Info, \"MyCelesteMod\", \"Hello World! Hello Everest!\");\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u851a\u84dd\u5e95\u5c42\u6846\u67b6 <code>Monocle</code> \u5f15\u64ce\u91cc\u7684\u4e00\u4e2a\u9759\u6001\u7c7b, \u5728\u4e4b\u540e\u6211\u4eec\u4f1a\u4ecb\u7ecd\u851a\u84dd\u4e2d\u5e38\u89c1\u7c7b\u7684\u4f7f\u7528. \u4e0b\u9762\u662f\u8fd9\u4e2a\u65b9\u6cd5\u7684\u53c2\u6570\u5217\u8868:</p> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570: \u8fd9\u53e5\u65e5\u5fd7\u7684\u7b49\u7ea7, \u8fd9\u91cc\u6211\u4eec\u5148\u9009 <code>Info</code>.</li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570: \u8fd9\u53e5\u65e5\u5fd7\u7684 <code>Tag</code>, \u901a\u5e38\u5b83\u662f\u4f60\u7684 Mod \u540d\u5b57</li> <li>\u7b2c\u4e09\u4e2a\u53c2\u6570: \u6211\u4eec\u5e0c\u671b\u8f93\u51fa\u7684\u8bdd</li> </ul> <p>\u90a3\u4e48\u4f60\u73b0\u5728\u7684\u4ee3\u7801\u5e94\u8be5\u662f\u5927\u6982\u8fd9\u6837\u5b50\u7684: MyCelesteMod.cs<pre><code>using Celeste.Mod;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\n\nnamespace MyCelesteMod\n{\n    public class MyModModule : EverestModule\n    {\n        public override void Load()\n        {\n            Logger.Log(LogLevel.Info, \"MyCelesteMod\", \"Hello World! Hello Everest!\");\n        }\n\n        public override void Unload()\n        {\n\n        }\n    }\n}\n</code></pre></p> <p>\u73b0\u5728, \u6309\u4e0b <code>Ctrl + B</code>, vs \u5e94\u8be5\u4f1a\u542f\u52a8\u7f16\u8bd1.</p> <p>\u4f60\u4f1a\u9047\u5230\u4e00\u4e2a\u5173\u4e8e <code>x86</code> \u4e0e <code>AnyCpu</code> \u67b6\u6784\u4e0d\u7b26\u7684\u8b66\u544a, \u8fd9\u91cc\u6211\u4eec\u5148\u5ffd\u7565\u5b83\u5e76\u5728\u540e\u9762\u89e3\u51b3.</p> <p>\u7f16\u8bd1\u5b8c\u6210, \u6211\u4eec\u5c31\u53ef\u4ee5\u627e\u5230\u6211\u4eec\u7f16\u8bd1\u51fa\u6765\u7684\u65b0\u9c9c\u7684\u7a0b\u5e8f\u96c6: <code>&lt;\u4f60\u7684\u9879\u76ee\u540d&gt;/&lt;\u4f60\u7684\u9879\u76ee\u540d&gt;/bin/Debug/&lt;\u4f60\u7684\u9879\u76ee\u540d&gt;.dll</code>, \u4f60\u7684 vs \u7684\u8f93\u51fa\u7a97\u53e3\u4e5f\u5e94\u8be5\u4f1a\u5199\u4e0a\u8fd9\u4e2a dll \u7684\u5b8c\u6574\u8def\u5f84.</p>"},{"location":"arc/basic_env/#everest","title":"\u8ba9 Everest \u52a0\u8f7d","text":"<p>\u4ee5\u4e0a\u4e00\u987f\u64cd\u4f5c\u8fc7\u540e\u4f60\u4f1a\u53d1\u73b0\u4f60\u7684\u851a\u84dd\u4ec0\u4e48\u4e5f\u6ca1\u53d1\u751f(\u4e50). \u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u544a\u8bc9\u5b83\u8ba9\u5b83\u52a0\u8f7d\u6211\u4eec\u7684 mod! \u4e3a\u4e86\u8ba9 Everest \u52a0\u8f7d\u6211\u4eec\u7684 mod, \u5176\u4e2d\u4e00\u4e2a\u65b9\u6cd5\u5c31\u662f\u5728\u851a\u84dd\u7684 Mods \u6587\u4ef6\u5939\u91cc\u9762\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939, \u5e76\u653e\u5165\u6211\u4eec\u7684 mod \u6587\u4ef6, \u5b83\u7684\u540d\u5b57\u6211\u4eec\u6700\u597d\u5c31\u662f\u9879\u76ee\u540d\u5b57, \u6bd4\u5982 <code>MyCelesteMod</code>, \u7136\u540e\u5728\u8fd9\u91cc\u5199\u4e00\u4efd <code>everest.yaml</code> \u6587\u4ef6, \u5b83\u5305\u542b\u6211\u4eec mod \u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f: everest.yaml<pre><code>- Name: &lt;mod\u540d\u5b57&gt;\n  Version: &lt;\u7248\u672c&gt;\n  DLL: &lt;dll\u4f4d\u7f6e&gt;\n  Dependencies:\n      - Name: Everest\n        Version: &lt;\u4f9d\u8d56\u7684 everest \u7248\u672c&gt;\n</code></pre> ok, \u6211\u4eec\u6765\u6162\u6162\u586b\u8fd9\u4e9b\u4e1c\u897f - <code>mod\u540d\u5b57</code>: \u63a8\u8350\u4e3a\u9879\u76ee\u540d\u6bd4\u5982 <code>MyCelesteMod</code> - <code>\u7248\u672c</code>: \u7531\u4e8e\u662f\u5f00\u53d1\u65e9\u671f, \u6240\u4ee5\u7248\u672c\u63a8\u8350\u6307\u5b9a\u4e3a0\u5f00\u5934\u7684 <code>0.1.0</code> - <code>\u4f9d\u8d56\u7684 everest \u7248\u672c</code>: \u8fd9\u91cc\u586b\u4f60\u7684 everest \u7248\u672c\u5c31\u884c\u4e86, \u6bd4\u5982\u8bf4\u5982\u679c\u4f60\u662f 3876 \u90a3\u4e48\u8fd9\u91cc\u5e94\u8be5\u5199 <code>1.3876.0</code> - <code>Dll \u4f4d\u7f6e</code>: \u6211\u4eec\u5148\u628a\u4e4b\u524d\u7f16\u8bd1\u7684\u65b0\u9c9c(\u53ef\u80fd\u73b0\u5728\u4e0d\u548b\u65b0\u9c9c\u4e86)\u7684 dll \u590d\u5236\u5230\u8fd9\u4e2a\u6587\u4ef6\u5939\u6765, \u6ca1\u8bb0\u9519\u7684\u8bdd\u5728\u8fd9\u91cc\u53eb <code>MyCelesteMod.dll</code>, ok, <code>everest.yaml</code> \u91cc\u8981\u5199\u7684 dll \u4f4d\u7f6e\u662f\u76f8\u5bf9\u4e8e\u8fd9\u4e2a\u6587\u4ef6\u5939\u7684, \u6211\u4eec\u5c31\u653e\u5728\u5b83\u91cc\u9762\u7b2c\u4e00\u5c42, \u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5199 <code>MyCelesteMod.dll</code> \u5c31\u884c\u4e86.</p> <p>\u73b0\u5728\u4f60\u7684\u90a3\u4e2a\u6587\u4ef6\u5939\u73b0\u5728\u53ef\u80fd\u957f\u8fd9\u4e2a\u6837\u5b50:</p> <ul> <li>MyCelesteMod<ul> <li>MyCelesteMod.dll</li> <li>everest.yaml</li> </ul> </li> </ul> <p>everest.yaml\u53ef\u80fd\u957f\u8fd9\u4e2a\u6837\u5b50: everest.yaml<pre><code>- Name: MyCelesteMod\n  Version: 0.1.0\n  DLL: MyCelesteMod.dll\n  Dependencies:\n      - Name: Everest\n        Version: 1.3876.0\n</code></pre></p> <p>ok, \u5728\u542f\u52a8\u4e4b\u524d\u6211\u4eec\u8fd8\u8981\u5e72\u6700\u540e\u4e00\u4ef6\u5c0f\u4e8b, \u5c31\u662f\u6211\u4eec\u7684\u65e5\u5fd7, \u5b83\u6253\u5370\u5728\u6587\u4ef6\u91cc\u540c\u65f6\u4e5f\u6253\u5370\u5728\u63a7\u5236\u53f0\u91cc, \u65e5\u5fd7\u6587\u4ef6\u7ffb\u9605\u6bd4\u8f83\u9ebb\u70e6, \u6240\u4ee5\u4e3a\u4e86\u65e5\u540e\u65b9\u4fbf\u8c03\u8bd5, \u6211\u4eec\u8fd8\u662f\u5148\u8ba9\u851a\u84dd\u542f\u52a8\u7684\u540c\u65f6\u542f\u52a8\u4e00\u4e2a\u63a7\u5236\u53f0\u597d\u4e00\u70b9. Everest \u5df2\u7ecf\u4e3a\u6211\u4eec\u505a\u4e86\u8fd9\u4ef6\u4e8b\u4e86, \u6211\u4eec\u8981\u505a\u7684\u53ea\u662f\u5728\u851a\u84ddexe\u540c\u76ee\u5f55\u4e0b\u627e\u5230<code>everest-launch.txt</code>, \u6ca1\u627e\u5230\u4e5f\u6ca1\u5173\u7cfb, \u65b0\u5efa\u4e00\u4e2a\u5c31\u53ef\u4ee5\u4e86, \u7136\u540e\u5728\u91cc\u9762\u5199\u4e0a<code>--console</code>, \u662f\u7684\u5c31\u8fd9\u4e00\u5c0f\u70b9\u4e1c\u897f, \u7136\u540e\u6211\u4eec\u4fdd\u5b58, \u542f\u52a8\u851a\u84dd!</p> <p>\u542f\u52a8\u540e\u4f60\u5e94\u8be5\u4f1a\u540c\u65f6\u770b\u5230\u4e00\u4e2a\u63a7\u5236\u53f0\u7a97\u53e3, \u626b\u89c6\u4e00\u4e0b: console output<pre><code>[MonoMod] [AutoPatch] Patch pass\n[MonoMod] [AutoPatch] PatchRefs pass\n[MonoMod] [PostProcessor] PostProcessor pass #1\n[MonoMod] [Write] Writing modded module into output file.\n(07/05/2023 23:22:16) [Everest] [Info] [MyCelesteMod] Hello World! Hello Everest!\n(07/05/2023 23:22:16) [Everest] [Info] [core] Module MyCelesteMod 0.1.0 registered.\n(07/05/2023 23:22:16) [Everest] [Info] [loader] Loading mods with unsatisfied optional dependencies (if any)\nFNA3D Driver: D3D11\nD3D11 Adapter: Intel(R) UHD Graphics 630\nBEGIN LOAD\n- GFX LOAD: 139ms\n- MTN LOAD: 9ms\nWINDOW-1600x900\nGAME DISPLAYED (in 291ms)\n- AUDIO LOAD: 454ms\n- GFX DATA LOAD: 75ms\n</code></pre> \u5927\u6982\u5728\u5982\u4e0a\u7684\u4f4d\u7f6e\u9644\u8fd1(\u5728\u8fd9\u91cc\u662f\u7b2c5\u884c)\u4f60\u5c31\u80fd\u627e\u5230\u4f60\u7684 Hello world \u4e86, \u81f3\u6b64\u57fa\u672c\u73af\u5883\u914d\u7f6e\u7ed3\u675f.</p>"},{"location":"arc/project_template/","title":"\u901a\u8fc7\u6a21\u677f\u521b\u5efa\u9879\u76ee","text":"<p>Info</p> <p>\u5728\u851a\u84dd\u56fd\u5916\u793e\u533a\u6d41\u884c\u7740\u53e6\u4e00\u4e2a mod \u9879\u76ee\u6a21\u677f, \u4e0d\u8fc7\u6211\u4e2a\u4eba\u4e0d\u592a\u559c\u6b22\u5b83, \u4e0d\u8fc7\u4f60\u9700\u8981\u7684\u8bdd\u8fd9\u662f Github \u4e3b\u9875 \u6240\u4ee5\u8fd9\u91cc\u4e3b\u8981\u4f7f\u7528\u6211\u4e2a\u4eba\u5236\u4f5c\u4e5f\u662f\u4e2a\u4eba\u6700\u5e38\u7528\u7684\u4e00\u4e2a.  </p> <p>_(:\u0437\u300d\u2220)_ \u6839\u636e\u4e00\u4e9b\u53cd\u9988\u6211\u4eec\u53d1\u73b0\u65e7\u7684\u624b\u52a8\u914d\u7f6e\u73af\u5883\u7684\u65b9\u5f0f\u975e\u5e38\u7684\u590d\u6742\u96be\u64cd\u4f5c( \u6240\u4ee5\u5462\u8fd9\u91cc\u5c31\u63a8\u8350\u4e00\u79cd\u65b0\u7684\u914d\u7f6e\u73af\u5883\u7684\u65b9\u5f0f - \u4f7f\u7528\u6a21\u677f \u8003\u8651\u5230 nuget \u5b89\u88c5\u6a21\u677f\u4e5f\u9700\u8981\u4e00\u5b9a\u7684\u547d\u4ee4\u884c\u57fa\u7840... \u6240\u4ee5\u8fd9\u91cc\u8003\u8651\u63d0\u4f9b\u76f4\u63a5\u7684\u4e0b\u8f7d\u94fe\u63a5, \u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 <code>dotnet cli</code> \u4ece nuget \u4e0a\u7684\u6a21\u677f\u5b89\u88c5:</p> <p>Note</p> <p>\u4f60\u53ef\u80fd\u8fd8\u9700\u8981\u5b89\u88c5 <code>.NET 8 SDK</code> \u6765\u4f7f\u7528\u8be5\u6a21\u677f, \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u5b83</p> \u4f7f\u7528 dotnet cli \u4ece\u6a21\u677f\u65b0\u5efa\u9879\u76ee <p>\u9996\u5148\u5728\u4e00\u4e2a\u4f60\u559c\u6b22\u7684\u4f4d\u7f6e\u653e\u7f6e\u4f60\u7684\u9879\u76ee\u6587\u4ef6\u5939, \u540d\u5b57\u5373\u4e3a\u4f60\u7684\u9879\u76ee\u540d, \u4f8b\u5982 <code>MyCelesteMod</code>: <pre><code>mkdir MyCelesteMod\ncd MyCelesteMod\n</code></pre> \u7136\u540e\u5728\u6b64\u4f4d\u7f6e\u5b89\u88c5 nuget \u4e0a\u6211\u7684 mod \u6a21\u677f(\u5982\u679c\u4f60\u6ca1\u6709\u5b89\u88c5\u7684\u8bdd): <pre><code>dotnet new install Saladim.CelesteModTemplate\n</code></pre> \u7136\u540e\u4f60\u5c31\u80fd\u4f7f\u7528\u8fd9\u6761\u6307\u4ee4\u76f4\u63a5\u521b\u5efa\u9879\u76ee\u4e86: <pre><code>dotnet new sapcelestemode\n</code></pre> \u540d\u5b57\u5373\u4e3a\u4e0a\u5c42\u6587\u4ef6\u5939\u540d, \u6216\u8005\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>-n</code> \u53c2\u6570\u91cd\u5199\u9879\u76ee\u540d\u5b57: <pre><code>dotnet new sapcelestemod -n MySuperCelesteMod\n</code></pre> \u6a21\u677f\u76ee\u524d\u9ed8\u8ba4\u4e0d\u4f1a\u521b\u5efa\u9488\u5bf9 Everest Core \u7684 Code Mod, \u5982\u679c\u4f60\u9700\u8981\u7684\u8bdd\u4f60\u53ef\u4ee5\u4f20\u5165 <code>--core-only true</code> \u53c2\u6570: <pre><code>dotnet new sapcelestemod --core-only true\n</code></pre></p> <p>\u5b8c\u6210\u540e\u4f7f\u7528\u4f60\u559c\u6b22\u7684\u7f16\u8f91\u5668\u6253\u5f00\u9879\u76ee(\u5bf9\u4e8e vs \u76f4\u63a5\u6253\u5f00 .csproj \u6587\u4ef6), \u90a3\u4e48\u6309\u7406\u6765\u8bf4\u4f60\u4f1a\u770b\u5230\u8fd9\u51e0\u4e2a\u6587\u4ef6:</p> <ul> <li>CelesteMod.props</li> <li>CelesteMod.targets</li> <li>Common.props</li> <li>MyCelesteModModule.cs</li> <li>MyCelesteMod.csproj</li> </ul> <p>\u4ee5\u53ca\u4f60\u7684\u9879\u76ee, \u5b83\u7684\u540d\u5b57\u662f <code>MyCelesteMod</code>, \u4e0d\u540c\u4e8e\u65e7\u7684\u65b9\u6cd5, \u5728\u8fd9\u91cc\u4f60\u7684\u914d\u7f6e\u8fc7\u7a0b\u5f88\u7b80\u5355:</p> <ul> <li>\u9996\u5148\u6253\u5f00 <code>Common.props</code>, \u5c06\u91cc\u9762\u7684 <code>CelesteRootPath</code> \u5185\u7684\u5185\u5bb9\u6539\u6210\u4f60\u7684\u851a\u84dd\u5b89\u88c5\u4f4d\u7f6e</li> </ul> <pre><code>&lt;Project&gt;\n    &lt;PropertyGroup&gt;\n        &lt;CelesteRootPath&gt;C:\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste&lt;/CelesteRootPath&gt;\n        &lt;CommonCelesteUsings&gt;true&lt;/CommonCelesteUsings&gt;\n        &lt;CommonCelesteReferences&gt;true&lt;/CommonCelesteReferences&gt;\n        &lt;ModAssetsFolderName&gt;ModFolder&lt;/ModAssetsFolderName&gt;\n    &lt;/PropertyGroup&gt;\n&lt;/Project&gt;\n</code></pre> <p>\u73b0\u5728\u4f60\u53ef\u4ee5\u6309\u4e0b <code>Ctrl+B</code> \u6216\u8005\u624b\u52a8\u70b9\u51fb <code>\u751f\u6210-&gt;\u751f\u6210\u89e3\u51b3\u65b9\u6848</code>, \u5982\u679c\u4f60\u5728\u4f60\u7684 vs \u8f93\u51fa\u91cc\u9762\u770b\u5230\u4e86\u7c7b\u4f3c\u8fd9\u4e24\u53e5:</p> <pre><code>1&gt;MyCelesteMod -&gt; D:\\User\\temp\\cm\\bin\\x86\\Debug\\net452\\MyCelesteMod.dll\n1&gt;MyCelesteMod -&gt; C:/Program Files (x86)/Steam/steamapps/common/Celeste/Mods/MyCelesteMod_copy/MyCelesteMod.dll\n</code></pre> <p>\u5e76\u4e14\u4f60\u5728\u4f60\u7684\u851a\u84dd Mod \u76ee\u5f55\u4e0b\u627e\u5230\u4e86\u8fd9\u4e2a\u88ab\u521b\u5efa\u7684\u76ee\u5f55, \u90a3\u4e48\u4f60\u7684\u73af\u5883\u5c31\u7b97\u662f\u914d\u5b8c\u4e86, \u5982\u679c\u4f60\u5f88\u611f\u5174\u8da3\u8fd9\u4e4b\u4e2d\u53d1\u751f\u4e86\u4ec0\u4e48, \u8981\u5f15\u7528\u54ea\u4e9b\u7a0b\u5e8f\u96c6, \u8fd9\u4e2a\u6a21\u677f\u80cc\u540e\u5e72\u4e86\u4ec0\u4e48, \u4f60\u53ef\u4ee5\u53bb\u770b\u90a3\u590d\u6742\u7684\u65e7\u7684\u914d\u7f6e\u65b9\u6cd5.</p> <p>Note</p> <p>\u8fd9\u4e2a\u6a21\u677f\u4f7f\u7528 <code>msbuild</code> \u5e2e\u52a9\u4e86\u4f60\u5f88\u591a\u4e8b! \u6bd4\u5982\u5f53\u4f60\u7f16\u8bd1\u5b8c\u9879\u76ee\u4e4b\u540e\u5b83\u4f1a\u590d\u5236\u7f16\u8bd1\u7ed3\u679c\u5230\u9879\u76ee\u76ee\u5f55\u7684 <code>ModFolder</code> \u76ee\u5f55\u4e0b, \u7136\u540e\u5c06\u6574\u4e2a <code>ModFolder</code> \u590d\u5236\u5230\u851a\u84dd\u7684 <code>Mods\\{\u4f60\u7684mod\u540d}_copy</code> \u6587\u4ef6\u5939\u4e0b! \u6240\u4ee5\u5f53\u6211\u4eec\u9700\u8981\u66f4\u6539\u4e00\u4e9b\u6bd4\u5982\u8bf4 loenn \u7684\u914d\u7f6e\u6587\u4ef6, <code>everest.yaml</code> \u7684\u5185\u5bb9, \u4f60\u7684\u6d4b\u8bd5\u5730\u56fe\u7b49\u65f6,  \u4f60\u53ea\u9700\u8981\u7b80\u5355\u5730\u91cd\u65b0\u7f16\u8bd1\u4e00\u904d\u9879\u76ee, \u7136\u540e\u7b49\u5f85\u6a21\u677f\u6765\u5e2e\u4f60\u505a\u5269\u4e0b\u7684\u6d3b!  </p>"},{"location":"arc/project_template/#_1","title":"\u66f4\u6539\u7ec6\u8282","text":"<p>\u901a\u8fc7\u6a21\u677f\u7684\u8bdd\u4f9d\u7136\u6709\u4e9b\u4e1c\u897f\u9700\u8981\u81ea\u884c\u66f4\u6539, \u6bd4\u5982\u8fd9\u4e2a Mod \u7684\u540d\u5b57. \u66f4\u6539 Mod \u7684\u540d\u5b57\u5f88\u7b80\u5355, \u4f60\u53ea\u9700\u8981\u7b80\u5355\u5730\u5728 vs \u91cc\u91cd\u547d\u540d\u9879\u76ee\u7684\u540d\u5b57 \u6bd4\u5982\u6211\u60f3\u53eb\u505a <code>MyAwesomeMod</code>, \u90a3\u4e48\u4f60\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6837: </p> <p>\u987a\u4fbf\u522b\u5fd8\u4e86\u628a\u7c7b\u4f3c <code>MyCelesteModModule.cs</code> \u7684\u6587\u4ef6\u540d\u4e5f\u6539\u6210\u7c7b\u4f3c <code>MyAwesomeModModule.cs</code>, \u4ee5\u53ca\u6539\u540d\u540e\u6e05\u7406\u4e00\u4e0b ModFolder \u4e0b\u9762\u53ef\u80fd\u6709\u7684\u4e00\u4e9b\u4ee5\u8fc7\u53bb\u540d\u5b57\u547d\u540d\u7684 .dll \u548c .pdb \u6587\u4ef6!  </p>"},{"location":"arc/sdk-styled-proj/","title":"\u504f\u597d - sdk-styled csproj","text":""},{"location":"arc/sdk-styled-proj/#sdk-style-csproj","title":"Sdk-style csproj","text":"<p>\u73b0\u5728\u6253\u5f00\u4f60\u7684\u9879\u76ee\u76ee\u5f55\u4e2d\u7684 <code>.csproj</code> \u6587\u4ef6(\u901a\u5e38\u4e5f\u4f1a\u88ab\u53eb\u4f5c*\u9879\u76ee\u6587\u4ef6*), \u5b83\u7528\u4e8e\u7ec4\u7ec7\u63cf\u8ff0\u4f60\u7684\u9879\u76ee\u662f\u4ec0\u4e48\u6837\u5b50\u7684, \u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u975e\u5e38\u7684\u6742\u4e71\u4e0d\u53ef\u8bfb, \u5c31\u50cf:</p> .csproj<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;Project ToolsVersion=\"15.0\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\"&gt;\n  &lt;Import Project=\"$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Microsoft.Common.props\" Condition=\"Exists('$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Microsoft.Common.props')\" /&gt;\n  &lt;PropertyGroup&gt;\n    &lt;Configuration Condition=\" '$(Configuration)' == '' \"&gt;Debug&lt;/Configuration&gt;\n    &lt;Platform Condition=\" '$(Platform)' == '' \"&gt;AnyCPU&lt;/Platform&gt;\n    &lt;ProjectGuid&gt;{100E625E-04C6-434F-865C-3E6E50A379B5}&lt;/ProjectGuid&gt;\n    &lt;OutputType&gt;Library&lt;/OutputType&gt;\n    &lt;AppDesignerFolder&gt;Properties&lt;/AppDesignerFolder&gt;\n    &lt;RootNamespace&gt;MyCelesteMod&lt;/RootNamespace&gt;\n    &lt;AssemblyName&gt;MyCelesteMod&lt;/AssemblyName&gt;\n    &lt;TargetFrameworkVersion&gt;v4.5.2&lt;/TargetFrameworkVersion&gt;\n    &lt;FileAlignment&gt;512&lt;/FileAlignment&gt;\n    &lt;Deterministic&gt;true&lt;/Deterministic&gt;\n  &lt;/PropertyGroup&gt;\n  &lt;PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' \"&gt;\n    &lt;DebugSymbols&gt;true&lt;/DebugSymbols&gt;\n    &lt;DebugType&gt;full&lt;/DebugType&gt;\n    &lt;Optimize&gt;false&lt;/Optimize&gt;\n    &lt;OutputPath&gt;bin\\Debug\\&lt;/OutputPath&gt;\n    &lt;DefineConstants&gt;DEBUG;TRACE&lt;/DefineConstants&gt;\n    &lt;ErrorReport&gt;prompt&lt;/ErrorReport&gt;\n    &lt;WarningLevel&gt;4&lt;/WarningLevel&gt;\n  &lt;/PropertyGroup&gt;\n  &lt;PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' \"&gt;\n    &lt;DebugType&gt;pdbonly&lt;/DebugType&gt;\n    &lt;Optimize&gt;true&lt;/Optimize&gt;\n    &lt;OutputPath&gt;bin\\Release\\&lt;/OutputPath&gt;\n    &lt;DefineConstants&gt;TRACE&lt;/DefineConstants&gt;\n    &lt;ErrorReport&gt;prompt&lt;/ErrorReport&gt;\n    &lt;WarningLevel&gt;4&lt;/WarningLevel&gt;\n  &lt;/PropertyGroup&gt;\n  &lt;ItemGroup&gt;\n    &lt;Reference Include=\"Celeste\"&gt;\n      &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\Celeste.exe&lt;/HintPath&gt;\n    &lt;/Reference&gt;\n    &lt;Reference Include=\"FNA\"&gt;\n      &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\FNA.dll&lt;/HintPath&gt;\n    &lt;/Reference&gt;\n    &lt;Reference Include=\"MMHOOK_Celeste\"&gt;\n      &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\MMHOOK_Celeste.dll&lt;/HintPath&gt;\n    &lt;/Reference&gt;\n    &lt;Reference Include=\"YamlDotNet\"&gt;\n      &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\YamlDotNet.dll&lt;/HintPath&gt;\n    &lt;/Reference&gt;\n    &lt;Reference Include=\"System\" /&gt;\n    &lt;Reference Include=\"System.Core\" /&gt;\n    &lt;Reference Include=\"System.Xml.Linq\" /&gt;\n    &lt;Reference Include=\"Microsoft.CSharp\" /&gt;\n    &lt;Reference Include=\"System.Xml\" /&gt;\n  &lt;/ItemGroup&gt;\n  &lt;ItemGroup&gt;\n    &lt;Compile Include=\"MyModModule.cs\" /&gt;\n    &lt;Compile Include=\"Properties\\AssemblyInfo.cs\" /&gt;\n  &lt;/ItemGroup&gt;\n  &lt;Import Project=\"$(MSBuildToolsPath)\\Microsoft.CSharp.targets\" /&gt;\n&lt;/Project&gt;\n</code></pre> <p>Note</p> <p>\u5bf9\u4e8e\u6b64\u90e8\u5206\u7684\u5185\u5bb9\u4f60\u53ef\u80fd\u9700\u8981\u9605\u8bfb\u4e86\u89e3\u4e00\u4e0b XML \u683c\u5f0f\u6587\u4ef6</p> <p>\u5b9e\u9645\u4e0a\u5bf9\u4e8e\u6211\u4eec\u771f\u6b63\u7ecf\u5e38\u4fee\u6539\u7684\u5c5e\u6027\u53ea\u6709\u4e0a\u9762\u6807\u4eae\u7684\u884c, \u90a3\u4e48\u5982\u679c\u8fd9\u65f6\u5019\u4f7f\u7528 <code>Sdk-style csproj</code> \u4f1a\u597d\u5f88\u591a, \u5b83\u770b\u4e0a\u53bb\u662f\u8fd9\u6837\u7684:</p> Sdk-style csproj<pre><code>&lt;Project Sdk=\"Microsoft.NET.Sdk\"&gt;\n\n    &lt;PropertyGroup&gt;\n        &lt;OutputType&gt;Library&lt;/OutputType&gt;\n        &lt;RootNamespace&gt;MyCelesteMod&lt;/RootNamespace&gt;\n        &lt;AssemblyName&gt;MyCelesteMod&lt;/AssemblyName&gt;\n        &lt;TargetFramework&gt;net452&lt;/TargetFramework&gt;\n    &lt;/PropertyGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;Reference Include=\"Celeste\"&gt;\n            &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\Celeste.exe&lt;/HintPath&gt;\n        &lt;/Reference&gt;\n        &lt;Reference Include=\"FNA\"&gt;\n            &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\FNA.dll&lt;/HintPath&gt;\n        &lt;/Reference&gt;\n        &lt;Reference Include=\"MMHOOK_Celeste\"&gt;\n            &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\MMHOOK_Celeste.dll&lt;/HintPath&gt;\n        &lt;/Reference&gt;\n        &lt;Reference Include=\"YamlDotNet\"&gt;\n            &lt;HintPath&gt;..\\..\\..\\..\\..\\..\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\YamlDotNet.dll&lt;/HintPath&gt;\n        &lt;/Reference&gt;\n        &lt;Reference Include=\"System\" /&gt;\n        &lt;Reference Include=\"System.Core\" /&gt;\n        &lt;Reference Include=\"System.Xml.Linq\" /&gt;\n        &lt;Reference Include=\"Microsoft.CSharp\" /&gt;\n        &lt;Reference Include=\"System.Xml\" /&gt;\n    &lt;/ItemGroup&gt;\n\n&lt;/Project&gt;\n</code></pre> <p>\u4f60\u4f1a\u53d1\u73b0\u5176\u5b9e\u8fd9\u91cc\u53ea\u7559\u4e0b\u4e86\u6211\u4eec\u4e0a\u9762\u6807\u9ec4\u7684\u4e1c\u897f, \u662f\u7684, \u8fd9\u5c31\u662f <code>Sdk-style csproj</code> \u7684\u4f18\u70b9. \u8fc1\u79fb\u81f3 <code>Sdk-style csproj</code> \u975e\u5e38\u7b80\u5355, \u4f60\u53ea\u9700\u8981:</p> <ul> <li>\u5220\u9664 <code>PropertyGroup</code> \u548c <code>ItemGroup</code> \u53ca\u65c1\u8fb9\u7684\u975e\u6807\u9ec4\u8282\u70b9</li> <li>\u5220\u9664 <code>Project</code> \u8282\u70b9\u4e0b\u7684\u4e24\u4e2a <code>Import</code></li> <li>\u5220\u9664 <code>Project</code> \u8282\u70b9\u7684\u6240\u6709\u5c5e\u6027</li> <li>\u91cd\u65b0\u5728 <code>Project</code> \u8282\u70b9\u4e0a\u52a0\u5165\u5c5e\u6027: <code>Sdk = \"Microsoft.NET.Sdk\"</code></li> <li><code>TargetFrameworkVersion</code> \u66f4\u6539\u4e3a\u65b0\u7248\u7684 <code>TargetFramework</code>, <code>v4.5.2</code> \u66f4\u6539\u4e3a <code>net452</code></li> </ul> <p>Note</p> <p>\u4e0d\u7528\u62c5\u5fc3\u5220\u6389\u8fd9\u4e48\u591a\u4e1c\u897f\u4f1a\u51fa\u73b0\u95ee\u9898, \u5b9e\u9645\u4e0a\u6211\u4eec\u5220\u6389\u7684\u4e1c\u897f\u53ea\u662f\u5408\u5e76\u5165 <code>Sdk = \"Microsoft.NET.Sdk\"</code> \u8fd9\u4e00\u53e5\u4e86\u800c\u5df2</p> <p>\u8fd9\u4e2a\u65f6\u5019\u6574\u4e2a\u6587\u4ef6\u6e05\u6670\u53ef\u8bfb:</p> <ul> <li>\u6839\u8282\u70b9\u7684 <code>Project</code> \u4e0b\u6302\u8f7d\u7740 <code>PropertyGroup</code> \u4ee5\u53ca <code>ItemGroup</code>,</li> <li><code>PropertyGroup</code> \u63cf\u8ff0\u4e86\u6211\u4eec\u9879\u76ee\u7684\u4e00\u4e9b\u901a\u7528\u5c5e\u6027, \u6bd4\u5982\u8f93\u51fa\u7c7b\u578b, \u547d\u540d\u7a7a\u95f4, \u7a0b\u5e8f\u96c6\u6635\u79f0\u4ee5\u53ca\u9879\u76ee\u6846\u67b6\u7248\u672c,</li> <li><code>ItemGroup</code> \u5219\u63cf\u8ff0\u4e86\u6211\u4eec\u9879\u76ee\u4e2d\u7684\u4e00\u4e9b\u5f15\u7528\u7b49.</li> </ul> <p>\u5728\u8fd9\u91cc\u63d0\u53ca\u8fd9\u4e2a\u662f\u56e0\u4e3a\u5728\u540e\u9762\u90e8\u5206\u6211\u4eec\u4f1a\u9700\u8981\u4fee\u6539 <code>.csproj</code> \u6587\u4ef6, \u901a\u8fc7\u5bf9\u6bd4\u4f60\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e24\u4e2a xml \u6587\u4ef6\u90fd\u6709 <code>PropertyGroup</code> \u548c <code>ItemGroup</code> \u8282\u70b9 (\u5982\u679c\u6709\u591a\u4e2a\u8282\u70b9\u7684\u8bdd, \u4efb\u610f\u4e00\u4e2a\u90fd\u884c), \u6240\u4ee5\u6211\u4eec\u4e4b\u540e\u5bf9\u9879\u76ee\u6587\u4ef6\u7684\u4fee\u6539\u7684\u63cf\u8ff0\u90fd\u4f1a\u57fa\u4e8e\u8fd9\u4e24\u4e2a\u8282\u70b9.</p> <p>Warning</p> <p>\u8bb0\u5f97\u5220\u9664 <code>Properties</code> \u6587\u4ef6\u5939\u91cc\u7684 cs \u6587\u4ef6, \u5b83\u53ef\u80fd\u4f1a\u4e0e sdk-styled csproj \u81ea\u52a8\u751f\u6210\u7684\u6587\u4ef6\u76f8\u51b2\u7a81</p>"},{"location":"basics/celeste_everest_monomod/","title":"Celeste Everest MonoMod","text":""},{"location":"basics/celeste_everest_monomod/#celeste","title":"Celeste","text":"<p>\u989d, \u6765\u8fd9\u91cc\u7684\u5e94\u8be5\u90fd\u77e5\u9053 Celeste \u662f\u4ec0\u4e48\u5427(( \u540e\u6587\u4e2d\u63d0\u5230\u7684 <code>Celeste</code>, <code>\u851a\u84dd</code> \u90fd\u4f1a\u53ea\u6307 Celeste \u8fd9\u4e2a\u6e38\u620f, \u4e5f\u5c31\u662f\u6211\u4eec\u6b63\u5728\u5b66\u4e60\u7684\u4e3a\u5176\u5236\u4f5c mod \u7684\u5bf9\u8c61.</p>"},{"location":"basics/celeste_everest_monomod/#everest","title":"Everest","text":"<p>\u4f5c\u4e3a\u4e00\u4e2a\u851a\u84dd\u7684 mod \u73a9\u5bb6, \u5b89\u88c5 Everest \u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u6b65\u9aa4, \u56e0\u4e3a\u6211\u4eec\u7684 mod \u4f9d\u8d56\u4e8e\u5b83\u6240\u63d0\u4f9b\u7684\u5236\u4f5c mod \u4e2d\u6240\u5fc5\u987b\u7684\u4e1c\u897f. \u5b83\u5f00\u6e90\u5728 Github \u4e0a. \u53ef\u80fd\u4f60\u8fd8\u542c\u8fc7 Olympus, \u5b83\u662f\u4e00\u4e2a Everest \u7684\u5b89\u88c5\u5668, \u4e5f\u662f\u4e00\u4e2a mod \u7ba1\u7406\u5668.</p> <p>\u5982\u679c\u4f60\u8fd8\u73a9\u8fc7 Minecraft \u7684\u8bdd\u6211\u4eec\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u8fd9\u6837\u7684\u5947\u5999\u5173\u7cfb:</p> \u851a\u84dd\u4fa7 MC\u4fa7 Celeste Minecraft Everest Forge/Fabric Olympus/CeleMod PCL2/HCML <p>\u989d\u5916\u5730, Everest, Forge, Fabric \u8fd9\u4e00\u7c7b\u4e1c\u897f\u6211\u4eec\u5bf9\u5176\u6709\u4e2a\u7edf\u79f0, \u53eb\u505a <code>ModApi</code>. \u5c31\u50cf Celeste \u548c Minecraft \u88ab\u7edf\u79f0\u4e3a\u6e38\u620f\u672c\u4f53/\u539f\u7248.</p>"},{"location":"basics/celeste_everest_monomod/#everest_1","title":"\u4e3a\u4ec0\u4e48\u9700\u8981Everest","text":""},{"location":"basics/celeste_everest_monomod/#monomod","title":"MonoMod","text":"<p>Everest \u5e95\u5c42\u57fa\u4e8e MonoMod, \u5728\u8fd9\u91cc\u4f60\u53ea\u9700\u8981\u77e5\u9053 Everest \u4f9d\u8d56\u4e86 MonoMod, \u540c\u6837\u5730\u5b83\u4e5f\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee(Github). \u6709\u8da3\u7684\u662f, Everest \u7684\u4e3b\u8981\u7ef4\u62a4\u8005\u4e4b\u4e00\u4e5f\u662f MonoMod \u7684\u4e3b\u8981\u7ef4\u62a4\u8005, \u540c\u65f6 MonoMod \u4e5f\u662f\u4e00\u4e9b\u5176\u4ed6\u6e38\u620f\u7684 mod \u5e95\u5c42, \u6bd4\u5982 Terraria \u7684 tModLoader, Fez \u7684 FEZMod \u7b49\u7b49.</p>"},{"location":"basics/ec_common/","title":"\u66f4\u591a EC","text":"<p>\u90a3\u4e48\u7ecf\u8fc7\u524d\u9762\u7684\u9605\u8bfb, \u76f8\u4fe1\u4f60\u5df2\u7ecf\u4e86\u89e3\u5230\u4e86\u4e00\u4e9b\u5f88\u5f88\u5f88\u57fa\u672c\u7684\u77e5\u8bc6, \u90a3\u4e48\u4ece\u8fd9\u4e00\u7ae0\u5f00\u59cb\u5c31\u662f\u4e00\u4e9b\u96f6\u788e\u4e14\u6742\u4e71\u7684\u4e1c\u897f\u4e86. \u987a\u4fbf\u6240\u4ee5, \u6211\u8fd8\u662f\u5f88\u5efa\u8bae\u4f60\u53bb\u591a\u9605\u8bfb\u4e00\u4e0b\u539f\u7248\u7684\u4ee3\u7801\u4ee5\u53ca\u4e00\u4e9b\u5e38\u89c1\u7b80\u5355Helper\u7684\u6e90\u7801, \u6bd5\u7adf\u6211\u81ea\u5df1\u90fd\u4e0d\u77e5\u9053\u6211\u9700\u8981\u5728\u8fd9\u91cc\u8bf4\u4e9b\u4ec0\u4e48(</p> <p>_(:\u0437\u300d\u2220)_</p> <p>_(:\u0437\u300d\u2220)_ \u6446\u70c2\u4e86\u8fd9\u8282\u53ef\u80fd\u4f1a\u5f88\u4e0d\u660e\u6240\u4ee5(</p>"},{"location":"basics/ec_common/#_1","title":"\u751f\u547d\u5468\u671f","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u5230\u4e86 <code>Update</code> \u51fd\u6570\u548c <code>Render</code> \u51fd\u6570, <code>Update</code> \u4e0e <code>Render</code> \u6bcf\u5e27\u90fd\u4f1a\u88ab\u8c03\u7528, \u5bf9\u4e8e\u903b\u8f91\u7684\u66f4\u65b0\u6211\u4eec\u5e94\u5728 <code>Update</code> \u4e2d\u505a, \u800c\u6709\u5173\u7ed8\u5236\u7684\u4efb\u52a1\u6211\u4eec\u5e94\u8be5\u5728 <code>Render</code> \u4e2d\u505a, \u8fd9\u662f\u56e0\u4e3a\u5373\u4f7f\u4f60\u5728 <code>Update</code> \u4e2d\u8fdb\u884c\u4e86\u7ed8\u5236\u7684\u8c03\u7528, \u5728 <code>Render</code> \u5f00\u59cb\u4e4b\u524d\u4e5f\u4f1a\u88ab\u851a\u84dd\u6e05\u7a7a. \u7c7b\u4f3c\u5730, \u6e38\u620f\u4e2d\u7684\u6682\u505c\u7684\u5b9e\u73b0\u539f\u7406\u662f\u505c\u6b62\u6bcf\u5e27 <code>Update</code> \u7684\u8c03\u7528\u800c\u4fdd\u7559 <code>Render</code> \u7684\u8c03\u7528, \u90a3\u4e48\u81ea\u7136\u5982\u679c\u4f60\u5728 <code>Render</code> \u91cc\u8fdb\u884c\u903b\u8f91\u66f4\u65b0\u4f60\u4f1a\u7834\u574f\u6389\u6e38\u620f\u539f\u6709\u7684\u6682\u505c.  </p> <p>ok\u90a3\u4e48\u6211\u4eec balabala \u8bf4\u4e86\u4e00\u5927\u5806, \u63a5\u4e0b\u6765\u4ecb\u7ecd\u51e0\u4e2a\u4f1a\u88ab\u851a\u84dd\u8c03\u7528\u7684\u51fd\u6570, \u8fd9\u4e9b\u51fd\u6570\u4e5f\u53eb\u505a<code>\u751f\u547d\u5468\u671f</code>\u51fd\u6570.</p>"},{"location":"basics/ec_common/#entity","title":"\u5bf9\u4e8e Entity","text":"<ul> <li><code>Update</code></li> <li><code>Render</code></li> <li><code>DebugRender</code>: \u8be5\u51fd\u6570\u4f1a\u5728\u851a\u84dd\u8c03\u8bd5\u63a7\u5236\u53f0\u88ab\u6253\u5f00\u65f6\u88ab\u6bcf\u5e27\u88ab\u8c03\u7528\u4f5c\u4e3a debug \u6e32\u67d3, \u5373 everest \u9ed8\u8ba4 ~ \u952e\u6253\u5f00\u7684\u90a3\u4e2a, \u5b83\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u7ed8\u5236\u8be5\u5b9e\u4f53\u7684\u78b0\u649e\u7bb1, \u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u505a\u4e00\u4e9b\u8c03\u8bd5\u7528\u7684\u6807\u8bc6\u7684\u7ed8\u5236, \u5c31\u6bd4\u5982\u8bf4\u4f60\u7684\u5b9e\u4f53\u7684\u4f5c\u7528\u8303\u56f4\u4ec0\u4e48\u7684.</li> <li><code>Added</code>: \u5f53\u8be5\u5b9e\u4f53\u88ab\u4ee5 <code>Scene.Add</code> \u51fd\u6570\u8c03\u7528\u52a0\u5165\u5230\u573a\u666f\u4e0a\u65f6\u8c03\u7528, \u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u8bfb\u53d6\u573a\u666f\u7684\u4e00\u4e9b\u72b6\u6001\u6216\u8005 flag \u4e4b\u7c7b\u7684\u5e76\u66f4\u6539\u5b83\u7684\u884c\u4e3a.</li> <li><code>Awake</code>: \u8be5\u51fd\u6570\u4e0e <code>Added</code> \u884c\u4e3a\u76f8\u540c, \u4f46\u662f\u5f53\u4e00\u5e27\u4e4b\u5185\u6709\u591a\u4e2a\u5b9e\u4f53\u88ab\u52a0\u5165\u573a\u666f\u65f6\u5b83\u4eec\u7684 <code>Awake</code> \u4f1a\u5728\u8fd9\u4e9b\u5b9e\u4f53\u90fd\u88ab\u52a0\u5165\u540e\u518d\u6279\u91cf\u8c03\u7528, \u800c <code>Added</code> \u5219\u662f\u52a0\u5165\u4e00\u4e2a\u5c31\u8c03\u7528\u4e00\u4e2a. \u4e00\u4e2a\u5f88\u597d\u7684\u5728\u5b98\u56fe\u4e2d\u8fd0\u7528\u7684\u4f8b\u5b50\u662f\u6d6e\u52a8\u5757\u7684\u8fde\u63a5, \u8fd9\u662f\u5728\u573a\u666f\u5f00\u59cb\u65f6\u505a\u7684, \u4e3a\u4e86\u9632\u6b62\u9057\u6f0f\u67d0\u4e9b\u6d6e\u52a8\u5757\u95f4\u7684\u8fde\u63a5\u5c31\u9700\u8981\u5728\u5b9e\u4f53\u90fd\u88ab\u52a0\u5165\u540e\u518d\u8c03\u7528.</li> <li><code>Removed</code>: \u5f53\u8be5\u5b9e\u4f53\u88ab\u4ee5 <code>Scene.Remove</code> \u51fd\u6570\u8c03\u7528\u79fb\u9664\u573a\u666f\u65f6\u8c03\u7528, \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u53d6\u6d88\u4e00\u4e9b\u5b9e\u4f53\u5bf9\u573a\u666f\u7684\u4e00\u4e9b\u4f5c\u7528, \u6bd4\u5982\u8bf4\u80cc\u666f\u7684\u53d8\u5316.</li> <li><code>SceneBegin</code>: \u5f53\u573a\u666f\u88ab\u8c03\u7528 <code>Scene.Begin</code> \u7684\u540c\u65f6\u8c03\u7528</li> <li><code>SceneEnd</code>: \u5f53\u573a\u666f\u88ab\u8c03\u7528 <code>Scene.End</code> \u7684\u540c\u65f6\u8c03\u7528</li> </ul>"},{"location":"basics/ec_common/#component","title":"\u5bf9\u4e8e Component","text":"<p>\u5bf9\u4e8e Component \u6765\u8bf4\u5927\u90e8\u5206\u51fd\u6570\u4e0e Entity \u7684\u7c7b\u4f3c, \u53ea\u4e0d\u8fc7\u540d\u5b57\u524d\u52a0\u4e2a\u4e86 Entity. \u6bd4\u5982\u5b9e\u4f53\u7684 <code>Awake</code> \u5bf9\u5e94 Component \u7684 <code>EntityAwake</code>, \u901a\u5e38\u8fd9\u4e9b\u51fd\u6570\u88ab\u8c03\u7528\u7684\u5730\u65b9\u662f\u5bf9\u5e94\u7684 Entity \u7684\u751f\u547d\u5468\u671f\u51fd\u6570\u7684\u9ed8\u8ba4\u5b9e\u73b0, \u6240\u4ee5\u9664\u975e\u6709\u610f\u800c\u4e3a\u4e4b\u8bb0\u5f97\u5728\u5f00\u5934\u8c03\u7528\u57fa\u7c7b\u7684\u751f\u547d\u5468\u671f\u5b9e\u73b0: MyInterestingEntity.cs<pre><code>public override void Awake()\n{\n    // ensure `Awake`s of its components has been called\n    base.Awake();\n    // do other thing...\n}\n</code></pre></p>"},{"location":"basics/ec_common/#scene","title":"\u5bf9\u4e8e Scene","text":"<p>\u55ef... \u5bf9\u5e94 Scene \u7684\u4e00\u4e9b\u751f\u547d\u5468\u671f\u51fd\u6570\u6211\u4e2a\u4eba\u4e5f\u4e0d\u662f\u5f88\u4e86\u89e3\u6bd5\u7adf\u6211\u4eec\u5927\u90e8\u5206\u7684\u65f6\u95f4\u90fd\u5728 gameplay \u7684\u573a\u666f\u4e0a, \u6240\u4ee5\u8fd9\u8282\u5c31\u6682\u65f6\u5495\u4e86(._.)</p>"},{"location":"basics/ec_common/#_2","title":"\u5e38\u89c1\u7684\u65b9\u6cd5\u4e0e\u5c5e\u6027","text":"<ul> <li><code>Scene.Add</code>: \u5c06\u4e00\u4e2a\u5b9e\u4f53\u52a0\u5165\u5230\u573a\u666f\u4e2d</li> <li><code>Entity.Add</code>: \u5c06\u4e00\u4e2a Component \u6302\u8f7d\u5230\u5b9e\u4f53\u4e0a</li> <li><code>Scene.Remove</code>: \u5c06\u4e00\u4e2a\u5b9e\u4f53\u79fb\u51fa\u573a\u666f</li> <li><code>Entity.Remove</code>: \u5c06\u4e00\u4e2a Component \u79fb\u51fa\u5b9e\u4f53</li> <li><code>Entity.RemoveSelf</code>: \u5c06 Entity \u81ea\u8eab\u79fb\u51fa\u81ea\u8eab\u6240\u5728\u573a\u666f</li> <li><code>Component.RemoveSelf</code>: \u5c06 Component \u81ea\u8eab\u79fb\u51fa\u6240\u5728\u5b9e\u4f53</li> <li><code>Scene.Entities</code>: \u83b7\u53d6\u5f53\u524d\u573a\u666f\u4e0a\u7684\u5b9e\u4f53\u5217\u8868</li> <li><code>Entity.Components</code>: \u83b7\u53d6\u5f53\u524d\u5b9e\u4f53\u7684 Component \u5217\u8868</li> </ul>"},{"location":"basics/ec_common/#entity_1","title":"Entity","text":"<p><code>Entity</code> \u672c\u8eab\u6709\u56db\u4e2a\u516c\u5f00\u7684\u5b57\u6bb5:</p> <ul> <li><code>Active</code>, \u8be5 <code>bool</code> \u5b57\u6bb5\u8868\u793a\u8be5 <code>Entity</code> \u662f\u5426 \"\u5b58\u6d3b\", \u5426\u5219\u4e3a \"\u5931\u6d3b\", \"\u5931\u6d3b\" \u7684 <code>Entity</code> \u5c06\u4e0d\u4f1a\u88ab\u8c03\u7528 <code>Update</code> \u65b9\u6cd5\u76f4\u5230 <code>Active</code> \u4e3a <code>true</code></li> <li><code>Collidable</code>, \u8be5 <code>bool</code> \u5b57\u6bb5\u8868\u793a\u8be5 <code>Entity</code> \u662f\u5426 \"\u53ef\u78b0\u649e\", \u4e0d\u53ef\u78b0\u649e\u7684\u5b9e\u4f53\u4e0e\u4efb\u4f55\u5b9e\u4f53\u8fdb\u884c\u78b0\u649e\u68c0\u6d4b\u65f6\u90fd\u4f1a\u8fd4\u56de <code>false</code>, \u6240\u4ee5\u4f60\u53ef\u4ee5\u5c06\u5b83\u8bbe\u4e3a<code>false</code>\u6765\u7981\u7528\u5b83\u7684\u78b0\u649e\u7bb1</li> <li><code>Visible</code>, \u8be5 <code>bool</code> \u5b57\u6bb5\u8868\u793a\u8be5 <code>Entity</code> \u662f\u5426 \"\u53ef\u89c1\", \u4e0d\u53ef\u89c1\u7684\u5b9e\u4f53\u4e0d\u4f1a\u88ab\u8c03\u7528 <code>Render</code> \u65b9\u6cd5, \u6ce8\u610f\u5373\u4f7f\u4e0d\u53ef\u89c1\u5b83\u7684\u78b0\u649e\u7bb1\u4f9d\u7136\u5b58\u5728.</li> <li><code>Position</code>, \u8be5 <code>Vector2</code> \u5b57\u6bb5\u8868\u793a\u8be5 <code>Entity</code> \u7684\u4f4d\u7f6e, \u6ce8\u610f\u8fd9\u4e2a\u4f4d\u7f6e\u76f8\u5bf9\u7684\u5750\u6807\u7cfb\u662f\u4e0d\u540c\u7684, \u5bf9\u4e8e HUD \u5b9e\u4f53\u6765\u8bf4\u5b83\u7684\u5750\u6807\u7cfb\u662f\u4e00\u4e2a 1922 x 1092 \u7684\u539f\u70b9\u5de6\u4e0a\u89d2\u7684\u5c4f\u5e55\u5750\u6807, \u5bf9\u4e8e gameplay \u5b9e\u4f53\u6765\u8bf4\u5b83\u662f\u76f8\u5bf9\u4e8e\u4e16\u754c\u539f\u70b9\u7684\u5206\u5ea6\u503c\u4e3a 1px \u7684\u5750\u6807. \u8fd9\u4e2a\u884c\u4e3a\u53ef\u4ee5\u901a\u8fc7\u540e\u9762\u6240\u8bf4\u7684 <code>Tag</code> \u6765\u914d\u7f6e.</li> </ul>"},{"location":"basics/ec_common/#tag","title":"Tag","text":"<p>:thinking: \u9664\u6b64\u4e4b\u5916\u5462\u8fd8\u6709\u4e00\u4e2a\u5c0f\u4e1c\u897f\u53eb <code>Tag</code>, \u8bed\u4e49\u4e0a\u6765\u8bf4\u5b83\u8868\u793a\u8fd9\u4e2a\u5b9e\u4f53\u7684\u4e00\u4e9b\u6807\u7b7e\u5c5e\u6027, \u4f60\u53ef\u4ee5\u901a\u8fc7 <code>Entity.Tag</code> \u5c5e\u6027\u6765\u8bbf\u95ee\u5b83, \u5b83\u662f\u4e00\u4e2a 32 \u4f4d\u6574\u6570, \u5b83\u7684\u6bcf\u4e00\u4f4d\u8868\u793a\u4e00\u4e2a\u8be5\u5b9e\u4f53\u7684\"\u5c5e\u6027\", \u6211\u4eec\u901a\u5e38\u4f1a\u4f7f\u7528 <code>AddTag</code> \u4ee5\u53ca <code>RemoveTag</code> \u6765\u64cd\u4f5c\u5b83. \u8981\u83b7\u53d6\u573a\u666f\u4e2d\u6240\u6709\u62e5\u6709\u67d0\u4e00 <code>Tag</code> \u7684\u5b9e\u4f53, \u6211\u4eec\u9700\u8981\u8bbf\u95ee <code>Scene</code> \u7684 <code>TagLists</code> \u800c\u4e0d\u662f <code>Tracker</code>, \u7136\u540e\u4f7f\u7528\u5b83\u7684\u7d22\u5f15\u5668(\u5f62\u5982 <code>tagList[yourtag]</code> \u7684\u8fd0\u7b97\u7b26)\u6765\u68c0\u7d22, \u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7b80\u4fbf\u7684\u65b9\u6cd5---\u76f4\u63a5\u8bbf\u95ee <code>Scene</code> \u7684\u7d22\u5f15\u5668. \u4e00\u822c\u7684\u8bdd, \u6211\u5bf9\u4e8e <code>Tag</code> \u7684\u5e94\u7528\u5f88\u5c11, \u6700\u8fd1\u4e00\u6b21\u662f\u5c06\u4e00\u4e2a <code>Entity</code> \u6807\u8bb0\u4e3a ui \u5c42, \u5b83\u7684\u4ee3\u7801\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684: <pre><code>this.AddTag(Tags.HUD);\n</code></pre> \u5f53\u4f60\u7684\u5b9e\u4f53\u62e5\u6709\u8fd9\u4e2a Tag \u540e, \u851a\u84dd\u4f1a\u5c06\u4f60\u7684\u5b9e\u4f53\u7ed8\u5236\u5728 ui \u5c42, \u6bd4\u8f83\u5e38\u89c1\u7684\u4f8b\u5b50\u5c31\u662f\u5de6\u4e0a\u89d2\u7684\u8ba1\u65f6\u5668, \u5b83\u5728\u6784\u9020\u5668\u5185\u5c31\u7ed9\u81ea\u5df1\u6253\u4e0a\u4e86 <code>Tags.HUD</code> \u7684\u6807\u7b7e. \u4e5f\u5982\u4e0a\u9762\u6240\u8bf4\u7684, \u4e00\u4e9b\u851a\u84dd\u5e38\u89c1\u7684\u6240\u6709 Tag \u4f60\u90fd\u53ef\u4ee5\u5728 <code>Celeste.Tags</code> \u7c7b\u5185\u627e\u5230.</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u53ef\u80fd\u5730\u5e38\u89c1\u7684 Tag:(\u5df2\u8fc1\u79fb)</p> <ul> <li><code>PauseUpdate</code>: \u662f\u5426\u5728\u6682\u505c\u671f\u95f4\u4f9d\u7136\u88ab\u8c03\u7528 <code>Update</code>, \u901a\u5e38\u7528\u4e8e ui \u5c42\u7684\u5b9e\u4f53\u4e0a</li> <li><code>FrozenUpdate</code>: \u662f\u5426\u5728 <code>Frozen</code> \u72b6\u6001\u4e0b\u4f9d\u7136\u88ab\u8c03\u7528 <code>Update</code> (\u6bd4\u5982\u8349\u8393\u7c7d\u52a8\u753b\u8fc7\u7a0b, 1a\u84dd\u5fc3\u89e3\u5bc6\u6210\u529f\u8fc7\u7a0b, \u6ce8\u610f\u6b64\u72b6\u6001\u4e0e\u51bb\u7ed3\u5e27\u65e0\u5173)</li> <li><code>TransitionUpdate</code>: \u662f\u5426\u5728\u5173\u5361\u5207\u677f\u65f6\u4f9d\u7136\u88ab\u8c03\u7528 <code>Update</code>, \u901a\u5e38\u7528\u4e8e\u5728\u5207\u677f\u65f6\u66f4\u65b0\u4e00\u4e9b\u89c6\u89c9\u4e0a\u7684\u4e1c\u897f(\u6bd4\u5982\u7535\u7f51\u7684 \"\u653e\u7535\" \u52a8\u753b\u4e0d\u4f1a\u5728\u5207\u677f\u65f6\u9759\u6b62)</li> <li><code>HUD</code>: \u5373\u662f\u5426\u662f ui \u5c42, \u6b64\u9879\u4f1a\u6539\u53d8 <code>Entity.Render</code> \u7684\u7ed8\u5236\u903b\u8f91, \u4f7f\u7ed8\u5236\u5750\u6807\u57fa\u4e8e\u5c4f\u5e55\u5750\u6807\u800c\u4e0d\u662f\u4e16\u754c\u5750\u6807</li> <li><code>Global</code>: \u8be5 Entity \u662f\u5426\u662f\u5168\u5c40\u7684, \u4e00\u4e2a\u975e\u5168\u5c40\u5b9e\u4f53\u5728\u5173\u5361\u91cd\u8bd5\u540e\u4f1a\u6d88\u5931, \u5168\u5c40 Tag \u53ef\u4ee5\u907f\u514d\u8fd9\u4ef6\u4e8b, \u901a\u5e38\u5168\u5c40 Tag \u6700\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u548c HUD \u7ed3\u5408\u5728\u4e00\u8d77, \u8fd9\u6837\u4f60\u5c31\u62e5\u6709\u4e86\u4e00\u4e2a\u5728\u6e38\u620f\u5185\u6301\u4e45\u7684 ui \u90e8\u4ef6\u4e86.</li> </ul>"},{"location":"basics/flag_tag_tracker/","title":"Flag, Tag, Tracker","text":""},{"location":"basics/flag_tag_tracker/#flag","title":"Flag","text":"<p>\u5728<code>Session</code>\u7c7b\u4e2d\u6709\u4e2a<code>HashSet&lt;string&gt; Flags</code>\u5b57\u6bb5, \u91cc\u9762\u5b58\u50a8\u4e86\u5f53\u524d\u6e38\u620f\u4e2d\u6fc0\u6d3b\u7684\u6240\u6709flag, \u4e00\u4e2aflag\u5bf9\u5e94\u5f00/\u5173(\u5728/\u4e0d\u5728\u54c8\u5e0c\u8868\u91cc)\u4e24\u79cd\u72b6\u6001, \u7c7b\u4f3cMC\u4e2d\u7684\u62c9\u6746</p> <p>\u90a3\u4e48\u5b83\u80fd\u505a\u4ec0\u4e48\u5462</p> <p>\u6bd4\u5982\u5f53\u4f60\u505a\u4e86\u4e00\u4e2a\u9677\u9631\u5b9e\u4f53, \u90a3\u4f60\u80af\u5b9a\u8fd8\u5f97\u5199\u4e2atrigger\u53bb\u89e6\u53d1\u8fd9\u4e2a\u9677\u9631\u5427, \u90a3\u5982\u679c\u73a9\u5bb6\u60f3\u8981trigger\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u89e6\u53d1\u67d0\u4e9b\u9677\u9631, \u4f60\u662f\u4e0d\u662f\u4e0d\u4ec5\u5f97\u8003\u8651\u914d\u5bf9\u7684\u95ee\u9898, \u8fd8\u5f97\u8003\u8651\u5404\u79cd\u6761\u4ef6, \u4e00\u4e0b\u5b50\u5c31\u5934\u5927\u4e86?</p> <p>\u6b64\u65f6\u5982\u679c\u4f60\u5199\u7684\u662f\u9677\u9631\u5b9e\u4f53(with flag), \u90a3\u4e48\u4f60\u5c31\u4ec0\u4e48\u90fd\u4e0d\u7528\u7ba1\u4e86, \u56e0\u4e3a\u6839\u636e\u6761\u4ef6\u89e6\u53d1flag\u8fd9\u4e8bTrigger Trigger(\u53e6\u4e00\u4e2ahelper\u91cc\u7684trigger)\u5df2\u7ecf\u505a\u4e86, \u6240\u4ee5\u4f60\u53ea\u8981\u53d1\u73b0\u6709\u8fd9\u4e2aflag\u5c31\u542f\u52a8\u9677\u9631\u5373\u53ef, \u662f\u4e0d\u662f\u5f88\u65b9\u4fbf, \u800c\u4e14\u8fd9\u4e5f\u964d\u4f4e\u4e86mapper\u5b66\u4e60\u4f60\u7684\u5b9e\u4f53\u7684\u6210\u672c</p>"},{"location":"basics/flag_tag_tracker/#tagbittag","title":"Tag(BitTag)","text":"<p>\u7b80\u5355\u7406\u89e3</p> <ul> <li><code>Global</code>: \u6c38\u4e45\u4fdd\u7559(\u6b7b\u4ea1\u4e0d\u9500\u6bc1)</li> <li><code>Persistent</code>: \u5207\u677f\u4fdd\u7559(\u6b7b\u4ea1\u9500\u6bc1)</li> <li><code>HUD</code>: \u753bUI\u7684,\u5207\u677f\u540e\u9500\u6bc1</li> <li><code>TransitionUpdate</code>: \u5207\u677f\u8fc7\u7a0b\u7ee7\u7eed\u66f4\u65b0(\u6216\u8005\u8bf4\u65f6\u95f4\u6d41\u901f\u6b63\u5e38), \u5207\u677f\u540e\u9500\u6bc1</li> <li><code>FrozenUpdate</code>: \u5728 Frozen \u72b6\u6001\u4e0b\u8fd8\u80fd\u66f4\u65b0\u7684\u5b9e\u4f53</li> <li><code>PauseUpdate</code>: \u5728 Pause \u72b6\u6001\u4e0b\u8fd8\u80fd\u66f4\u65b0\u7684\u5b9e\u4f53</li> </ul> <p>Note</p> <p>\u6ce8\u610f\u6709\u4e9b\u6807\u7b7e\u53ea\u662f\u6682\u65f6\u4f7f\u7528, \u6240\u4ee5\u6211\u4e00\u822c\u4f1a\u7528\"xxx\u7684\u65f6\u5019\"\u6765\u63cf\u8ff0, \u5217\u51fa\u6765\u7684\u5b9e\u4f53\u4e5f\u4ec5\u4ec5\u662f\u8ddf\u8fd9\u4e2a\u6807\u7b7e\u6709\u5173, \u7531\u4e8e\u5b9e\u4f53\u5f88\u591a\u5f88\u6742\u4f1a\u6709\u758f\u6f0f, \u5982\u679c\u4f60\u89c9\u5f97\u54ea\u91cc\u4e0d\u5bf9\u6216\u8005\u611f\u5174\u8da3, \u76f4\u63a5\u53bb\u770b\u4ee3\u7801\u5c31\u597d\u4e86</p>"},{"location":"basics/flag_tag_tracker/#global","title":"Global","text":"<p>\u8868\u793a\u8be5 Entity \u662f\u5426\u662f\u5168\u5c40\u7684, \u4e00\u4e2a\u975e\u5168\u5c40\u5b9e\u4f53\u5728\u5173\u5361\u91cd\u8bd5\u540e\u4f1a\u6d88\u5931, \u5168\u5c40 Tag \u53ef\u4ee5\u907f\u514d\u8fd9\u4ef6\u4e8b, \u901a\u5e38\u5168\u5c40 Tag \u6700\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u548c HUD \u7ed3\u5408\u5728\u4e00\u8d77, \u8fd9\u6837\u4f60\u5c31\u62e5\u6709\u4e86\u4e00\u4e2a\u5728\u6e38\u620f\u5185\u6301\u4e45\u7684 ui \u90e8\u4ef6\u4e86</p> <p>Note</p> <p>\u7531\u4e8e\u672c\u8d28\u4e0a\u53ea\u662f\u5728\u8be5\u5378\u8f7d\u7684\u65f6\u5019\u53d6\u6d88\u5378\u8f7d, \u6240\u4ee5\u5982\u679c\u518d\u6b21\u52a0\u8f7d\u573a\u666f, \u5bf9\u8c61\u4f9d\u65e7\u4f1a\u88abnew\u4e00\u4e2a, \u6240\u4ee5\u8981\u4e48\u662f\u5728new\u7684\u65f6\u5019\u903b\u8f91\u4e0a\u5224\u65ad(\u53c2\u8003<code>CassetteBlockManager</code>)\u4ee5\u6d88\u9664\u9519\u8bef(\u6709\u70b9\u5355\u4f8b\u7684\u611f\u89c9), \u8981\u4e48\u662f\u7528\u4ee3\u7801\u5728Scene\u4e0a\u624b\u52a8\u6dfb\u52a0\u4e00\u4e2a\u7c7b\u4f3cManager\u7684\u4e1c\u897f, \u7531\u4e8e\u5176\u4ed6\u573a\u666f\u539f\u5148\u6ca1\u6709\u6446\u653e\u4f60\u8fd9\u4e2a\u5bf9\u8c61, \u81ea\u7136\u4e5f\u4e0d\u4f1a\u88ab\u52a0\u8f7d\u591a\u6b21</p> \u4f8b\u5982 <ul> <li>\u80cc\u666f\u7816<code>BackgroundTiles</code></li> <li>\u8282\u594f\u5757\u7ba1\u7406\u5668<code>CassetteBlockManager</code>(\u4f60\u4f1a\u53d1\u73b0\u8282\u594f\u9762\u91cd\u751f\u540e\u8f74\u6709\u70b9\u602a, \u56e0\u4e3amanager\u4e0d\u4f1areset)</li> <li>4a\u73a9\u5bb6\u88ab\u955c\u5b50\u5438\u5165\u7684cutscene<code>CS04_MirrorPortal</code>(\u56e0\u4e3a\u80cc\u666f\u662f\u4e2a\u9ed1\u573a\u8fc7\u6e21, \u73a9\u5bb6\u53c8\u4f20\u9001\u4e86(\u6216\u8005\u8bf4\u5728\u53e6\u4e00\u4e2aroom\u91cd\u751f\u4e86), \u6240\u4ee5\u8981\u7528global\u6807\u7b7e\u624d\u80fd\u4fdd\u6301fadeout)</li> <li>7a\u7ed3\u5c3e\u7684cutscene(\u540c\u4e0a)<code>CS07_Credits</code></li> <li>\u88ab<code>DetachStrawberryTrigger</code>(\u5982\u679cGlobal\u5c5e\u6027\u5f00\u4e86\u7684\u8bdd)\u4f5c\u7528\u7684<code>Follower</code></li> <li>\u4e3a\u7164\u7403\u7ed8\u5236\u63cf\u8fb9\u7684<code>DustEdges</code></li> <li>6a\u4e0b\u843d\u9762\u7684\u901f\u5ea6\u7ebf<code>FallEffects</code></li> <li>\u5403\u5fc3\u5f39\u51fapoem\u540e\u5e95\u4e0b\u7684\u9ed1\u8272panel<code>FormationBackdrop</code></li> <li>Pause\u754c\u9762\u4e0b\u65b9\u7684\u8349\u8393\u8bb0\u5f55 <code>GameplayStats</code></li> <li>\u4f5c\u7528\u4e8e<code>GlassBlock</code>\u7684<code>GlassBlockBg</code>(\u5b98\u56fe\u597d\u50cf`\u6ca1\u51fa\u73b0\u8fc7)</li> <li>Grab\u6a21\u5f0f\u4e3aToggle\u7684\u65f6\u5019\u7684\u8f85\u52a9\u663e\u793a\u5bf9\u8c61<code>GrabbyIcon</code></li> <li>\u4f1a\u5728\u7b2c8\u7ae0cold\u6a21\u5f0f\u4e0b\u5728core\u524d\u666f\u7816\u4e0a\u9644\u4e0a\u51b0\u971c\u7684<code>IceTileOverlay</code></li> <li>\u7ed8\u5236\u7535\u7f51\u91cc\u7684\u95ea\u7535<code>LightningRenderer</code></li> <li>\u7ed8\u5236\u955c\u5b50\u4e0a\u7684\u753b\u9762<code>MirrorSurfaces</code></li> <li>3a\u548cTheo\u5bf9\u8bdd\u5b8c\u540eTheo\u722c\u8fdb\u7ba1\u9053\u540e\u53ef\u4ee5\u5728\u9694\u58c1\u770b\u89c1<code>NPC03_Theo_Escaping</code></li> <li><code>OldSiteChaseMusicHandler</code></li> <li>\u51b2\u523a\u8f85\u52a9\u6307\u793a\u5668<code>PlayerDashAssist</code></li> <li>\u4fdd\u5b58\u5e76\u9000\u51fa\u65f6\u53f3\u4e0b\u89d2\u7684Icon<code>SaveLoadIcon</code></li> <li>\u7ba1\u7406Barrier\u7684\u5916\u90e8\u6e32\u67d3(\u91cc\u9762\u7c92\u5b50\u662fBarrier\u81ea\u5df1\u7684)<code>SeekerBarrierRenderer</code></li> <li>\u65b0\u6d6a\u5728\u7684\u65f6\u5019RGB\u5206\u79bb\u6548\u679c<code>SeekerEffectsController</code></li> <li>\u524d\u666f\u7816<code>SolidTiles</code></li> <li>\u8ba1\u65f6\u5668<code>SpeedrunTimerDisplay</code></li> <li><code>TempleEndingMusicHandler</code></li> <li>\u8349\u8393\u8ba1\u6570<code>TotalStrawberriesDisplay</code></li> <li>\u6b8b\u5f71<code>TrailManager</code>\u548c<code>TrailManager.Snapshot</code></li> </ul>"},{"location":"basics/flag_tag_tracker/#persistent","title":"Persistent","text":"<p>\u8868\u793a\u9700\u8981\u6301\u4e45\u5316\u5728\u573a, \u5207\u677f\u4e0d\u5378\u8f7d\u7684\u5b9e\u4f53, \u6b7b\u4ea1\u4f1a\u5378\u8f7d, \u4e00\u822c\u5728<code>Coroutine</code>(\u8fc7\u573a/\u52a8\u753b\u7b49)\u91cc\u7528\u6765\u6682\u65f6\u4fdd\u5b58\u4e0b\u72b6\u6001, \u6216\u8005\u662f\u50cfTheo\u8fd9\u79cd\u5f97\u8ba9\u4eba\u80cc\u7740\u7684</p> \u4f8b\u5982 <ul> <li><code>birdNPC</code>\u6700\u540e\u4e00\u6b21\u98de\u8d70\u7684\u65f6\u5019</li> <li><code>Booster</code>\u628aplayer\u5410\u51fa\u5207\u677f\u7684\u65f6\u5019</li> <li>\u649e\u788e<code>DashBlock</code>\u6389\u843d\u7684<code>Debris</code></li> <li>\u6240\u6709\u88ab<code>DetachStrawberryTrigger</code>(\u5e26\u91d1\u8349\u8393\u7684\u6708\u6885\u9762\u4f1a\u7528\u5230)\u89e3\u7ed1\u7684<code>Follower</code></li> <li>\u6240\u6709\u88ab\u73a9\u5bb6\u62fe\u8d77\u7684<code>Follower</code>(<code>Strawberry</code>, <code>Key</code>\u7b49)</li> <li>\u6240\u6709\u88ab\u73a9\u5bb6\u62fe\u8d77\u7684<code>Holdable</code>(<code>TheoCrystal</code>, <code>Glider(Jellyfish)</code>\u7b49)</li> <li>7a 7b \u663e\u793a500m 1000m\u7684\u5b9e\u4f53<code>HeightDisplay</code></li> <li><code>LightningBreakerBox</code>\u7535\u7bb1\u88ab\u649e\u88c2\u7684\u65f6\u5019</li> <li><code>MoonGlitchBackgroundTrigger</code>\u626b\u63cf\u7ebfGlitch\u89e6\u53d1\u7684\u65f6\u5019(\u8bb0\u5f97\u628aCelesteTAS\u78b0\u649e\u7bb1\u548c\u5149\u654f\u6a21\u5f0f\u5173\u4e86, \u4e0d\u7136\u770b\u4e0d\u5230(\u4e50))</li> <li>Player\u81ea\u8eab(\u663e\u800c\u6613\u89c1)</li> <li>\u7b2c\u516b\u7ae0\u7684<code>SandwichLava</code>\u7194\u5ca9\u971c\u51bb\u5939\u5fc3</li> <li><code>SoundEmitter</code>(\u611f\u89c9\u5c31\u6bd4\u76f4\u63a5\u7528Audio\u591a\u4e86\u4e2a\u5207\u677f\u9500\u6bc1)</li> <li><code>StrawberryPoints</code>\u8349\u8393\u5f97\u5206\u70b9\u6570</li> <li>\u7b2c\u4e03\u7ae0\u649e\u788e<code>SummitGem</code>\u65f6\u7684\u95ea\u5149</li> <li><code>TalkComponentUI</code>(\u73a9\u5bb6\u9760\u8fd1\u65f6\u5f39\u51fa\u7684prompt, \u4f8b\u5982\u671b\u8fdc\u955c<code>Lookout</code>\u4e0a\u7684\u90a3\u4e2a) (\u4f46\u5b83\u53c8\u662f\u7531<code>TalkComponent</code>\u63a7\u5236\u7684, \u6240\u4ee5\u597d\u50cf\u5b83\u7684persistent\u6ca1\u7528?)</li> </ul>"},{"location":"basics/flag_tag_tracker/#hud","title":"HUD","text":"<p>\u5373\u662f\u5426\u662f UI \u5c42, \u6b64\u9879\u4f1a\u6539\u53d8 <code>Entity.Render</code> \u7684\u7ed8\u5236\u903b\u8f91(\u6ce8\u610f<code>Position</code>\u4e0d\u53d8), \u4f7f\u7ed8\u5236\u5750\u6807\u57fa\u4e8e\u5c4f\u5e55\u5750\u6807(<code>1920 x 1080</code>)\u800c\u4e0d\u662f\u4e16\u754c\u5750\u6807\u7ed8\u5236, \u5e76\u8c03\u6574\u7ed8\u5236\u987a\u5e8f\u4f7f\u5176\u7f6e\u4e8e\u9876\u5c42</p> <p>Note</p> <p>\u672c\u8d28\u4e0a\u9009\u62e9HUD Tag\u540e\u6e38\u620f\u4f1a\u5728\u7ed8\u5236\u65f6\u901a\u8fc7\u77e9\u9635\u628a\u5750\u6807\u4ece\u5c4f\u5e55\u7a7a\u95f4\u8f6c\u5316\u5230\u4e16\u754c\u7a7a\u95f4(\u53c2\u8003<code>HiresRenderer</code>, \u7ebf\u6027\u4ee3\u6570\u6700\u6709\u7528\u7684\u4e00\u96c6~), \u6240\u4ee5\u5176\u5b9e\u7ed8\u5236\u7528\u7684\u8fd8\u662f\u4e16\u754c\u5750\u6807</p> \u4f8b\u5982 <ul> <li>\u9e1f\u7684\u6559\u7a0b\u6846<code>BirdTutorialGui</code></li> <li>6a\u7684\u6df1\u547c\u5438~<code>BreathingMinigame</code></li> <li>\u5403\u5230\u78c1\u5e26b\u9762\u89e3\u9501\u753b\u9762<code>UnlockedBSide UnlockedRemixDisplay</code></li> <li>2a Awake\u6700\u4e0a\u9762\u7684\u8bd7<code>CS02_Journal.PoemPage</code></li> <li>3a(11-a) \u7684\u5012\u95ed\u901a\u77e5<code>CS03_Memo.MemoPage</code></li> <li>6a \u7684\u548c\u597d\u62b1\u62b1<code>CS06_BossEnd</code></li> <li>6a \u7bdd\u706b\u524d\u548c\u7684Theo\u5bf9\u8bdd\u9009\u9879<code>CS06_Campfire.Option</code></li> <li>7a\u901a\u5173\u7684\u5236\u4f5c\u4eba\u5458\u540d\u5355<code>CS07_Credits</code></li> <li>\u5c3e\u58f0\u91cc\u7684\u8349\u8393\u86cb\u7cd5<code>CS08_Ending</code></li> <li>9a\u5c3e\u58f0 <code>CS10_Ending</code></li> <li>\u6536\u96c6\u5b8c\u8349\u8393\u7c7d\u7684\u5408\u6210\u52a8\u753b <code>CSGEN_StrawberrySeeds</code>(\u4f46\u8fd9\u4e2a\u7c7b\u672c\u8eab\u5e76\u6ca1\u6709render, \u6240\u4ee5\u597d\u50cf\u6ca1\u7528?)</li> <li>\u542f\u52a8\u6e38\u620f\u65f6\u4e00\u5f00\u59cb\u51fa\u73b0\u7684credits \u548c logo<code>GameLoader.handler</code></li> <li>Pause\u754c\u9762\u4e0b\u65b9\u7684\u8349\u8393\u8bb0\u5f55 <code>GameplayStats</code></li> <li>7a 7b \u663e\u793a500m 1000m\u7684\u5b9e\u4f53<code>HeightDisplay</code></li> <li><code>HudRenderer</code>(\u7ba1UI\u663e\u9690\u7684)</li> <li>B\u9762\u5165\u573a\u63d2\u78c1\u5e26<code>BSideTitle</code></li> <li>\u5f00\u955c\u753b\u9762<code>Lookout.Hud</code></li> <li>\u7eaa\u5ff5\u7891\u6587\u5b57<code>MemorialText</code></li> <li>6a badeline\u8ff7\u4f60\u5bf9\u8bdd\u6846<code>MiniTextbox</code></li> <li>\u5404\u79cdOui, \u5404\u79cdpanel</li> <li>\u5403\u5fc3\u540e\u663e\u793a\u7684\u6587\u5b57<code>Poem</code></li> <li>\u660e\u4fe1\u7247<code>Postcard</code></li> <li>prologue\u7ed3\u5c3e<code>PrologueEndingText</code>(You can do this!)</li> <li>\u81ea\u62cd\u7167<code>Selfie</code></li> <li>\u8ba1\u65f6\u5668<code>SpeedrunTimerDisplay</code></li> <li>\u8349\u8393\u8ba1\u6570<code>TotalStrawberriesDisplay</code></li> <li><code>TalkComponentUI</code></li> <li>\u5bf9\u8bdd\u6846<code>Textbox</code></li> <li>\u51cc\u6ce2\u5fae\u6b65, \u5feb\u4e50\u7684\u821e\u6b65~<code>WaveDashPresentation</code></li> </ul>"},{"location":"basics/flag_tag_tracker/#transitionupdate","title":"TransitionUpdate","text":"<p>\u5207\u677f\u8fc7\u7a0b\u7ee7\u7eed\u66f4\u65b0(\u6216\u8005\u8bf4\u65f6\u95f4\u6d41\u901f\u6b63\u5e38), \u5207\u677f\u540e\u9500\u6bc1(\u6ce8\u610f: \u6807\u7b7e\u53ef\u4f5c\u7528\u4e8e\u8981\u88abload\u7684\u6216\u8005\u662f\u8981\u88abunload\u7684\u5bf9\u8c61)</p> \u4f8b\u5982 <ul> <li>\u7b2c\u4e03\u7ae0\u7ba1\u4e0a\u5347\u5207\u677f\u7684<code>AscendManager</code>(\u597d\u50cf\u5c31\u5bf9\u5e94Loenn\u91cc\u7684<code>SummitBackgroundManager</code>)</li> <li>6a\u4ece\u4e3b\u4e16\u754ccutscene\u5207\u52306a\u7b2c\u4e8c\u7ae0\u6240\u7528\u7684\u9ed1\u573a\u8fc7\u6e21<code>BackgroundFadeIn</code></li> <li>6a\u7011\u5e03<code>BigWaterfall</code></li> <li>9a\u7684<code>BirdPath</code></li> <li>\u7bdd\u706b<code>Bonfire</code></li> <li>\u7ea2(\u7eff)\u6ce1\u6ce1<code>Booster</code></li> <li>\u7b2c\u56db\u7ae0\u5404\u79cd\u65d7\u5e1c<code>CliffsideWindFlag</code></li> <li>3a\u6536\u62fe\u6742\u7269<code>ClutterAbsorbEffect</code></li> <li>3a\u6536\u62fe\u5b8c\u6742\u7269\u628a\u95e8\u5835\u4f4f\u7684\u90a3\u4e2a\u679c\u51bb<code>ClutterDoor</code></li> <li>\u5706\u523a<code>CrystalStaticSpinner</code></li> <li><code>DustEdges</code></li> <li>\u706b\u7403<code>FireBall</code></li> <li>\u5ca9\u6d46\u5899<code>FireBarrier</code></li> <li><code>GameplayStats</code></li> <li><code>GrabbyIcon</code></li> <li>\u5c3e\u58f0\u53f3\u4fa7\u9e1f\u5de2<code>InvisibleBarrier</code></li> <li>\u6bd4\u59826a\u84dd\u5fc3\u623f\u5de6\u8fb9\u7684\u5de6\u8fb9\u90a3\u4e2a\u623f\u95f4\u91cc\u7684\u4e00\u7f15\u7f15\u5149<code>LightBeam</code></li> <li>\u6539\u623f\u95f4\u706f\u5149\u7684\u900f\u660e\u5ea6<code>LightFadeTrigger</code></li> <li><code>LightningRenderer</code></li> <li>\u9501\u5757\u88ab\u89e3\u9501\u540e<code>LockBlock</code></li> <li><code>MiniTextbox</code></li> <li>9a\u5c0f\u874c\u86aa<code>MoonCreature</code></li> <li>\u79fb\u52a8\u5feb\u649e\u505c\u540e\u6389\u843d\u7684\u788e\u7247<code>MoveBlock.Debris</code></li> <li><code>NPC03_Theo_Vents</code></li> <li>5a\u7a7f\u8fc7\u955c\u5b50\u4ece\u4e0a\u9762\u843d\u4e0b\u6765\u540e\u7684badeline<code>NPC05_Badeline</code></li> <li><code>OldSiteChaseMusicHandler</code></li> <li>pico-8\u6e38\u620f\u673a<code>PicoConsole</code></li> <li>6a\u89e6\u624b<code>ReflectionTentacles</code></li> <li><code>SandwichLava</code></li> <li><code>SeekerBarrierRenderer</code></li> <li><code>SoundEmitter</code></li> <li><code>SpeedrunTimerDisplay</code></li> <li>\u8349\u8393\u6536\u96c6\u7684\u65f6\u5019<code>Strawberry</code></li> <li><code>StrawberryPoints</code></li> <li>5a\u5c3e\u58f0\u7ba1\u97f3\u4e50\u7684<code>TempleEndingMusicHandler</code></li> <li>Theo<code>TheoCrystal</code></li> <li>\u521d\u89c1Theo\u6c34\u6676\u7684\u5e95\u5ea7<code>TheoCrystalPedestal</code></li> <li><code>TotalStrawberriesDisplay</code></li> <li>\u4f20\u9001\u5e26<code>WallBooster</code></li> <li>\u6c34<code>Water</code></li> <li>\u7011\u5e03<code>WaterFall</code></li> <li>9a\u6559\u51cc\u6ce2\u7684\u90a3\u4e2a\u5821<code>WaveDashTutorialMachine</code></li> <li>\u7b2c4\u7ae0\u7ba1\u98ce\u529b\u548c\u98ce\u5411\u7684<code>WindController</code></li> </ul>"},{"location":"basics/flag_tag_tracker/#frozenupdate","title":"FrozenUpdate","text":"<p>Frozen\u53ea\u662fLevel\u91cc\u7684\u4e00\u4e2a\u51bb\u7ed3\u72b6\u6001(\u6216\u8005\u8bf4\u4e00\u4e2abool\u53d8\u91cf, \u800c\u4e0d\u662f\u771f\u7684\u8ba9\u6e38\u620ffreeze\u7684\u90a3\u4e2a\u51bb\u7ed3\u5e27)</p> \u4f8b\u5982 <ul> <li>\u5403\u6c34\u6676\u6e85\u5c04\u7684\u767d\u7403<code>AbsorbOrb</code></li> <li>\u78c1\u5e26<code>Cassette</code></li> <li>\u8349\u8393\u7c7d\u5408\u6210\u52a8\u753b<code>CSGEN_StrawberrySeeds</code></li> <li><code>FormationBackdrop</code></li> <li>\u89e3\u95011a\u6c34\u6676\u4e4b\u5fc3\u8fc7\u7a0b<code>ForsakenCitySatellite</code></li> <li>\u6c34\u6676\u4e4b\u5fc3<code>HeartGem</code></li> <li>\u6c34\u6676\u4e4b\u5fc3\u4e0a\u7684\u6587\u5b57<code>Poem</code></li> <li>\u4fdd\u5b58\u5e76\u9000\u51fa\u65f6\u53f3\u4e0b\u89d2\u7684Icon<code>SaveLoadIcon</code></li> <li><code>StrawberryPoints</code></li> <li><code>StrawberrySeed</code></li> <li><code>Textbox</code></li> <li>\u6b8b\u5f71<code>TrailManager.Snapshot</code></li> </ul>"},{"location":"basics/flag_tag_tracker/#pauseupdate","title":"PauseUpdate","text":"<p>\u5728Pause\u72b6\u6001\u4e0b\u8fd8\u80fd\u66f4\u65b0\u7684\u5b9e\u4f53</p> \u4f8b\u5982 <ul> <li><code>Cassette.UnlockedBSide</code>(\u7531\u4e8e\u5b83\u662f\u7531Cassette\u63a7\u5236\u7684, \u6240\u4ee5\u76f8\u5f53\u4e8e\u81ea\u5e26\u4e00\u4e2aFrozenUpdate, \u4f46\u662f\u5b83\u5728\u88ab\u8c03\u7528\u524dPause\u5df2\u7ecf\u88ab\u9501\u4f4f\u4e86, \u6240\u4ee5\u8fd9\u4e2a\u72b6\u6001\u8c8c\u4f3c\u767d\u52a0\u4e86\ud83e\udd14)</li> <li>\u5c3e\u58f0<code>CS08_Ending</code></li> <li><code>GameplayStats</code></li> <li><code>GrabbyIcon</code></li> <li><code>LanguageSelectUI</code></li> <li>1a\u5c3e, 2a\u5934\u7684\u7eaa\u5ff5\u7891<code>Memorial</code>(\u7528\u5230\u6807\u7b7e\u7684\u5730\u65b9\u4e3b\u8981\u662f2a\u7eaa\u5ff5\u7891\u4e0a\u7684\u4e71\u7801)</li> <li><code>MemorialText</code>(\u56e0\u4e3apaused\u7684\u65f6\u5019\u4e0d\u80fd\u663e\u793a)</li> <li><code>OuiChapterSelectIcon</code></li> <li><code>OuiFileSelectSlot</code></li> <li><code>PicoConsole</code></li> <li><code>SaveLoadIcon</code></li> <li><code>SpeedrunTimerDisplay</code></li> <li><code>Textbox</code></li> <li>\u5e94\u8be5\u662f\u5f00\u59cb\u83dc\u5355<code>TextMenu</code></li> <li><code>TotalStrawberriesDisplay</code></li> <li><code>UnlockedPico8Message</code></li> <li><code>ViewportAdjustmentUI</code></li> </ul>"},{"location":"basics/flag_tag_tracker/#tracker","title":"Tracker","text":"<p><code>Tracker</code> \u7531 <code>Scene</code> \u7ba1\u7406, \u5728\u6211\u4eec\u4f7f\u7528 <code>Scene.Add(new Entity())</code> \u7684\u65f6\u5019, \u4f1a\u901a\u8fc7 <code>EntityList</code> \u5411 <code>Tracker</code> \u52a0\u5165 <code>Entity</code> (\u5f53\u7136\u8fd8\u6709 <code>Component</code>, \u4f46\u5728\u540e\u9762\u53ea\u63d0\u53ca <code>Entity</code>). \u6240\u6709\u9700\u8981\u88ab <code>Tracked</code> (\u6216\u8005\u8bf4\u88ab\u8bb0\u5f55) \u7684 <code>Entity</code> \u9700\u8981\u52a0\u4e0a <code>[Tracked]</code> \u7279\u6027. \u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7 <code>[TrackedAs(typeof(xxx))]</code> \u7279\u6027\u8ba9\u4e00\u4e2a <code>A</code> \u7c7b\u578b\u88ab\u540c\u65f6\u5f53\u4f5c <code>B</code> \u7c7b\u578b, \u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>Scene.Tracker.GetEntities&lt;B&gt;()</code> \u6765\u540c\u65f6\u62ff\u5230 <code>A</code> \u548c <code>B</code> \u4e86 (\u8fd9\u4e2a\u7279\u6027\u4f5c\u4e3a Everest \u7684\u4e00\u4e2a\u62d3\u5c55\u5b58\u5728).</p>"},{"location":"basics/session_settings_savedata/","title":"Settings, Session, SaveData","text":"<p>\u8fd9\u90e8\u5206\u5185\u5bb9\u5728 Everest Wiki \u91cc\u662f\u5728\u914d\u7f6e\u73af\u5883\u7684\u540c\u65f6\u8bf4\u7684, \u6211\u4e2a\u4eba\u8ba4\u4e3a\u5e94\u8be5\u63a8\u540e\u4e00\u70b9\u4f46\u662f\u4f3c\u4e4e\u73b0\u5728\u63a8\u540e\u7684\u6709\u70b9\u8fc7\u5934.</p> <p>\u4f60\u5e94\u8be5\u8fd8\u8bb0\u5f97\u6211\u4eec\u6700\u5f00\u59cb\u7684\u90a3\u4e2a\u7ee7\u627f\u4e8e <code>EverestModule</code> \u7684\u7c7b <code>MyCelesteModModule</code>, \u5230\u76ee\u524d\u4e3a\u6b62\u6211\u4eec\u53ea\u4f7f\u7528\u4e86\u5b83\u7684 <code>Load</code> \u65b9\u6cd5\u548c <code>Unload</code> \u65b9\u6cd5\u7528\u4e8e\u52a0\u8f7d\u521d\u59cb\u5316\u6211\u4eec\u7684\u94a9\u5b50. \u5f53\u7136, \u8fd9\u80af\u5b9a\u662f\u4e0d\u6b62\u7684, \u90a3\u4e48\u8fd9\u4e00\u8282\u5c06\u4f1a\u805a\u7126\u4e8e <code>EverestModule</code> \u7684\u66f4\u591a\u7684\u5185\u5bb9.</p>"},{"location":"basics/session_settings_savedata/#settings","title":"Settings","text":""},{"location":"basics/session_settings_savedata/#_1","title":"\u57fa\u672c","text":"<p>Settings, \u987e\u540d\u601d\u4e49\u5c31\u662f\u9009\u9879\u7684\u610f\u601d. Everest \u4e3a\u6211\u4eec\u5c01\u88c5\u4e86\u4e00\u4e2a\u975e\u5e38\u4fbf\u5229\u7684\u7cfb\u7edf, \u6211\u4eec\u8981\u505a\u7684\u53ea\u662f\u7b80\u5355\u5730\u52a0\u5165\u5c5e\u6027, \u7136\u540e\u88c5\u9970\u51e0\u4e2a\u7b80\u5355\u7684\u7279\u6027, \u5c31\u80fd\u521b\u5efa\u51fa\u6613\u7528\u7684\u83dc\u5355\u9009\u9879, \u5269\u4e0b\u7684 ui \u65b9\u9762\u548c\u4fdd\u5b58\u8bfb\u53d6\u7684\u5de5\u4f5c\u90fd\u7531 Everest \u8d1f\u8d23.</p> <p>\u5728\u6b64\u4e4b\u524d, \u6211\u4eec\u5148\u4fdd\u5b58\u4e00\u4e0b\u6211\u4eec\u7684 <code>EverestModule</code> \u5b9e\u4f8b\u4ee5\u65b9\u4fbf\u6211\u4eec\u8bbf\u95ee\u5b83\u7684\u5b9e\u4f8b(Everest \u4f1a\u786e\u4fdd\u5b83\u662f\u5355\u4f8b\u7684):</p> <pre><code>public class MyCelesteModModule : EverestModule\n{\n    public static MyCelesteModModule Instance { get; private set; }\n\n    public override void Load()\n    {\n        Instance = this;\n    }\n\n    public override void Unload()\n    {\n    }\n}\n</code></pre> <p>\u7136\u540e\u65b0\u5efa\u4e00\u4e2a\u540d\u5b57\u6700\u597d\u4ee5 mod \u5f00\u5934, <code>Settings</code> \u7ed3\u5c3e\u7684 <code>MyCelesteModSettings</code> \u7c7b\u5e76\u7ee7\u627f <code>EverestModuleSettings</code>:</p> <pre><code>public class MyCelesteModSettings : EverestModuleSettings\n{\n\n}\n</code></pre> <p>\u7136\u540e\u5728 module \u7c7b\u91cc\u8fd9\u6837\u6ce8\u518c\u8fd9\u4e2a\u7c7b:</p> <pre><code>public class MyCelesteModModule : EverestModule\n{\n    public static MyCelesteModModule Instance { get; private set; }\n\n    public override Type SettingsType =&gt; typeof(MyCelesteModSettings);\n    public static MyCelesteModSettings Settings =&gt; (MyCelesteModSettings)Instance._Settings;\n\n    public override void Load()\n    {\n        Instance = this;\n    }\n\n    public override void Unload()\n    {\n    }\n}\n</code></pre> <p>\u73b0\u5728, \u6211\u4eec\u5411\u9009\u9879\u4e2d\u65b0\u52a0\u4e00\u6761\u516c\u5f00\u7684 bool \u7c7b\u578b\u7684\u5c5e\u6027:</p> <pre><code>public class MyCelesteModSettings : EverestModuleSettings\n{\n    public bool AnInterestingSwitch { get; set; }\n}\n</code></pre> <p>\u73b0\u5728\u76f4\u63a5\u7f16\u8bd1\u4f60\u7684\u9879\u76ee, \u7136\u540e\u4f60\u5e94\u8be5\u4f1a\u770b\u5230 Everest \u4e3a\u4f60\u5728 mod \u9009\u9879\u4e2d\u751f\u6210\u4e86\u8fd9\u6837\u4e00\u6761\u6709\u8da3\u7684\u8bbe\u7f6e:</p> <p></p> <p>\u968f\u540e\u4f60\u5c31\u80fd\u5728\u4f60 mod \u7684\u4efb\u4f55\u5730\u65b9\u7528 <code>MyCelesteModSettings.Settings.AnInterestingSwitch</code> \u6765\u8bbf\u95ee\u8fd9\u4e2a\u5f00\u5173\u4e86.</p> <p>\u9664\u6b64\u4e4b\u5916 Everest \u8fd8\u652f\u6301\u679a\u4e3e, \u5b57\u7b26\u4e32\u548c\u6570\u5b57, \u5b83\u4eec\u5206\u522b\u4f1a\u751f\u6210\u8fd9\u6837\u7684\u9009\u9879:</p> <pre><code>public class MyCelesteModSettings : EverestModuleSettings\n{\n    public bool AnInterestingSwitch { get; set; }\n\n    [SettingRange(0, 100)]\n    public int AnInteger { get; set; }\n\n    public string AString { get; set; }\n\n    public DayOfWeek DayOfWeek { get; set; }\n}\n</code></pre> <p></p> <p>Info</p> <p><code>AString</code> \u90a3\u6761\u9009\u9879\u662f\u4e00\u4e2a\u6309\u94ae, \u6309\u4e0b\u540e\u4f1a\u8fdb\u5165\u6587\u5b57\u8f93\u5165\u754c\u9762, \u5192\u53f7\u540e\u9762\u4f1a\u8ddf\u73a9\u5bb6\u8f93\u5165\u4e86\u7684\u6587\u5b57. <code>DayOfWeek</code> \u9009\u9879\u5141\u8bb8\u4f60\u5de6\u53f3\u9009\u62e9 <code>DayOfWeek</code> \u679a\u4e3e\u4e2d\u7684\u6bcf\u4e00\u9879.</p> <p>\u5176\u4e2d int \u90a3\u6761\u5c5e\u6027\u9700\u8981\u88c5\u9970 <code>SettingRange</code> \u7279\u6027\u5e76\u6307\u5b9a\u6700\u5927\u6700\u5c0f\u503c, \u5426\u5219 Everest \u4f1a\u62d2\u7edd\u751f\u6210\u5b83, \u6b64\u5916\u5b83\u8fd8\u6709\u4e2a\u53c2\u6570\u53ef\u4ee5\u7528\u6765\u6307\u5b9a\u8be5\u9009\u9879\u662f\u5426\u9700\u8981 \"\u5927\u7684\u8303\u56f4\" (<code>LargeRange</code>), \u5982\u679c\u6307\u5b9a\u4e3a true, \u5219\u957f\u6309\u8c03\u6574\u8be5\u503c\u65f6\u7684\u589e\u957f\u901f\u5ea6\u4f1a\u6162\u6162\u589e\u52a0\u4ee5\u4fbf\u5feb\u901f\u8c03\u6574\u81f3\u66f4\u5927/\u5c0f\u7684\u503c.  </p> <p>\u9664\u4e86 <code>SettingRange</code> \u7279\u6027, \u8fd8\u6709\u66f4\u591a\u5176\u4ed6\u7684\u7279\u6027\u7528\u4e8e\u6307\u793a\u8be5\u9009\u9879\u7684\u4e00\u4e9b\u6027\u8d28:</p> <ul> <li><code>SettingNeedsRelauch</code>: \u6307\u793a\u8be5\u9009\u9879\u9700\u8981\u91cd\u542f\u6e38\u620f\u751f\u6548.</li> <li><code>SettingNumberInput</code>: \u5982\u679c\u8be5\u9009\u9879\u5bf9\u5e94\u7684\u5c5e\u6027\u662f\u4e2a\u6570\u5b57(int, float), \u90a3\u4e48\u4f7f\u7528\u8f93\u5165\u6587\u5b57\u7684\u83dc\u5355\u6765\u8f93\u5165\u6570\u5b57\u800c\u4e0d\u662f\u5de6\u53f3\u5207\u6362\u6570\u5b57.<ul> <li><code>allowNegatives</code>: \u662f\u5426\u5141\u8bb8\u8d1f\u6570</li> <li><code>maxLength</code>: \u5b57\u7b26\u4e32\u6700\u5927\u957f\u5ea6</li> </ul> </li> <li><code>SettingMaxLength</code>: \u8bbe\u7f6e\u8be5\u5b57\u7b26\u4e32\u9009\u9879\u7684\u6700\u5927\u957f\u5ea6. \u5426\u5219\u9ed8\u8ba4 12 \u4e2a\u5b57\u7b26.<ul> <li><code>max</code>: \u6700\u5927\u957f\u5ea6</li> </ul> </li> <li><code>SettingInGame</code>: \u6307\u793a\u8be5\u9009\u9879\u662f\u5426\u51fa\u73b0\u5728\u6e38\u620f\u5185(\u56fe\u5185)\u83dc\u5355\u4e2d.<ul> <li><code>inGame</code>: \u5982\u4e0a.</li> </ul> </li> <li><code>SettingIgnore</code>: \u6307\u793a\u662f\u5426\u5ffd\u7565\u8be5\u9009\u9879\u88ab\u52a0\u5165\u83dc\u5355, \u6ce8\u610f\u5ffd\u7565\u540e\u4f9d\u7136\u4f1a\u88ab Everest \u6b63\u5e38\u8bfb\u53d6\u4fdd\u5b58.</li> <li><code>YamlIgnore</code>: \u6307\u793a\u662f\u5426\u5ffd\u7565\u8be5\u5c5e\u6027\u7684\u4fdd\u5b58.</li> </ul> <p>Note</p> <p><code>YamlIgnore</code> \u4f4d\u4e8e\u547d\u540d\u7a7a\u95f4 <code>YamlDotNet.Serialization</code> \u5185.</p>"},{"location":"basics/session_settings_savedata/#_2","title":"\u672c\u5730\u5316","text":"<p>\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u9ed8\u8ba4\u751f\u6210\u7684\u9009\u9879\u540d\u5b57\u5c31\u662f\u5c5e\u6027\u540d, \u5c3d\u7ba1\u6211\u4eec\u901a\u5e38\u80fd\u731c\u5230\u5b83\u7684\u610f\u601d\u4ee5\u53ca\u5b83\u4f1a\u5e72\u4ec0\u4e48, \u4f46\u662f\u73a9\u5bb6\u4eec\u901a\u5e38\u4e0d\u4f1a, \u6240\u4ee5\u6211\u4eec\u8fd8\u5f97\u4e3a\u5176\u914d\u7f6e\u672c\u5730\u5316, \u5176\u5c31\u5305\u542b\u4e86\u6211\u4eec\u901a\u5e38\u8bb2\u7684 \"\u6c49\u5316\", \"\u4e2d\u6587\u7ffb\u8bd1\".  </p> <p>\u5728\u8fd9\u91cc, \u6211\u4eec\u9700\u8981\u7684\u672c\u5730\u5316\u952e\u540d\u662f <code>modoptions_{\u7c7b\u540d}_{\u5c5e\u6027\u540d}</code>, \u4f8b\u5982\u5982\u4e0b\u7c7b:</p> <pre><code>public class MyCelesteModSettings : EverestModuleSettings\n{\n    public bool EnableFunnyThing { get; set; }\n}\n</code></pre> <p>\u5176\u4e2d\u90a3\u6761\u5c5e\u6027\u5bf9\u5e94\u7684\u672c\u5730\u5316\u952e\u540d\u5219\u662f: <code>modoptions_mycelestemod_enablefunnything</code>, \u6240\u4ee5\u6211\u4eec\u5c06\u5176\u5199\u5728 Dialog \u6587\u4ef6\u91cc:</p> ModFolder/Dialog/Simplified Chinese.txt<pre><code>modoptions_mycelestemod_enablefunnything=\u5f00\u542f\u6709\u8da3\u7684\u4e1c\u897f\n</code></pre> ModFolder/Dialog/english.txt<pre><code>modoptions_mycelestemod_enablefunnything=Enable funny thing\n</code></pre> <p>Note</p> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053 dialog \u6587\u4ef6\u662f\u4ec0\u4e48\u7684\u8bdd, \u4f60\u53ef\u4ee5\u8be2\u95ee mapper \u4eec, \u6216\u8005\u5728\u8fd9\u91cc\u4f60\u5c31\u5e72\u8106\u7167\u505a, \u4e5f\u5c31\u662f\u65b0\u5efa\u5982\u5176\u6807\u9898\u6240\u5c55\u793a\u7684\u6587\u4ef6\u7136\u540e\u7c98\u8d34\u5bf9\u5e94\u5185\u5bb9.</p> <p>\u6b64\u5916, mod \u9009\u9879\u7684\u5927\u6807\u9898\u4e5f\u6709\u4e2a\u672c\u5730\u5316\u952e\u540d, \u76f8\u5bf9\u4e8e\u4e0a\u9762\u7684\u952e\u540d\u53ea\u662f\u5c06\u5c5e\u6027\u540d\u6362\u6210\u4e86 <code>title</code>, \u4f8b\u5982\u4ee5\u4e0b dialog \u6587\u4ef6:</p> ModFolder/Dialog/Simplified Chinese.txt<pre><code>modoptions_mycelestemod_enablefunnything=\u5f00\u542f\u6709\u8da3\u7684\u4e1c\u897f\nmodoptions_mycelestemod_title=\u6211\u7684\u6709\u8da3 mod \u7684\u8bbe\u7f6e (MyCelesteMod)\n</code></pre> ModFolder/Dialog/english.txt<pre><code>modoptions_mycelestemod_enablefunnything=Enable funny thing\nmodoptions_mycelestemod_title=funny MyCelesteMod\n</code></pre> <p>Note</p> <p>\u65f6\u523b\u8bb0\u5f97\u586b\u5145 <code>english.txt</code>, \u56e0\u4e3a\u5982\u679c\u5176\u4ed6\u8bed\u8a00\u6ca1\u627e\u5230\u8fd9\u4e2a\u952e\u540d\u4f1a\u9ed8\u8ba4\u56de\u9000\u5230 <code>english</code>, \u5982\u679c\u518d\u6ca1\u6709\u7684\u8bdd\u5c31\u4f1a\u76f4\u63a5\u5c55\u793a\u4e11\u964b\u7684\u952e\u540d.</p> <p></p> <p>\u672c\u5730\u5316\u952e\u540d\u5e76\u4e0d\u662f\u56fa\u5b9a\u7684, \u4f60\u53ef\u4ee5\u4f7f\u7528 <code>SettingName</code> \u88c5\u9970\u5230\u7c7b\u4e0a\u6216\u8005\u5c5e\u6027\u4e0a\u6765\u4fee\u6539\u5b83, \u4e0d\u8fc7\u6211\u4e2a\u4eba\u4e0d\u662f\u5f88\u5efa\u8bae\u4fee\u6539\u5b83, \u56e0\u4e3a\u9ed8\u8ba4\u7684\u503c\u4f5c\u4e3a\u952e\u540d\u5b8c\u5168\u591f\u7528, \u6b64\u5916\u8fd8\u6709\u4e00\u4e2a <code>SettingSubText</code> \u7279\u6027, \u5b83\u53ef\u4ee5\u5411\u8be5\u9009\u9879\u88ab\u9009\u4e2d\u65f6\u5728\u5e95\u4e0b\u663e\u793a\u4e00\u884c\u5c0f\u5b57, \u5b83\u7684\u53c2\u6570\u540c\u6837\u662f\u4e2a\u672c\u5730\u5316\u952e\u540d, \u7c7b\u4f3c\u7684\u8fd8\u6709 <code>SettingSubHeader</code> \u7279\u6027, \u5b83\u4f1a\u5411\u8be5\u9009\u9879\u4e4b\u524d\u52a0\u5165\u4e00\u4e2a\u5c0f\u6807\u9898.</p> <p>\u5bf9\u4e8e\u679a\u4e3e\u6bcf\u4e00\u9879\u7684\u503c\u53ef\u4ee5\u4f7f\u7528 <code>modoptions_{\u7c7b\u540d}_{\u5c5e\u6027\u540d}_{\u679a\u4e3e\u9879\u540d}</code> \u6765\u6307\u5b9a, \u4f8b\u5982\u5bf9\u4e8e <code>DayOfWeek</code> \u679a\u4e3e\u7c7b\u578b\u7684 <code>Day</code> \u5c5e\u6027:</p> ModFolder/Dialog/Simplified Chinese.txt<pre><code>modoptions_mycelestemod_day_sunday=\u661f\u671f\u65e5\nmodoptions_mycelestemod_day_monday=\u661f\u671f\u4e00\nmodoptions_mycelestemod_day_tuesday=\u661f\u671f\u4e8c\nmodoptions_mycelestemod_day_wednesday=\u661f\u671f\u4e09\nmodoptions_mycelestemod_day_thursday=\u661f\u671f\u56db\nmodoptions_mycelestemod_day_friday=\u661f\u671f\u4e94\nmodoptions_mycelestemod_day_saturday=\u661f\u671f\u516d\n</code></pre> <p>Info</p> <p>\u5982\u679c\u4f60\u5b9e\u9645\u6d4b\u8bd5\u7684\u8bdd\u4f60\u4f1a\u53d1\u73b0 <code>\u4e09</code> \u5b57\u548c <code>\u4e94</code> \u5b57\u6ca1\u6709\u6e32\u67d3\u51fa\u6765, \u8fd9\u662f\u6b63\u5e38\u7684, \u56e0\u4e3a\u851a\u84dd\u7684\u5b57\u5e93\u4e2d\u6ca1\u6709\u8fd9\u4e24\u4e2a\u5b57, \u8fd9\u91cc\u6211\u5c31\u4e0d\u8d58\u8ff0\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e86, \u5177\u4f53\u53ef\u4ee5\u54a8\u8be2 mapper \u4eec. (\u65e5\u5e38\u5077\u61d2.jpg)</p>"},{"location":"basics/session_settings_savedata/#_3","title":"\u6700\u540e","text":"<p>\u6216\u8bb8\u4f60\u4e5f\u5df2\u7ecf\u731c\u5230\u4e86, Everest \u6b63\u662f\u4f7f\u7528\u7684 Yaml \u6765\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u4f60\u7684 <code>Settings</code> \u7c7b, \u6240\u4ee5\u8bf7\u52a1\u5fc5\u4e0d\u8981\u5728\u4f60\u7684 <code>Settings</code> \u7c7b\u4e2d\u653e\u7f6e\u5947\u602a\u7684\u7c7b\u548c\u7ed3\u6784\u4f53! \u5982\u679c\u4f60\u8981\u8fd9\u4e48\u505a\u8bf7\u786e\u4fdd Everest \u80fd\u6b63\u786e\u5730\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u4f60\u7684 <code>Settings</code> \u7c7b, \u5426\u5219\u4f60\u7684\u8bbe\u7f6e\u5c06\u4e0d\u4f1a\u88ab\u6b63\u5e38\u4fdd\u5b58, \u6c38\u8fdc\u90fd\u662f\u9ed8\u8ba4\u503c.</p>"},{"location":"basics/session_settings_savedata/#session","title":"Session","text":""},{"location":"basics/session_settings_savedata/#_4","title":"\u57fa\u672c","text":"<p>Session \u662f\u4e00\u4e2a\u851a\u84dd\u4e2d\u4fdd\u5b58\u6570\u636e\u7684\u6982\u5ff5, \u5b83\u7528\u4e8e\u4fdd\u5b58 \"\u4fdd\u5b58\u5e76\u9000\u51fa\" \u6309\u94ae\u6309\u4e0b\u540e\u6240\u4fdd\u5b58\u7684\u6570\u636e, \u4f8b\u5982\u5f53\u524d\u5df2\u6fc0\u6d3b\u7684 Flag, \u91cd\u751f\u70b9, \u5df2\u62fe\u53d6\u7684\u94a5\u5319, \u8349\u8393, \u6838\u5fc3\u7684\u6a21\u5f0f\u7b49. \u5728\u81ea\u5b9a\u4e49\u4f60\u81ea\u5df1\u7684 <code>Session</code> \u540e, \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u4fdd\u5b58\u4f60\u81ea\u5df1\u72ec\u6709\u7684\u6536\u96c6\u7269\u4fe1\u606f, \u6216\u8005\u662f\u4e00\u4e9b\u5b9e\u4f53\u9700\u8981\u4e34\u65f6\u4fdd\u5b58\u4e8e\u5173\u5361\u7684\u6570\u636e. \u4e0e Settings \u76f8\u540c, \u6211\u4eec\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a\u7ee7\u627f\u4e8e <code>EverestModuleSession</code> \u7684\u7c7b, \u7136\u540e\u5728\u6a21\u5757\u7c7b\u4e2d\u58f0\u660e\u5b83:</p> MyCelesteModSession.cs<pre><code>namespace Celeste.Mod.MyCelesteMod;\n\npublic class MyCelesteModSession : EverestModuleSession\n{\n}\n</code></pre> MyCelesteModModule.cs<pre><code>namespace Celeste.Mod.MyCelesteMod;\n\npublic class MyCelesteModModule : EverestModule\n{\n    public static MyCelesteModModule Instance { get; private set; }\n\n    public override Type SettingsType =&gt; typeof(MyCelesteModSettings);\n    public static MyCelesteModSettings Settings =&gt; (MyCelesteModSettings)Instance._Settings;\n\n    public override Type SessionType =&gt; typeof(MyCelesteModSession);\n    public static MyCelesteModSession Session =&gt; (MyCelesteModSession)Instance._Session;\n\n    public override void Load()\n    {\n        Instance = this;\n    }\n\n    public override void Unload()\n    {\n    }\n}\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4efb\u4f55\u6e38\u620f\u5904\u4e8e\u5173\u5361\u5185\u7684\u65f6\u5019\u4f7f\u7528 <code>MyCelesteModModule.Session</code> \u6765\u8bbf\u95ee\u6211\u4eec\u7684 Session \u4e86. \u5982\u679c\u4f60\u5c1d\u8bd5\u5728\u6e38\u620f\u4e0d\u5728\u5173\u5361\u5185\u65f6\u8bfb\u53d6\u5b83, \u90a3\u4e48\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a <code>null</code> \u503c.  </p> <p>\u5047\u8bbe\u73b0\u5728 <code>SetPassByRefillDashesTrigger</code> \u7684\u529f\u80fd\u4e3a\"\u5c06\u6240\u6709\u7684<code>PassByRefill</code>\u51b2\u6b21\u6570\u56fa\u5b9a\u4e3a\u4e00\u4e2a\u503c\", \u90a3\u4e48\u663e\u7136\u78b0\u5230trigger\u518d\u4e3b\u52a8\u53bb\u6539\u662f\u9519\u8bef\u7684\u505a\u6cd5, \u56e0\u4e3a\u5207\u677f/\u4fdd\u5b58\u5e76\u9000\u51fa\u4f1a\u5bfc\u81f4<code>PassByRefill</code>\u91cd\u65b0\u52a0\u8f7d, \u51b2\u523a\u6570\u4e5f\u4f1a\u88ab\u6539\u56de\u53bb, \u8fd9\u4e2a\u65f6\u5019<code>Session</code>\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86(\u4e00\u4e9b\u6bd4\u8f83\u7b80\u5355\u7684\u9700\u6c42\u7528\u539f\u7248\u7684<code>Session</code>\u5c31\u8db3\u591f\u4e86, \u8fd9\u91cc\u6211\u4eec\u7528\u81ea\u5b9a\u4e49\u7684), \u4ee5\u4e0b\u4e3a\u793a\u4f8b\u4ee3\u7801</p> MyCelesteModSession.cs<pre><code>namespace Celeste.Mod.MyCelesteMod;\n\npublic class MyCelesteModSession : EverestModuleSession\n{\n    public int FixedPassByRefillDashes = -1;  // \u6211\u4eec\u8bb0\u5f55Trigger\u4fee\u6539\u7684\u503c(-1\u8868\u793a\u8fd8\u6ca1\u6539\u8fc7), \u4e4b\u540ePassByRefill\u4ece\u8fd9\u8bfb\n}\n</code></pre> SetPassByRefillDashesTrigger.cs<pre><code>using Celeste.Mod.Entities;\n\nnamespace MyCelesteMod;\n\n[CustomEntity(\"MyCelesteMod/SetPassByRefillDashesTrigger\")]\npublic class SetPassByRefillDashesTrigger : Trigger\n{\n    public int Dashes;\n\n    public SetPassByRefillDashesTrigger(EntityData data, Vector2 offset)\n        : base(data, offset)\n    {\n        Dashes = data.Int(\"dashes\");\n    }\n\n    public override void OnEnter(Player player)\n    {\n        base.OnEnter(player);\n        MyCelesteModModule.Session.FixedPassByRefillDashes = Dashes;\n    }\n}\n</code></pre> PassByRefill.cs<pre><code>using Celeste.Mod.Entities;\n\nnamespace MyCelesteMod;\n\n[CustomEntity(\"MyCelesteMod/PassByRefill\")]\npublic class PassByRefill : Entity\n{\n    private int _dashes;\n    public int Dashes =&gt; MyCelesteModModule.Session.FixedPassByRefillDashes == -1 ? _dashes : MyCelesteModModule.Session.FixedPassByRefillDashes;\n\n    private Image image;\n\n    public PassByRefill(Vector2 position, int dashes)\n    {\n        Depth = 1;\n        _dashes = dashes;\n        Position = position;\n        Hitbox hitbox = new(64, 64);\n        Collider = hitbox;\n\n        MTexture tex = GFX.Game[\"MyCelesteMod/pass_by_refill\"];\n        image = new(tex);\n        Add(image);\n    }\n\n    public PassByRefill(EntityData data, Vector2 offset)\n        : this(data.Position + offset, data.Int(\"dashes\"))\n    {\n    }\n\n    public override void Update()\n    {\n        base.Update();\n        var player = Scene.Tracker.GetEntity&lt;Player&gt;();\n        if (player is not null &amp;&amp; CollideCheck(player))\n        {\n            player.Dashes = Dashes;\n        }\n    }\n}\n</code></pre>"},{"location":"basics/session_settings_savedata/#savedata","title":"SaveData","text":"<p>\u987e\u540d\u601d\u4e49, <code>SaveData</code> \u7528\u6765\u4fdd\u5b58\u4e00\u4e9b\u6301\u4e45\u5316\u6570\u636e, \u4f8b\u5982\u5f53\u524d\u5b58\u6863\u603b\u65f6\u95f4, \u603b\u6b7b\u4ea1\u6570, \u603b\u8349\u8393\u6570\u7b49. \u4f7f\u7528\u5b83\u4e0e\u4f7f\u7528 <code>Session</code> \u6781\u5176\u76f8\u4f3c:</p> MyCelesteModSaveData.cs<pre><code>namespace Celeste.Mod.MyCelesteMod;\n\npublic class MyCelesteModSaveData : EverestModuleSaveData\n{\n}\n</code></pre> MyCelesteModModule.cs<pre><code>namespace Celeste.Mod.MyCelesteMod;\n\npublic class MyCelesteModModule : EverestModule\n{\n    public static MyCelesteModModule Instance { get; private set; }\n\n    public override Type SettingsType =&gt; typeof(MyCelesteModSettings);\n    public static MyCelesteModSettings Settings =&gt; (MyCelesteModSettings)Instance._Settings;\n\n    public override Type SessionType =&gt; typeof(MyCelesteModSession);\n    public static MyCelesteModSession Session =&gt; (MyCelesteModSession)Instance._Session;\n\n    public override Type SaveDataType =&gt; typeof(MyCelesteModSaveData);\n    public static MyCelesteModSaveData SaveData =&gt; (MyCelesteModSaveData)Instance._SaveData;\n\n    public override void Load()\n    {\n        Instance = this;\n    }\n\n    public override void Unload()\n    {\n    }\n}\n</code></pre>"},{"location":"coding_challenges/simple_entity/","title":"\u7b80\u5355\u81ea\u5b9a\u4e49\u5b9e\u4f53","text":"<p>\u5728\u77e5\u9053\u4e00\u4e9b mod \u5236\u4f5c\u4e2d\u6700\u4e3a\u57fa\u7840\u7684\u4e1c\u897f\u540e, \u6211\u4eec\u9996\u5148\u628a\u5174\u8da3\u70b9\u8f6c\u5411\u81ea\u5b9a\u4e49\u5b9e\u4f53, \u76f8\u4fe1\u76f8\u5bf9\u4e8e\u4fee\u6539\u5df2\u6709\u7684\u4e1c\u897f\u5e76\u4f34\u968f\u7740\u4e00\u5b9a\u7684\u70e7\u8111(\u6211\u8be5\u600e\u4e48\u6539? \u8fd9\u4e48\u6539\u4f1a\u4e0d\u4f1a\u7834\u574f\u5b98\u56fe\u5143\u7d20?), \u4f60\u53ef\u80fd\u66f4\u559c\u6b22\u81ea\u5df1\u5236\u4f5c\u4e00\u4e2a\u5b9e\u4f53, \u90a3\u5c31\u5bf9\u4e86! \u5728\u8fd9\u4e00\u8282, \u6211\u4eec\u4f1a\u4e86\u89e3 loenn \u7684\u57fa\u7840\u4f7f\u7528\u3001\u6dfb\u52a0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5b9e\u4f53\u7684\u901a\u7528\u6b65\u9aa4, \u4ee5\u53ca\u4e00\u4e9b\u6e38\u620f\u5e38\u7528\u7684\u65b9\u6cd5!</p>"},{"location":"coding_challenges/simple_entity/#_2","title":"\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u5b9e\u4f53\u7c7b","text":""},{"location":"coding_challenges/simple_entity/#_3","title":"\u5b83\u80fd\u5e72\u4ec0\u4e48","text":"<p>\u5728\u5f00\u59cb\u5236\u4f5c\u8fd9\u4e2a\u81ea\u5b9a\u4e49\u5b9e\u4f53\u4e4b\u524d, \u6211\u4eec\u5148\u660e\u767d\u4e00\u4e0b\u8fd9\u4e2a\u5b9e\u4f53\u505a\u51fa\u6765\u662f\u4ec0\u4e48\u6548\u679c\u7684. \u90a3\u4e48, \u4e3a\u4e86\u7b80\u5355\u8d77\u89c1, \u8fd9\u91cc\u5c31\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u529f\u80fd, \u5b83\u5927\u6982\u662f:</p> <ul> <li>\u5b83\u53eb\u505a <code>PassByRefill</code></li> <li>\u957f\u5ea6\u548c\u5bbd\u5ea6\u662f\u968f\u610f\u7684</li> <li>\u5b83\u770b\u8d77\u6765\u662f\u4e2a\u900f\u660e\u7684\u7ea2\u8272\u7269\u4f53</li> <li>\u73a9\u5bb6\u4e0e\u5176\u78b0\u649e\u65f6\u4f1a\u9501\u5b9a\u4e3a\u67d0\u4e2a\u51b2\u523a\u6570</li> <li>\u8fd9\u4e2a\u51b2\u523a\u6570\u53ef\u4ee5\u5728\u4f5c\u56fe\u8f6f\u4ef6\u4e2d\u8bbe\u7f6e</li> </ul> <p>\u662f\u7684\u5c31\u8fd9\u6837\u7b80\u5355, \u90a3\u4e48\u6211\u4eec\u5f00\u59cb\u5427.</p>"},{"location":"coding_challenges/simple_entity/#_4","title":"\u58f0\u660e\u8fd9\u4e2a\u7c7b","text":"<p>Warning</p> <p>\u5728\u524d\u9762\u6211\u4eec\u94a9\u53d6\u4e86 <code>Player.Update()</code> \u5e76\u4e14\u5728\u4e00\u76f4\u4fee\u6539\u51b2\u523a\u6570\u4e3a 1! \u4e0d\u8981\u5fd8\u8bb0\u628a\u94a9\u5b50\u51fd\u6570\u4ee5\u53ca\u94a9\u53d6\u548c\u53d6\u6d88\u94a9\u53d6\u7684\u90a3\u4e9b\u4ee3\u7801\u5220\u6389, \u6700\u540e\u4f60\u7684 Module \u7c7b\u5e94\u8be5\u53ea\u5305\u542b\u4e24\u4e2a\u7a7a\u7684 <code>Load</code> \u548c <code>Unload</code> \u65b9\u6cd5!</p> <p>\u9996\u5148\u5728\u4ee3\u7801\u4e2d, \u6211\u4eec\u9700\u8981\u58f0\u660e\u8fd9\u4e2a\u7c7b, \u4e5f\u5c31\u662f\u521b\u5efa\u4e00\u4e2a .cs \u6587\u4ef6, \u7136\u540e\u547d\u4e2a\u540d. \u5728\u8fd9\u91cc\u4f60\u8fd8\u9700\u8981\u7ee7\u627f\u4e00\u4e0b <code>Entity</code>, \u5728\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u8fc7\u4e86\u5b83\u662f <code>Monocle</code> \u7684\u4e00\u4e2a\u7c7b, \u8868\u793a\u573a\u666f\u4e2d\u7684\u5b9e\u4f53. \u90a3\u4e48\u4f60\u5e94\u8be5\u4f1a\u5199\u51fa\u5982\u4e0b\u7684\u4ee3\u7801:</p> PassByRefill.cs<pre><code>namespace MyCelesteMod;\n\npublic class PassByRefill : Entity\n{\n\n}\n</code></pre> <p>ok, \u63a5\u4e0b\u6765, \u6211\u4eec\u52a0\u4e00\u4e2a\u8868\u793a\u51b2\u523a\u6570\u7684\u5b57\u6bb5, \u7136\u540e\u641e\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u63a5\u6536\u5e76\u8d4b\u503c\u5b83: PassByRefill.cs<pre><code>public int Dashes = 0;\n\npublic PassByRefill(Vector2 position, Vector2 size, int dashes)\n{\n    Position = position;\n    Dashes = dashes;\n}\n</code></pre></p> <p>\u8fd9\u91cc\u7684 <code>position</code> \u53c2\u6570\u4f1a\u88ab\u7528\u4e8e\u8bbe\u7f6e\u5b83\u7684 <code>Position</code> \u5b57\u6bb5, \u8fd9\u4e2a\u5b57\u6bb5\u4ece <code>Monocle.Entity</code> \u7ee7\u627f\u800c\u6765, \u5b83\u8868\u793a\u8fd9\u4e2a <code>Entity</code> \u5728\u573a\u666f\u4e2d\u6240\u5728\u7684\u4f4d\u7f6e(\u4e16\u754c\u5750\u6807). <code>Vector2</code> \u662f\u4e00\u4e2a XNA \u4e2d\u7684\u7ed3\u6784\u4f53, \u5305\u542b\u4e00\u4e2a <code>X</code> \u548c\u4e00\u4e2a <code>Y</code> \u7684 <code>float</code> \u5b57\u6bb5, \u5b83\u7528\u4e8e\u63cf\u8ff0\u4e00\u4e2a\u5e73\u9762\u5411\u91cf, \u5c31\u50cf\u4f60\u5728\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e2d\u6240\u505a\u7684\u4e00\u6837! \u4e0d\u8fc7\u8fd9\u91cc\u9700\u8981\u6ce8\u610f, \u6e38\u620f\u4e2d\u7684\u5750\u6807\u7cfb\u548c\u6211\u4eec\u901a\u5e38\u6570\u5b66\u4e2d\u7684\u5750\u6807\u7cfb\u4e0d\u540c, \u5b83\u7684\u539f\u70b9\u5728\u5de6\u4e0a\u89d2, X \u8f74\u6c34\u5e73\u5411\u53f3\u4f46\u662f Y \u8f74\u7ad6\u76f4\u5411\u4e0b! \u8bb0\u4f4f\u4e0d\u8981\u641e\u6df7\u4e86. \u4f60\u53ef\u80fd\u6ce8\u610f\u5230\u6211\u4eec\u5e76\u6ca1\u6709\u7406 <code>size</code> \u8fd9\u4e2a\u8868\u793a\u5927\u5c0f\u53c2\u6570, \u7a0d\u7b49\u4e00\u4e0b, \u6211\u4eec\u7b49\u4f1a\u5c31\u4f1a\u4f7f\u7528\u5b83\u4e86.</p> <p></p> <p>\u63a5\u4e0b\u6765, \u6211\u4eec\u9700\u8981\u58f0\u660e\u4e00\u4e2a\u7279\u6b8a\u7684\u6784\u9020\u51fd\u6570, \u4ee5\u8ba9 Everest \u53cd\u5c04\u8c03\u7528\u5e76\u4f7f\u5f97\u6211\u4eec\u7684\u5b9e\u4f53\u53ef\u4ee5\u6b63\u5e38\u83b7\u53d6\u5730\u56fe\u7684\u6570\u636e, \u7136\u540e\u5c06\u6570\u636e\u4f20\u7ed9\u6211\u4eec\u7684\u6784\u9020\u51fd\u6570: PassByRefill.cs<pre><code>public PassByRefill(EntityData data, Vector2 offset) \n        : this(data.Position + offset, new Vector2(data.Width, data.Height), data.Int(\"dashes\"))\n    { }\n</code></pre> \u5728\u8fd9\u91cc, <code>EntityData data</code> \u50a8\u5b58\u4e86\u4f5c\u56fe\u8f6f\u4ef6\u4fdd\u5b58\u7684\u76f8\u5173\u6570\u636e, \u6211\u4eec\u8981\u63d0\u53d6\u5b83\u4eec\u5f88\u7b80\u5355. \u6bd4\u5982\u8bf4\u6211\u4eec\u8981\u63d0\u53d6\u4e00\u4e2a\u540d\u4e3a <code>dashes</code> \u7684 <code>int</code> \u7c7b\u578b\u7684\u6570\u636e, \u6211\u4eec\u5c31\u7b80\u5355\u5730\u8c03\u7528\u5b83\u7684\u65b9\u6cd5 <code>Int(string name)</code>, \u7136\u540e\u662f\u5b83\u7684\u5927\u5c0f\u6570\u636e, \u5927\u5c0f\u5728\u8fd9\u662f\u4e2a\u7279\u6b8a\u7684\u4e1c\u897f, \u5f97\u9700\u8981\u901a\u8fc7 <code>Width</code> \u548c <code>Height</code> \u5b57\u6bb5\u6765\u63d0\u53d6, \u7136\u540e\u6211\u4eec\u6254\u8fdb <code>Vector2</code> \u91cc\u5e76\u4f20\u9012\u7ed9\u6211\u4eec\u4e0a\u9762\u7684\u6784\u9020\u51fd\u6570. \u5bf9\u4e8e\u66f4\u591a\u65b9\u6cd5\u4ee5\u53ca\u8fd9\u90e8\u5206\u6570\u636e\u8be5\u5982\u4f55\u81ea\u5b9a\u4e49\u6211\u4eec\u4f1a\u5728\u672c\u8282\u540e\u534a\u90e8\u5206\u8bf4\u660e. <code>Vector2 offset</code> \u53c2\u6570\u8868\u793a\u8fd9\u4e00\u9762\u7684\u6700\u5de6\u4e0a\u89d2\u7684\u4e16\u754c\u5750\u6807, <code>EntityData</code> \u7684 <code>Position</code> \u5b57\u6bb5\u8868\u793a\u7269\u4f53\u76f8\u5bf9\u4e8e\u8fd9\u4e00\u9762\u6700\u5de6\u4e0a\u89d2\u7684\u4f4d\u7f6e, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u628a\u5b83\u76f8\u52a0\u6765\u5f97\u5230\u4e16\u754c\u5750\u6807. (\u56e0\u4e3a <code>Entity.Position</code> \u901a\u5e38\u53ea\u5141\u8bb8\u4e16\u754c\u5750\u6807!)</p> <p></p> <p>Info</p> <p>\u8fd9\u4e2a\u6784\u9020\u51fd\u6570\u7684\u7b7e\u540d\u4e5f\u80fd\u4e3a\u5176\u4ed6\u7684\u6837\u5b50, \u4f46\u662f\u6211\u4eec\u6700\u6700\u6700\u5e38\u7528\u7684\u4e00\u4e2a\u7248\u672c\u5c31\u662f\u4e0a\u9762\u8fd9\u4e2a</p>"},{"location":"coding_challenges/simple_entity/#everest","title":"\u8ba9 Everest \u627e\u5230\u5b83","text":"<p>\u73b0\u5728\u6211\u4eec\u53ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b Everest \u90a3\u8fb9\u662f\u5565\u4e5f\u4e0d\u77e5\u9053\u7684, \u6240\u4ee5\u6211\u4eec\u5f97\u544a\u8bc9\u5b83, \u800c\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u4eec\u4e00\u822c\u5c31\u53eb <code>\u6ce8\u518c</code>. \u8981\u6ce8\u518c\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5b9e\u4f53\u975e\u5e38\u7b80\u5355, \u6211\u4eec\u53ea\u9700\u8981\u5c06 <code>CustomEntity</code> (\u5728\u547d\u540d\u7a7a\u95f4 <code>Celeste.Mod.Entities</code> \u4e2d) \u88c5\u9970\u5230\u6211\u4eec\u7684\u7c7b\u4e0a\u5e76\u4f20\u5165\u6211\u4eec\u5b9e\u4f53\u7684 \"\u540d\u79f0 ID\". \u5c31\u50cf: PassByRefill.cs<pre><code>[CustomEntity(\"MyCelesteMod/PassByRefill\")]\npublic class PassByRefill : Entity\n{\n......\n</code></pre> \u5728\u8fd9\u91cc \"\u540d\u79f0 ID\" \u6211\u4eec\u4e00\u822c\u63a8\u8350\u4ee5 \"{Mod\u540d}/\u8be5\u5b9e\u4f53\u7c7b\u540d\" \u8fdb\u884c\u547d\u540d, \u5c31\u50cf\u8fd9\u91cc\u4e00\u6837, Mod \u540d\u4e3a <code>MyCelesteMod</code>, \u7c7b\u540d\u4e3a <code>PassByRefill</code>, \u5b9e\u4f53 \"\u540d\u79f0 ID\" \u5c31\u662f <code>MyCelesteMod/PassByRefill</code>. \u8fd9\u91cc\u6211\u5efa\u8bae\u4f60\u8bb0\u4f4f\u5b83, \u5f85\u4f1a\u6211\u4eec\u4f1a\u5728\u4f5c\u56fe\u8f6f\u4ef6\u914d\u7f6e\u7684\u65f6\u5019\u7528\u5230.</p>"},{"location":"coding_challenges/simple_entity/#loenn","title":"Loenn","text":"<p>\u4f5c\u56fe\u8f6f\u4ef6</p> <p>\u851a\u84dd\u7684\u4f5c\u56fe\u8f6f\u4ef6\u6700\u6d41\u884c\u7684\u76ee\u524d\u6709 <code>ahorn</code> \u4e0e <code>loenn</code>, \u4e0d\u8fc7\u6211\u66f4\u63a8\u8350 <code>loenn</code>, \u56e0\u4e3a <code>ahorn</code> \u5b9e\u5728\u662f \u592a!!\u5361!!\u4e86!!</p>"},{"location":"coding_challenges/simple_entity/#_5","title":"\u57fa\u7840\u4f7f\u7528","text":"<p>Loenn \u662f\u4e00\u4e2a\u851a\u84dd\u7684\u4f5c\u56fe\u8f6f\u4ef6, \u5f53\u7136\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u5b83\u4e0d\u662f\u5236\u4f5c\u51fa\u7cbe\u7f8e\u7684\u5730\u56fe, \u800c\u662f\u4ec5\u4ec5\u653e\u7f6e\u4e00\u4e0b\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u5b9e\u4f53! _(:\u0437\u300d\u2220)_, \u8fd9\u91cc\u6211\u4e0d\u600e\u4e48\u60f3\u91cd\u590d\u5b83\u7684\u57fa\u7840\u4f7f\u7528, \u6240\u4ee5\u6211\u63a8\u8350\u4f60\u53bb\u4ee5\u4e0b\u51e0\u4e2a\u89c6\u9891\u4e2d\u4e86\u89e3(\u53ef\u5728\u6d4b\u8bd5\u5730\u56fe\u4e2d\u6363\u9f13):</p> <ul> <li>Bilibili \u3010Celeste\u851a\u84dd\u3011\u7535\u7bb1\u4f5c\u56fe\u6559\u7a0b\u91cd\u7f6e\u7248 0-1 Loenn\u7684\u5b89\u88c5</li> <li>Bilibili \u3010Celeste\u851a\u84dd\u3011\u7535\u7bb1\u4f5c\u56fe\u6559\u7a0b\u91cd\u7f6e\u7248 1-1 Loenn\u7684\u4f7f\u7528</li> </ul> <p>\u7248\u672c</p> <p>\u5982\u679c\u4f60\u4e4b\u524d\u5df2\u7ecf\u4e0b\u8f7d\u4e86 Loenn, \u6211\u5efa\u8bae\u4f60\u786e\u4fdd\u5b83\u5347\u7ea7\u5230\u6700\u65b0\u7248\u4e86, \u56e0\u4e3a\u63a5\u4e0b\u6765\u7684\u67d0\u4e9b\u4e1c\u897f\u6211\u53ef\u80fd\u4e0d\u592a\u8bb0\u5f97\u662f\u54ea\u4e2a\u7248\u672c\u5f15\u5165\u7684\u4e86.</p>"},{"location":"coding_challenges/simple_entity/#loenn_1","title":"\u8ba9 Loenn \u627e\u5230\u6211\u4eec\u7684\u5b9e\u4f53","text":"<p>\u76f8\u4fe1\u4f60\u73b0\u5728\u5df2\u7ecf\u61c2\u7684 Loenn \u57fa\u672c\u7684\u4f7f\u7528\u7528\u6cd5\u4e86, \u90a3\u4e48\u73b0\u5728, \u6211\u4eec\u8981\u7ed9 Loenn \u5199\u4e00\u4e9b\u4e1c\u897f\u8ba9\u5b83\u77e5\u9053\u6211\u4eec\u8fd9\u4e2a\u5b9e\u4f53 mapper \u4eec\u80fd\u7528\u4e86. \u9996\u5148\u6211\u4eec\u5728 ModFolder \u4e0b\u65b0\u5efa\u4e00\u4e2a\u53eb <code>Loenn</code> \u7684\u6587\u4ef6\u5939, \u518d\u5728\u91cc\u9762\u65b0\u5efa\u4e00\u4e2a\u53eb <code>entities</code> \u7684\u6587\u4ef6\u5939, \u518d\u5728\u91cc\u9762\u65b0\u5efa\u4e00\u4e2a\u53eb <code>PassByRefill.lua</code> (\u4e5f\u5c31\u662f<code>{\u5b9e\u4f53\u7c7b\u540d}.lua</code>) \u7684\u6587\u672c\u6587\u4ef6. \u73b0\u5728\u4f60\u7684\u76ee\u5f55\u7ed3\u6784\u5e94\u8be5\u662f\u8fd9\u6837\u7684:</p> <ul> <li>ModFolder<ul> <li>Loenn<ul> <li>entities<ul> <li>PassByRefill.lua</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>ok, \u7136\u540e\u6211\u4eec\u6253\u5f00 <code>PassByRefill.lua</code>, \u8fd9\u662f\u4e00\u4e2a <code>lua</code> \u8bed\u8a00\u7684\u6e90\u6587\u4ef6, \u8fd9\u91cc\u6211\u4eec\u4e0d\u9700\u8981\u5f88\u591a <code>lua</code> \u77e5\u8bc6, \u76f4\u63a5\u7167\u7740\u6284\u5c31\u597d\u4e86:</p> PassByRefill.lua<pre><code>local entity = {}\n\nentity.name = \"MyCelesteMod/PassByRefill\"\nentity.placements = {\n    name = \"normal\",\n    data = {\n        width = 16,\n        height = 16,\n        dashes = 1\n    }\n}\n\nreturn entity\n</code></pre> <p>\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u8bb0\u4f4f\u7684\u5b9e\u4f53 \"\u540d\u79f0 ID\" \u5417? \u5728\u8fd9\u91cc\u4f60\u5c31\u9700\u8981\u5c06\u5176\u8d4b\u503c\u7ed9 <code>entity.name</code>.  </p> <ul> <li>\u7136\u540e\u662f <code>entity</code> \u7684 <code>placements</code>, \u5b83\u8868\u793a\u8fd9\u4e2a\u5b9e\u4f53\u7684\u653e\u7f6e\u9009\u9879, \u5728\u8fd9\u91cc\u6211\u4eec\u5148\u4e0d\u7ba1, \u4f60\u5c31\u7406\u89e3\u4e3a\u4f60\u5e0c\u671b Loenn \u600e\u4e48\u628a\u4f60\u8fd9\u4e2a\u5b9e\u4f53\u62c6\u5206\u4e3a\u591a\u4e2a\u653e\u7f6e\u9009\u9879, \u8fd9\u91cc\u6211\u4eec\u7684\u5199\u6cd5\u8868\u793a\u4e0d\u5e0c\u671b Loenn \u62c6\u5206\u5b83, \u5982\u679c\u8fd9\u91cc\u7684 <code>placements</code> \u662f\u4e2a\u6570\u7ec4\u7684\u8bdd\u90a3\u4e48 Loenn \u5c31\u4f1a\u62c6\u5206\u5b83\u4e86.<ul> <li>\u7ee7\u7eed\u5230 <code>name</code> \u5c5e\u6027, \u5b83\u8868\u793a\u8fd9\u4e2a\u653e\u7f6e\u9009\u9879\u7684\u540d\u79f0, \u8fd9\u4e2a\u540d\u79f0\u662f\u4efb\u610f\u7684, \u5b83\u53ea\u88ab\u7528\u6765\u4f5c\u4e3a\u672c\u5730\u5316\u952e\u540d(\u672c\u5730\u5316\u5c31\u5305\u62ec\u6211\u4eec\u5e38\u8bf4\u7684\"\u6c49\u5316\").</li> <li>\u7136\u540e\u662f <code>data</code> \u5c5e\u6027, \u5b83\u8868\u793a\u8fd9\u4e2a\u5b9e\u4f53\u7684\u6570\u636e.<ul> <li>\u5728\u8fd9\u91cc\u6211\u4eec\u58f0\u660e\u4e86\u4e09\u4e2a\u6570\u5b57\u7c7b\u578b\u7684\u5c5e\u6027: <code>width</code>, <code>height</code>, <code>dashes</code>, \u524d\u4e24\u4e2a\u5c5e\u6027\u662f\u7279\u6b8a\u7684, \u5728\u4ee3\u7801\u4e2d\u63d0\u53d6\u53ea\u9700\u8981\u5bf9 <code>EntityData</code> \u83b7\u53d6 <code>Width</code>/<code>Height</code> \u5b57\u6bb5\u5373\u53ef.  </li> <li>\u7b2c\u4e09\u4e2a <code>dashes</code> \u5c5e\u6027\u5c31\u662f\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u5c5e\u6027</li> </ul> </li> </ul> </li> </ul> <p>\u5728 <code>data</code> \u5bf9\u8c61\u91cc\u7684\u5c5e\u6027, \u540e\u9762\u7684\u7b49\u53f7\u5c31\u8868\u793a\u5b83\u7684\u9ed8\u8ba4\u503c, \u6bd4\u5982 <code>width</code> \u9ed8\u8ba4\u4e3a 16, <code>dashes</code> \u9ed8\u8ba4\u4e3a 1.</p> <p>Note</p> <p>\u5982\u679c\u4f60\u4e0d\u58f0\u660e <code>width</code> \u548c <code>height</code> \u5c5e\u6027\u5e76\u4e14\u4e0d\u52a0\u8d34\u56fe\u7684\u8bdd Loenn \u4f3c\u4e4e\u4f1a\u76f4\u63a5\u7981\u6b62\u4f60\u653e\u7f6e\u8fd9\u4e2a\u5b9e\u4f53.</p> <p>\u597d\u5427\u770b\u8d77\u6765\u4e0a\u9762\u8fd9\u4e00\u5768*\u975e\u5e38\u96be\u61c2*, \u4e0d\u8fc7\u6ca1\u5173\u7cfb, \u53ea\u8981\u4f60\u4f1a\u76f4\u63a5\u590d\u5236\u4e0a\u9762\u7684\u4e1c\u897f, \u6539\u4e00\u4e0b <code>entity.name</code>, \u5411 <code>data</code> \u91cc\u52a0\u4e00\u4e9b\u5c5e\u6027\u5c31\u884c\u4e86. \u5b9e\u9645\u4e0a\u6211\u4e5f\u662f\u8fd9\u4e48\u505a\u7684.  </p> <p>\u90a3\u4e48, \u91cd\u65b0\u7f16\u8bd1\u6211\u4eec\u7684\u9879\u76ee, \u8ba9 <code>msbuild</code> \u628a\u6211\u4eec\u7684\u4e1c\u897f\u590d\u5236\u8fc7\u53bb, \u8fd9\u65f6\u6253\u5f00\u6211\u4eec\u7684 Loenn (\u6216\u8005\u91cd\u542f Loenn), \u641c\u7d22\u4e00\u4e0b <code>@MyCelesteMod</code>. \u90a3\u4e48\u5217\u8868\u4e0a\u5e94\u8be5\u53ea\u4f1a\u51fa\u73b0\u4e00\u4e2a\u540d\u5b57\u5f88\u5947\u602a\u7684\u9009\u9879(\u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u914d\u7f6e\u672c\u5730\u5316\u76f8\u5173\u7684\u4e1c\u897f!), \u73b0\u5728\u628a\u5b83\u653e\u5230\u4efb\u4f55\u4f60\u559c\u6b22\u7684\u5730\u65b9, \u6253\u5f00\u5b83\u7684\u5c5e\u6027\u6846, \u6211\u4eec\u5c31\u80fd\u770b\u5230\u4e00\u4e2a\u5927\u5927\u7684 <code>dashes</code> \u5c5e\u6027\u5728\u4e0a\u9762\u5141\u8bb8\u6211\u4eec\u6539\u5566. \u4f60\u53ef\u80fd\u6ce8\u610f\u5230\u5b83\u662f\u5168\u767d\u7684! \u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u544a\u8bc9 Loenn \u5b83\u957f\u4ec0\u4e48\u6837! \u4e0d\u8fc7\u8fd9\u4e2a\u7b49\u4ee5\u540e\u6211\u4eec\u518d\u6765\u641e.</p>"},{"location":"coding_challenges/simple_entity/#_6","title":"\u56de\u5230\u4ee3\u7801","text":"<p>\u73b0\u5728\u5728\u6e38\u620f\u4e2d\u8fdb\u5165\u653e\u4e86\u6211\u4eec\u90a3\u4e2a\u5b9e\u4f53\u7684\u90a3\u5f20\u56fe, \u7136\u540e\u5230\u4e4b\u524d\u4f60\u559c\u6b22\u7684\u90a3\u4e2a\u5730\u65b9, \u7136\u540e... \u662f\u7684, \u4f60\u5565\u4e5f\u4e0d\u4f1a\u770b\u89c1, \u56e0\u4e3a\u6211\u4eec\u4e5f\u6ca1\u544a\u8bc9\u6e38\u620f\u5b83\u957f\u4ec0\u4e48\u6837! \u540c\u65f6\u4f60\u8d70\u5230\u5b83\u9644\u8fd1, \u4e5f\u4e0d\u4f1a\u53d1\u751f\u4efb\u4f55\u4e8b, \u56e0\u4e3a\u6211\u4eec\u4e5f\u6ca1\u544a\u8bc9\u6e38\u620f\u8fd9\u4e2a\u5b9e\u4f53\u5e94\u8be5\u5e72\u4ec0\u4e48!</p>"},{"location":"coding_challenges/simple_entity/#_7","title":"\u544a\u8bc9\u6e38\u620f\u5b83\u8be5\u505a\u4ec0\u4e48","text":"<p>\u90a3\u4e48, \u5c31\u50cf\u524d\u9762\u63cf\u8ff0\u7684\u4e00\u6837, \"\u73a9\u5bb6\u4e0e\u5176\u78b0\u649e\u65f6\u4f1a\u9501\u5b9a\u4e3a\u67d0\u4e2a\u51b2\u523a\u6570\", \u90a3\u4e48\u6211\u4eec\u9700\u8981\u505a\u4e00\u4e9b\u78b0\u649e. \u5728 <code>Monocle</code> \u91cc\u8fd9\u9879\u5de5\u4f5c\u5f88\u7b80\u5355, \u6211\u4eec\u9996\u5148\u5728\u6784\u9020\u51fd\u6570\u91cc\u53bb <code>new</code> \u4e00\u4e2a\u957f\u65b9\u5f62\u7684\u78b0\u649e\u7bb1: PassByRefill.PassByRefill<pre><code>public PassByRefill(Vector2 position, Vector2 size, int dashes)\n{\n    Hitbox hitbox = new(size.X, size.Y);\n}\n</code></pre></p> <p>Info</p> <p>\u6211\u4eec\u5728\u8fd9\u91cc\u7528\u5230\u4e86\u4e4b\u524d\u7684 <code>size</code> \u53c2\u6570</p> <p><code>Hitbox</code> \u5c31\u662f\u6211\u4eec\u60f3\u8981\u7684\u957f\u65b9\u5f62\u78b0\u649e\u7bb1, \u5b83\u7684\u552f\u4e00\u7684\u6784\u9020\u5668\u63a5\u6536\u56db\u4e2a\u53c2\u6570, \u524d\u4e24\u4e2a\u53c2\u6570\u4e3a\u5b83\u7684\u5bbd\u9ad8, \u540e\u4e24\u4e2a\u53c2\u6570\u4e3a\u8fd9\u4e2a\u78b0\u649e\u7bb1\u7684\u504f\u79fb(\u56e0\u4e3a\u78b0\u649e\u7bb1\u6211\u4eec\u8981\u9644\u52a0\u5230 <code>Entity</code> \u8eab\u4e0a, \u6240\u4ee5\u4f1a\u6709\u504f\u79fb\u8fd9\u4e2a\u4e1c\u897f), \u8fd9\u4e24\u4e2a\u53c2\u6570\u9ed8\u8ba4\u90fd\u4e3a 0. \u7136\u540e\u8bbe\u7f6e\u5230 <code>Entity</code> \u8eab\u4e0a: PassByRefill.PassByRefill<pre><code>Collider = hitbox;\n</code></pre> <code>Collider</code> \u662f <code>Entity</code> \u7684\u4e00\u4e2a\u5c5e\u6027, \u5b83\u8868\u793a\u8fd9\u4e2a <code>Entity</code> \u81ea\u8eab\u7684\u78b0\u649e\u7bb1. <code>Collider</code> \u5c5e\u6027\u662f <code>Collider</code> \u7c7b\u578b\u7684, \u5b83\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\u8868\u793a\u4e00\u4e2a\u78b0\u649e\u4f53, \u8fd9\u91cc\u6211\u4eec\u7684 <code>Hitbox</code> \u5c31\u662f\u5b83\u7684\u4e00\u4e2a\u5b9e\u73b0, \u4e5f\u5c31\u662f\u4e00\u79cd\u957f\u65b9\u5f62\u78b0\u649e\u7bb1\u7684\u5b9e\u73b0.  </p> <p>\u78b0\u649e\u7bb1\u8bbe\u7f6e\u5b8c\u540e, \u6211\u4eec\u5c31\u8be5\u5728 <code>Update()</code> \u91cc\u68c0\u6d4b\u78b0\u649e\u4e86, \u8fd9\u5f88\u7b80\u5355~ PassByRefill.Update()<pre><code>public override void Update()\n{\n    base.Update();\n    // \u83b7\u53d6 Player \u5b9e\u4f8b (\u522b\u5bb3\u6015!)\n    var player = Scene.Tracker.GetEntity&lt;Player&gt;();\n\n    // \u68c0\u6d4b\u662f\u5426\u4e0e\u73a9\u5bb6\u78b0\u649e\n    if (player is not null &amp;&amp; this.CollideCheck(player))\n    {\n        // \u5982\u679c\u78b0\u649e\u4e86, \u90a3\u4e48\u8bbe\u7f6e\u5b83\u7684\u51b2\u523a\u6570\n        player.Dashes = this.Dashes;\n    }\n}\n</code></pre></p> <p>\u76f8\u4fe1\u4f60\u770b\u5230\u7b2c\u4e94\u884c\u4e00\u5b9a\u4f1a\u88ab\u5413\u4e00\u8df3! \u76f8\u4fe1\u90a3\u4e00\u4e32\u4e1c\u897f\u5bf9\u4e8e\u65b0\u4eba\u6765\u8bf4\u4e00\u5b9a\u5f88\u590d\u6742, \u4e0d\u8fc7\u6ca1\u5173\u7cfb, \u4f60\u53ea\u9700\u8981\u77e5\u9053\u90a3\u4e00\u4e32\u4f1a\u8fd4\u56de\u5728\u573a\u7684\u90a3\u4e2a\u73a9\u5bb6\u5c31\u884c(\u4e0d\u5728\u573a\u65f6\u4e3a null). \u7136\u540e\u6211\u4eec\u7528 <code>Entity</code> \u7684 <code>CollideCheck</code> \u68c0\u67e5\u6211\u4eec\u6709\u6ca1\u6709\u4e0e\u73a9\u5bb6\u53d1\u751f\u78b0\u649e, \u5982\u679c\u6709\u5219\u5f3a\u5236\u8bbe\u7f6e\u5b83\u7684\u51b2\u523a\u6570. \u7531\u4e8e\u6211\u4eec\u6bcf\u4e00\u5e27\u90fd\u5728\u68c0\u67e5, \u90fd\u5728\u8bbe\u7f6e, \u6240\u4ee5\u6700\u7ec8\u7684\u6548\u679c\u5c31\u662f\u73a9\u5bb6\u4e00\u65e6\u8fdb\u5165\u8fd9\u4e2a\u533a\u57df, \u51b2\u523a\u6570\u88ab\u9501\u5b9a\u4e3a <code>Dashes</code>.</p> <p>Info</p> <p>\u5b9e\u9645\u4e0a\u8fd9\u91cc\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u6765\u5355\u72ec\u68c0\u6d4b\u4e0e\u73a9\u5bb6\u7684\u78b0\u649e, \u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\u8fd9\u91cc\u6ca1\u6709\u91c7\u7528. \u4e0d\u8fc7\u6211\u4eec\u4f9d\u7136\u4f1a\u5728\u540e\u9762\u63d0\u5230(\"\u5e38\u89c1 Celeste, Monocle \u7c7b\"\u8282). \u7b2c\u4e00\u884c\u7684 <code>base.Update()</code> \u4f1a\u904d\u5386\u8c03\u7528\u8be5 <code>Entity</code> \u7684\u6240\u6709 <code>Component</code> \u7684 <code>Update()</code>, \u901a\u5e38\u6211\u4eec\u9700\u8981\u5728\u5f00\u5934\u5c31\u8c03\u7528\u5b83. \u540e\u9762\u7684 <code>Render()</code> \u4e5f\u662f.</p> <p>Info</p> <p>\u5728\u73a9\u5bb6\u6b7b\u4ea1\u540e\u7684\"\u70df\u82b1\"\u5e76\u4e0d\u662f <code>Player</code> \u5b9e\u4f8b, \u6240\u4ee5\u6b64\u65f6\u6211\u4eec\u4f1a\u5f97\u5230\u4e00\u4e2a <code>null</code> \u7684\u7ed3\u679c, \u5982\u679c\u4f60\u4e0d\u60f3\u8ba9\u4f60\u7684\u6e38\u620f\u5d29\u6e83\u7684\u8bdd\u8bb0\u5f97\u68c0\u67e5\u5b83\u662f\u5426\u4e3a <code>null</code>.</p>"},{"location":"coding_challenges/simple_entity/#_8","title":"\u544a\u8bc9\u6e38\u620f\u5b83\u957f\u4ec0\u4e48\u6837","text":"<p>\u90a3\u4e48, \u529f\u80fd\u505a\u597d\u540e, \u5f97\u8ba9\u73a9\u5bb6\u770b\u89c1, \u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\u8fd9\u91cc\u6211\u4eec\u4e0d\u6253\u7b97\u4f7f\u7528\u56fe\u7247, \u53ea\u662f\u50cf\u524d\u9762\u63cf\u8ff0\u7684\u4e00\u6837, \u5b83\u662f\u4e2a\"\u900f\u660e\u7684\u7ea2\u8272\u7269\u4f53\", \u5728\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u91cd\u5199 <code>Entity</code> \u7684 <code>Render()</code> \u65b9\u6cd5\u6765\u7ed8\u5236\u4e00\u4e2a\u7eaf\u8272\u957f\u65b9\u5f62, \u5b83\u4f1a\u5728\u6e38\u620f\u4e2d\u6bcf\u5e27\u90fd\u4f1a\u88ab\u8c03\u7528, \u5c31\u50cf <code>Update()</code> \u4e00\u6837, \u4e0d\u8fc7\u5207\u8bb0\u4e0d\u8981\u5728\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u91cc\u5e72\u4e0d\u76f8\u5173\u7684\u4e8b! \u4f60\u5e94\u8be5\u5728 <code>Update()</code> \u91cc\u53ea\u66f4\u65b0\u4f60\u7684\u903b\u8f91, \u800c\u5728 <code>Render()</code> \u91cc\u53ea\u505a\u7ed8\u5236. \u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u7ed8\u5236\u4e00\u4e2a\u900f\u660e\u7684\u7ea2\u8272\u957f\u65b9\u5f62, \u6211\u4eec\u9700\u8981\u501f\u52a9\u8fd9\u4e2a\u51fd\u6570:</p> Monocle.Draw.Rect<pre><code>Draw.Rect(Vector2 position, float width, float height, Color color)\n</code></pre> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6211\u4eec\u5e0c\u671b\u7ed8\u5236\u7684\u4f4d\u7f6e(\u4e16\u754c\u5750\u6807)</li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u6211\u4eec\u5e0c\u671b\u7ed8\u5236\u7684\u5bbd\u5ea6 </li> <li>\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u6211\u4eec\u5e0c\u671b\u7ed8\u5236\u7684\u9ad8\u5ea6</li> <li>\u7b2c\u56db\u4e2a\u53c2\u6570\u662f\u6211\u4eec\u5e0c\u671b\u7ed8\u5236\u7684\u989c\u8272</li> </ul> <p>\u6211\u4eec\u5728\u8fd9\u91cc\u4f1a\u8fd9\u6837\u7528\u5b83:</p> PassByRefill.Render()<pre><code>base.Render();\nColor c = Color.Red;\nc.A = 127;\nDraw.Rect(Position, Width, Height, c);\n</code></pre> <p>\u9996\u5148\u6211\u4eec\u83b7\u53d6\u4e00\u4e2a\u7ea2\u8272\u7684 <code>Color</code>, \u7136\u540e\u8bbe\u7f6e\u900f\u660e\u5ea6\u4e3a <code>127</code>, \u7136\u540e\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7ed8\u5236. \u4f60\u53ef\u80fd\u6ce8\u610f\u5230 <code>Width</code> \u548c <code>Height</code> \u8fd9\u4e24\u4e2a\u4e1c\u897f, \u5b83\u662f <code>Entity</code> \u7684\u4e24\u4e2a\u5c5e\u6027, \u9ed8\u8ba4\u5b83\u4eec\u90fd\u662f 0, \u5728\u4f60\u52a0\u5165\u78b0\u649e\u7bb1\u7684\u77ac\u95f4\u4ed6\u4eec\u4f1a\u53d8\u6210\u78b0\u649e\u7bb1\u7684\u5bbd\u548c\u9ad8, \u5728\u8fd9\u91cc\u5b83\u4eec\u7684\u503c\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u8bbe\u7f6e\u7684 <code>Hitbox</code> \u7684\u5bbd\u9ad8.</p>"},{"location":"coding_challenges/simple_entity/#_9","title":"\u51c6\u5907\u5c31\u7eea","text":"<p>\u90a3\u4e48, \u4e00\u5207\u5c31\u7eea, \u7f16\u8bd1\u4f60\u7684\u9879\u76ee, \u5230\u90a3\u4e2a\u5730\u65b9, \u5728\u534a\u900f\u660e\u7ea2\u8272\u7684\u533a\u57df\u91cc\u4eab\u53d7\u9501\u5b9a\u51b2\u523a\u6570\u7684\u5feb\u4e50\u5427(\u52a0\u80cc\u666f\u5899\u624d\u770b\u5f97\u51fa\u6765\u534a\u900f\u660e)!</p> <p></p> <p>\u5982\u679c\u4f60\u9047\u5230\u4e86\u56f0\u96be, \u53ef\u4ee5\u5bf9\u6bd4\u4e00\u4e0b\u6700\u7ec8\u7684\u4ee3\u7801: PassByRefill.cs<pre><code>using Celeste.Mod.Entities;\n\nnamespace MyCelesteMod;\n\n[CustomEntity(\"MyCelesteMod/PassByRefill\")]\npublic class PassByRefill : Entity\n{\n    public int Dashes = 0;\n\n    public PassByRefill(Vector2 position, Vector2 size, int dashes)\n    {\n        Dashes = dashes;\n        Position = position;\n        Hitbox hitbox = new(size.X, size.Y);\n        Collider = hitbox;\n    }\n\n    public PassByRefill(EntityData data, Vector2 offset)\n        : this(data.Position + offset, new Vector2(data.Width, data.Height), data.Int(\"dashes\"))\n    { }\n\n    public override void Update()\n    {\n        base.Update();\n        var player = Scene.Tracker.GetEntity&lt;Player&gt;();\n        if (player is not null &amp;&amp; this.CollideCheck(player))\n        {\n            player.Dashes = this.Dashes;\n        }\n    }\n\n    public override void Render()\n    {\n        base.Render();\n        Color c = Color.Red;\n        c.A = 127;\n        Draw.Rect(Position, Width, Height, c);\n    }\n}\n</code></pre></p>"},{"location":"coding_challenges/simple_entity/#_10","title":"\u66f4\u591a","text":""},{"location":"coding_challenges/simple_entity/#loenn-dashes","title":"\u5728 Loenn \u4e2d\u7981\u6b62\u8bbe\u7f6e dashes \u4e3a\u5c0f\u6570","text":"<p>\u5728 Loenn \u4e2d\u5982\u679c\u4f60\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u67d0\u4e2a\u6570\u5b57 data \u7684\u7c7b\u578b\u7684\u8bdd\u5b83\u9ed8\u8ba4\u4f1a\u662f\u6d6e\u70b9\u6570, \u4e5f\u5c31\u662f\u4f60\u80fd\u8f93\u5165\u5c0f\u6570, \u4e0d\u8fc7\u8fd9\u4e0d\u4f1a\u5f88\u5f71\u54cd(\u8fd8\u662f\u6709\u7684!)\u4ee3\u7801\u90a3\u8fb9, \u6240\u4ee5\u6211\u4eec\u5f97\u8ddf Loenn \u8bf4\u4e00\u4e0b\u5b83\u662f\u4e2a\u6574\u6570! \u90a3\u4e48\u6211\u4eec\u5728\u4ee3\u7801 return entity \u4e4b\u524d\u8fd9\u6837\u8bbe\u7f6e\u4e00\u4e0b: PassByRefill.lua<pre><code>entity.fieldInformation = \n{\n    dashes = {\n        fieldType = \"integer\"\n    }\n}\n</code></pre> \u5728\u8fd9\u91cc\u6211\u4eec\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u65b0\u7684\u5c5e\u6027 <code>fieldInformation</code>, \u7136\u540e\u5728\u91cc\u9762\u544a\u8bc9 Loenn \u6211\u4eec\u7684 <code>dashes</code> \u8fd9\u4e2a\u5c5e\u6027\u7684 <code>fieldType</code> \u662f <code>integer</code>, \u4e5f\u5c31\u662f\u6574\u6570. \u90a3\u4e48\u73b0\u5728\u518d\u91cd\u65b0\u7f16\u8bd1, \u91cd\u542f Loenn, \u4f60\u5e94\u8be5\u4f1a\u770b\u5230 Loenn \u53ea\u5141\u8bb8\u4f60\u8f93\u5165\u6574\u6570\u4e86.</p>"},{"location":"coding_challenges/simple_entity/#loenn_2","title":"\u4e3a Loenn \u4fa7\u914d\u7f6e\u672c\u5730\u5316","text":"<p>\u73b0\u5728\u6211\u4eec\u5728 Loenn \u4fa7\u6211\u4eec\u7684\u5b9e\u4f53\u653e\u7f6e\u9009\u62e9\u7684\u540d\u79f0\u975e\u5e38\u5947\u602a! \u8fd9\u80af\u5b9a\u4e0d\u662f\u4f60\u60f3\u8981\u7684\u7ed3\u679c, \u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u5c06\u4e3a\u5176\u914d\u7f6e\u672c\u5730\u5316. \u90a3\u4e48, \u5e38\u89c4\u5730, \u6211\u4eec\u9700\u8981\u5728 <code>ModFolder/Loenn</code> \u8fd9\u4e2a\u6587\u4ef6\u5939\u4e0b\u518d\u65b0\u5efa\u4e00\u4e2a\u53eb <code>lang</code> \u7684\u6587\u4ef6\u5939, \u7136\u540e\u5728\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u53eb <code>en_gb.lang</code> \u7684\u7a7a\u6587\u4ef6,  \u5b83\u662f Loenn \u9ed8\u8ba4\u8bfb\u53d6\u7684\u672c\u5730\u5316\u6587\u4ef6. \u73b0\u5728\u4f60\u7684\u76ee\u5f55\u7ed3\u6784\u5e94\u8be5\u50cf:</p> <ul> <li>ModFolder<ul> <li>Loenn<ul> <li>entities<ul> <li>PassByRefill.lua</li> </ul> </li> <li>lang<ul> <li>en_gb.lang</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>\u5728 <code>en_gb.lang</code> \u6587\u4ef6\u91cc, \u6211\u4eec\u5199\u4e0b:</p> <pre><code>entities.MyCelesteMod/PassByRefill.placements.name.normal=PassByRefill\n</code></pre> <p>\u554a, \u8fd9\u4e00\u4e32\u53ef\u80fd\u6709\u4ebf\u70b9\u957f, \u6211\u4eec\u6162\u6162\u6765\u89e3\u91ca\u4e00\u4e0b: \u9996\u5148\u8fd9\u662f\u4e00\u4e2a\u5b9e\u4f53, \u6240\u4ee5\u4ee5 <code>entities</code> \u5f00\u5934, \u7136\u540e\u6211\u4eec\u9700\u8981\u952e\u5165\u5b9e\u4f53\u7684\"\u540d\u79f0 ID\", \u7136\u540e\u518d\u4f9d\u6b21\u952e\u5165 <code>placements</code> \u548c <code>name</code>, \u8fd9\u8868\u793a\u6211\u4eec\u60f3\u672c\u5730\u5316\u7684\u5185\u5bb9\u662f\u90a3\u4e2a\u5b9e\u4f53\u7684\u653e\u7f6e\u9009\u9879\u7684\u540d\u79f0, \u6700\u540e\u952e\u5165\u653e\u7f6e\u9009\u9879\u7684\u540d\u5b57 \"normal\"(\u5b83\u5e94\u8be5\u4f1a\u5728\u4f60\u7684 lua \u7684\u7b2c\u4e94\u884c\u9644\u8fd1). ok \u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u6307\u5b9a\u4e86\u6211\u4eec\u60f3\u672c\u5730\u5316\u4ec0\u4e48\u4e1c\u897f\u4e86, \u90a3\u4e48\u63a5\u4e0b\u6765\u7b80\u5355\u7684 <code>={\u5185\u5bb9}</code>, \u5728\u8fd9\u91cc\u662f <code>PassByRefill</code>. \u6700\u540e, \u7f16\u8bd1\u590d\u5236, \u91cd\u542f Loenn, \u4f60\u5e94\u8be5\u5c31\u4f1a\u770b\u5230\u6211\u4eec\u7684\u5b9e\u4f53\u7ec8\u4e8e\u6709\u4e2a\u6b63\u5e38\u540d\u5b57\u4e86:</p> <p></p> <p>Info</p> <p>\u5bf9\u4e8e\u5b83\u7684\u8d34\u56fe\u6211\u4eec\u4e4b\u540e\u518d\u8bf4, \u6211\u77e5\u9053\u4f60\u5f88\u6025\u4f46\u662f\u4f60\u5148\u522b\u6025.</p>"},{"location":"coding_challenges/simple_texturing/","title":"\u7b80\u5355\u8d34\u56fe","text":"<p>\u55ef... \u90a3\u4e48\u5230\u8fd9\u4e00\u7ae0\u6211\u4eec\u8be5\u7ed9\u6211\u4eec\u5b9e\u4f53\u4e0a\u70b9\u8d34\u56fe\u4e86, \u4ee5\u53ca\u8fd8\u6709 Loenn \u4fa7\u7684\u8d34\u56fe, \u90a3\u4e48\u7ed3\u675f\u8fd9\u4e00\u7ae0\u540e\u4f60\u5e94\u8be5\u4f1a\u89c9\u5f97\u6211\u4eec\u7684\u5b9e\u4f53\u662f\u4e2a\"\u50cf\u6837\"\u7684\u5b9e\u4f53\u4e86. \u8fd9\u91cc\u6211\u4eec\u4f1a\u4f7f\u7528\u8fd9\u4e2a 64 x 64 \u7684\u8d85\u7ea7\u4e11\u964b\u7684\u8d34\u56fe:  </p> <p> </p> \u554a\u5b83\u771f\u7684\u592a\u4e11\u964b\u4e86 <p>\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u4e0b\u8f7d\u5b83: fucking_ugly_texture.png</p>"},{"location":"coding_challenges/simple_texturing/#_2","title":"\u7981\u6b62\u6211\u4eec\u7684\u5b9e\u4f53\u7f29\u653e","text":"<p>\u5728\u8fd9\u91cc\u6211\u4eec\u7684\u8d34\u56fe\u662f\u6b63\u65b9\u5f62\u7684, \u6240\u4ee5\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\u6682\u65f6\u8ba9\u6211\u4eec\u7684\u5b9e\u4f53\u4e0d\u80fd\u7f29\u653e, \u90a3\u4e48\u5728\u4ee3\u7801\u8fd9\u8fb9\u7684\u8868\u73b0\u5c31\u662f\u76f4\u63a5\u5220\u53bb\u4e0e Size \u6709\u5173\u7684\u4e1c\u897f\u5e76\u5c06\u78b0\u649e\u7bb1\u786c\u7f16\u7801\u6210 64x64 \u5927\u5c0f:</p> AfterBefore PassByRefill.cs<pre><code>public PassByRefill(Vector2 position, int dashes)\n{\n    Dashes = dashes;\n    Position = position;\n    Hitbox hitbox = new(64, 64);\n    Collider = hitbox;\n}\n\npublic PassByRefill(EntityData data, Vector2 offset)\n    : this(data.Position + offset, data.Int(\"dashes\"))\n{ }\n</code></pre> PassByRefill.cs<pre><code>public PassByRefill(Vector2 position, Vector2 size, int dashes)\n{\n    Dashes = dashes;\n    Position = position;\n    Hitbox hitbox = new(size.X, size.Y);\n    Collider = hitbox;\n}\n\npublic PassByRefill(EntityData data, Vector2 offset)\n    : this(data.Position + offset, new Vector2(data.Width, data.Height), data.Int(\"dashes\"))\n{ }\n</code></pre> <p>Info</p> <p>\u5728 Loenn \u90a3\u8fb9\u6211\u4eec\u5f85\u4f1a\u518d\u8bf4, \u5982\u679c\u4f60\u73b0\u5728\u5c31\u5220\u9664 width \u548c height \u5c5e\u6027\u7684\u8bdd\u4f60\u4f1a\u53d1\u73b0\u4f60\u653e\u7f6e\u4e0d\u4e86\u8fd9\u4e2a\u5b9e\u4f53</p>"},{"location":"coding_challenges/simple_texturing/#monocleimage","title":"\u8d34\u56fe\u4ee5\u53ca Monocle.Image","text":""},{"location":"coding_challenges/simple_texturing/#_3","title":"\u851a\u84dd\u4fa7","text":"<p>ok \u90a3\u4e48\u73b0\u5728\u6211\u4eec\u8be5\u5728\u4ee3\u7801\u8fd9\u8fb9\u6765\u70b9\u8d34\u56fe\u4e86, \u8fd9\u91cc\u6211\u4eec\u4f1a\u7528\u5230\u4e4b\u524d\u63d0\u5230\u7684 <code>Component</code> \u7684\u6982\u5ff5\u53ca\u5bf9\u5e94\u7684\u4e00\u4e2a\u65b0\u7684\u7c7b <code>Monocle.Image</code>, \u5b83\u7684\u4f5c\u7528\u5c31\u662f\u7ed8\u5236\u8d34\u56fe. \u9996\u5148\u6211\u4eec\u5f97\u8ba9\u6e38\u620f\u627e\u5230\u5e76\u52a0\u8f7d\u5230\u6211\u4eec\u7684\u8d34\u56fe, \u8fd9\u4e00\u6b65\u5f88\u7b80\u5355\u5e76\u7c7b\u4f3c, \u53ea\u9700\u8981\u5957\u51e0\u5c42\u6587\u4ef6\u5939:</p> <ul> <li>ModFolder<ul> <li>Graphics<ul> <li>Atlases<ul> <li>Gameplay<ul> <li>objects<ul> <li>PassByRefill<ul> <li>pass_by_refill.png</li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> </ul> <p><code>pass_by_refill.png</code> \u5373\u6211\u4eec\u7684\u8d34\u56fe, \u5982\u679c\u4f60\u540c\u65f6\u4e5f\u662f\u4e00\u4f4d mapper \u7684\u8bdd\u4f60\u4e00\u5b9a\u5f88\u719f\u6089\u8fd9\u4e2a\u6587\u4ef6\u5939\u5957\u5957\u4e50! \u5728\u4ee3\u7801\u8fd9\u8fb9, \u6211\u4eec\u4f7f\u7528 <code>GFX.Game[\"objects/PassByRefill/pass_by_refill\"]</code> \u6765\u83b7\u53d6\u8fd9\u4e2a\u8d34\u56fe, \u5b83\u662f\u4e00\u4e2a <code>MTexture</code> \u7c7b\u578b\u7684\u5b9e\u4f8b, \u5728\u83b7\u53d6\u5230\u8fd9\u4e2a\u8d34\u56fe\u540e, \u6211\u4eec <code>new</code> \u4e00\u4e2a <code>Monocle.Image</code>, \u7136\u540e\u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u5165\u5b83, \u7136\u540e\u4f7f\u7528 <code>this.Add</code> \u51fd\u6570\u6302\u8f7d\u5230\u6211\u4eec\u7684\u8fd9\u4e2a\u5b9e\u4f53\u4e0a, \u603b\u7684\u4ee3\u7801\u5e94\u8be5\u662f\u8fd9\u6837\u7684: PassByRefill.cs<pre><code>public PassByRefill(Vector2 position, int dashes)\n{\n    Dashes = dashes;\n    Position = position;\n    Hitbox hitbox = new(64, 64);\n    Collider = hitbox;\n\n    MTexture tex = GFX.Game[\"objects/PassByRefill/pass_by_refill\"];\n    Image image = new(tex);\n    this.Add(image);\n}\n</code></pre></p> <p>Info</p> <p><code>GFX</code> \u662f\u851a\u84dd\u4e2d\u7684\u4e00\u4e2a\u7ba1\u7406\u8d34\u56fe\u7684\u7c7b, \u6211\u4eec\u7528\u5b83\u83b7\u53d6\u5230\u4e00\u4e2a\u8d34\u56fe\u7ec4 <code>Game</code>, \u7136\u540e\u5411\u5b83\u68c0\u7d22\u4e00\u4e2a\u540d\u4e3a <code>objects/PassByRefill/pass_by_refill</code> \u7684\u8d34\u56fe, \u4f60\u53ef\u80fd\u4f1a\u7591\u60d1\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u7684\u8def\u5f84\u53ea\u9700\u8981\u540e\u534a\u90e8\u5206,</p> <p>\u8fd9\u662f\u56e0\u4e3a <code>GFX.Game</code> \u53ea\u4f1a\u68c0\u7d22 <code>Graphics/Atlases/Gameplay</code> \u4e2d\u7684\u5185\u5bb9. \u540c\u6837\u7684, <code>GFX.Portraits</code> \u53ea\u4f1a\u68c0\u7d22 <code>Graphics/Atlases/Portraits</code> \u4e2d\u7684\u5185\u5bb9.</p> <p>\u987a\u4fbf\u8bb0\u5f97\u5220\u6389\u6211\u4eec\u91cd\u5199\u7684 <code>Render</code> \u51fd\u6570, \u6211\u4eec\u4e0d\u518d\u9700\u8981\u5b83\u4e86. \u603b\u7684\u7c7b\u5e94\u8be5\u662f\u8fd9\u6837\u7684: PassByRefill.cs<pre><code>[CustomEntity(\"MyCelesteMod/PassByRefill\")]\n[Tracked]\npublic class PassByRefill : Entity\n{\n    public int Dashes = 0;\n\n    public PassByRefill(Vector2 position, int dashes)\n    {\n        Dashes = dashes;\n        Position = position;\n        Hitbox hitbox = new(64, 64);\n        Collider = hitbox;\n\n        MTexture tex = GFX.Game[\"objects/PassByRefill/pass_by_refill\"];\n        Image image = new(tex);\n        this.Add(image);\n    }\n\n    public PassByRefill(EntityData data, Vector2 offset)\n        : this(data.Position + offset, data.Int(\"dashes\"))\n    { }\n\n    public override void Update()\n    {\n        base.Update();\n        var player = Scene.Tracker.GetEntity&lt;Player&gt;();\n        if (player is not null &amp;&amp; this.CollideCheck(player))\n        {\n            player.Dashes = this.Dashes;\n        }\n    }\n}\n</code></pre></p>"},{"location":"coding_challenges/simple_texturing/#loenn","title":"Loenn \u4fa7","text":"<p>\u5728 Loenn \u4fa7\u8fd9\u8fb9\u4e5f\u975e\u5e38\u7b80\u5355, \u9996\u5148\u6211\u4eec\u5148\u5927\u80c6\u7684\u5220\u6389 width \u548c height \u5c5e\u6027:</p> AfterBefore PassByRefill.lua<pre><code>local entity = {}\n\nentity.name = \"MyCelesteMod/PassByRefill\"\nentity.placements = {\n    name = \"normal\",\n    data = {\n        dashes = 2\n    }\n}\n\nentity.fieldInformation = \n{\n    dashes = {\n        fieldType = \"integer\"\n    }\n}\n\nreturn entity\n</code></pre> PassByRefill.lua<pre><code>local entity = {}\n\nentity.name = \"MyCelesteMod/PassByRefill\"\nentity.placements = {\n    name = \"normal\",\n    data = {\n        width = 16,\n        height = 16,\n        dashes = 2\n    }\n}\n\nentity.fieldInformation = \n{\n    dashes = {\n        fieldType = \"integer\"\n    }\n}\n\nreturn entity\n</code></pre> <p>\u7136\u540e\u8bbe\u7f6e entity \u7684 <code>texture</code> \u5c5e\u6027, \u8fd9\u4f1a\u8ba9 Loenn \u4e3a\u5176\u8bbe\u7f6e\u8d34\u56fe: <pre><code>entity.texture = \"objects/PassByRefill/pass_by_refill\"\n</code></pre> \u987a\u4fbf\u8bbe\u7f6e\u8d34\u56fe\u951a\u70b9\u4e3a\u5de6\u4e0a\u89d2, \u5426\u5219 Loenn \u4e2d\u7684\u663e\u793a\u53ef\u80fd\u4f1a\u4e0e\u5b9e\u9645\u6e38\u620f\u4e2d\u7684\u4e0d\u540c: <pre><code>entity.justification = { 0.0, 0.0 }\n</code></pre></p> <p>\u951a\u70b9</p> <p>\u7b80\u5355\u7406\u89e3\u5c31\u662f\u4f60\u5728\u4e00\u5f20\u7167\u7247\u4e0a\u63d2\u4e86\u6839\u56fe\u9489, \u7167\u7247\u7684\u5e73\u79fb(\u4f4d\u7f6e), \u65cb\u8f6c, \u7f29\u653e\u90fd\u662f\u57fa\u4e8e/\u76f8\u5bf9\u4e8e\u8fd9\u4e2a\u56fe\u9489\u7684</p> <p>\u8fd9\u91cc\u7684\u8def\u5f84\u4e0e\u6211\u4eec\u4e4b\u524d\u5728\u4ee3\u7801\u4e2d\u7684\u7c7b\u4f3c. \u90a3\u4e48\u73b0\u5728\u603b\u4f53\u4e0a\u770b\u4e0a\u53bb\u5e94\u8be5\u662f\u8fd9\u6837\u7684: <pre><code>local entity = {}\n\nentity.name = \"MyCelesteMod/PassByRefill\"\nentity.placements = {\n    name = \"normal\",\n    data = {\n        dashes = 2\n    }\n}\n\nentity.fieldInformation = \n{\n    dashes = {\n        fieldType = \"integer\"\n    }\n}\n\nentity.texture = \"objects/PassByRefill/pass_by_refill\"\nentity.justification = { 0.0, 0.0 }\n\nreturn entity\n</code></pre></p>"},{"location":"coding_challenges/simple_texturing/#_4","title":"\u6700\u540e","text":"<p>\u6700\u540e\u7f16\u8bd1\u6211\u4eec\u7684\u9879\u76ee, \u6253\u5f00\u6216\u8005\u91cd\u542f Loenn, \u4f60\u5c31\u4f1a\u770b\u5230\u6211\u4eec\u7684\u5b9e\u4f53\u6709\u7740\u4e00\u4e2a\u4e0d\u600e\u4e48\u597d\u770b\u7684\u8d34\u56fe\u4e86! \u73b0\u5728\u8fdb\u5165\u5230\u6e38\u620f\u4e2d\u4f60\u4e5f\u4f1a\u770b\u5230\u8fd9\u4e2a\u4e0d\u600e\u4e48\u597d\u770b\u7684\u8d34\u56fe\u4e86!</p>"},{"location":"coding_challenges/simple_trigger/","title":"\u7b80\u5355\u81ea\u5b9a\u4e49 Trigger","text":"<p>\u5982\u679c\u4f60\u662f\u4e00\u4f4d Mapper \u7684\u8bdd\u90a3\u4f60\u4e00\u5b9a\u77e5\u9053 Trigger \u662f\u591a\u4e48\u91cd\u8981\u7684\u5b58\u5728. \u5728\u8fd9\u91cc\u53ef\u80fd\u4e0d\u662f\u5f88\u80fd\u5728\u77ed\u7bc7\u5e45\u5185\u8bf4\u660e Trigger \u7684\u91cd\u8981\u6027, \u8fd9\u91cc\u53ea\u7b80\u5355\u4e3e\u51e0\u4e2a\u4f8b\u5b50:</p> <ul> <li>\u7edd\u5927\u90e8\u5206\u955c\u5934\u7684\u79fb\u52a8\u4e0e\u504f\u79fb</li> <li>\u5267\u60c5\u7684\u89e6\u53d1, \u65e0/\u5355/\u53cc\u51b2\u7684\u5207\u6362</li> <li>\u98ce\u7684\u6539\u53d8</li> <li>\u91cd\u751f\u70b9\u7684\u8bbe\u7f6e</li> <li>\u97f3\u4e50\u53c2\u6570\u7684\u8bbe\u7f6e</li> <li>\u80cc\u666f\u7684\u6e10\u53d8, \u524d\u666f\u7684\u5404\u79cd\u53d8\u6362</li> </ul> <p>\u4ee5\u4e0a\u51e0\u4e2a\u4f8b\u5b50\u4e0d\u8bf4\u7edd\u5927\u90e8\u5206, \u4e5f\u6709\u5f88\u5927\u7684\u5360\u6bd4\u90fd\u662f\u7531 Trigger \u5b8c\u6210\u7684. Trigger \u662f Entity \u7684\u5b50\u7c7b, \u5b83\u5e26\u6709\u4e00\u4e2a\u957f\u65b9\u5f62\u7684\u78b0\u649e\u7bb1, \u901a\u5e38\u5b83\u662f\u5bf9\u73a9\u5bb6\u4e0d\u53ef\u89c1\u7684, \u5f53\u73a9\u5bb6 <code>\u8fdb\u5165(OnEnter)</code>, <code>\u4fdd\u6301(OnStay)</code>, <code>\u79bb\u5f00(OnLeave)</code> \u4f1a\u5206\u522b\u6267\u884c\u4e0d\u540c\u7684\u52a8\u4f5c, \u6bd4\u5982\u8bf4\u5f53\u73a9\u5bb6 <code>\u8fdb\u5165</code> \u6539\u53d8\u98ce\u7684 Trigger \u65f6\u4f1a\u6539\u53d8\u573a\u4e0a\u7684\u98ce\u7684\u60c5\u51b5, \u5f53\u73a9\u5bb6 <code>\u4fdd\u6301</code> \u5728\u955c\u5934\u504f\u79fb\u6539\u53d8 Trigger \u91cc\u65f6\u4f1a\u4fdd\u6301\u955c\u5934\u76f8\u5bf9\u4e8e\u73a9\u5bb6\u7684\u504f\u79fb\u4e8e\u4e00\u4e2a\u503c.</p> <p>Info</p> <p>\u5728\u5b98\u56fe\u7b2c\u4e5d\u7ae0\u5047\u5fc3\u9644\u8fd1\u7684 Trigger \u770b\u4e0a\u53bb\u5c31\u50cf:  \u5728\u8fd9\u91cc, \u5de6\u8fb9\u6709\u4e2a\u8bbe\u7f6e\u91cd\u751f\u70b9\u7684 Trigger, \u4e2d\u95f4\u6709\u4e2a\u4fdd\u6301\u955c\u5934\u4f4d\u7f6e\u7684 Trigger, \u800c\u5728\u53f3\u8fb9\u6709\u4e2a\u66f4\u6539\u80cc\u666f\u7684 Trigger.</p> <p>\u90a3\u4e48, \u662f\u65f6\u5019\u5236\u4f5c\u4e00\u4e2a\u5c5e\u4e8e\u6211\u4eec\u81ea\u5df1\u7684 Trigger \u4e86, \u7b80\u5355\u8d77\u89c1\u8fd9\u91cc\u6211\u4eec\u53ea\u505a\u51e0\u4e2a\u6700\u7b80\u5355\u7684\u529f\u80fd:</p> <ul> <li>\u5b83\u53eb <code>SetPassByRefillDashesTrigger</code></li> <li>\u73a9\u5bb6\u8fdb\u5165\u540e\u4fee\u6539\u573a\u4e0a\u6240\u6709\u6211\u4eec\u4e4b\u524d\u7684 <code>PassByRefill</code> \u5b9e\u4f53\u7684\u51b2\u523a\u6570</li> <li>\u6ca1\u4e86, \u662f\u7684, \u5c31\u662f\u8fd9\u4e48\u7b80\u5355!</li> </ul>"},{"location":"coding_challenges/simple_trigger/#entity","title":"\u50cf\u5bf9 Entity \u4e00\u6837\u5730\u505a\u51c6\u5907\u5de5\u4f5c","text":"<p>\u9996\u5148\u5728\u4ee3\u7801\u4e2d\u51c6\u5907\u6211\u4eec\u7684\u7c7b, \u4e0d\u8fc7\u8fd9\u6b21\u6211\u4eec\u7ee7\u627f\u7684\u662f <code>Trigger</code>. \u54e6\u5bf9\u4e86, \u5b83\u8fd8\u4f1a\u8981\u6c42\u58f0\u660e\u4e00\u4e2a\u5e26\u53c2\u7684\u6784\u9020\u51fd\u6570, \u56e0\u4e3a <code>Trigger</code> \u57fa\u7c7b\u6ca1\u6709\u65e0\u53c2\u6784\u9020\u5668, \u6240\u4ee5\u4f60\u53ef\u80fd\u9700\u8981\u50cf\u5982\u4e0b\u4e00\u6837\u58f0\u660e\u4e00\u4e0b: SetPassByRefillDashesTrigger.cs<pre><code>[CustomEntity(\"MyCelesteMod/SetPassByRefillDashesTrigger\")]\npublic class SetPassByRefillDashesTrigger : Trigger\n{\n    public SetPassByRefillDashesTrigger(EntityData data, Vector2 offset)\n        : base(data, offset)\n    {\n\n    }\n}\n</code></pre> \u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u5176\u5b9e\u5b83\u8981\u6c42\u7684\u5c31\u662f Everest \u8981\u6c42\u6211\u4eec\u5b9a\u4e49\u7684\u90a3\u4e2a! \u90a3\u521a\u597d\u6211\u4eec\u5c31\u4e0d\u7528\u518d\u989d\u5916\u5b9a\u4e49\u4e00\u4e2a\u4e86. \u7136\u540e\u6211\u4eec\u7a0d\u4f5c\u66f4\u6539, \u4ee5\u8ba9\u5b83\u4e5f\u80fd\u63d0\u53d6\u5230\u4e00\u4e2a\u53eb <code>dashes</code> \u7684\u6570\u636e: SetPassByRefillDashesTrigger.cs<pre><code>public int Dashes;\n\npublic SetPassByRefillDashesTrigger(EntityData data, Vector2 offset)\n    : base(data, offset)\n{\n    Dashes = data.Int(\"dashes\");\n}\n</code></pre></p> <p>\u6784\u9020\u51fd\u6570\u94fe</p> <p>\u5f62\u5982 <code>: base(data, offset)</code> <code>: this(position)</code> \u7684\u8fd9\u79cd\u8bed\u6cd5\u53eb\u505a\u6784\u9020\u51fd\u6570\u94fe, \u8fd9\u4e00\u90e8\u5206\u4f3c\u4e4e\u5f88\u591a C# \u6559\u7a0b\u6ca1\u6709\u7279\u522b\u63d0\u53ca, \u5982\u679c\u4f60\u5bf9\u6b64\u4e0d\u662f\u5f88\u4e86\u89e3\u7684\u8bdd\u6211\u63a8\u8350\u4f60\u53bb\u67e5\u9605\u4e86\u89e3\u8be5\u8bed\u6cd5.</p> <p>\u4f60\u53ef\u80fd\u6ce8\u610f\u5230 Trigger \u4e00\u822c\u90fd\u662f\u6709\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u7684, \u5728\u8fd9\u91cc\u6211\u4eec\u5e76\u6ca1\u6709\u7528 <code>EntityData data</code> \u53bb\u83b7\u53d6, \u800c\u4e14\u6211\u4eec\u4e5f\u6ca1\u8bbe\u7f6e\u5b83\u7684 <code>Position</code>! \u5b9e\u9645\u4e0a\u5f53\u4f60 <code>: base(data, offset)</code> \u65f6\u8fd9\u4e9b\u4e8b\u60c5\u5df2\u7ecf\u7531\u7236\u7c7b Trigger \u7684\u6784\u9020\u51fd\u6570\u505a\u4e86, \u5982\u679c\u4f60\u597d\u5947\u53ef\u4ee5\u7ffb\u9605 <code>Trigger</code> \u6784\u9020\u51fd\u6570\u9644\u8fd1\u7684\u4ee3\u7801.</p> Trigger.Trigger(EntityData data, Vector2 offset) <pre><code>/// .......\npublic Trigger(EntityData data, Vector2 offset)\n    : base(data.Position + offset)\n{\n    base.Collider = new Hitbox(data.Width, data.Height);\n    Visible = false;\n}\n/// .......\n</code></pre>"},{"location":"coding_challenges/simple_trigger/#trigger_1","title":"Trigger \u7684\u5b9e\u9645\u529f\u80fd","text":"<p>ok \u73b0\u5728\u8ba9\u6211\u4eec\u60f3\u60f3\u6211\u4eec\u7684 Trigger \u7684\u529f\u80fd\u5982\u4f55\u5b9e\u73b0. \u5b83\u5927\u6982\u5c31\u662f:</p> <ul> <li>\u68c0\u6d4b\u73a9\u5bb6\u662f\u5426\u8fdb\u5165<ul> <li>\u8bbe\u7f6e\u573a\u4e0a\u6240\u6709 <code>PassByRefill</code> \u7684 <code>Dashes</code> \u5b57\u6bb5</li> </ul> </li> <li>\u6ca1\u4e86</li> </ul> <p>\u5728\u8fd9\u91cc\u6211\u4eec\u4f1a\u4f7f\u7528 Trigger \u7684 <code>OnEnter</code> \u865a\u51fd\u6570, \u5b83\u4f1a\u5728\u73a9\u5bb6\u9996\u6b21\u8fdb\u5165\u76841\u5e27\u88ab\u8c03\u75281\u6b21. SetPassByRefillDashesTrigger.cs<pre><code>public override void OnEnter(Player player)\n{\n    base.OnEnter(player);\n}\n</code></pre></p> <p>Note</p> <p>\u851a\u84dd\u5185\u90e8\u5927\u90e8\u5206\u865a\u51fd\u6570\u91cd\u5199\u65f6\u6700\u597d\u5728\u5f00\u5934\u8c03\u7528\u4e00\u904d\u57fa\u7c7b\u7684\u5b9e\u73b0, \u9664\u975e\u4f60\u771f\u7684\u77e5\u9053\u5b83\u505a\u4e86\u4ec0\u4e48\u5e76\u4e14\u4f60\u771f\u7684\u4e0d\u9700\u8981\u5b83.</p> <p>\u7136\u540e\u662f\u83b7\u53d6\u573a\u4e0a\u6240\u6709\u7684 <code>PassByRefill</code>, \u4ee5\u4fbf\u6211\u4eec\u80fd\u8bbe\u7f6e\u5b83\u4eec\u7684 <code>Dashes</code>. \u8fd9\u91cc\u6211\u4eec\u4f1a\u642c\u51fa\u4e00\u4e2a\u4f60\u53ef\u80fd\u773c\u719f\u7684\u4e00\u4e32: SetPassByRefillDashesTrigger.OnEnter(Player player)<pre><code>// \u83b7\u53d6\u6240\u6709\u7684 PassByRefill\nvar refills = Scene.Tracker.GetEntities&lt;PassByRefill&gt;();\n</code></pre></p> <p>\u5728\u8fd9\u91cc\u6216\u8bb8\u8be5\u4ecb\u7ecd\u4ecb\u7ecd\u8fd9\u4e00\u4e32\u662f\u4ec0\u4e48\u4e86, \u9996\u5148\u6211\u4eec\u901a\u8fc7 <code>Scene</code> \u5c5e\u6027\u83b7\u53d6\u81ea\u8eab\u6240\u5728\u7684\u573a\u666f, \u7136\u540e\u83b7\u53d6\u5b83\u7684 <code>Tracker</code>. Tracker \u662f\u851a\u84dd\u573a\u666f\u5185\u7684\u4e00\u4e2a\u8f85\u52a9\u7c7b, \u5b83\u53ef\u4ee5\u5f88\u5feb\u7684\u5e2e\u4f60\u7b5b\u9009\u51fa\u573a\u4e0a\u7684\u5b9e\u4f53, \u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u5b83\u7684 <code>GetEntities&lt;T&gt;</code> \u6765\u7b5b\u9009\u51fa\u6240\u6709\u7c7b\u578b\u4e3a <code>T</code>, \u4e5f\u5c31\u662f <code>PassByRefill</code> \u7684\u5b9e\u4f53. \u90e8\u5206\u5b9e\u4f53\u5728\u573a\u4e0a\u53ef\u80fd\u6c38\u8fdc\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u65f6, \u6bd4\u5982\u8bf4\u6211\u4eec\u7684 <code>Player</code>, \u9664\u975e\u4f60\u5b89\u88c5\u4e86\u5947\u5947\u602a\u602a\u7684 mod, \u5426\u5219\u5b83\u6c38\u8fdc\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b, \u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>GetEntity</code>, \u5b83\u53ea\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5b9e\u4f8b. \u90a3\u4e48\u4f60\u73b0\u5728\u5e94\u8be5\u61c2\u5f97\u4e4b\u524d\u6211\u4eec\u5199\u4e0b\u7684 <code>Scene.Tracker.GetEntity&lt;Player&gt;()</code> \u662f\u4ec0\u4e48\u610f\u601d\u4e86: \"\u4f7f\u7528\u573a\u666f\u7684 Tracker \u83b7\u53d6\u573a\u4e0a\u552f\u4e00\u7684\u90a3\u4e2a Player \u5b9e\u4f8b\".  </p> <p>\u54e6\u5bf9\u4e86, \u6211\u4eec\u8fd8\u5f97\u5728\u6211\u4eec\u60f3\u8981 Tracker \u83b7\u53d6\u7684\u5b9e\u4f53\u7684\u7c7b\u4e0a\u52a0\u4e00\u4e2a <code>Tracked</code> \u7279\u6027, \u5c31\u50cf: PassByRefill.cs<pre><code>[CustomEntity(\"MyCelesteMod/PassByRefill\")]\n[Tracked]\npublic class PassByRefill : Entity\n{\n</code></pre> \u8fd9\u4e00\u6b65\u5176\u5b9e\u5f88\u5bb9\u6613\u88ab\u5fd8\u8bb0, \u5c31\u50cf\u6211\u5199\u5b8c\u521d\u7a3f\u5e76\u505a\u5230\u6700\u540e\u4e00\u6b65\u6e38\u620f\u5d29\u6e83\u65f6\u624d\u60f3\u8d77\u6765(\u4e50).</p> <p>\u597d\u7684\u7136\u540e\u6211\u4eec\u8be5\u8bbe\u7f6e <code>PassByRefill</code> \u4eec\u7684 <code>Dashes</code>... \u989d\u7b49\u7b49! \u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u8fd9\u91cc\u7684 <code>refills</code> \u5c40\u90e8\u53d8\u91cf\u5176\u5b9e\u662f\u4e2a <code>List&lt;Entity&gt;</code> \u7c7b\u578b, \u8fd9\u4e2a\u6211\u4e0d\u592a\u6e05\u695a\u4e3a\u4ec0\u4e48, \u4f30\u8ba1\u662f\u4e00\u4e2a <code>Monocle</code> \u5728\u5b9e\u73b0\u4e2d\u7684\u4e00\u4e2a\u5c0f\u9519\u8bef, \u4e3a\u4e86\u7ea0\u6b63\u5b83\u8fd9\u91cc\u6211\u4f1a\u4f7f\u7528 <code>Linq</code> \u7684 <code>Cast</code> \u6765\u8f6c\u6362\u4e00\u4e0b\u7c7b\u578b:</p> SetPassByRefillDashesTrigger.OnEnter(Player player)<pre><code>var refills = Scene.Tracker.GetEntities&lt;PassByRefill&gt;().Cast&lt;PassByRefill&gt;();\n</code></pre> <p>ok, \u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u904d\u5386\u5e76\u8bbe\u7f6e\u4e86: SetPassByRefillDashesTrigger.OnEnter(Player player)<pre><code>foreach(var refill in refills)\n{\n    refill.Dashes = this.Dashes;\n}\n</code></pre></p> <p>\u6700\u540e, \u4f60\u7684\u4ee3\u7801\u5e94\u8be5\u603b\u4f53\u4e0a\u662f\u8fd9\u4e2a\u6837\u5b50: SetPassByRefillDashesTrigger.cs<pre><code>using Celeste.Mod.Entities;\n\nnamespace MyCelesteMod;\n\n[CustomEntity(\"MyCelesteMod/SetPassByRefillDashesTrigger\")]\npublic class SetPassByRefillDashesTrigger : Trigger\n{\n    public int Dashes;\n\n    public SetPassByRefillDashesTrigger(EntityData data, Vector2 offset)\n        : base(data, offset)\n    {\n        Dashes = data.Int(\"dashes\");\n    }\n\n    public override void OnEnter(Player player)\n    {\n        base.OnEnter(player);\n        var refills = Scene.Tracker.GetEntities&lt;PassByRefill&gt;().Cast&lt;PassByRefill&gt;();\n        foreach(var refill in refills)\n        {\n            refill.Dashes = this.Dashes;\n        }\n    }\n}\n</code></pre></p>"},{"location":"coding_challenges/simple_trigger/#loenn","title":"Loenn \u914d\u7f6e","text":"<p>ok \u6211\u4eec\u7684 Trigger \u7684\u4ee3\u7801\u5df2\u7ecf\u5199\u597d\u4e86, \u63a5\u4e0b\u6765\u5199\u4e00\u4e2a Loenn \u914d\u7f6e\u5c31\u597d\u4e86, \u8fd9\u4e00\u6b65\u4e0e Entity \u7684\u5f88\u50cf, \u4e0d\u8fc7\u4f60\u9700\u8981\u628a\u5b83\u653e\u5230 triggers \u6587\u4ef6\u5939\u5185:</p> <ul> <li>ModFolder<ul> <li>Loenn<ul> <li>entities<ul> <li>PassByRefill.lua</li> </ul> </li> <li>triggers<ul> <li>SetPassByRefillDashesTrigger.lua</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>\u5185\u5bb9\u5927\u540c\u5c0f\u5f02:</p> SetPassByRefillDashesTrigger.lua<pre><code>local trigger = {}\n\ntrigger.name = \"MyCelesteMod/SetPassByRefillDashesTrigger\"\ntrigger.placements = {\n    name = \"normal\",\n    data = {\n        width = 16,\n        height = 16,\n        dashes = 2\n    }\n}\n\ntrigger.fieldInformation = \n{\n    dashes = {\n        fieldType = \"integer\"\n    }\n}\n\nreturn trigger\n</code></pre> <p>\u6700\u540e\u8bb0\u5f97\u5199\u4e2a\u672c\u5730\u5316\u4fe1\u606f, \u4e0d\u7136\u5b83\u7684\u540d\u5b57\u80af\u5b9a\u4f1a\u5f88\u4e11! \u8fd9\u4e00\u6b65\u4e5f\u662f\u5f88\u7c7b\u4f3c\u7684: <pre><code>entities.MyCelesteMod/PassByRefill.placements.name.normal=PassByRefill\ntriggers.MyCelesteMod/SetPassByRefillDashesTrigger.placements.name.normal=SetPassByRefillDashesTrigger\n</code></pre></p> <p>Note</p> <p>\u522b\u5fd8\u4e86\u7f16\u8bd1, \u4e0d\u8981\u50cf\u6211\u4e00\u6837\u5bf9\u7740 Loenn \u7591\u60d1\u6211\u7684 trigger/\u5b9e\u4f53 \u600e\u4e48\u4e0d\u89c1\u4e86(</p>"},{"location":"coding_challenges/simple_trigger/#_1","title":"\u6548\u679c","text":"<p>\u73b0\u5728\u5728\u4f60\u7684\u5730\u56fe\u4e0a\u6446\u653e\u8fd9\u4e2a trigger \u4ee5\u53ca\u51e0\u4e2a <code>PassByRefill</code>. \u6211\u5728\u8fd9\u91cc\u4f1a\u6446\u51e0\u4e2a\u80cc\u666f\u7816\u6765\u5e2e\u6211\u4eec\u8fa8\u8bc6\u8fd9\u4e2a trigger \u5728\u54ea, \u56e0\u4e3a trigger \u901a\u5e38\u90fd\u662f\u4e0d\u53ef\u89c1\u7684 (\u6216\u8005\u4f60\u53ef\u4ee5\u901a\u8fc7 <code>~</code> \u952e\u6216\u8005\u4e0b\u8f7d <code>CelesteTAS</code> \u8fd9\u4e2a mod \u6765\u67e5\u770b\u78b0\u649e\u7bb1).  \u90a3\u4e48\u89c1\u8bc1\u4f60\u7684\u6770\u4f5c\u5427! </p> <p>\u8fdb\u5165 trigger \u524d (PassByRefill \u7684 Dashes \u8bbe\u7f6e\u4e3a 2): \u8fdb\u5165 trigger \u540e (\u88ab\u8bbe\u7f6e\u4e3a 1 \u4e86): </p>"},{"location":"coding_challenges/simple_trigger/#_2","title":"\u6700\u540e","text":"<p>\u6211\u4eec\u76ee\u524d\u5b9e\u73b0\u7684\u90a3\u4e2a Entity \u4e0e\u8fd9\u4e2a Trigger \u7684\u642d\u914d\u5176\u5b9e\u95ee\u9898\u7e41\u591a, \u6bd4\u5982 Entity \u5982\u679c\u5728 Trigger \u89e6\u53d1\u540e\u624d\u88ab\u653e\u7f6e\u5230\u573a\u4e0a, \u90a3\u4e48\u51b2\u523a\u6570\u4f1a\u4fdd\u6301\u5b83\u7684\u9ed8\u8ba4, \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u6700\u4f73\u7684\u65b9\u6848\u662f\u4f7f\u7528\u851a\u84dd\u4e2d\u7684 <code>Session</code>, \u6211\u4eec\u4f1a\u5728\u540e\u9762\u63d0\u5230\u5b83.</p>"},{"location":"coding_challenges/test_map/","title":"\u6d4b\u8bd5\u5730\u56fe","text":"<p>\u5b9e\u6218\u90e8\u5206\u9644\u5e26\u4e00\u5f20\u6d4b\u8bd5\u5730\u56fe\u4f9b\u8bfb\u8005\u4e0b\u8f7d\u4e0b\u6765\u4e71\u5f04\u7814\u7a76\u4e0e\u6d4b\u8bd5.       \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u8fdb\u884c\u4e0b\u8f7d.      \u4ee3\u7801\u4f60\u53ef\u4ee5\u5728 <code>Source</code> \u76ee\u5f55\u4e0b\u627e\u5230.</p> <p>Info</p> <p>\u4e0b\u8f7d\u5e76\u89e3\u538b\u540e\u522b\u5fd8\u4e86\u751f\u6210 Mod \u7684 <code>dll</code> \u6587\u4ef6!</p>"},{"location":"coding_setup/basic_env/","title":"\u57fa\u7840\u73af\u5883\u914d\u7f6e","text":"<p>Note</p> <p>\u672c\u8282\u5185\u5bb9\u7531\u624b\u52a8\u914d\u7f6e\u91cd\u5199\u4e3a\u901a\u8fc7\u6a21\u677f\u914d\u7f6e, \u65e7\u7248\u4f60\u53ef\u4ee5\u5230\u5f52\u6863-\u57fa\u7840\u73af\u5883\u914d\u7f6e\u4e2d\u627e\u5230(\u4e0d\u63a8\u8350)</p>"},{"location":"coding_setup/basic_env/#celeste","title":"Celeste","text":"<p>Note</p> <p>\u5982\u679c\u4f60\u4e0d\u662f Windows \u7528\u6237\u7684\u8bdd\u8fd9\u4e00\u6b65\u4f60\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7.</p> <p>Info</p> <p>\u5728 Everest Core \u7248\u672c\u540e(Stable \u7248\u672c\u53f7\u5927\u4e8e 4465)\u5f3a\u5236\u5207\u6362\u4e3a\u4e86 FNA \u7248\u672c, \u5982\u679c\u4f60\u5df2\u662f Core \u7248\u672c\u4f60\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u6b65.</p> <p>Everest \u9700\u6c42\u6211\u4eec\u4f7f\u7528 FNA \u7248\u672c\u7684\u851a\u84dd, \u800c Linux \u548c MacOS \u4e0a\u7684\u851a\u84dd\u5df2\u7ecf\u5c31\u662f FNA \u7248\u672c\u4e86, \u800c\u5728 Windows \u4e0a\u5219\u662f XNA \u7248\u672c, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e9b\u65b9\u6cd5\u5207\u6362\u5230 FNA \u7248\u672c:</p> <ul> <li>\u5728 Steam \u4e0a:  \u5e93-&gt;Celeste, \u53f3\u952e\u83dc\u5355\u5c5e\u6027-&gt;\u6d4b\u8bd5\u7248-&gt;Opengl</li> <li>\u5728 itch \u4e0a: \u91cd\u65b0\u4e0b\u8f7d\u4e00\u4e2a <code>Celeste Windows OpenGL</code> \u7248\u672c</li> <li>\u5728 Epic \u4e0a: \u5df2\u7ecf\u662f FNA \u7248\u672c\u4e86</li> </ul> <p>Note</p> <p>Everest \u4f1a\u5728\u8fd0\u884c\u65f6\u5c06\u4f60\u4ee5 FNA \u7248\u672c\u5236\u4f5c\u7684 mod \u91cd\u94fe\u63a5\u4e3a XNA, \u6240\u4ee5\u4f60\u4e0d\u662f\u5f88\u9700\u8981\u5728\u610f\u8fd9\u4fe9\u7684\u5dee\u8ddd \u6ce8\u610f\u66f4\u6362\u7248\u672c\u540e\u4f1a\u53d8\u56de\u539f\u7248, \u4f60\u9700\u8981\u91cd\u65b0\u5b89\u88c5 Everest</p>"},{"location":"coding_setup/basic_env/#c","title":"C# \u7f16\u7a0b\u80fd\u529b \u4e0e \u5f00\u53d1\u73af\u5883","text":"<p>\u56e0\u4e3a\u6211\u4eec\u662f Code Mod, \u55ef, \u90a3\u4e48\u5199\u4e00\u4e9b\u4ee3\u7801\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684, \u851a\u84dd\u662f\u4f7f\u7528 <code>C#</code> \u57fa\u4e8e <code>.NET Framework 4.5.2</code> \u6765\u5236\u4f5c\u7684, \u90a3\u4e48\u5b66\u4e60 <code>C#</code> \u5f53\u7136\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684.  </p> <p>Info</p> <p>\u5728 Everest Core \u7248\u672c\u4e0a\u851a\u84dd\u88ab\u8fc1\u79fb\u5230\u4e86 <code>.NET 7</code> \u4e0a, \u4e0d\u8fc7\u57fa\u4e8e\u65e7\u6846\u67b6\u7684 mod \u4f1a\u5c3d\u53ef\u80fd\u5730\u88ab Everest \u81ea\u52a8\u8f6c\u6362\u4e3a\u57fa\u4e8e\u65b0\u6846\u67b6\u7684 mod.</p> <p>Info</p> <p>\u7406\u8bba\u4e0a\u6240\u6709 .NET \u7cfb\u8bed\u8a00\u6bd4\u5982 <code>VB.NET</code> <code>F#</code> \u90fd\u53ef\u4ee5, \u4e0d\u8fc7\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\u6211\u4eec\u8fd8\u662f\u4f7f\u7528 C#.</p> <p>\u597d\u5427\u8fd9\u53e5\u8bdd\u53ef\u80fd\u8bf4\u7684\u592a\u5e73\u6de1\u4e86(, \u6bd5\u7adf\u5927\u90e8\u5206\u851a\u6279\u851a\u84dd mod \u7231\u597d\u8005\u5c31\u662f\u88ab\u8fd9\u4e00\u6b65\u5361\u4f4f\u7684, \u90a3\u4e48\u8fd9\u91cc...\u53ea\u80fd\u7ed9\u4f60\u63a8\u8350\u51e0\u4e2a\u5b66\u4e60\u6e20\u9053\u4e86, \u6bd5\u7adf\u5728\u8fd9\u91cc\u6ca1\u5fc5\u8981\u8ba9\u8fd9\u4e2a\u6559\u7a0b\u8fc7\u4e8e\u5168\u80fd.</p> <ol> <li>\u89c6\u9891: Bilibili - \u4e11\u840c\u6c14\u8d28\u72d7 - \u3010C#\u96f6\u57fa\u7840\u5165\u95e8\u6559\u7a0b Visual Studio 2022\u3011\u4eba\u751f\u4f4e\u8c37\u6765\u5b66C# (\u5168p, \u7a0d\u5fae\u4e0d\u5168)</li> <li>\u89c6\u9891: Bilibili - C#\u4ece\u5165\u95e8\u5230\u7cbe\u901a\uff08\u7b2c5\u7248\uff09 (1-71p, 109-132p)</li> <li>\u89c6\u9891: Bilibili - \u5218\u94c1\u731b - C#\u8bed\u8a00\u5165\u95e8\u8be6\u89e3-\u7b2c1\u5b63-\u526a\u8f91\u7248-\u516833\u8bfe-\u5206154\u96c6 (1-152p)</li> <li>\u7f51\u7ad9: Runnob - C# \u6559\u7a0b</li> <li>\u7f51\u7ad9: w3schools - C# \u6559\u7a0b (\u82f1\u6587)</li> <li>\u4e66\u7c4d: C#\u5165\u95e8\u7ecf\u5178-\u7b2c7\u7248-C# 6.0</li> </ol> <p>Info</p> <p>\u5982\u679c\u4f60\u6ca1\u6709\u80fd\u529b\u652f\u6301\u6b63\u7248\u4e66\u7c4d\u7684\u8bdd, \u4f60\u53ef\u4ee5\u5230\u4e00\u4e9b C# \u5f00\u53d1\u8005\u7fa4\u5185\u5bfb\u627e\u5b83\u7684\u7535\u5b50\u975e\u6b63\u7248(\u6bd4\u5982\u89c6\u9891 <code>1.</code> up \u7684\u7fa4\u5185) \u4e0a\u9762\u51e0\u4e2a\u6211\u66f4\u52a0\u63a8\u8350\u7684\u662f <code>1.</code> \u548c <code>3.</code> \u501f\u7528 <code>4.</code> \u7684\u76ee\u5f55, \u786e\u4fdd\u4f60\u5bf9\u4e0b\u9762\u8fd9\u4e9b\u6982\u5ff5(\u753b \u00d7 \u7684\u6682\u65f6\u5728\u851a\u84dd Code Mod \u4e2d\u7528\u4e0d\u5230)\u6709\u8db3\u591f\u6e05\u6670\u7684\u4e86\u89e3\u5728\u5f00\u59cb\u4f60\u7684\u851a\u84dd Code Mod \u4e4b\u65c5\u4e4b\u524d: </p> <p>\u76f8\u4fe1\u5728\u4e0a\u9762\u7684\u6559\u7a0b\u4e2d\u4f60\u5e94\u8be5\u5df2\u7ecf\u88ab\u63a8\u8350\u4e86\u4e00\u4e9b\u7f16\u8f91\u5668 / IDE, \u90a3\u4e48\u5728\u672c\u6559\u7a0b\u4e2d\u6211\u4e2a\u4eba\u4f1a\u4e3a\u4e86\u65b9\u4fbf\u4ec5\u5728 <code>Windows</code> \u4e0a\u4f7f\u7528 <code>Visual Studio</code>, \u5f53\u7136\u4e0d\u4fdd\u8bc1\u5728\u5176\u4ed6\u5730\u65b9\u4f1a\u9047\u5230\u5947\u5947\u602a\u602a\u7684\u95ee\u9898. _(:\u0437\u300d\u2220)_</p>"},{"location":"coding_setup/basic_env/#_2","title":"\u901a\u8fc7\u6a21\u677f\u521b\u5efa\u9879\u76ee","text":"<p>Info</p> <p>\u5728\u851a\u84dd\u56fd\u5916\u793e\u533a\u6d41\u884c\u7740\u53e6\u4e00\u4e2a mod \u9879\u76ee\u6a21\u677f, \u8fd9\u662f\u5b83\u7684 Github \u4e3b\u9875 \u4e0d\u8fc7\u8fd9\u91cc\u4e3b\u8981\u4ecb\u7ecd\u4f7f\u7528\u6211\u4e2a\u4eba\u5236\u4f5c\u4e5f\u662f\u4e2a\u4eba\u6700\u5e38\u7528\u7684\u4e00\u4e2a.</p> <p>Note</p> <p>\u9879\u76ee\u6a21\u677f\u5728\u91cd\u6784\u7684\u6559\u7a0b\u4e2d\u8fdb\u884c\u4e86\u66f4\u65b0, \u65e7\u7248\u4f60\u53ef\u4ee5\u5728\u5f52\u6863-\u901a\u8fc7\u6a21\u677f\u521b\u5efa\u9879\u76ee\u4e2d\u627e\u5230(\u4e0d\u63a8\u8350)</p> <p>\u6211\u4eec\u5728\u8fd9\u91cc\u63d0\u4f9b\u4e24\u79cd\u6a21\u677f:</p> <ul> <li>\u5916\u90e8: \u5728\u851a\u84dd\u6839\u76ee\u5f55\u5916\u7f16\u5199\u4ee3\u7801.</li> <li>\u5c31\u5730: \u5728 <code>Celeste/Mods/&lt;\u4f60\u7684 Mod \u540d\u79f0&gt;/Source</code> \u4e2d\u7f16\u5199\u4ee3\u7801.</li> </ul> <p>\u6211\u4eec\u5728\u4e0b\u9762\u4f1a\u4f7f\u7528 <code>Visual Studio</code> \u8fdb\u884c\u6f14\u793a. \u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 <code>dotnet cli</code> \u4ece nuget \u4e0a\u7684\u6a21\u677f\u5b89\u88c5:</p> <p>Note</p> <p>\u4f60\u53ef\u80fd\u8fd8\u9700\u8981\u5b89\u88c5 <code>.NET 8 SDK</code> \u6765\u4f7f\u7528\u8be5\u6a21\u677f, \u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u5b83</p> \u4f7f\u7528 dotnet cli \u4ece\u6a21\u677f\u65b0\u5efa\u9879\u76ee <p>\u9996\u5148\u5728\u4e00\u4e2a\u4f60\u559c\u6b22\u7684\u4f4d\u7f6e\u653e\u7f6e\u4f60\u7684\u9879\u76ee\u6587\u4ef6\u5939, \u540d\u5b57\u5373\u4e3a\u4f60\u7684\u9879\u76ee\u540d, \u4f8b\u5982 <code>MyCelesteMod</code>: <pre><code>mkdir MyCelesteMod\ncd MyCelesteMod\n</code></pre> \u7136\u540e\u5728\u6b64\u4f4d\u7f6e\u5b89\u88c5 nuget \u4e0a\u6211\u7684 mod \u6a21\u677f(\u5982\u679c\u4f60\u6ca1\u6709\u5b89\u88c5\u7684\u8bdd): <pre><code>dotnet new install Saladim.CelesteModTemplate\n</code></pre> \u7136\u540e\u4f60\u5c31\u80fd\u4f7f\u7528\u8fd9\u6761\u6307\u4ee4\u76f4\u63a5\u521b\u5efa\u5916\u90e8\u6a21\u677f\u4e86: <pre><code>dotnet new sapcelestemode\n</code></pre> \u5982\u679c\u9700\u8981\u5c31\u5730\u6a21\u677f\u4f7f\u7528\u8fd9\u6761\u6307\u4ee4: <pre><code>dotnet new sapcelestemodi\n</code></pre> \u4e0b\u9762\u662f\u53ef\u9009\u62e9\u7684\u4e00\u4e9b\u53c2\u6570:</p> <ul> <li><code>-n</code>: \u4f60\u7684 Mod \u540d\u79f0, \u9ed8\u8ba4\u4e3a <code>MyCelesteMod</code>, \u7528\u4e8e\u91cd\u5199\u9879\u76ee\u540d\u5b57, \u4f8b\u5982 <code>-n YourCelesteMod</code>.</li> <li><code>-c</code>: \u6307\u5b9a\u851a\u84dd\u6839\u76ee\u5f55(\u53ea\u5bf9\u5916\u90e8\u6a21\u677f\u751f\u6548), \u4f8b\u5982 <code>-c \"C:\\Program Files\\steam\\steamapps\\Celeste\"</code>.</li> <li><code>-up</code>: \u662f\u5426\u4f7f\u7528 Publicize \u540e\u7684 Celeste \u7a0b\u5e8f\u96c6, \u9ed8\u8ba4\u5f00\u542f, \u5173\u95ed\u53ef\u4ee5 <code>-up false</code>.</li> <li><code>-ua</code>: \u662f\u5426\u4f7f\u7528 Celeste Mod \u5206\u6790\u5668, \u9ed8\u8ba4\u5f00\u542f, \u5173\u95ed\u53ef\u4ee5 <code>-ua false</code>.</li> <li><code>-ss</code>: \u5411\u9879\u76ee\u4e2d\u6dfb\u52a0 <code>Session</code> \u7c7b\u5e76\u5728 <code>Module</code> \u4e2d\u81ea\u52a8\u914d\u7f6e, \u9ed8\u8ba4\u5173\u95ed.</li> <li><code>-st</code>: \u5411\u9879\u76ee\u4e2d\u6dfb\u52a0 <code>Settings</code> \u7c7b\u5e76\u5728 <code>Module</code> \u4e2d\u81ea\u52a8\u914d\u7f6e, \u9ed8\u8ba4\u5173\u95ed.</li> <li><code>-sd</code>: \u5411\u9879\u76ee\u4e2d\u6dfb\u52a0 <code>SaveData</code> \u7c7b\u5e76\u5728 <code>Module</code> \u4e2d\u81ea\u52a8\u914d\u7f6e, \u9ed8\u8ba4\u5173\u95ed.</li> <li><code>-ev</code>: \u6307\u5b9a <code>everest.yaml</code> \u4e2d\u7684 <code>EverestCore</code> \u7248\u672c, \u9ed8\u8ba4\u4e3a <code>4465</code>.</li> <li><code>-mv</code>: \u6307\u5b9a <code>everest.yaml</code> \u4e2d\u7684\u4f60\u7684 Mod \u7684\u521d\u59cb\u7248\u672c, \u9ed8\u8ba4\u4e3a <code>0.1.0</code>.</li> </ul> <p>\u9996\u5148\u6211\u4eec\u6253\u5f00\u547d\u4ee4\u884c, \u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u5b89\u88c5: <pre><code>dotnet new install Saladim.CelesteModTemplate\n</code></pre></p> <p>\u5b8c\u6210\u540e\u6253\u5f00 <code>Visual Studio</code>, \u9009\u62e9 <code>\u521b\u5efa\u65b0\u9879\u76ee</code>, \u7136\u540e\u5728\u641c\u7d22\u6846\u4e2d\u8f93\u5165 <code>Celeste</code>, \u4f60\u5e94\u8be5\u80fd\u770b\u5230\u4ee5\u4e0b\u4e24\u4e2a\u6a21\u677f: </p>"},{"location":"coding_setup/basic_env/#_3","title":"\u5916\u90e8\u6a21\u677f","text":"<p>\u9009\u62e9\u5e76\u586b\u5199\u597d\u9879\u76ee\u540d\u79f0\u4e4b\u540e, \u4f60\u5e94\u8be5\u80fd\u770b\u5230\u4ee5\u4e0b\u5185\u5bb9: </p> <p>\u5176\u4e2d\u7684\u5404\u9009\u9879\u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u628a\u9f20\u6807\u79fb\u5230\u65c1\u8fb9\u7684 <code>info</code> \u56fe\u6807\u8fdb\u884c\u67e5\u770b.</p> <p>\u5b8c\u6210\u521b\u5efa\u540e\u4f60\u53ef\u4ee5\u6309\u4e0b <code>Ctrl+B</code> \u6216\u8005\u624b\u52a8\u70b9\u51fb <code>\u751f\u6210-&gt;\u751f\u6210\u89e3\u51b3\u65b9\u6848</code>, \u5982\u679c\u4f60\u5728\u4f60\u7684 vs \u8f93\u51fa\u91cc\u9762\u770b\u5230\u4e86\u7c7b\u4f3c\u8fd9\u4e24\u53e5:</p> <pre><code>1&gt;MyCelesteMod -&gt; D:\\User\\temp\\cm\\bin\\x86\\Debug\\net452\\MyCelesteMod.dll\n1&gt;MyCelesteMod -&gt; C:/Program Files (x86)/Steam/steamapps/common/Celeste/Mods/MyCelesteMod_copy/MyCelesteMod.dll\n</code></pre> <p>\u5e76\u4e14\u4f60\u5728\u4f60\u7684\u851a\u84dd Mod \u76ee\u5f55\u4e0b\u627e\u5230\u4e86\u8fd9\u4e2a\u88ab\u521b\u5efa\u7684\u76ee\u5f55, \u90a3\u4e48\u4f60\u7684\u73af\u5883\u5c31\u7b97\u662f\u914d\u5b8c\u4e86, \u5982\u679c\u4f60\u5f88\u611f\u5174\u8da3\u8fd9\u4e4b\u4e2d\u53d1\u751f\u4e86\u4ec0\u4e48, \u8981\u5f15\u7528\u54ea\u4e9b\u7a0b\u5e8f\u96c6, \u8fd9\u4e2a\u6a21\u677f\u80cc\u540e\u5e72\u4e86\u4ec0\u4e48, \u4f60\u53ef\u4ee5\u53bb\u770b\u90a3\u590d\u6742\u7684\u65e7\u7684\u914d\u7f6e\u65b9\u6cd5.</p> <p>Note</p> <p>\u8fd9\u4e2a\u6a21\u677f\u4f7f\u7528 <code>msbuild</code> \u5e2e\u52a9\u4e86\u4f60\u5f88\u591a\u4e8b! \u6bd4\u5982\u5f53\u4f60\u7f16\u8bd1\u5b8c\u9879\u76ee\u4e4b\u540e\u5b83\u4f1a\u590d\u5236\u7f16\u8bd1\u7ed3\u679c\u5230\u9879\u76ee\u76ee\u5f55\u7684 <code>ModFolder</code> \u76ee\u5f55\u4e0b, \u7136\u540e\u5c06\u6574\u4e2a <code>ModFolder</code> \u590d\u5236\u5230\u851a\u84dd\u7684 <code>Mods\\{\u4f60\u7684mod\u540d}_copy</code> \u6587\u4ef6\u5939\u4e0b! \u6240\u4ee5\u5f53\u6211\u4eec\u9700\u8981\u66f4\u6539\u4e00\u4e9b\u6bd4\u5982\u8bf4 loenn \u7684\u914d\u7f6e\u6587\u4ef6, <code>everest.yaml</code> \u7684\u5185\u5bb9, \u4f60\u7684\u6d4b\u8bd5\u5730\u56fe\u7b49\u65f6,  \u4f60\u53ea\u9700\u8981\u7b80\u5355\u5730\u91cd\u65b0\u7f16\u8bd1\u4e00\u904d\u9879\u76ee, \u7136\u540e\u7b49\u5f85\u6a21\u677f\u6765\u5e2e\u4f60\u505a\u5269\u4e0b\u7684\u6d3b!  </p>"},{"location":"coding_setup/basic_env/#_4","title":"\u5c31\u5730\u6a21\u677f","text":"<p>\u5c31\u5730\u6a21\u677f\u5728\u8fdb\u884c\u9879\u76ee\u540d\u79f0\u586b\u5199\u65f6\u4f60\u5e94\u8be5\u4f1a\u770b\u5230\u4ee5\u4e0b\u5185\u5bb9: </p> <p>\u8fd9\u91cc\u7684 <code>\u9879\u76ee\u540d\u79f0</code> \u5c31\u662f\u4f60\u7684 Mod \u540d\u79f0.   <code>\u4f4d\u7f6e</code> \u6211\u4eec\u9700\u8981\u6539\u5230\u851a\u84dd\u7684 <code>Mods</code> \u76ee\u5f55\u4e0b, \u4f8b\u5982 <code>C:\\Program Files\\steam\\steamapps\\Celeste\\Mods</code>.    \u586b\u5199\u5b8c\u6210\u540e\u6211\u4eec\u8fd8\u9700\u8981\u52fe\u9009 <code>\u5c06\u89e3\u51b3\u65b9\u6848\u548c\u9879\u76ee\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e2d</code>.</p> <p>\u540e\u9762\u7684\u9879\u76ee\u914d\u7f6e\u57fa\u672c\u4e0e\u5916\u90e8\u6a21\u677f\u4e00\u81f4, \u9664\u4e86 <code>Celeste \u6240\u5728\u7684\u76ee\u5f55</code>. \u8fd9\u9879\u5df2\u7ecf\u5728\u4e0a\u4e00\u6b65\u7684 <code>\u4f4d\u7f6e</code> \u586b\u5199\u8fc7\u4e86\u6240\u4ee5\u4e0d\u9700\u8981\u518d\u586b\u5199.</p>"},{"location":"coding_setup/basic_env/#module","title":"Module \u7c7b","text":"<p>\u5c31\u50cf\u6211\u4eec\u7684\u7ecf\u5178\u7684\u63a7\u5236\u53f0 C# \u5e94\u7528\u7a0b\u5e8f\u4e00\u6837\u6709\u4e2a <code>Main</code> \u65b9\u6cd5, \u6211\u4eec\u7684\u851a\u84dd Mod \u4e5f\u6709\u4e00\u4e2a\u7c7b\u4f3c\u7684\u4e1c\u897f,  \u90a3\u5c31\u662f Everest \u63d0\u4f9b\u7ed9\u6211\u4eec\u7684 <code>EverestModule</code> \u7c7b. \u90a3\u4e48, \u73b0\u5728\u6253\u5f00\u4f60\u7684 <code>MyCelesteModModule.cs</code> \u90a3\u4e2a\u6587\u4ef6, \u4f60\u5e94\u8be5\u4f1a\u770b\u5230\u7c7b\u4f3c\u7ed3\u6784\u8fd9\u6837\u7684\u4ee3\u7801: <pre><code>namespace MyCelesteMod;\n\npublic class MyCelesteModModule : EverestModule\n{\n    public override void Load()\n    {\n\n    }\n\n    public override void Unload()\n    {\n    }\n}\n</code></pre> \u5728\u5f00\u5934\u6211\u4eec\u58f0\u660e\u4e86\u547d\u540d\u7a7a\u95f4, \u63a5\u4e0b\u6765\u6211\u4eec\u58f0\u660e\u4e86\u4e00\u4e2a\u7c7b, \u7136\u540e\u8ba9\u5b83\u7ee7\u627f\u4e8e <code>EverestModule</code>, \u6ce8\u610f\u8fd9\u4e2a\u7c7b\u662f\u62bd\u8c61\u7684, \u5b83\u8981\u6c42\u6211\u4eec\u5b9e\u73b0\u7684\u4e24\u4e2a\u65b9\u6cd5\u5206\u522b\u4e3a <code>Load</code> \u4e0e <code>Unload</code>. \u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5f88\u7b80\u5355:</p> <ul> <li><code>Load</code> \u65b9\u6cd5\u5728\u4f60\u7684 mod \u88ab\u52a0\u8f7d\u65f6\u8c03\u7528.</li> <li><code>Unload</code> \u65b9\u6cd5\u5728\u4f60\u7684 mod \u88ab\u5378\u8f7d\u65f6\u8c03\u7528.</li> </ul> <p>\u901a\u5e38\u6211\u4eec\u4f1a\u5728 <code>Load</code> \u65b9\u6cd5\u91cc\u52a0\u8f7d\u6211\u4eec\u9700\u8981\u7684\u8d44\u6e90, \u8fdb\u884c\u9002\u5f53\u7684\u521d\u59cb\u5316, \u5728 <code>Unload</code> \u65b9\u6cd5\u91cc\u91ca\u653e\u6211\u4eec\u7684\u8d44\u6e90. \u5728\u8fd9\u91cc\u4e3a\u4e86\u660e\u663e\u53ef\u89c1, \u6211\u4eec\u5728 <code>Load</code> \u65b9\u6cd5\u91cc\u901a\u8fc7\u4e00\u4e2a\u851a\u84dd\u4e2d\u7684\u7c7b <code>Logger</code> \u6253\u5370\u51fa\u4e86\u4e00\u53e5 \"Hello World\".</p> \u5982\u679c\u4f60\u597d\u5947 <code>Logger.Log</code> \u8fd9\u4e2a\u65b9\u6cd5\u4f60\u53ef\u4ee5\u5c55\u5f00\u6765\u4e86\u89e3 <p><code>Logger</code> \u662f\u4e00\u4e2a\u851a\u84dd\u5e95\u5c42\u5f15\u64ce <code>Monocle</code> \u7684\u4e00\u4e2a\u5de5\u5177\u7c7b, \u5b83\u5e2e\u52a9\u4f60\u6253\u5370\u8f93\u51fa\u4e00\u4e9b\u8c03\u8bd5\u4fe1\u606f, \u901a\u5e38\u8fd9\u4e9b\u4fe1\u606f\u4f1a\u88ab\u6253\u5370\u8fdb\u63a7\u5236\u53f0\u7684\u540c\u65f6\u5199\u5165\u6e38\u620f\u7684 <code>log.txt</code> \u6587\u4ef6\u4e2d,  \u8fd9\u4e5f\u5c31\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u4f60\u9047\u5230\u5404\u79cd\u95ee\u9898\u65f6\u522b\u4eba\u603b\u8981\u6c42\u4f60\u53d1\u9001\u4f60\u7684 <code>log.txt</code>. <code>Logger.Log</code> \u6709\u4e24\u4e2a\u91cd\u8f7d, \u5176\u4e2d\u4e00\u4e2a\u7684\u7b7e\u540d\u662f: <pre><code>public static void Log(LogLevel logLevel, string tag, string str)\n</code></pre> \u5b83\u4f1a\u4ee5 <code>logLevel</code> \u7684\u65e5\u5fd7\u7b49\u7ea7\u6253\u5370\u4e00\u4e2a\u6807\u7b7e\u4e3a <code>tag</code> \u7684\u6d88\u606f <code>str</code>, \u53e6\u4e00\u4e2a\u91cd\u8f7d\u4e0d\u8981\u6c42\u4f60\u4f20\u5165 <code>logLevel</code> \u4f46\u4f1a\u9ed8\u8ba4\u4f60\u7684 <code>logLevel</code> \u4e3a <code>LogLevel.Verbose</code>. <code>LogLevel</code> \u679a\u4e3e\u5305\u542b <code>Verbose, Debug, Info, Warn, Error</code>. \u901a\u5e38\u5bf9\u4e8e\u666e\u901a\u65e5\u5fd7\u6211\u4eec\u4f1a\u9009\u62e9 <code>Info</code>, \u5bf9\u4e8e\u8f83\u591a\u7684\u8c03\u8bd5\u4fe1\u606f\u9009\u62e9 <code>Debug</code>, \u5bf9\u4e8e\u5197\u4f59\u7684\u4fe1\u606f\u9009\u62e9 <code>Verbose</code>, \u5bf9\u4e8e\u4e00\u4e9b\u9519\u8bef\u4f46\u4e0d\u5f71\u54cd\u6e38\u620f\u8fdb\u884c\u7684\u4fe1\u606f\u9009\u62e9 <code>Warn</code>, \u5bf9\u4e8e\u4e00\u4e9b\u81f4\u547d\u6027\u9519\u8bef\u6211\u4eec\u4f1a\u9009\u62e9 <code>Error</code>. \u4e00\u822c\u5730, \u6e38\u620f\u53ea\u4f1a\u6253\u5370 <code>Info</code> \u7b49\u7ea7\u53ca\u4ee5\u4e0a\u7684\u65e5\u5fd7, \u4f60\u53ef\u4ee5\u901a\u8fc7\u5728\u851a\u84dd\u542f\u52a8\u7684\u547d\u4ee4\u884c\u4e2d\u52a0\u5165<code>--loglevel {\u7b49\u7ea7}</code>\u6765\u6307\u5b9a\u8fc7\u6ee4\u7b49\u7ea7.</p>"},{"location":"coding_setup/basic_env/#everestyaml","title":"everest.yaml","text":"<p>ok, \u6211\u4eec\u524d\u9762\u5df4\u62c9\u5df4\u62c9\u8bb2\u4e86\u51e0\u4e4e\u4e09\u5343\u591a\u4e2a\u5b57, \u4f46\u662f\u4f9d\u7136\u6ca1\u6709\u8ba9\u851a\u84dd\u52a0\u8f7d\u5230\u6211\u4eec\u7684mod, \u4e0d\u8fc7\u522b\u6025, \u8fd9\u662f\u5012\u6570\u7b2c\u4e8c\u6b65\u4e86. \u5b9e\u9645\u4e0a\u6709\u5173 code mod \u7684\u6240\u6709\u4ee3\u7801\u76f8\u5173\u7684\u4e1c\u897f\u6211\u4eec\u90fd\u5df2\u7ecf\u505a\u5b8c\u4e86, \u5269\u4f59\u7684\u5176\u5b9e\u53ea\u662f\u4e00\u4e2a\u666e\u901a mod \u8981\u505a\u7684 ---- \u5199 <code>everest.yaml</code>. \u5728\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u5728 <code>ModFolder</code> \u8fd9\u4e2a\u6587\u4ef6\u5939\u91cc\u505a\u8fd9\u4ef6\u4e8b, \u90a3\u4e48, \u5728\u4f60\u7684\u8fd9\u4e2a\u6587\u4ef6\u5939\u4e0b\u521b\u5efa <code>everest.yaml</code> \u7a7a\u6587\u4ef6, \u4f60\u7684\u76ee\u5f55\u7ed3\u6784\u53ef\u80fd\u50cf\u662f:</p> <ul> <li>ModFolder<ul> <li>everest.yaml</li> <li>MyCelesteMod.dll</li> <li>MyCelesteMod.pdb</li> </ul> </li> </ul> <p>Note</p> <p><code>.dll</code> \u6587\u4ef6\u548c <code>.pdb</code> \u6587\u4ef6\u4ec5\u4f1a\u5728\u4f60\u6784\u5efa\u8fc7\u9879\u76ee\u540e\u51fa\u73b0, \u6709\u65f6\u5019\u751a\u81f3 ModFolder \u76ee\u5f55\u4e5f\u4f1a\u5728\u6784\u5efa\u8fc7\u540e\u51fa\u73b0</p> <p>\u597d\u7684, \u73b0\u5728\u6211\u4eec\u6253\u5f00 <code>everest.yaml</code>, \u7136\u540e\u50cf\u4e00\u4e2a\u666e\u901a\u7684 mapper \u4e00\u6837\u586b\u5199\u4fe1\u606f: <pre><code>- Name: MyCelesteMod\n  Version: 0.1.0\n  DLL: MyCelesteMod.dll\n  Dependencies:\n    - Name: EverestCore\n      Version: 1.4465.0\n</code></pre> \u8fd9\u4e9b\u53c2\u6570\u5206\u522b\u662f:</p> <ul> <li><code>Name</code>: \u4f60\u7684 mod \u540d\u5b57</li> <li><code>Version</code>: \u4f60\u7684 mod \u7684\u7248\u672c</li> <li><code>DLL</code>: \u5982\u679c\u4f60\u662f code mod \u7684\u8bdd, \u8fd9\u91cc\u586b\u5165\u4f60\u7684 code (\u4e5f\u5c31\u662f dll \u6587\u4ef6) \u7684\u4f4d\u7f6e, \u8fd9\u91cc\u6211\u4eec\u662f\u76f4\u63a5\u628a .dll \u6587\u4ef6\u653e\u5230\u8fd9\u4e2a yaml \u7684\u65c1\u8fb9\u4e86, \u6240\u4ee5\u76f4\u63a5\u5199\u540d\u5b57\u5c31\u597d</li> </ul> <p>\u6700\u540e\u662f\u6700\u5e95\u4e0b\u7684\u90a3\u4e2a\u4f9d\u8d56, \u8fd9\u91cc\u6211\u4eec\u53ea\u4f9d\u8d56\u6700\u57fa\u7840\u7684 Everest, \u7248\u672c\u586b\u4e0a\u4f60\u76ee\u524d\u4f7f\u7528\u7684 Everest \u7248\u672c, \u8fd9\u91cc\u6211\u5c31\u586b\u5199 3971 \u4e86. \u5982\u679c\u4f60\u7684 mod \u4f9d\u8d56 Everest Core, \u4f60\u9700\u8981\u5728\u8fd9\u91cc\u5c06 <code>Everest</code> \u66f4\u6539\u4e3a <code>EverestCore</code>, \u5e76\u5c06\u7248\u672c\u53f7\u586b\u5199\u5927\u4e8e 4465 \u7684\u503c.</p>"},{"location":"coding_setup/basic_env/#_5","title":"\u6700\u540e\u4e00\u6b65","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u7684\u8c03\u8bd5, \u6211\u4eec\u9700\u8981\u8ba9\u851a\u84dd\u6253\u5f00\u7684\u540c\u65f6\u6253\u5f00\u63a7\u5236\u53f0, \u8fd9\u4e00\u6b65\u5f88\u7b80\u5355:</p> <ul> <li>\u627e\u5230\u851a\u84dd\u6839\u76ee\u5f55\u4e0b\u7684 <code>everest-launch.txt</code>, \u6ca1\u6709\u7684\u8bdd\u65b0\u5efa\u4e00\u4e2a\u7a7a\u7684\u5c31\u884c\u4e86</li> <li>\u5411\u91cc\u9762\u5199\u5165 <code>--console</code></li> <li>\u641e\u5b9a, \u8d70\u4f60!</li> </ul> <p>\u73b0\u5728, \u91cd\u65b0\u7f16\u8bd1\u9879\u76ee, \u8ba9 <code>msbuild</code> \u5e26\u7740\u4f60\u7684 <code>ModFolder</code> \u7684\u5185\u5bb9\u524d\u5f80\u851a\u84dd Mods \u6587\u4ef6\u5939\u4e0b, \u542f\u52a8\u851a\u84dd, \u8ba9 Everest \u627e\u5230\u4f60\u7684 dll. \u5728\u540c\u65f6\u542f\u52a8\u7684\u9ed1\u4e4e\u4e4e\u7684\u547d\u4ee4\u884c\u7a97\u53e3\u4e0a\u4f60\u5e94\u8be5\u80fd\u5728\u8fd9\u9644\u8fd1\u770b\u5230\u90a3\u53e5\u719f\u6089\u7684 Hello world: <pre><code>(07/08/2023 21:18:59) [Everest] [Info] [core] Module DialogCutscene 1.0.0 registered.\n(07/08/2023 21:18:59) [Everest] [Info] [core] Module UpdateChecker 1.0.2 registered.\n(07/08/2023 21:18:59) [Everest] [Info] [core] Module InfiniteSaves 1.0.0 registered.\n(07/08/2023 21:18:59) [Everest] [Info] [core] Module DebugRebind 1.0.0 registered.\n(07/08/2023 21:18:59) [Everest] [Info] [core] Module RebindPeriod 1.0.0 registered.\n(07/08/2023 21:19:00) [Everest] [Info] [Everest.LuaBoot] Lua ready.\n(07/08/2023 21:19:00) [Everest] [Info] [MyCelesteMod] Hello World!\n(07/08/2023 21:19:00) [Everest] [Info] [core] Module MyAwesomeMod 0.1.0 registered.\n(07/08/2023 21:19:00) [Everest] [Info] [loader] Loading mods with unsatisfied optional dependencies (if any)\nFNA3D Driver: D3D11\nD3D11 Adapter: Intel(R) UHD Graphics 630\n</code></pre></p> <p>\u5728\u7ecf\u8fc7\u5982\u4e0a\u7684\u914d\u7f6e\u540e, \u4f60\u4f1a\u53d1\u73b0\u5728\u851a\u84dd\u542f\u52a8\u7684\u65f6\u5019, \u8fdb\u884c\u7f16\u8bd1\u5e76\u590d\u5236\u8d44\u6e90\u65f6\u4f1a\u62a5\u9519,  \u8fd9\u662f\u56e0\u4e3a Everest \u9501\u5b9a\u5360\u7528\u4e86\u5b83\u4eec, \u5bfc\u81f4\u4f60\u4e0d\u5f97\u4e0d\u8ba9\u8fd9\u4e00\u5207\u5728\u851a\u84dd\u5173\u95ed\u65f6\u8fdb\u884c, \u540c\u65f6\u7531\u4e8e\u851a\u84dd\u7684\u91cd\u542f\u901f\u5ea6\u4e0d\u662f\u5f88\u7406\u60f3, \u8fd9\u5927\u5927\u7684\u62c9\u4f4e\u4e86 mod \u5f00\u53d1\u6548\u7387. \u4e0d\u8fc7\u597d\u5728 Everest \u63d0\u4f9b\u4e86\u4e00\u4e2a\u6280\u672f\u53eb\u505a <code>code hot reload</code>, \u5373\u70ed\u91cd\u8f7d, \u5b83\u5141\u8bb8\u4f60\u5728\u6e38\u620f\u8fd0\u884c\u671f\u95f4\u66ff\u6362\u4f60\u7684\u4ee3\u7801\u5e76\u91cd\u8f7d\u8d44\u6e90, \u5b83\u76ee\u524d\u8fd8\u5728 wip \u72b6\u6001. \u8981\u5f00\u542f\u8fd9\u9879\u529f\u80fd, \u9996\u5148\u5230\u4f60\u7684\u851a\u84dd\u6839\u76ee\u5f55\u4e0b\u7684 Saves \u76ee\u5f55, \u627e\u5230\u5e76\u6253\u5f00 <code>modsettings-Everest.celeste</code> \u8fd9\u4e2a\u6587\u4ef6, \u4f7f\u7528<code>Ctrl + F \u641c\u7d22</code>\u627e\u5230\u5c5e\u6027 <code>CodeReload_WIP</code>, \u5c06\u5176\u66f4\u6539\u4e3a <code>true</code>, \u6b64\u65f6\u91cd\u65b0\u7f16\u8bd1\u4f60\u7684\u9879\u76ee, \u4f60\u5e94\u8be5\u5c31\u4e0d\u4f1a\u518d\u5f97\u5230\u4efb\u4f55\u9519\u8bef, \u5e76\u4e14 Everest \u4e5f\u6b63\u786e\u5730\u70ed\u91cd\u8f7d\u4e86\u4f60\u7684 mod \u548c\u4f60\u7684 mod \u8d44\u6e90.</p> <p>\u8fd9\u4e00\u8282\u5b8c\u6210\u540e\u4f60\u7684\u76ee\u5f55\u7ed3\u6784\u5927\u6982\u4f1a\u50cf\u662f         \u5916\u90e8\u6a21\u677f:</p> <ul> <li>MyCelesteMod (\u4f60\u9879\u76ee\u7684\u6839\u76ee\u5f55)<ul> <li>ModFolder<ul> <li>Code<ul> <li>MyCelesteMod.dll</li> <li>MyCelesteMod.pdb</li> </ul> </li> <li>everest.yaml</li> </ul> </li> <li>CelesteMod.props</li> <li>CelesteMod.targets</li> <li>MyCelesteMod.csproj</li> <li>MyCelesteModModule.cs</li> </ul> </li> </ul> <p>\u6216 \u5c31\u5730\u6a21\u677f:</p> <ul> <li>MyCelesteMod (\u4f60\u9879\u76ee\u7684\u6839\u76ee\u5f55)<ul> <li>everest.yaml</li> <li>Source<ul> <li>CelesteMod.props</li> <li>CelesteMod.targets</li> <li>MyCelesteMod.csproj</li> <li>MyCelesteModModule.cs</li> <li>.everestignore</li> </ul> </li> <li>Code <ul> <li>MyCelesteMod.dll</li> <li>MyCelesteMod.pdb</li> </ul> </li> </ul> </li> </ul> <p>\u5176\u4e2d\u6b63\u5982\u4e4b\u524d\u6240\u4ecb\u7ecd\u7684, \u5982\u679c\u4f60\u4f7f\u7528\u5916\u90e8\u6a21\u677f\u7684\u8bdd, mod \u7684\u8d44\u6e90\u6587\u4ef6\u5e94\u8be5\u653e\u5728 <code>ModFolder</code> \u4e2d, \u7136\u540e\u5c31\u50cf\u5f80\u5e38\u4e00\u6837\u653e\u7f6e\u4f60\u7684 mod \u8d44\u6e90, \u5f53\u4f60\u7684\u9879\u76ee\u5728\u6784\u5efa\u65f6\u5b83\u4eec\u4f1a\u81ea\u52a8\u88ab\u590d\u5236. \u5e76\u4e14\u5c06\u4ee3\u7801\u6587\u4ef6\u653e\u7f6e\u5728 .csproj \u540c\u76ee\u5f55\u4e0b\u6216\u5d4c\u5957\u6587\u4ef6\u5939\u4e0b, \u5982\u679c\u4f60\u6ca1\u6709\u66f4\u6539\u4f60\u7684\u9879\u76ee\u800c\u53ea\u66f4\u6539\u4e86\u8d44\u6e90\u6587\u4ef6\u65f6\u4f60\u4f1a\u53d1\u73b0\u7f16\u8bd1\u9879\u76ee\u4f1a\u56e0\u4e3a \"\u6240\u6709\u6587\u4ef6\u90fd\u662f\u6700\u65b0\u7684\" \u800c\u8df3\u8fc7\u7f16\u8bd1, \u800c\u540c\u65f6\u4e5f\u4f1a\u8df3\u8fc7\u6211\u4eec\u7684\u8d44\u6e90\u590d\u5236, \u5bf9\u6b64\u6211\u4eec\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848:</p> <ul> <li>\u76f4\u63a5\u5f3a\u5236\u91cd\u65b0\u6784\u5efa\u9879\u76ee (vs \u4e2d \"\u751f\u6210\" -&gt; \"\u91cd\u65b0\u751f\u6210\u9879\u76ee\")</li> <li>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u6267\u884c <code>msbuild -target:PostModBuild</code> \u547d\u4ee4\u884c</li> </ul> <p>\u597d\u50cf\u662f\u6709\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6cd5, \u4e0d\u8fc7\u9274\u4e8e\u672c\u4eba MSBuild \u77e5\u8bc6\u4e0d\u8db3\u53ea\u80fd\u505a\u6210\u8fd9\u6837\u4e86(x</p>"},{"location":"coding_setup/code_reading/","title":"\u9605\u8bfb\u4ee3\u7801","text":""},{"location":"coding_setup/code_reading/#_2","title":"\u53cd\u7f16\u8bd1\u5de5\u5177","text":"<p>\u4e3a\u4e86\u8fdb\u884c Code Mod \u7684\u5f00\u53d1, \u663e\u7136\u6211\u4eec\u9700\u8981\u77e5\u9053\u770b\u4e00\u773c\u5c31\u80fd\u88ab\u5413\u8dd1\u7684\u851a\u84dd\u7684\u4ee3\u7801\u662f\u600e\u4e48\u8fd0\u884c\u7684.</p> <p>\u6240\u4ee5\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u9605\u8bfb\u851a\u84dd\u7684\u4ee3\u7801\u4ee5\u4e86\u89e3\u8fd9\u4e9b\u4e1c\u897f. \u5f53\u7136, \u851a\u84dd\u662f\u4e2a\u5546\u4e1a\u6e38\u620f, \u60f3\u6307\u671b\u5b83\u5f00\u6e90\u6240\u6709\u4ee3\u7801\u662f\u4e0d\u53ef\u80fd\u7684, \u6240\u4ee5\u6211\u4eec\u5c31\u5fc5\u987b\u5f97\u501f\u52a9\u4e00\u4e9b\u53cd\u7f16\u8bd1\u5de5\u5177.  </p> <p>\u5728\u8fd9\u91cc\u6211\u4f1a\u63a8\u8350 <code>dnSpy</code> \u6216 <code>ILSpy</code></p> <p>Warning</p> <p>\u4e0d\u8981\u4e0a\u4f20\u53cd\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u5230\u4efb\u4f55\u5730\u65b9, \u8fd9\u53ef\u80fd\u4f1a\u4e0d\u53ef\u907f\u514d\u7684\u9020\u6210\u4e00\u4e9b\u4e89\u8bae.</p>"},{"location":"coding_setup/code_reading/#dnspy","title":"dnSpy","text":"<p>\u4f7f\u7528\u8be5\u8f6f\u4ef6\u5f88\u7b80\u5355:</p> <ul> <li>\u6253\u5f00\u5b83</li> <li>\u70b9\u51fb\u5de6\u4e0a\u89d2\u7684<code>\u6587\u4ef6</code>, <code>\u6253\u5f00</code></li> <li>\u9009\u62e9 <code>Celeste.exe</code> (\u5982\u679c\u4f60\u4f7f\u7528 core \u7248\u672c\u7684 everest, \u4f60\u9700\u8981\u9009\u62e9 <code>Celeste.dll</code>)</li> <li>\u5c55\u5f00\u851a\u84dd\u7684\u7a0b\u5e8f\u96c6</li> <li>\u4f60\u73b0\u5728\u53ef\u4ee5\u770b\u5230\u851a\u84dd\u90fd\u6709\u54ea\u4e9b\u7c7b\u4e86</li> <li>\u4f60\u73b0\u5728\u4e5f\u53ef\u4ee5\u770b\u5230\u851a\u84dd\u90fd\u6709\u54ea\u4e9b\u51fd\u6570\u4e86</li> </ul> <p>\u73b0\u5728\u6211\u4eec\u6d4f\u89c8\u851a\u84dd\u7684\u4ee3\u7801\u5c31\u50cf\u4f60\u5728 IDE \u91cc\u6d4f\u89c8\u4f60\u7684\u9879\u76ee\u4e00\u6837, \u867d\u7136\u8fd9\u4e0d\u662f\u6211\u4eec\u7684\u9879\u76ee. \u5728\u6d4f\u89c8\u8fc7\u7a0b\u4e2d, \u901a\u5e38\u53ef\u80fd\u4f60\u4f1a\u5bf9\u7740\u4e00\u4e2a\u5b57\u6bb5\u3001\u4e00\u4e2a\u51fd\u6570\u53d1\u5446, \u5927\u6982\u662f\u56e0\u4e3a\u4f60\u6839\u672c\u4e0d\u77e5\u9053\u5b83\u662f\u505a\u4ec0\u4e48\u7684! \u597d\u5728 <code>dnSpy</code> \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f88\u597d\u7528\u7684\"\u5206\u6790\"\u529f\u80fd\u6765\u7f13\u89e3\u8fd9\u4e2a :  \u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u770b\u5230\u54ea\u4e9b\u5b57\u6bb5\u3001\u54ea\u4e9b\u51fd\u6570\u88ab\u8c01\u8c03\u7528\u4e86\u3001\u88ab\u8c01\u5f15\u7528\u4e86\u3001\u88ab\u8c01\u66f4\u6539\u4e86:  </p>"},{"location":"coding_setup/code_reading/#ilspy","title":"ILSpy","text":"<p>\u4f7f\u7528\u8be5\u8f6f\u4ef6\u7684\u65b9\u5f0f\u4e0e <code>dnSpy</code> \u76f8\u540c:</p> <ul> <li>\u6253\u5f00\u5b83</li> <li>\u70b9\u51fb\u5de6\u4e0a\u89d2\u7684<code>\u6587\u4ef6</code>, <code>\u6253\u5f00</code></li> <li>\u9009\u62e9 <code>Celeste.exe</code> (\u5982\u679c\u4f60\u4f7f\u7528 core \u7248\u672c\u7684 everest, \u4f60\u9700\u8981\u9009\u62e9 <code>Celeste.dll</code>)</li> <li>\u5c55\u5f00\u851a\u84dd\u7684\u7a0b\u5e8f\u96c6, \u6d4f\u89c8\u7c7b\u548c\u65b9\u6cd5</li> </ul> <p>\u76f8\u5e94\u7684, <code>ILSpy</code> \u4e5f\u63d0\u4f9b\u4e86\"\u5206\u6790\"\u7684\u529f\u80fd:</p> <p> \u4ee5\u53ca\u5bf9\u5e94\u7684\u5206\u6790\u7ed3\u679c(\u5c55\u5f00\u592a\u957f\u4e86\u5c31\u4e0d\u5c55\u5f00\u4e86):</p> <p> </p> \u5206\u6790\u7ed3\u679c\u8bf4\u660e <p>\u56e0\u4e3a <code>ILSpy</code> \u5e76\u6ca1\u6709\u5b9e\u73b0\u5206\u6790\u7ed3\u679c\u7684\u7ffb\u8bd1, \u8fd9\u91cc\u505a\u4e0b\u7b80\u5355\u7684\u7ffb\u8bd1:</p> <ul> <li><code>Uses</code> \u76f4\u63a5\u4f9d\u8d56\u4e8e</li> <li><code>Used By</code> \u88ab\u8c03\u7528\u4e8e</li> <li><code>Read By</code> \u88ab\u8bfb\u53d6\u4e8e</li> <li><code>Assigned By</code> \u8d4b\u503c\u4e8e</li> <li><code>Expose By</code> \u66b4\u9732\u4e8e</li> <li><code>Instantiated By</code> \u88ab\u5b9e\u4f8b\u5316\u4e8e</li> <li><code>Extension Methods</code> \u62d3\u5c55\u65b9\u6cd5</li> </ul>"},{"location":"coding_setup/code_reading/#_3","title":"\u53cd\u7f16\u8bd1\u4ee3\u7801\u4e2d\u7684\"\u7279\u6b8a\"\u8bed\u6cd5","text":"<p>\u4e00\u4e9b\u60c5\u51b5\u4e0b, \u9605\u8bfb\u7531\u53cd\u7f16\u8bd1\u5668\u751f\u6210\u7684\u4ee3\u7801\u65f6\u53ef\u80fd\u4e0d\u662f\u90a3\u4e48\u987a\u5229, \u90a3\u4e48\u8fd9\u4e00\u8282\u4f1a\u7b80\u5355\u8bf4\u4e00\u4e9b\u53cd\u7f16\u8bd1\u5668\u751f\u6210\u7684\u4ee3\u7801\u4e0e\u901a\u5e38\u7684 C# \u4ee3\u7801\u4e0d\u4e00\u6837\u7684\u5730\u65b9.</p> <p>\u5728\u53cd\u7f16\u8bd1\u5668\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u5947\u602a\u7684\u8bed\u6cd5: Celeste.FinalBoss (\u5373 6a \u540e\u534a\u6bb5 Badeline Boss \u5b9e\u4f53)<pre><code>public void orig_ctor(EntityData e, Vector2 offset)\n{\n    this..ctor(e.Position + offset, e.NodesOffset(offset), e.Int(\"patternIndex\", 0), e.Float(\"cameraPastY\", 120f), e.Bool(\"dialog\", false), e.Bool(\"startHit\", false), e.Bool(\"cameraLockY\", true));\n}\n</code></pre></p> <p>\u55ef...\u597d\u7684, \u9996\u5148 <code>orig_ctor</code> \u8fd9\u4e2a\u540d\u5b57\u6709\u70b9\u602a\u4f46\u662f\u80fd\u63a5\u53d7, \u4f46\u662f\u63a5\u4e0b\u6765\u7684 <code>this..ctor</code> \u662f\u4ec0\u4e48? \u5b83\u751a\u81f3\u5728 <code>C#</code> \u4e2d\u662f\u4e2a\u975e\u6cd5\u8bed\u6cd5! \u5176\u5b9e\u8fd9\u5e76\u4e0d\u7f55\u89c1, \u7531\u4e8e Everest \u5bf9\u851a\u84dd\u7a0b\u5e8f\u7684\u4fee\u6539\u5e76\u4e0d\u53ea\u662f\u505c\u7559\u5728\u8868\u9762, \u800c\u66f4\u662f\u6df1\u5165\u5230\u4e86 IL \u4ee3\u7801\u5c42, \u8fd9\u662f\u4e00\u79cd\u76f8\u5bf9\u5e95\u5c42\u7684\u4ee3\u7801, \u4f60\u7684 <code>C#</code> \u4ee3\u7801\u6700\u7ec8\u90fd\u4f1a\u88ab\u7f16\u8bd1\u4e3a <code>IL</code> \u7136\u540e\u6254\u7ed9\u8fd0\u884c\u65f6(CLR-Common Language Runtime)\u6765\u6267\u884c, \u540c\u6837\u5730, \u6240\u6709\u5176\u4ed6\u7684 <code>.NET</code> \u7cfb\u8bed\u8a00\u6bd4\u5982 <code>VB.NET</code> \u548c <code>F#</code> \u4e5f\u90fd\u4f1a\u88ab\u7f16\u8bd1\u4e3a IL. \u90a3\u4e48\u65e2\u7136\u8fd9\u91cc\u7684 IL \u662f\u7531 <code>C#</code> \u7f16\u8bd1\u800c\u6765\u7684, \u90a3\u4e48\u8fd9\u6837\u7684 IL \u591a\u591a\u5c11\u5c11\u4f1a\u6709\u4e00\u79cd \"C# \u5473\", \u53cd\u7f16\u8bd1\u5668\u5c31\u662f\u9760\u8fd9\u79cd\u4e00\u5b9a\u7684 \"C# \u5473\" \u6765\u9006\u63a8\u51fa\u53ef\u80fd\u7684 <code>C#</code> \u6e90\u7801.  \u4f46\u662f\u65e2\u7136\u8fd9\u91cc Everest \u76f4\u63a5\u5728 IL \u4ee3\u7801\u5c42\u8fdb\u884c\u4e86\u4fee\u6539, \u7834\u574f\u4e86\u8fd9\u79cd \"C# \u5473\", \u90a3\u81ea\u7136\u53cd\u7f16\u8bd1\u5668\u5c31\u4f1a\u751f\u6210\u5947\u5947\u602a\u602a\u751a\u81f3\u975e\u6cd5\u7684\u4ee3\u7801.  </p> <p>\u90a3\u4e48\u8fd9\u91cc\u751f\u6210\u7684\u5947\u602a\u975e\u6cd5\u7684\u4ee3\u7801\u662f\u4ec0\u4e48?  </p>"},{"location":"coding_setup/code_reading/#ctor-cctor","title":".ctor / .cctor","text":"<p><code>.ctor</code> \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u51fd\u6570\u540d\u79f0, \u8868\u793a\u8be5\u7c7b\u7684\u6784\u9020\u51fd\u6570, \u6bd4\u5982 <code>Player..ctor(a, b)</code> \u5373\u8868\u793a\u8c03\u7528 <code>Player</code> \u7c7b\u7684 <code>.ctor</code> \u51fd\u6570, \u867d\u7136\u4f60\u81ea\u5df1\u662f\u505a\u4e0d\u5230\u7684.  </p> <p><code>.cctor</code> \u4e5f\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u51fd\u6570\u540d\u79f0, \u8868\u793a\u8be5\u7c7b\u7684\u9759\u6001\u6784\u9020\u51fd\u6570, \u6bd4\u5982 <code>Input..cctor()</code> \u5373\u8868\u793a\u8c03\u7528 <code>Input</code> \u7c7b\u7684\u65e0\u53c2\u9759\u6001\u6784\u9020\u51fd\u6570.  </p> <p>\u8fd9\u4e00\u7c7b\u51fd\u6570\u5728 <code>IL</code> \u5c42\u6709\u4e2a\u6807\u8bb0\u53eb <code>special name</code>, \u5f53\u53cd\u7f16\u8bd1\u5668\u53d1\u73b0\u4e00\u4e2a\u65b9\u6cd5\u540d\u4e3a <code>.ctor</code> \u4e14\u5e26\u6709 <code>special name</code> \u6807\u8bb0\u7684\u65b9\u6cd5\u65f6, \u53cd\u7f16\u8bd1\u5668\u5c31\u4f1a\u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a\u6784\u9020\u51fd\u6570, \u5982\u679c\u53cd\u7f16\u8bd1\u5668\u53d1\u73b0\u8fd9\u4e2a\u65b9\u6cd5\u5728\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u5f00\u5934\u8c03\u7528\u4e86, \u90a3\u4e48\u53cd\u7f16\u8bd1\u5668\u5c31\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u6784\u9020\u51fd\u6570\u5e26\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u94fe, \u4f46\u662f\u5982\u679c\u5b83\u7684\u8c03\u7528\u4f4d\u7f6e\u5728\u5176\u4ed6\u4f4d\u7f6e, \u540c\u65f6\u53c8\u56e0\u4e3a <code>C#</code> \u7f16\u8bd1\u5668\u662f\u4e0d\u53ef\u80fd\u8fd9\u4e48\u7f16\u8bd1\u7684, \u90a3\u4e48\u53cd\u7f16\u8bd1\u5668\u5c31\u4f1a\u4e0d\u77e5\u6240\u63aa, \u53ea\u80fd\u65e0\u5948\u7684\u751f\u6210 <code>xxx..ctor()</code> \u8fd9\u79cd\u9519\u8bef\u7684\u8bed\u6cd5. \u8fd9\u4e5f\u662f\u6211\u4eec\u4e0a\u9762\u770b\u5230\u7684 <code>this..ctor</code> \u8fd9\u79cd\u8bed\u6cd5\u88ab\u751f\u6210\u7684\u539f\u56e0, \u56e0\u4e3a\u8fd9\u4e2a\u6784\u9020\u51fd\u6570\u8c03\u7528\u4e0d\u5728\u6784\u9020\u51fd\u6570\u91cc\u51fa\u73b0, \u800c\u662f\u5728\u4e00\u4e2a\u6b63\u5e38\u7684 <code>orig_ctor</code> \u65b9\u6cd5\u91cc\u9762!  </p> <p>Info</p> <p><code>ctor</code> \u8fd9\u4e2a\u5947\u602a\u7684\u7f29\u5199\u6765\u81ea\u5355\u8bcd <code>constructor</code>, \u76f4\u8bd1\u5373 <code>\u6784\u9020\u5668</code>.</p> <p>\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u4e5f\u4f1a\u7528 <code>.ctor</code> / <code>ctor</code> \u6765\u6307\u4ee3\u6784\u9020\u51fd\u6570, <code>.cctor</code> / <code>cctor</code> \u6307\u4ee3\u9759\u6001\u6784\u9020\u51fd\u6570. \u6b64\u5916, Visual Studio \u4e2d\u6709\u4e2a\u81ea\u5e26\u7684\u4ee3\u7801\u7247\u6bb5\u5c31\u662f <code>ctor</code>, \u5728\u7c7b\u4e2d\u6253\u51fa ctor \u5e76\u53cc\u51fb Tab \u952e, vs \u5c31\u4f1a\u81ea\u52a8\u751f\u6210\u8be5\u7c7b\u7684\u6784\u9020\u51fd\u6570, \u8fd9\u91cc\u7684 <code>ctor</code> \u6765\u6e90\u4e5f\u5c31\u5728\u6b64. </p> <p>Info</p> <p>\u5728\u540e\u9762\u7684\u94a9\u5b50\u8282\u6211\u4eec\u6ca1\u6709\u63a2\u8ba8\u8fc7\u6784\u9020\u51fd\u6570\u5982\u4f55\u94a9\u53d6, \u5728\u8fd9\u91cc\u4f60\u53ef\u80fd\u5c31\u4f1a\u660e\u767d, \u94a9\u53d6\u540d\u5b57\u4e3a <code>ctor</code> \u7684\u51fd\u6570\u5c31\u662f\u94a9\u53d6\u4e86\u6784\u9020\u51fd\u6570, \u9759\u6001\u6784\u9020\u51fd\u6570\u540c\u7406.</p>"},{"location":"coding_setup/code_reading/#orig_","title":"orig_*","text":"<p>\u8fd8\u6709\u4e00\u4e9b\u51fd\u6570\u4ee5 <code>orig_</code> \u5f00\u5934, \u8fd9\u5176\u5b9e\u662f everest \u81ea\u5df1\"\u94a9\u53d6\"\u7684\u51fd\u6570. \u5728\u8fd9\u91cc, \u6bd4\u5982 <code>Player.Update</code> \u65b9\u6cd5\u5c31\u88ab everest \u8fdb\u884c\u4e86\"\u94a9\u53d6\", \u800c\u94a9\u5b50\u51fd\u6570\u672c\u4f53\u5c31\u662f <code>Player.Update</code>, \u800c\u5bf9\u5e94\u6211\u4eec\u94a9\u5b50\u7684 <code>orig</code> \u59d4\u6258\u5728\u5c31\u4f53\u73b0\u4e3a <code>orig_Update</code> \u65b9\u6cd5.</p> Player.Update  (\u50cf\u94a9\u5b50\u672c\u4f53\u4e00\u6837!)<pre><code>public override void Update()\n{\n    this.orig_Update(); // \u5c31\u50cf\u5728\u6211\u4eec\u7684\u94a9\u5b50\u91cc\u8c03\u7528 orig \u59d4\u6258\u4e00\u6837\n    // \u5c31\u50cf\u5728\u6211\u4eec\u7684\u94a9\u5b50\u91cc\u5728\u51fd\u6570\u6267\u884c\u5b8c\u540e\u505a\u4e9b\u4e8b\u60c5\u4e00\u6837\n    Level level = base.Scene as Level;\n    if (level == null)\n    ......\n}\n// Player.orig_Update() \u5c31\u50cf\u6211\u4eec\u7684\u94a9\u5b50\u94a9\u53d6\u7684\u539f\u51fd\u6570!\n</code></pre> <p>Info</p> <p>\u5982\u679c\u4f60\u81ea\u884c\u94a9\u53d6 <code>Player.Update</code> \u51fd\u6570\u8fd9\u79cd\u5df2\u88ab everest \"\u94a9\u53d6\" \u7684\u51fd\u6570\u5b9e\u9645\u4e0a\u4f60\u94a9\u53d6\u7684\u662f everest \u7684\u94a9\u5b50, \u8fd9\u5bf9\u4e8e <code>On</code> \u94a9\u5b50\u53ef\u80fd\u6ca1\u6709\u5927\u5f71\u54cd, \u4f46\u662f\u5bf9\u4e8e\u540e\u9762\u6211\u4eec\u4f1a\u8bf4\u7684 <code>IL</code> \u94a9\u5b50\u6709\u5f88\u5927\u5f71\u54cd, \u4e0d\u8fc7\u8fd9\u4e9b\u6211\u4eec\u7b49\u5230\u540e\u9762\u518d\u8bf4.</p>"},{"location":"coding_setup/code_reading/#_4","title":"\u53cd\u7f16\u8bd1\u4ee3\u7801\u4e2d\u7684\u5947\u602a\u6570\u5b57","text":"<p>\u6709\u65f6\u4f60\u80fd\u5728\u4ee3\u7801\u4e2d\u770b\u5230\u5404\u79cd\u5947\u602a\u7684\u6570\u5b57</p> <ul> <li>\u4f8b\u5982 320, 180, \u8fd9\u662f\u56e0\u4e3a\u5bf9\u4e8e const \u5e38\u91cf\u6210\u5458, c# \u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u671f\u5c31\u628a\u5f15\u7528\u7684\u8fd9\u4e9b\u4e1c\u897f\u76f4\u63a5\u66ff\u6362\u4e3a\u4e86\u6570\u5b57</li> <li>\u4f8b\u5982 0.100000024f, \u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u5e38\u91cf\u8ba1\u7b97\u5b8c\u540e\u672c\u8eab\u5c31\u957f\u8fd9\u6837, \u4e5f\u53ef\u80fd\u5355\u7eaf\u662f\u6d6e\u70b9\u8bef\u5dee\u4e4b\u7c7b\u7684</li> </ul>"},{"location":"coding_setup/code_reading/#_5","title":"\u53cd\u7f16\u8bd1\u4ee3\u7801\u4e2d\u7684\u5947\u602a\u547d\u540d","text":""},{"location":"coding_setup/code_reading/#num-text-array-flag","title":"num, text, array, flag","text":"<p>\u5f53\u6ca1\u6709\u7279\u610f\u505a\u8fc7\u4ee3\u7801\u6df7\u6dc6\u7684\u65f6\u5019, \u7f16\u8bd1\u51fa\u6765\u7136\u540e\u53cd\u7f16\u8bd1\u56de\u53bb\u7684\u4ee3\u7801\u7406\u8bba\u4e0a\u90fd\u80fd\u88ab\u6e05\u6670\u7684\u9605\u8bfb, \u4f46\u6211\u4eec\u65f6\u5e38\u5728\u53cd\u7f16\u8bd1\u51fa\u6765\u7684\u4ee3\u7801\u4e2d\u770b\u5230\u7c7b\u4f3c<code>num, text, array, flag</code>\u7684\u5b57\u6837, \u8fd9\u662f\u600e\u4e48\u56de\u4e8b\u5462, \u660e\u660e\u6709\u4e9b\u53d8\u91cf\u540d\u662f\u53ef\u8bfb\u7684\u5440, \u600e\u4e48\u6709\u7684\u5c31\u4e0d\u53ef\u8bfb\u4e86, \u5176\u5b9e\u53ea\u8981\u4f60\u4ed4\u7ec6\u89c2\u5bdf\u5c31\u4f1a\u53d1\u73b0, \u53ef\u8bfb\u7684\u57fa\u672c\u4e0a\u90fd\u662f\u4e00\u4e9b\u7c7b\u540d, \u5b57\u6bb5, \u5c5e\u6027, \u65b9\u6cd5\u7b49, \u800c\u4e00\u4e9b\u5c40\u90e8\u53d8\u91cf\u7684\u540d\u5b57\u5f80\u5f80\u4e0d\u53ef\u8bfb, \u8fd9\u662f\u56e0\u4e3a\u8fd9\u90e8\u5206\u7684\u4fe1\u606f\u5b58\u5728\u4e86<code>.dll</code>\u540c\u540d\u7684<code>.pdb(Program Database File)</code>\u7c7b\u578b\u7684\u6587\u4ef6\u4e2d, \u5b83\u5305\u542b\u4e86\u7a0b\u5e8f\u7684\u5404\u79cd\u8c03\u8bd5\u6570\u636e, \u6240\u4ee5\u53ea\u9700\u8981\u628a\u5b83\u8ddf\u5bf9\u5e94<code>.dll</code>\u653e\u4e00\u8d77\u5c31\u597d\u4e86(\u6ca1\u6709\u5c31\u6ca1\u529e\u6cd5\u4e86), \u4e0d\u7136\u53cd\u7f16\u8bd1\u5668\u5c31\u53ea\u80fd\u6839\u636e\u8fd9\u4e2a\u53d8\u91cf\u7684\u7c7b\u578b\u7ed9\u5b83\u4e00\u4e2a\u5927\u4f17\u7684\u540d\u5b57\u4e86(\u6bd4\u5982bool\u7ed9flag, \u5b57\u7b26\u4e32\u7ed9text\u7b49)</p> <p>\u8fd9\u91cc\u6211\u5199\u4e86\u4e00\u4e2a\u7b80\u5355\u7684c#\u63a7\u5236\u53f0\u5e94\u7528\u7a0b\u5e8f</p> <p></p> <p>\u4f60\u4f1a\u53d1\u73b0\u7f16\u8bd1\u51fa\u6765\u7684\u6587\u4ef6\u6709<code>.exe</code> <code>.dll</code> <code>.pdb</code></p> <p></p> <p>\u5982\u679c\u6211\u76f4\u63a5\u53cd\u7f16\u8bd1\u8fd9\u4e2a<code>.dll</code>\u4f60\u5c31\u4f1a\u53d1\u73b0\u4ee3\u7801\u53ef\u8bfb, \u51e0\u4e4e\u8ddf\u5728\u81ea\u5df1\u7684ide\u91cc\u6ca1\u4ec0\u4e48\u4e24\u6837</p> <p></p> <p>\u800c\u5982\u679c\u628a\u8fd9\u4e2a<code>.dll</code>\u62d6\u5230\u684c\u9762\u518d\u53cd\u7f16\u8bd1\u4f60\u5c31\u4f1a\u53d1\u73b0\u4ee3\u7801\u5f00\u59cb\u53d8\u5f97\u5947\u602a\u4e86</p> <p></p>"},{"location":"coding_setup/code_reading/#_6","title":"\u53cd\u7f16\u8bd1\u4ee3\u7801\u4e2d\u7684\u5947\u602a\u5199\u6cd5","text":""},{"location":"coding_setup/code_reading/#if-if-if-if-if","title":"if if if if if ... \u66fe\u7ecf\u7684\u6bb5\u5b50\u5982\u4eca\u8ba9\u6211\u78b0\u5230\u4e86","text":"<p>\u6709\u7684\u65f6\u5019\u4f60\u4f1a\u770b\u5230\u7c7b\u4f3c\u5982\u4e0b\u56fe\u6240\u793a\u7684\u5947\u602a\u4ee3\u7801</p> <p>WEG\u8868\u793a: \u5176\u5b9e\u672c\u8d28\u4e0a\u5b83\u5c31\u662f\u4e00\u4e2a<code>switch case</code>, \u56e0\u4e3a<code>switch case</code>\u5bf9\u4e8e\u5927\u5206\u652f\u5b9e\u9645\u4e0a\u4f1a\u5bf9key\u505a\u4e00\u4e2a\u54c8\u5e0c, dnspy\u53cd\u7f16\u8bd1\u4e0d\u592a\u884c \u7528ilspy\u770b</p> <p></p> <p>\u7528ilspy\u6253\u5f00\u540e\u5c31\u53d1\u73b0\u786e\u5b9e\u6b63\u5e38\u4e86, ilspy win!(\u8bdd\u867d\u5982\u6b64, \u6211\u89c9\u5f97dnspy\u7528\u7740\u8fd8\u662f\u86ee\u8212\u670d\u7684)</p> <p></p>"},{"location":"coding_setup/debug/","title":"Debug \u8c03\u8bd5","text":"<p>\u53ea\u8981\u5199\u7a0b\u5e8f\u5c31\u514d\u4e0d\u4e86 bug, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5f3a\u6709\u529b\u7684 debug \u624b\u6bb5</p> <p></p> <p>\u6700\u5e38\u89c1\u7684 debug \u624b\u6bb5\u662f\u901a\u8fc7 <code>Logger.Log()</code>, \u80fd\u89e3\u51b3\u5927\u90e8\u5206\u95ee\u9898, \u4f46\u5f53\u9879\u76ee\u505a\u5927, \u5d4c\u5957\u53d8\u591a, <code>Logger</code> \u8f93\u51fa\u7684\u4fe1\u606f\u5df2\u7ecf\u6ee1\u8db3\u4e0d\u4e86\u6211\u4eec\u7684\u65f6\u5019(\u751a\u81f3\u6211\u4eec\u90fd\u4e0d\u77e5\u9053\u8fd9\u4e2a bug \u54ea\u513f\u6765\u7684), \u6211\u4eec\u4e00\u822c\u5c31\u8981\u4f7f\u7528\u65ad\u70b9\u6765\u8c03\u8bd5, \u6b65\u9aa4\u5982\u4e0b:</p> <ul> <li>\u6253\u5f00\u851a\u84dd</li> <li>\u5728\u4f60\u7684 IDE \u4e0a debug \u9009\u9879\u9644\u8fd1\u9009\u62e9\u9644\u52a0\u5230\u8fdb\u7a0b, \u7136\u540e\u9009\u62e9 <code>Celeste.exe</code>, \u8fd9\u91cc\u4ee5 <code>Visual Studio</code> \u4e3a\u4f8b:</li> </ul> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u65b0\u5efa\u4e00\u4e2a <code>SampleTrigger</code> \u8fdb\u884c\u6f14\u793a:</p> SampleTrigger.cs<pre><code>[CustomEntity(\"MyCelesteMod/SampleTrigger\")]\npublic class SampleTrigger : Trigger\n{\n    private int num;\n\n    public SampleTrigger(EntityData data, Vector2 offset)\n        : base(data, offset)\n    {\n        num = 0;\n    }\n\n    public override void OnStay(Player player)\n    {\n        base.OnStay(player);\n\n        num++;\n        if (num &gt; 60)\n        {\n            Logger.Log(LogLevel.Info, \"MyCelesteMod\", \"Number has passed 60! Now reset to 0.\");\n            num = 0;\n        }\n    }\n}\n</code></pre> <p>\u6211\u4eec\u5728\u65c1\u8fb9\u6253\u4e0a\u7ea2\u7ea2\u7684\u65ad\u70b9:</p> <p></p> <ul> <li>\u7136\u540e\u5f53 Madeline \u78b0\u5230 <code>SampleTrigger</code> \u65f6, \u6e38\u620f\u8fdb\u7a0b\u5c31\u4f1a\u88ab\u9501\u4f4f, \u63a5\u7740\u4f60\u53ef\u4ee5\u901a\u8fc7\u6b65\u8fdb, \u6b65\u5165, \u6b65\u51fa\u7b49\u65b9\u5f0f\u8fdb\u884c\u8c03\u8bd5, \u83b7\u53d6\u60f3\u8981\u7684\u4fe1\u606f \u4f8b\u5982\u83b7\u53d6 <code>num</code> \u7684\u503c:</li> </ul> <p></p> <ul> <li>\u8c03\u8bd5\u5b8c\u6210\u540e, \u4f60\u53ef\u4ee5\u76f4\u63a5\u505c\u6b62\u8c03\u8bd5, \u6216\u8005\u628a\u65ad\u70b9\u70b9\u6389\u7136\u540e\u70b9\u51fb\"\u6062\u590d\u7a0b\u5e8f\u8fd0\u884c\", \u4e4b\u540e\u518d\u6253\u4e0a\u65ad\u70b9\u7ee7\u7eed\u8c03\u8bd5</li> </ul>"},{"location":"coding_setup/preference/","title":"\u504f\u597d","text":"<p>\u5728\u672c\u7cfb\u5217\u6559\u7a0b\u4e2d\u672c\u4eba\u53ef\u80fd\u4f1a\u5076\u5c14\u4e60\u60ef\u6027\u7684\u4f7f\u7528\u4e00\u4e9b\u6bd4\u8f83\u65b0\u7684 C# \u8bed\u6cd5\u6216\u8005\u662f\u7279\u6027, \u901a\u5e38\u8fd9\u662f\u5927\u90e8\u5206 C# \u6559\u7a0b\u4e2d\u5f88\u5c11\u63d0\u53ca\u7684, \u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u56f0\u60d1\u6211\u4f1a\u5728\u8fd9\u91cc\u63d0\u53ca\u4ed6\u4eec.</p> <p>Note</p> <p>\u4e3a\u4e86\u4f7f\u7528\u8fd9\u4e9b\u8bed\u6cd5\u4f60\u53ef\u80fd\u9700\u8981\u5b89\u88c5 <code>.NET 8 SDK</code>, \u5982\u679c\u4f60\u65e0\u6cd5\u7406\u89e3\u67d0\u4e9b\u4e1c\u897f, \u6ca1\u5173\u7cfb, \u4f60\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u540c\u65f6\u63d0\u53ca\u5230\u7684\u7b49\u6548\u65b9\u6cd5</p>"},{"location":"coding_setup/preference/#_2","title":"\u7b80\u5355\u4e86\u89e3\u9879\u76ee\u6587\u4ef6","text":"<p>\u5728\u89e3\u51b3\u65b9\u6848\u8d44\u6e90\u7ba1\u7406\u5668\u4e2d, \u53cc\u51fb\u4f60\u7684\u9879\u76ee, \u6309\u7406\u6765\u8bf4\u4f60\u5e94\u8be5\u4f1a\u6253\u5f00\u8be5\u9879\u76ee\u7684 <code>.csproj</code> \u6587\u4ef6, \u901a\u5e38\u4e5f\u53eb\u505a\u9879\u76ee\u6587\u4ef6, \u5b83\u63cf\u8ff0\u4e86\u8fd9\u4e2a\u9879\u76ee\u7684\u5404\u65b9\u9762\u7684\u4fe1\u606f, \u5e76\u4e14\u4ee5\u4e0b\u51e0\u5c0f\u8282\u7684\u5185\u5bb9\u4e5f\u4f9d\u8d56\u4e8e\u6b64. \u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u4ece\u6a21\u677f\u914d\u7f6e\u7684\u73af\u5883, \u90a3\u4e48\u4f60\u5e94\u8be5\u4f1a\u770b\u5230\u5982\u4e0b\u5185\u5bb9:</p> .csproj<pre><code>&lt;Project Sdk=\"Microsoft.NET.Sdk\"&gt;\n    &lt;Import Project=\"CelesteMod.props\" /&gt;\n    &lt;Import Project=\"Common.props\" /&gt;\n    &lt;PropertyGroup&gt;\n        &lt;RootNamespace&gt;$(AssemblyName)&lt;/RootNamespace&gt;\n        &lt;LangVersion&gt;preview&lt;/LangVersion&gt;\n    &lt;/PropertyGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;Reference Include=\"System\" /&gt;\n        &lt;Reference Include=\"System.Core\" /&gt;\n        &lt;Reference Include=\"System.Xml.Linq\" /&gt;\n        &lt;Reference Include=\"System.Xml\" /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;Import Project=\"CelesteMod.targets\" /&gt;\n&lt;/Project&gt;\n</code></pre> <p>Note</p> <p>\u8fd9\u4e2a\u6587\u4ef6\u662f XML \u683c\u5f0f\u7684, \u5982\u679c\u4f60\u4e0d\u719f\u6089 XML \u7684\u8bdd\u4f60\u53ef\u4ee5\u5230\u8fd9\u91cc\u7b80\u5355\u770b\u4e00\u4e0b, \u514d\u5f97\u4f60\u4e0d\u77e5\u9053\u6211\u4eec\u8ba8\u8bba\u7684\u4e1c\u897f\u90fd\u662f\u4ec0\u4e48</p> <p>\u5176\u4e2d\u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8\u91cc\u9762\u7684 <code>PropertyGroup</code> \u4ee5\u53ca <code>ItemGroup</code> \u8282\u70b9 <code>PropertyGroup</code> \u8282\u70b9\u5b9a\u4e49\u4e86\u8fd9\u4e2a\u9879\u76ee\u6709\u54ea\u4e9b\u5c5e\u6027, \u6bd4\u5982\u9879\u76ee\u6846\u67b6\u7248\u672c, \u8bed\u8a00\u7248\u672c, \u7a0b\u5e8f\u96c6\u6635\u79f0\u7b49 <code>ItemGroup</code> \u5219\u5b9a\u4e49\u4e86\u8fd9\u4e2a\u9879\u76ee\u5305\u542b\u4ec0\u4e48, \u6bd4\u5982\u5f15\u7528\u4e86\u54ea\u4e9b\u7a0b\u5e8f\u96c6\u3001\u54ea\u4e9b nuget \u5305\u7b49.</p>"},{"location":"coding_setup/preference/#implicit-usings-using","title":"Implicit Usings (\u9690\u5f0f Using)","text":"<p>Note</p> <p>\u5bf9\u4e8e\u901a\u8fc7\u6a21\u677f\u6784\u5efa\u7684\u9879\u76ee\u6765\u8bf4\u8fd9\u4e00\u6b65\u5df2\u7ecf\u5b8c\u6210, \u4f60\u53ef\u4ee5\u5c1d\u8bd5\u5c06 <code>Common.props</code> \u4e2d\u7684 <code>CommonCelesteUsings</code> \u66f4\u6539\u4e3a <code>false</code> \u6765\u611f\u53d7\u6ca1\u6709\u542f\u7528\u7684\u6548\u679c</p> <p>\u73b0\u5728\u770b\u770b\u4f60\u7684\u6e90\u6587\u4ef6\u5934\u9876\u662f\u4e0d\u662f\u5145\u6ee1\u4e86\u4e00\u5927\u5806 <code>using xxx</code>? \u90a3\u5c31\u5bf9\u4e86, \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7279\u6027\u6765\u8ba9\u5b83\u770b\u8d77\u6765\u66f4\u7b80\u4ecb\u4e9b. \u90a3\u4e48\u6253\u5f00\u4f60\u7684\u9879\u76ee\u6587\u4ef6, \u5411\u4f60\u7684 <code>ItemGroup</code> \u4e2d\u52a0\u5165\u8fd9\u4e9b:</p> <pre><code>&lt;Using Include=\"System\"/&gt;\n&lt;Using Include=\"System.Collections.Generic\"/&gt;\n&lt;Using Include=\"System.IO\"/&gt;\n&lt;Using Include=\"System.Linq\"/&gt;\n&lt;Using Include=\"System.Threading\"/&gt;\n&lt;Using Include=\"System.Threading.Tasks\"/&gt;\n</code></pre> <p>\u8fd9\u4e2a\u65f6\u5019\u4f60\u5c31\u53ef\u4ee5\u79fb\u9664\u4f60\u7684\u5927\u90e8\u5206 <code>System</code> \u5f00\u5934\u7684 Using \u8bed\u53e5\u5566, \u8fd9\u88ab\u79f0\u4e3a <code>\u9690\u5f0f Using</code>, \u56e0\u4e3a\u6211\u4eec\u662f\u851a\u84dd mod, \u6240\u4ee5\u6211\u4eec\u7ecf\u5e38\u4e5f\u4f1a Using \u4ee5\u4e0b\u51e0\u4e2a\u547d\u540d\u7a7a\u95f4:</p> <ul> <li><code>Celeste.Mod</code>: \u5305\u542b\u5f88\u591a Everest \u76f8\u5173\u4e1c\u897f</li> <li><code>Celeste</code>: \u851a\u84dd\u672c\u4f53\u6240\u5728\u547d\u540d\u7a7a\u95f4</li> <li><code>Monocle</code>: \u851a\u84dd\u81ea\u5df1\u7684\u6e38\u620f\u5f15\u64ce</li> <li><code>Microsoft.Xna.Framework</code>: \u851a\u84dd\u81ea\u5df1\u7684\u6e38\u620f\u5f15\u64ce\u7684\u5e95\u5c42\u6846\u67b6</li> </ul> <p>\u5bf9\u8fd9\u4e9b\u9690\u5f0f Using \u6211\u4eec\u4e5f\u5411 <code>ItemGroup</code> \u52a0\u5165: <pre><code>&lt;Using Include=\"Celeste.Mod\"/&gt;\n&lt;Using Include=\"Celeste\"/&gt;\n&lt;Using Include=\"Monocle\"/&gt;\n&lt;Using Include=\"Microsoft.Xna.Framework\"/&gt;\n</code></pre></p> <p>\u73b0\u5728\u6253\u5f00\u4f60\u7684\u4ee3\u7801\u6587\u4ef6, \u4f60\u53ef\u4ee5\u5c06\u5934\u9876\u4e0a\u7684\u5927\u90e8\u5206 Using \u90fd\u5220\u9664\u4e86, \u8fd9\u6837, \u4f60\u7684\u4ee3\u7801\u6587\u4ef6\u53d8\u7684\u66f4\u52a0\u7684\u5e72\u51c0\u6574\u6d01: MyModModule.cs<pre><code>namespace MyCelesteMod\n{\n    public class MyModModule : EverestModule\n    {\n        public override void Load()\n        {\n\n            Logger.Log(LogLevel.Info, \"MyCelesteMod\", \"Hello World! Hello Everest!\");\n        }\n\n        public override void Unload()\n        {\n\n        }\n    }\n}\n</code></pre></p>"},{"location":"coding_setup/preference/#file-scoped-namespaces","title":"File Scoped Namespaces","text":"<p>\u5bf9\u4e8e namespace \u547d\u540d\u7a7a\u95f4\u6765\u8bf4\u6211\u4eec\u901a\u5e38\u4e00\u4e2a\u6587\u4ef6\u53ea\u6709\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4, \u90a3\u4e48\u6700\u5916\u5c42\u7684 namespace \u7684\u7f29\u8fdb\u5c31\u6709\u4e9b\u6d6a\u8d39\u6a2a\u5411\u7a7a\u95f4, \u6240\u4ee5\u6211\u4eec\u9009\u62e9\u4f7f\u7528 <code>File Scoped Namespaces</code>, \u8fd9\u5f88\u7b80\u5355:</p> <ul> <li>\u5728 <code>namespace MyCelesteMod</code> \u540e\u52a0\u4e0a\u4e00\u4e2a\u5206\u53f7</li> <li>\u5220\u9664 namespace \u7684\u4e24\u4e2a\u5927\u62ec\u53f7</li> <li>\u56de\u9000 namespace \u4e0b\u7684\u6240\u6709\u7f29\u8fdb</li> <li>\u641e\u5b9a\u4e86, \u8d70\u4f60!</li> </ul> MyModModule.cs<pre><code>namespace MyCelesteMod;\n\npublic class MyModModule : EverestModule\n{\n    public override void Load()\n    {\n        Logger.Log(LogLevel.Info, \"MyCelesteMod\", \"Hello World! Hello Everest!\");\n    }\n\n    public override void Unload()\n    {\n\n    }\n}\n</code></pre> <p>Info</p> <p>\u5982\u679c\u4f60\u6536\u5230\u9519\u8bef <code>CS8370</code>, \u90a3\u4f60\u53ef\u80fd\u9700\u8981\u5728 <code>PropertyGroup</code> \u4e0b\u6dfb\u52a0\u8fd9\u4e00\u884c: <pre><code>&lt;LangVersion&gt;preview&lt;/LangVersion&gt;\n</code></pre></p>"},{"location":"coding_setup/preference/#_3","title":"\u65b9\u6cd5? \u51fd\u6570?","text":"<p>\u55ef\u8fd9\u4e2a\u662f\u540e\u6765\u52a0\u7684, \u56e0\u4e3a\u6211\u53d1\u73b0\u6211\u5728\u6574\u4e2a\u6587\u6863\u91cc\u90fd\u5728\u6df7\u7528 \"\u65b9\u6cd5\" \u548c \"\u51fd\u6570\" \u8fd9\u4e24\u4e2a\u540d\u5b57, \u4f46\u662f\u4fee\u6539\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\u6240\u4ee5\u6211\u8fd8\u662f\u9009\u62e9\u5728\u8fd9\u91cc\u8bf4\u51e0\u53e5: \"\u51fd\u6570\" \u662f\u6e90\u81ea\u53e4\u65e9\u7684\u9762\u5411\u8fc7\u7a0b\u8bed\u8a00\u7684\u6982\u5ff5, \u540e\u6765\u968f\u7740 OOP(Object Oriented Programming) \u9762\u5411\u5bf9\u8c61\u601d\u60f3\u7684\u6d41\u884c, \u51fd\u6570\u9010\u6e10\u88ab\u5c01\u88c5\u5230\u7c7b\u91cc, \u800c\u7c7b\u91cc\u7684\u8fd9\u4e9b\u51fd\u6570\u5728\u4e60\u60ef\u4e0a\u6211\u4eec\u624d\u4f1a\u79f0\u4e4b\u4e3a \"\u65b9\u6cd5\", \u4f46\u662f\u4e5f\u6709\u4eba\u4ecd\u7136\u5c06\u8fd9\u4e9b\u4e1c\u897f\u79f0\u4e4b\u4e3a \"\u51fd\u6570\", \u6240\u4ee5\u5b9e\u9645\u4e0a\u5728\u9762\u5411\u5bf9\u8c61\u7684\u8bed\u8a00\u91cc\u4f60\u53ef\u4ee5\u5c06 \"\u65b9\u6cd5\" \u548c \"\u51fd\u6570\" \u770b\u4e3a\u4e00\u4e2a\u4e1c\u897f, \u6216\u8005\u4ec5\u5728\u672c\u6587\u6863\u4e2d\u8fd9\u4e48\u770b.</p>"},{"location":"components/alarm_tween_coroutine/","title":"Alarm, Tween, Coroutine","text":""},{"location":"components/alarm_tween_coroutine/#tween","title":"Tween","text":"<p>Tween \u662f\u4e00\u4e2a\u5728 Monocle \u4e2d\u7528\u6765\u5b9e\u73b0\u7f13\u52a8\u7684 <code>Component</code>, \u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u8fdb\u884c\u6240\u6709 easings.net \u4e0a\u7684\u7f13\u52a8, \u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u5f88\u7b80\u5355: \u4f7f\u7528 Tween<pre><code>// \u9996\u5148\u4f7f\u7528\u9759\u6001\u65b9\u6cd5 Tween.Create \u6765\u521b\u5efa\nTween tw = Tween.Create(Tween.TweenMode.Oneshot, Ease.BackIn, 1f, false);\n</code></pre></p> <p>\u8fd9\u91cc\u53c2\u6570\u53ef\u80fd\u76f8\u5bf9\u8f83\u591a:</p> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570 <code>mode</code>: \u5b83\u8868\u793a\u7f13\u52a8\u7684\u7c7b\u578b, \u53ef\u7528\u7684\u6709:<ul> <li><code>Persist</code>: \u7f13\u52a8\u7ed3\u675f\u540e\u8be5\u7ec4\u4ef6\u4f1a\u5931\u6d3b, \u76f4\u5230\u518d\u6b21\u88ab\u8c03\u7528 <code>Start</code></li> <li><code>Oneshot</code>: \u7f13\u52a8\u7ed3\u675f\u540e\u8be5\u7ec4\u4ef6\u4f1a\u79fb\u9664\u81ea\u8eab</li> <li><code>Looping</code>: \u7f13\u52a8\u7ed3\u675f\u4e00\u6b21\u540e\u4f1a\u7acb\u523b\u518d\u6b21\u5f00\u59cb\u540c\u4e00\u4e2a\u7f13\u52a8, \u5e76\u5faa\u73af</li> <li><code>YoyoOneshot</code>: \u7f13\u52a8\u7ed3\u675f\u540e\u4f1a\u7acb\u523b\u8fdb\u884c\u4e00\u6b21\u53cd\u5411\u7684\u7f13\u52a8, \u7ed3\u675f\u540e\u79fb\u9664\u81ea\u8eab</li> <li><code>YoyoLooping</code>: \u540c <code>YoyoOneshot</code>, \u4f46\u662f\u4f1a\u5faa\u73af\u800c\u4e0d\u662f\u79fb\u9664\u81ea\u8eab</li> </ul> </li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>easer</code>: \u5b83\u8868\u793a\u8be5\u7f13\u52a8\u7684 <code>Easer</code>, \u901a\u5e38\u6211\u4eec\u4f7f\u7528 <code>Ease</code> \u7c7b\u4e2d\u7684\u5df2\u6709\u9759\u6001\u5b57\u6bb5\u4e2d\u63d0\u4f9b\u7684\u5c31\u884c\u4e86,  \u540c\u6837\u5730\u4f60\u53ef\u4ee5\u5728 easings.net \u611f\u53d7\u5e76\u68c0\u7d22\u4f60\u6240\u9700\u8981\u7684\u7f13\u52a8\u7c7b\u578b.</li> <li>\u7b2c\u4e09\u4e2a\u53c2\u6570 <code>duration</code>: \u8868\u793a\u8be5\u7f13\u52a8\u8fdb\u884c\u7684\u65f6\u95f4(\u5355\u4f4d\u79d2), \u5bf9\u4e8e\u7279\u6b8a\u7684\u7f13\u52a8\u7c7b\u578b\u6765\u8bf4\u5b83\u6307\u4e00\u6b21\u6b63\u5411\u7f13\u52a8\u6216\u8005\u4e00\u6b21\u53cd\u5411\u7f13\u52a8\u6240\u9700\u65f6\u95f4.</li> <li>\u7b2c\u56db\u4e2a\u53c2\u6570 <code>start</code>: \u662f\u5426\u7acb\u5373\u5f00\u59cb\u8fd9\u4e2a <code>Tween</code>, \u5426\u5219\u6211\u4eec\u5f97\u9700\u8981\u624b\u52a8\u8c03\u7528 <code>Start</code> \u65b9\u6cd5</li> </ul> <p>\u5728\u521b\u5efa\u5b8c\u6211\u4eec\u7684 <code>tw</code> \u5b9e\u4f8b\u540e, \u6211\u4eec\u5148\u5236\u70b9\u5c0f\u76ee\u6807:</p> <ul> <li>\u5728\u7f13\u52a8\u5f00\u59cb\u65f6\u8f93\u51fa \"Tween start!\"</li> <li>\u5728\u7f13\u52a8\u8fc7\u7a0b\u65f6\u8f93\u51fa \"Tweening... Eased: &lt;\u6b64\u65f6\u7684\u7f13\u52a8\u503c&gt;, Percent: &lt;\u7f13\u52a8\u5df2\u8fdb\u884c\u7684\u65f6\u95f4\u5360\u6bd4&gt;\"</li> <li>\u5728\u7f13\u52a8\u7ed3\u675f\u540e\u8f93\u51fa \"Tween complete!\"</li> </ul> <p>\u5bf9\u4e8e\u5f00\u59cb\u548c\u7ed3\u675f\u5f88\u7b80\u5355, \u6211\u4eec\u53ea\u9700\u8981\u8d4b\u503c\u4e00\u4e9b\u5b57\u6bb5:</p> \u8d4b\u503c Tween \u7684\u4e00\u4e9b\u5b57\u6bb5<pre><code>tw.OnStart = t =&gt; Logger.Log(LogLevel.Info, \"test\", \"Tween start!\");\ntw.OnComplete = t =&gt; Logger.Log(LogLevel.Info, \"test\", \"Tween complete!\");\n</code></pre> <p>\u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 lambda \u8868\u8fbe\u5f0f\u4e3a\u5176\u8d4b\u503c, \u5176\u4e2d\u8be5 lambda \u88ab\u4f20\u5165\u7684\u53c2\u6570\u5c31\u662f\u8fd9\u4e2a <code>Tween</code> \u5b9e\u4f8b, \u8fd9\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u907f\u514d lambda \u6355\u83b7\u4ee5\u53ca\u590d\u7528\u6211\u4eec\u7684 <code>Tween</code> \u5904\u7406\u51fd\u6570.</p> <p>\u5bf9\u4e8e\u7f13\u52a8\u8fc7\u7a0b, \u6211\u4eec\u9996\u5148\u4ecb\u7ecd\u4e24\u4e2a\u5c5e\u6027:</p> <ul> <li><code>Eased</code>: \u8868\u793a\u8be5\u7f13\u52a8\u5f53\u524d\u7684 \"\u7f13\u52a8\u503c\"</li> <li><code>Percent</code>: \u8868\u793a\u8be5\u7f13\u52a8\u5df2\u8fdb\u884c\u65f6\u95f4\u5360\u6bd4, \u5373 \u5df2\u8fdb\u884c\u65f6\u95f4/\u603b\u65f6\u95f4</li> </ul> <p>\u4e00\u4e2a\u66f4\u6e05\u695a\u7684\u4f8b\u5b50\u662f\u89c2\u5bdf easings.net \u7684\u56fe\u50cf, <code>Eased</code> \u5373\u7eb5\u5750\u6807\u503c, <code>Percent</code> \u5373\u6a2a\u5750\u6807\u503c.</p> <p>\u90a3\u4e48\u8fd9\u91cc\u5c31\u5f88\u7b80\u5355\u5b9e\u73b0\u4e86: <pre><code>tw.OnUpdate = t =&gt; Logger.Log(LogLevel.Info, \"test\", $\"Tweening... Eased: {t.Eased}, Percent: {t.Percent}\");\n</code></pre></p> <p>\u6700\u540e\u8bb0\u5f97 <code>Start</code> \u5b83\u5e76\u4e14\u8bb0\u5f97\u628a\u5b83\u6302\u8f7d\u5230\u5b9e\u4f53\u4e0a, \u56e0\u4e3a\u5b83\u7684\u66f4\u65b0\u662f\u4f9d\u8d56\u5b9e\u4f53\u7684:</p> \u5f00\u59cb\u5e76\u6302\u8f7d<pre><code>// \u5982\u679c\u4f60\u5bf9 `start` \u53c2\u6570\u4f20\u5165 `true` \u90a3\u4e48\u4f60\u53ef\u4ee5\u4e0d\u7528\u505a\u8fd9\u4e00\u6b65\ntw.Start();\n// \u8fd9\u91cc\u5047\u8bbe\u6211\u4eec\u7684\u6240\u6709\u4ee3\u7801\u90fd\u8fdb\u884c\u5728\u4e00\u4e2a\u5b9e\u4f53\u5185\u90e8\nthis.Add(tw);\n</code></pre> <p>\u6216\u8005, \u6211\u4eec\u4f7f\u7528 <code>Tween.Set</code> \u65b9\u6cd5, \u5b83\u662f\u4e00\u4e2a\u5de5\u5177\u65b9\u6cd5\u5141\u8bb8\u6211\u4eec\u7b80\u5316\u5bf9 Tween \u7684\u4f7f\u7528, \u4e0a\u9762\u7684\u4f8b\u5b50\u7528\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5199\u6210\u8fd9\u6837: <pre><code>Tween tw = Tween.Set(this, Tween.TweenMode.Oneshot, 1f, Ease.BackIn,\n    t =&gt; Logger.Log(LogLevel.Info, \"test\", $\"Tweening... Eased: {t.Eased}, Percent: {t.Percent}\"),\n    t =&gt; Logger.Log(LogLevel.Info, \"test\", \"Tween complete!\"));\n// OnStart \u8fd8\u5f97\u624b\u52a8\u8bbe\u7f6e\u5450\ntw.OnStart = t =&gt; Logger.Log(LogLevel.Info, \"test\", \"Tween start!\");\ntw.Start();\n</code></pre></p> <p>\u5b83\u4f1a\u81ea\u52a8\u5e2e\u6211\u4eec\u6302\u8f7d\u5230\u5b9e\u4f53\u4e0a, \u4e0d\u8fc7\u4f9d\u7136\u9700\u8981\u6211\u4eec\u624b\u52a8 <code>Start</code>, \u8fd9\u91cc\u65b9\u4fbf\u4e4b\u5904\u5c31\u5728\u4e8e\u4f60\u53ef\u4ee5\u76f4\u63a5\u628a\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u76f4\u63a5\u5728\u53c2\u6570\u4e2d\u4f20\u5165, \u800c\u4e0d\u662f <code>Create</code> \u540e\u518d\u8bbe\u7f6e\u5b57\u6bb5. \u4e0d\u8fc7\u8fd9\u91cc\u53c2\u6570\u5217\u8868\u4e2d\u5e76\u6ca1\u6709 <code>Start</code> \u76f8\u5173\u7684\u53c2\u6570, \u5982\u679c\u4f60\u8fd8\u9700\u8981\u8bbe\u7f6e <code>Start</code> \u7684\u56de\u8c03\u7684\u8bdd\u4f60\u53ef\u4ee5\u56de\u9000\u5230\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u7684\u65b9\u6cd5, \u5c31\u50cf\u4e0a\u9762\u7684\u4ee3\u7801\u4e00\u6837\u624b\u52a8\u8bbe\u7f6e <code>OnStart</code>.</p>"},{"location":"components/alarm_tween_coroutine/#alarm","title":"Alarm","text":"<p>\u987e\u540d\u601d\u4e49, \u5b83\u5c31\u662f\u4e2a'\u95f9\u949f', \u5b83\u5141\u8bb8\u4f60\u8bbe\u5b9a\u4e00\u4e2a\u65f6\u95f4\u5e76\u5728\u65f6\u95f4\u7ed3\u675f\u540e\u505a\u4e00\u4e9b\u4e8b\u60c5, \u5176\u4f7f\u7528\u8d77\u6765\u5f88\u7b80\u5355: <pre><code>Alarm alarm = Alarm.Create(Alarm.AlarmMode.Oneshot, OnAlarm, 2f, false);\nAdd(alarm);\nalarm.Start();\n\nstatic void OnAlarm()\n{\n    Logger.Log(LogLevel.Info, \"Test\", \"123\");\n}\n</code></pre></p> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570 <code>AlarmMode</code> \u4e0e <code>Tween.TweenMode</code> \u7684\u57fa\u672c\u4e00\u81f4, \u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86</li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u65f6\u95f4\u5230\u540e\u7684\u56de\u8c03\u51fd\u6570</li> <li>\u7b2c\u4e09\u4e2a\u53c2\u6570\u8868\u793a\u65f6\u95f4\u6709\u591a\u957f</li> <li>\u7b2c\u56db\u4e2a\u53c2\u6570\u4e5f\u4e0e tween \u7c7b\u4f3c, \u8868\u793a\u662f\u5426\u5e0c\u671b\u81ea\u52a8\u8c03\u7528 <code>Start</code> \u65b9\u6cd5</li> </ul> <p>\u9664\u4e86\u5728\u7b2c\u4e09\u4e2a\u53c2\u6570\u5904\u8bbe\u7f6e\u65f6\u95f4\u957f\u5ea6\u5916, <code>Start</code> \u65b9\u6cd5\u4e5f\u5141\u8bb8\u6211\u4eec\u4f20\u5165\u4e00\u4e2a\u65f6\u95f4\u957f\u5ea6, \u8fd9\u4f1a\u5728\u4f60\u9700\u8981\u4e00\u4e2a\u4e0d\u5b9a\u957f\u7684\u95f9\u949f\u7684\u65f6\u5019\u5f88\u6709\u7528. \u9664\u6b64\u4e4b\u5916, <code>Alarm</code> \u4e5f\u6709\u7c7b\u4f3c\u4e8e <code>Tween.Set</code> \u7684\u65b9\u6cd5\u76f4\u63a5\u4f5c\u7528\u4e0e <code>Entity</code> \u4e0a, \u53c2\u6570\u4e5f\u4e0e\u5176\u6784\u9020\u51fd\u6570\u76f8\u540c: <pre><code>// \u4e0d\u8fc7\u8fd9\u91cc AlarmMode \u53cd\u800c\u88ab matt \u653e\u5230\u6700\u540e\u53bb\u4e86\nAlarm.Set(this, 2f, OnAlarm, Alarm.AlarmMode.Oneshot).Start();\n</code></pre></p>"},{"location":"components/alarm_tween_coroutine/#coroutine","title":"Coroutine","text":"<p><code>Coroutine</code> \u5e38\u89c1\u7684\u4e2d\u6587\u7ffb\u8bd1\u53eb\u505a '\u534f\u7a0b', \u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u5f3a\u5927\u7684\u4e1c\u897f, \u4f46\u5728\u7406\u89e3\u5b83\u4e4b\u524d\u9700\u8981\u77e5\u9053\u4ee5\u4e0b\u51e0\u4e2a\u6982\u5ff5:</p>"},{"location":"components/alarm_tween_coroutine/#_1","title":"\u4e32\u884c","text":"<p>\u4e00\u4e2a\u4e2a\u4efb\u52a1\u5148\u540e\u6267\u884c, \u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u518d\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1 </p>"},{"location":"components/alarm_tween_coroutine/#_2","title":"\u5e76\u884c","text":"<p>\u591a\u4e2a\u4efb\u52a1\u4e00\u8d77\u6267\u884c</p>"},{"location":"components/alarm_tween_coroutine/#_3","title":"\u5e76\u53d1","text":"<p>\u4e00\u4e2a\u4e2a\u4efb\u52a1\u5148\u540e\u6267\u884c, \u4f46\u662f\u6bcf\u4e2a\u4efb\u52a1\u53ea\u7ed9\u5f88\u77ed\u7684\u65f6\u95f4\u6267\u884c(\u6bd4\u5982<code>0.0001f</code>), \u65f6\u95f4\u82b1\u5b8c\u4e86\u5c31\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1, \u5f53\u6700\u540e\u4e00\u4e2a\u4efb\u52a1\u65f6\u95f4\u82b1\u5b8c\u5219\u518d\u6b21\u4ece\u5934\u5f00\u59cb\u6267\u884c, \u4ece\u5b8f\u89c2\u4e0a\u770b, \u5b83\u505a\u5230\u4e86\u5e76\u884c, \u4ece\u5fae\u89c2\u4e0a\u770b, \u5b83\u662f\u4e32\u884c\u7684</p> <p>\u800c\u534f\u7a0b\u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u6709\u5e76\u53d1\u6027\u8d28\u7684\u7c7b, \u5b83\u5229\u7528\u4e86\u8fed\u4ee3\u5668\u8d70\u8d70\u505c\u505c\u7684\u7279\u6027, \u4f7f\u5b83\u5f97\u4ee5\u5728\u987a\u5e8f\u6267\u884c\u7684EC\u67b6\u6784\u4e0b, \u64cd\u63a7\u65f6\u95f4</p> <p>\u5177\u4f53\u8868\u73b0\u5c31\u662f\u5f53\u4f60<code>yield return (\u6570\u5b57)</code>\u7684\u65f6\u5019, \u5b83\u771f\u7684\u4f1a\u76f4\u63a5\u505c\u4f4f, \u7136\u540e\u5728<code>(\u6570\u5b57)\u79d2\u540e</code>\u7ee7\u7eed\u6267\u884c, \u505c\u4f4f\u671f\u95f4\u4e0d\u5f71\u54cd/\u963b\u585e\u5176\u4ed6\u5b9e\u4f53\u7684\u66f4\u65b0\u4e0e\u7ed8\u5236(\u5f53\u7136\u7531\u4e8eCoroutine\u518d\u600e\u4e48\u5389\u5bb3\u5b83\u4e5f\u8fd8\u662f\u4e00\u4e2aComponent, \u8fed\u4ee3\u5668\u8fd8\u662f\u7531\u7ebf\u6027\u7684<code>Update()</code>\u63a7\u5236\u7684, \u800c\u4e14\u7531\u4e8e\u851a\u84dd\u662f\u4e2a60\u5e27\u7684\u6e38\u620f, \u6240\u4ee5\u63a8\u8350yield\u7b49\u5f85\u7684\u65f6\u95f4\u4e5f\u662f<code>1/60f</code>\u7684\u500d\u6570)</p> <p>\u4e0b\u9762\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50, \u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u534f\u7a0b, \u5e76\u7ed9\u5b83\u4f20\u4e86\u4e00\u4e2a\u8fed\u4ee3\u5668, \u5b83\u4f1a<code>\u6253\u5370\u5e76\u7b491s ... \u6253\u5370\u5e76\u7b492s ... \u6253\u5370\u5e76\u9000\u51fa\u8fed\u4ee3\u5668(\u5f80\u5f80\u4e5f\u610f\u5473\u7740\u9000\u51fa\u534f\u7a0b)</code>:</p> <pre><code>var coroutine = new Coroutine(MakeRoutine());\nAdd(coroutine);\n\nstatic IEnumerator MakeRoutine()\n{\n    Logger.Log(LogLevel.Info, \"tag\", \"\u5f00\u59cb!\");\n    yield return 1f;\n    Logger.Log(LogLevel.Info, \"tag\", \"\u8fc7\u4e861s!\");\n    yield return 2f;\n    Logger.Log(LogLevel.Info, \"tag\", \"\u53c8\u8fc7\u4e862s!\");\n    yield break;\n}\n</code></pre> <p>Info</p> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684 <code>yield return</code> \u7b49\u8bed\u6cd5\u5c5e\u4e8e \"\u8fed\u4ee3\u5668\u51fd\u6570\", \u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u5b83\u7684\u8bdd\u4f60\u53ef\u4ee5\u5230 msdn \u4e0a\u6216\u8005 bing \u641c\u7d22 \u4e0a\u67e5\u627e\u5b83.</p> <p>\u4f60\u53ef\u80fd\u89c9\u5f97\u8fd9\u4e0d\u5c31\u662f\u4e2a\u9ad8\u7ea7\u70b9\u7684 <code>Alarm</code> \u5417, \u786e\u5b9e, \u4f60\u4ecd\u7136\u53ef\u4ee5\u7528 <code>Alarm</code> \u6765\u91cd\u5199\u8fd9\u90e8\u5206\u529f\u80fd, \u4e0d\u8fc7\u5f88\u5feb\u4f60\u5c31\u4f1a\u9677\u5165\u56de\u8c03\u5730\u72f1\u5e76\u4e14\u4ee3\u7801\u4e5f\u53d8\u7684\u5341\u5206\u96be\u8bfb: <pre><code>Logger.Log(LogLevel.Info, \"tag\", \"\u5f00\u59cb!\");\nAlarm.Set(this, 1f, () =&gt;\n{\n    Logger.Log(LogLevel.Info, \"tag\", \"\u8fc7\u4e861s!\");\n    Alarm.Set(this, 2f, () =&gt;\n    {\n        Logger.Log(LogLevel.Info, \"tag\", \"\u53c8\u8fc7\u4e862s!\");\n\n    }, Alarm.AlarmMode.Oneshot);\n\n}, Alarm.AlarmMode.Oneshot);\n</code></pre></p> <p>\u9664\u4e86\u8fd4\u56de\u4e00\u4e9b\u6d6e\u70b9\u6570, \u6211\u4eec\u8fd8\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a <code>null</code>, \u8fd9\u6837\u4f1a\u8ba9\u6e38\u620f\u4ec5\u7b49\u5f85\u4e00\u5e27, \u4e5f\u5c31\u662f\u5728\u8fd9\u6b21\u8fd4\u56de\u540e, \u6e38\u620f\u5728\u4e0b\u4e00\u5e27\u7acb\u523b\u7ee7\u7eed\u6267\u884c\u800c\u4e0d\u662f\u7b49\u5f85\u79d2\u6570. \u6bd4\u5982\u5728\u5b98\u56fe\u4e2d <code>FallingBlock</code> \u5bf9\u5176\u7684\u4e00\u4e2a\u5e94\u7528(\u5df2\u7b80\u5316, \u5220\u9664\u4e86 BadelineBoss \u76f8\u5173\u7684\u4ee3\u7801): Celeste.FallingBlock.Sequence()<pre><code>// \u6301\u7eed\u68c0\u6d4b\u662f\u5426\u73a9\u5bb6\u5728\u4e0a\u9762\u6293/\u7ad9\u7740\nwhile (!PlayerFallCheck())\n    yield return null;\n// \u73a9\u5bb6\u6293/\u7ad9\u7740, \u8fdb\u5165\u6389\u843d\u72b6\u6001\nHasStartedFalling = true;\nwhile (true)\n{\n    // \u5728\u771f\u6b63\u8fdb\u884c\u5411\u4e0b\u79fb\u52a8\u65f6\u5148\u7b49\u5f85 0.2s \n    yield return 0.2f;\n\n    // \u7136\u540e\u7b49\u5f85 0.4s, \u4f46\u662f\u73a9\u5bb6\u79bb\u5f00\u6389\u843d\u5757\u540e\u4f1a\u53d6\u6d88\u8fd9\u4e2a\u7b49\u5f85\n    float waitTimer = 0.4f;\n    while (waitTimer &gt; 0f &amp;&amp; PlayerWaitCheck())\n    {\n        yield return null;\n        waitTimer -= Engine.DeltaTime;\n    }\n\n    // ......, \u6267\u884c\u6301\u7eed\u6389\u843d\u7684\u903b\u8f91, \u76f4\u5230\u78b0\u5230\u4e86\u5e73\u53f0(\u6cdb\u6307\u6240\u6709\u4e0a\u9762\u80fd\u7ad9\u7684\u4e1c\u897f, \u975e\u6307\u6728\u5e73\u53f0, \u4e0b\u540c)\u7136\u540e\u505c\u4e0b\n\n    // \u6bcf\u9694 0.1s \u68c0\u6d4b\u662f\u5426\u5e95\u4e0b\u4f9d\u7136\u8fd8\u5b58\u5728\u5e73\u53f0, \u5426\u5219\u8fdb\u5165\u4e0b\u4e00\u6b21 while \u5faa\u73af\n    while (CollideCheck&lt;Platform&gt;(Position + new Vector2(0f, 1f)))\n        yield return 0.1f;\n}\n......\n</code></pre> \u73b0\u5728\u56de\u5fc6\u4e00\u4e0b\u5b98\u56fe\u7684\u6389\u843d\u5757\u7684\u903b\u8f91, \u662f\u4e0d\u662f\u548c\u4e0a\u9762\u4ee3\u7801\u63cf\u8ff0\u7684\u4e00\u81f4? \u5982\u679c\u6ca1\u6709\u4e86\u534f\u7a0b, \u6211\u4eec\u5c31\u5f97\u7528\u4e00\u4e2a\u72b6\u6001\u53d8\u91cf\u6765\u50a8\u5b58\u6389\u843d\u5757\u8fdb\u884c\u5230\u54ea\u4e00\u6b65, \u5e76\u4e14\u65f6\u65f6\u523b\u523b\u7ef4\u62a4\u8fd9\u4e2a\u53d8\u91cf, \u65e5\u76ca\u53d8\u7684\u8d8a\u6765\u8d8a\u9ebb\u70e6.</p> <p>\u534f\u7a0b(\u8fed\u4ee3\u5668)\u8fd8\u80fd\u8fd4\u56de\u53e6\u4e00\u4e2a\u534f\u7a0b(\u8fed\u4ee3\u5668), \u53ea\u9700\u8981\u8fd4\u56de\u4e00\u4e2a <code>IEnumerator</code>: <pre><code>var coroutine = new Coroutine(MakeRoutine());\nAdd(coroutine);\n\nstatic IEnumerator MakeRoutine()\n{\n    Logger.Log(LogLevel.Info, \"tag\", \"\u5f00\u59cb!\");\n    yield return 1f;\n    Logger.Log(LogLevel.Info, \"tag\", \"\u8fc7\u4e861s!\");\n    yield return MakeRoutineInner();\n    Logger.Log(LogLevel.Info, \"tag\", \"\u5185\u90e8\u7684\u534f\u7a0b\u7ed3\u675f\u4e86!\");\n    yield return MakeRoutineInner();\n    Logger.Log(LogLevel.Info, \"tag\", \"\u5185\u90e8\u7684\u534f\u7a0b\u53c8\u4e00\u6b21\u7ed3\u675f\u4e86!\");\n    yield break;\n}\n\nstatic IEnumerator MakeRoutineInner()\n{\n    yield return 1f;\n    Logger.Log(LogLevel.Info, \"tag\", \"\u5185\u90e8\u7b49\u4e861s!\");\n    yield return 1f;\n    Logger.Log(LogLevel.Info, \"tag\", \"\u5185\u90e8\u53c8\u7b49\u4e861s!\");\n    yield break;\n}\n</code></pre> \u5b83\u7684\u8f93\u51fa\u4f1a\u50cf\u662f: <pre><code>(09/30/2023 13:39:28) [Everest] [Info] [tag] \u5f00\u59cb!\n(09/30/2023 13:39:29) [Everest] [Info] [tag] \u8fc7\u4e861s!\n(09/30/2023 13:39:30) [Everest] [Info] [tag] \u5185\u90e8\u7b49\u4e861s!\n(09/30/2023 13:39:31) [Everest] [Info] [tag] \u5185\u90e8\u53c8\u7b49\u4e861s!\n(09/30/2023 13:39:31) [Everest] [Info] [tag] \u5185\u90e8\u7684\u534f\u7a0b\u7ed3\u675f\u4e86!\n(09/30/2023 13:39:32) [Everest] [Info] [tag] \u5185\u90e8\u7b49\u4e861s!\n(09/30/2023 13:39:33) [Everest] [Info] [tag] \u5185\u90e8\u53c8\u7b49\u4e861s!\n(09/30/2023 13:39:33) [Everest] [Info] [tag] \u5185\u90e8\u7684\u534f\u7a0b\u53c8\u4e00\u6b21\u7ed3\u675f\u4e86!\n</code></pre></p> <p>\u4f7f\u7528\u534f\u7a0b, \u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5c31\u50cf\u81ea\u7136\u63cf\u8ff0\u4e00\u4e2a\u8fc7\u7a0b\u4e00\u6837 \"\u81ea\u7136\" \u5730\u5199\u5b9e\u73b0\u7684\u4ee3\u7801, \u5b98\u56fe\u4e2d\u5267\u60c5\u7684\u5b9e\u73b0\u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50(\u6b64\u5904\u4e3a\u5e8f\u7ae0\u9e1f\u6559\u51b2\u523a\u7684\u5267\u60c5, \u5df2\u5927\u91cf\u7b80\u5316): Celeste.CS00_Ending<pre><code>private IEnumerator Cutscene(Level level)\n{\n    // \u6162\u6162\u51cf\u6162\u6e38\u620f\u901f\u5ea6\u76f4\u5230 0.0x, \u5e76\u4e14\u5728\u51cf\u6162\u5230 0.5x \u65f6\u505c\u6b62\u6865\u5d29\u584c\u97f3\u4e50\n    while (Engine.TimeRate &gt; 0f)\n    {\n        yield return null;\n        if (Engine.TimeRate &lt; 0.5f &amp;&amp; bridge != null)\n            bridge.StopCollapseLoop();\n        level.StopShake();\n        Engine.TimeRate -= Engine.RawDeltaTime * 2f;\n    }\n    // \u6b64\u65f6\u6e38\u620f\u901f\u5ea6\u4f1a\u88ab\u8bef\u51cf\u5230\u8d1f\u6570, \u8bbe\u7f6e\u56de 0 \u9632\u6b62\u6e38\u620f\u884c\u4e3a\u5f02\u5e38\n    Engine.TimeRate = 0f;\n    // \u5207\u6362\u73a9\u5bb6\u72b6\u6001\u5230 StDummy, \u5373\u7981\u6b62\u6240\u6709\u8f93\u5165\u548c\u4ea4\u4e92\n    player.StateMachine.State = Player.StDummy;\n    // \u9501\u5b9a\u73a9\u5bb6\u671d\u5411\u4e3a\u53f3\n    player.Facing = Facings.Right;\n    // \u65e0\u89c6\u6e38\u620f\u901f\u5ea6\u5730\u7b49\u5f85 1s, \u9ed8\u8ba4\u8fd4\u56de\u6d6e\u70b9\u6570\u7684\u7b49\u5f85\u4f1a\u53d7\u6e38\u620f\u901f\u5ea6\u5f71\u54cd,\n    // \u8fd9\u91cc\u5982\u679c\u7528\u8fd4\u56de\u6d6e\u70b9\u6570\u7684\u7b49\u5f85\u4f1a\u9020\u6210\u534f\u7a0b\u505c\u6b62, \u56e0\u4e3a\u6e38\u620f\u901f\u5ea6\u4e3a 0x, \u5373\u7b49\u5f85\u6c38\u8fdc\u4e0d\u4f1a\u7ed3\u675f\n    yield return WaitFor(1f);\n    // \u64ad\u653e\u9e1f\u98de\u5165\u7684\u58f0\u97f3\n    Audio.Play(\"event:/game/general/bird_in\", bird.Position);\n    // \u8bbe\u7f6e\u9e1f\u7684\u671d\u5411\u548c\u52a8\u753b\n    bird.Facing = Facings.Left;\n    bird.Sprite.Play(\"fall\", false, false);\n    // \u7f13\u52a8\u9e1f\u7684\u4f4d\u7f6e, \u5e76\u5728\u9e1f\u98de\u5230\u4e00\u534a\u65f6\u64ad\u653e\u98de\u884c\u7684\u52a8\u753b\n    float percent = 0f;\n    Vector2 from = bird.Position;\n    Vector2 to = bird.StartPosition;\n    while (percent &lt; 1f)\n    {\n        bird.Position = from + (to - from) * Ease.QuadOut(percent);\n        if (percent &gt; 0.5f)\n            bird.Sprite.Play(\"fly\", false, false);\n        percent += Engine.RawDeltaTime * 0.5f;\n        yield return null;\n    }\n    bird.Position = to;\n    from = default(Vector2);\n    to = default(Vector2);\n    // \u64ad\u653e\u9e1f\u78b0\u5730\u7684\u97f3\u6548\n    Audio.Play(\"event:/game/general/bird_land_dirt\", bird.Position);\n    // \u5411\u5de6\u91ca\u653e\u5c18\u57c3\u7c92\u5b50\u6548\u679c\n    Dust.Burst(bird.Position, - MathHelper.PI / 2, 12);\n    // \u64ad\u653e\u95f2\u7f6e\u52a8\u753b, \u7136\u540e\u7b49\u5f85 0.5s \u540e\u518d\u6b21\u64ad\u653e\u5544\u5730\u7684\u52a8\u753b\n    bird.Sprite.Play(\"idle\", false, false);\n    yield return WaitFor(0.5f);\n    bird.Sprite.Play(\"peck\", false, false);\n    // \u7b49\u5f85 1.1s, \u4e5f\u5c31\u662f\u5dee\u4e0d\u591a\u5544\u5730\u52a8\u753b\u7684\u957f\u5ea6\n    yield return WaitFor(1.1f);\n    // \u64ad\u653e\u51b2\u523a\u6559\u5b66\n    yield return bird.ShowTutorial(new BirdTutorialGui(\n        bird, new Vector2(0f, -16f), Dialog.Clean(\"tutorial_dash\", null), \n        new Vector2(1f, -1f), \"+\", BirdTutorialGui.ButtonPrompt.Dash\n        ), caw: true);\n\n    // \u6301\u7eed\u7b49\u5f85, \u76f4\u5230\u73a9\u5bb6\u6309\u4e0b\u4e86\u53f3\u4e0a\u51b2\n    for (;;)\n    {\n        Vector2 aimVector = Input.GetAimVector(Facings.Right);\n        if (aimVector.X &gt; 0f &amp;&amp; aimVector.Y &lt; 0f &amp;&amp; Input.Dash.Pressed)\n            break;\n        yield return null;\n    }\n    // \u8bbe\u7f6e\u73a9\u5bb6\u7684\u72b6\u6001\u4e3a \"\u9e1f\u51b2\u523a\u6559\u7a0b\" \u72b6\u6001, \u8fd9\u4e2a\u72b6\u6001\u5373\u51b2\u523a\u5f00\u59cb\u5230\u4e0a\u5cb8\u5e76\u5f3a\u5236\u79fb\u52a8\u5230\u53f3\u4fa7\u7684\u72b6\u6001\n    player.StateMachine.State = Player.StBirdDashTutorial;\n    player.Dashes = 0;\n    level.Session.Inventory.Dashes = 1;\n    // \u6062\u590d\u6e38\u620f\u901f\u7387\n    Engine.TimeRate = 1f;\n    // \u6536\u56de\u9e1f\u7684\u6559\u7a0b\u6846\u6846\n    bird.Add(new Coroutine(bird.HideTutorial()));\n    // \u7b49\u5f85 0.25s\n    yield return 0.25f;\n    // \u64ad\u653e\u9e1f\u88ab\u73a9\u5bb6\u5413\u8d70\u98de\u8d70\u7684\u52a8\u753b (\u6b64\u65f6\u5927\u7ea6\u662f\u73a9\u5bb6\u51b2\u523a\u7ed3\u675f\u7684\u65f6\u95f4)\n    bird.Add(new Coroutine(bird.StartleAndFlyAway()));\n    // \u7b49\u5f85\u76f4\u5230\u73a9\u5bb6\u843d\u5730, \u6216\u8005\u76f4\u5230\u73a9\u5bb6\u5bc4\u4e86\n    while (!player.Dead &amp;&amp; !player.OnGround(1))\n        yield return null;\n    // \u7b49\u5f85 2s\n    yield return 2f;\n    // \u64ad\u653e title_ping \u97f3\u6548, \u5982\u679c\u4f60\u60f3\u4e0d\u8d77\u6765\u7684\u8bdd\u4f60\u53ef\u4ee5\u53bb\u4ed4\u7ec6\u542c\u542c\n    // \u5728\u851a\u84dd\u6e90 fmod \u5de5\u7a0b\u6587\u4ef6\u91cc\u5b83\u7684\u97f3\u9891\u6587\u4ef6\u4f4d\u4e8e music/kuraine/mus_lvl0_titleping_oneshot.ogg\n    Audio.SetMusic(\"event:/music/lvl0/title_ping\");\n    // \u7ee7\u7eed\u7b49\u5f85 2s\n    yield return 2f;\n    // \u5411\u573a\u666f\u4e2d\u52a0\u5165\u663e\u793a \"\u4f60\u80fd\u505a\u5230.\" \u8fd9\u53e5\u8bdd\u7684\u5b9e\u4f53\n    endingText = new PrologueEndingText(false);\n    Scene.Add(endingText);\n\n    // \u83b7\u53d6\u5173\u5361\u4e2d\u63a7\u5236\u524d\u666f\u96ea\u548c\u80cc\u666f\u96ea\u7684\u5b9e\u4f53\n    Snow bgSnow = level.Background.Get&lt;Snow&gt;();\n    Snow fgSnow = level.Foreground.Get&lt;Snow&gt;();\n    // \u987a\u4fbf\u52a0\u5165\u9ad8\u5206\u8fa8\u7387\u7684\u96ea, \u4e5f\u5373 ui \u5c42\u4e0a\u7684\u96ea (HiresSnow = High resolution snow)\n    level.Add(level.HiresSnow = new HiresSnow(0.45f));\n    // \u4f46\u662f\u5148\u628a\u900f\u660e\u5ea6\u8c03\u6210 0, \u7528\u6765\u7b49\u4f1a\u6e10\u53d8\n    level.HiresSnow.Alpha = 0f;\n\n    // \u5f00\u59cb\u6e10\u53d8\u4e09\u5c42\u96ea\u7684\u900f\u660e\u5ea6\n    float ease = 0f;\n    while (ease &lt; 1f)\n    {\n        ease += Engine.DeltaTime * 0.25f;\n        float eased = Ease.CubeInOut(ease);\n        if (fgSnow != null)\n            fgSnow.Alpha -= Engine.DeltaTime * 0.5f;\n        if (bgSnow != null)\n            bgSnow.Alpha -= Engine.DeltaTime * 0.5f;\n        level.HiresSnow.Alpha = Calc.Approach(level.HiresSnow.Alpha, 1f, Engine.DeltaTime * 0.5f);\n        // \u4e8e\u6b64\u540c\u65f6 \"\u4f60\u80fd\u505a\u5230.\" \u8fd9\u53e5\u8bdd\u4e5f\u6162\u6162\u964d\u4e0b\u6765\n        endingText.Position = new Vector2(960f, 540f - 1080f * (1f - eased));\n        // \u6444\u50cf\u673a\u4e5f\u6162\u6162\u5411\u4e0a\u79fb\u52a8\n        level.Camera.Y = level.Bounds.Top - 3900f * eased;\n        yield return null;\n    }\n    // \u7ed3\u675f\u8fd9\u4e2a\u5267\u60c5\n    EndCutscene(level);\n    yield break;\n}\n</code></pre></p>"},{"location":"components/sprite_image/","title":"Sprite, Image","text":"<p>Sprite \u4f60\u53ef\u4ee5\u628a\u5b83\u5f53\u4f5c\u7ba1\u52a8\u753b\u7684</p> <p>Image \u4f60\u53ef\u4ee5\u628a\u5b83\u5f53\u4f5c\u7ba1\u56fe\u7247\u7684</p>"},{"location":"components/sprite_image/#_1","title":"\u7ee7\u627f\u94fe","text":"<p><code>Sprite</code> -&gt; <code>Image</code> -&gt; <code>GraphicsComponent</code> -&gt; <code>Component</code>, \u63a5\u4e0b\u6765\u4f1a\u9010\u4e00\u8bb2\u89e3</p>"},{"location":"components/sprite_image/#graphicscomponent","title":"GraphicsComponent","text":"<p>\u63d0\u4f9b\u4e86\u6700\u57fa\u7840\u7684\u6e32\u67d3\u56fe\u7247\u6240\u9700\u7684\u4fe1\u606f\u548c\u5e38\u7528\u65b9\u6cd5\u5982: \u4f4d\u7f6e, \u65cb\u8f6c, \u7f29\u653e, \u951a\u70b9, \u989c\u8272\u7cfb\u6570, \u662f\u5426\u7ffb\u8f6c\u56fe\u50cf, \u63cf\u8fb9\u7b49</p> \u7c7b\u7684\u5c5e\u6027\u5b57\u6bb5\u65b9\u6cd5\u8bf4\u660e <ul> <li>Vector2 Position: \u56fe\u7247\u76f8\u5bf9\u4e8e<code>Entity.Position</code>\u7684\u4f4d\u7f6e</li> <li>Vector2 Origin: \u56fe\u7247\u7684\u951a\u70b9\u4f4d\u7f6e(\u4e5f\u5c31\u662f\u56fe\u7247\u7684\u65cb\u8f6c\u7f29\u653e\u5e73\u79fb\u57fa\u4e8e\u56fe\u7247\u7684\u54ea\u4e2a\u76f8\u5bf9\u4f4d\u7f6e)</li> <li>Vector2 Scale: \u56fe\u7247\u7684\u7f29\u653e</li> <li>float Rotation: \u56fe\u7247\u7684\u65cb\u8f6c(\u4ee5\u5f27\u5ea6\u4e3a\u5355\u4f4d\u987a\u65f6\u9488\u65cb\u8f6c(\u867d\u7136\u611f\u89c9\u9006\u65f6\u9488\u66f4\u7b26\u5408\u76f4\u89c9\u70b9))</li> <li>Color Color: \u56fe\u7247\u7684\u989c\u8272\u7cfb\u6570(\u6e32\u67d3\u65f6\u4f1a\u5728\u539f\u6765\u56fe\u7247\u57fa\u8272\u7684\u57fa\u7840\u4e0a\u4e58\u4e0a\u8fd9\u4e2a\u503c, \u6240\u4ee5\u4e0d\u8981\u60f3\u7740\u7528\u767d\u8272\u5f53\u7cfb\u6570\u56fe\u7247\u5c31\u53d8\u6210\u7eaf\u767d\u7684\u4e86)</li> <li>SpriteEffects Effects: \u662f\u5426\u6c34\u5e73(\u7ad6\u76f4)\u53cd\u8f6c\u56fe\u7247</li> <li>float X, Y: <code>Position</code></li> <li>bool FlipX, FlipY: \u5bf9<code>Effects</code>\u7684\u5c01\u88c5</li> <li>Vector2 RenderPosition: \u5b9e\u9645\u7684\u6e32\u67d3\u4f4d\u7f6e</li> <li>Vector2 RenderPosition: \u5b9e\u9645\u7684\u6e32\u67d3\u4f4d\u7f6e</li> <li>void DrawOutline(Color color, int offset = 1): \u628a\u81ea\u8eab\u5f80\u4e0a\u4e0b\u5de6\u53f3\u5e73\u79fb<code>offset</code>, \u5e76\u4ee5<code>color</code>\u4e3a\u989c\u8272\u7cfb\u6570\u901a\u8fc7<code>Render</code>\u6765\u7ed8\u5236\u63cf\u8fb9</li> <li>void DrawSimpleOutline(): <code>offset</code>\u4e3a1\u4e2a\u5355\u4f4d\u7684\u9ed1\u8272\u63cf\u8fb9</li> </ul>"},{"location":"components/sprite_image/#image","title":"Image","text":"<p>\u5bf9 <code>GraphicsComponent</code> \u7684\u8fdb\u4e00\u6b65\u5c01\u88c5, \u4e3b\u8981\u63d0\u4f9b\u4e86 <code>Texture</code> \u7eb9\u7406(\u56fe\u7247)\u76f8\u5173\u4fe1\u606f, \u6b64\u65f6\u5c31\u53ef\u4ee5\u6839\u636e\u4e4b\u524d\u7684\u4fe1\u606f\u6e32\u67d3\u51fa\u4e00\u5f20\u56fe\u7247\u4e86, \u5c31\u50cf\u4f60\u4e4b\u524d\u5728 <code>PassByRefill</code> \u90a3\u8282\u505a\u7684\u90a3\u6837 </p> \u7c7b\u7684\u5c5e\u6027\u5b57\u6bb5\u65b9\u6cd5\u8bf4\u660e <ul> <li>MTexture Texture: \u6750\u8d28(\u4f60\u53ef\u4ee5\u628a\u5b83\u5f53\u6210\u4e00\u5f20<code>png</code>\u56fe\u7247)</li> <li>virtual float Width, Height: \u56fe\u7247\u7684\u5bbd(\u9ad8)</li> <li>Image SetOrigin(float x, float y): \u8bbe\u7f6e\u951a\u70b9</li> <li>Image CenterOrigin(): \u8bbe\u7f6e\u951a\u70b9\u5230\u4e2d\u5fc3(\u6bd4\u8f83\u5e38\u7528\u7684\u60c5\u51b5, \u6240\u4ee5\u4f60\u89c1\u5230\u7684\u951a\u70b9\u5927\u591a\u6570\u662f\u4f4d\u4e8e\u5341\u5b57\u56db\u5bab\u683c\u4e0a\u76849\u4e2a\u70b9)</li> <li>Image JustifyOrigin(Vector2 at): \u5355\u4f4d\u5316\u7684\u951a\u70b9\u5750\u6807(\u8303\u56f4\u662f<code>Vector2.Zero ~ Vector2.One</code>)(   \u8fd9\u6837\u5f53\u6211\u4eec\u9700\u8981\u628a\u951a\u70b9\u8bbe\u7f6e\u5230\u4e2d\u5fc3\u7684\u65f6\u5019\u5c31\u4e0d\u9700\u8981\u7528<code>new Vector2(Width, Height) / 2</code>\u4e86, \u76f4\u63a5\u7528<code>new Vector2(0.5f, 0.5f)</code>\u5373\u53ef)</li> <li>SetColor(Color color): \u8bbe\u7f6eColor\u989c\u8272</li> </ul>"},{"location":"components/sprite_image/#sprite","title":"Sprite","text":"<p>\u5bf9 <code>Image</code> \u7684\u8fdb\u4e00\u6b65\u5c01\u88c5, \u63d0\u4f9b\u4e86\u5bf9\u52a8\u753b\u7684\u7ba1\u7406(\u4e00\u8fde\u4e32\u56fe\u7247\u5f62\u6210\u4e00\u4e2a\u5e27\u52a8\u753b, \u518d\u7528 <code>id</code> \u5206\u7ec4, \u901a\u8fc7\u52a8\u753b\u72b6\u6001\u673a\u5b9e\u73b0\u52a8\u753b\u95f4\u7684\u8df3\u8f6c\u6216\u662f\u81ea\u8eab\u7684 <code>loop</code>)</p> \u7c7b\u7684\u5c5e\u6027\u5b57\u6bb5\u65b9\u6cd5\u8bf4\u660e <p>\u91cc\u9762\u6709\u4e00\u5c42<code>Animation</code>\u7c7b, \u662f\u5bf9\u52a8\u753b\u7684\u7b80\u5355\u5c01\u88c5</p> <pre><code>public class Animation\n{\n    public Animation()\n    {\n    }\n\n    public float Delay;  // \u4e00\u5e27\u52a8\u753b\u6301\u7eed\u591a\u5c11\u79d2\n    public MTexture[] Frames;  // \u52a8\u753b\u7684\u56fe\u7247\u5e27\u5e8f\u5217\n    public Chooser&lt;string&gt; Goto;  // Chooser\u4f60\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9\u5206\u5c42\u968f\u673a\u6570\u62bd\u6837\u7684\u5c01\u88c5, \u8fd9\u91cc\u662f\u64ad\u653e\u5b8c\u5f53\u524d\u52a8\u753b\u540e\u5e94\u8be5\u8df3\u5230\u54ea\u4e2a\u52a8\u753b(\u4f60\u53ef\u4ee5\u53bb\u4e86\u89e3\u4e0b\"\u52a8\u753b\u72b6\u6001\u673a\") \n}\n</code></pre> <ul> <li>float Rate: \u52a8\u753b\u64ad\u653e\u901f\u5ea6\u500d\u7387(\u8d1f\u6570\u610f\u5473\u7740\u5012\u653e)</li> <li>bool UseRawDeltaTime: \u662f\u5426\u4f7f\u7528\u73b0\u5b9e\u65f6\u95f4\u6d41\u901f(\u56e0\u4e3a\u6e38\u620f\u53ef\u4ee5\u8c03\u901f\u561b)</li> <li>Vector2? Justify: <code>Origin</code>\u7684\u989d\u5916\u504f\u79fb\u91cf</li> <li>Action OnFinish: \u5f53\u524d\u52a8\u753b\u64ad\u653e\u5b8c\u5207\u6362\u5230\u5176\u4ed6\u52a8\u753b\u65f6\u5e72\u7684\u4e8b <li>Action OnLoop: \u52a8\u753b\u5f00\u59cb\u5faa\u73af\u65f6\u5e72\u7684\u4e8b <li>Action OnFrameChange: \u52a8\u753b\u64ad\u653e\u4e0b\u4e00\u5e27\u65f6\u5e72\u7684\u4e8b <li>Action OnLastFrame: \u64ad\u653e\u5230\u5b8c\u52a8\u753b\u6700\u540e\u4e00\u5e27\u65f6\u5e72\u7684\u4e8b <li>Action OnChange: \u52a8\u753b\u5207\u6362\u65f6\u5e72\u7684\u4e8b <li>Atlas atlas: \u56fe\u7247\u6765\u6e90\u4e8e\u54ea\u4e2aAtlas</li> <li>string Path: \u56fe\u7247\u7684\u76f8\u5bf9\u8def\u5f84</li> <li>Dictionary animations: \u52a8\u753b\u96c6\u5408 <li>Dictionary Animations: <code>animations</code> <li>Sprite.Animation currentAnimation: \u5f53\u524d\u52a8\u753b</li> <li>float animationTimer: \u52a8\u753b\u5e94\u8be5\u5f00\u59cb\u591a\u4e45\u4e86(\u7528\u6765\u5904\u7406<code>Delay</code>\u7684)</li> <li>int width: \u6240\u6709\u52a8\u753b\u5e27\u7684\u6700\u5927\u5bbd\u5ea6</li> <li>int height: \u6240\u6709\u52a8\u753b\u5e27\u7684\u6700\u5927\u9ad8\u5ea6</li> <li>Reset(Atlas atlas, string path): \u6062\u590d\u51fa\u5382\u8bbe\u7f6e, \u8bbe\u7f6e\u65b0\u7684\u56fe\u7247\u8def\u5f84</li> <li>MTexture GetFrame(string animation, int frame): \u62ff\u5230\u5bf9\u5e94<code>id</code>\u52a8\u753b\u7684\u67d0\u4e00\u5e27\u56fe\u7247</li> <li>Vector2 Center: <code>new Vector2(this.Width / 2f, this.Height / 2f)</code></li> <li>override void Update(): \u6838\u5fc3\u903b\u8f91, \u5efa\u8bae\u662f\u81ea\u5df1\u770b\u6e90\u7801</li> <li>void SetFrame(MTexture texture): \u8bbe\u7f6e\u5f53\u524d\u5e27\u56fe\u7247, \u987a\u4fbf\u8c03\u6574\u4e00\u4e0b\u951a\u70b9</li> <li>void SetAnimationFrame(int frame): \u91cd\u7f6e<code>animationTimer</code>\u5e76\u628a\u5f53\u524d\u5e27\u8bbe\u7f6e\u4e3a\u52a8\u753b\u7684\u7b2c<code>frame</code>\u5e27</li> <li>void AddLoop(string id, string path, float delay, params int[] frames): \u6dfb\u52a0\u4e00\u4e2aid\u4e3a<code>id</code>\u7684\u52a8\u753b, \u5e76\u63d0\u4f9b\u76f8\u5e94\u53c2\u6570, \u540c\u65f6\u628a<code>Goto</code>\u6307\u5411<code>id</code>\u5f62\u6210<code>loop</code>, \u5982\u679c\u6709\u9700\u8981,   \u8fd8\u53ef\u4ee5\u6307\u5b9a\u67d0\u4e9b\u5e27\u6765<code>loop</code></li> <li>void Add(string id, string path, float delay, params int[] frames): \u65e0<code>loop</code>\u7248\u7684AddLoop</li> <li>MTexture[] GetFrames(string path, int[] frames = null): \u901a\u8fc7\u76f8\u5bf9\u8def\u5f84\u52a0\u8f7d\u56fe\u7247\u5e8f\u5217, \u7ed9\u4e86<code>frames</code>\u5c31\u52a0\u8f7d\u5bf9\u5e94\u7684</li> <li>ClearAnimations(): \u6e05\u7a7a\u6ce8\u518c\u7684\u52a8\u753b</li> <li>void Play(string id, bool restart = false, bool randomizeFrame = false): \u64ad\u653e\u5bf9\u5e94<code>id</code>\u7684\u52a8\u753b(\u76f8\u540c\u7684\u4e0d\u64ad\u653e, \u9664\u975e<code>restart</code>), \u82e5\u5f00\u542f<code>randomizeFrame</code>,   \u5219\u4f1a\u968f\u673a\u5316<code>animationTimer</code>\u548c<code>CurrentAnimationFrame</code></li> <li>void PlayOffset(string id, float offset, bool restart = false): \u64ad\u653e\u5bf9\u5e94<code>id</code>\u7684\u52a8\u753b\u5e76\u5feb\u8fdb<code>offset</code>\u65f6\u95f4</li> <li>IEnumerator PlayRoutine(string id, bool restart = false): \u64ad\u653e\u5bf9\u5e94<code>id</code>\u7684\u52a8\u753b\u76f4\u5230\u52a8\u753b\u505c\u6b62</li> <li>IEnumerator ReverseRoutine(string id, bool restart = false): \u64ad\u653e\u5bf9\u5e94<code>id</code>\u7684\u52a8\u753b\u76f4\u5230\u52a8\u753b\u505c\u6b62</li> <li>IEnumerator PlayUtil(): \u76f4\u5230\u5f53\u524d\u52a8\u753b\u505c\u6b62</li> <li>void Reverse(string id, bool restart = false): \u5c06\u52a8\u753b\u64ad\u653e\u65b9\u5411\u8bbe\u7f6e\u4e3a\u9006\u5e8f\u64ad\u653e</li> <li>Has(string id): \u67e5\u770b\u662f\u5426\u6ce8\u518c\u8fc7id\u4e3a<code>id</code>\u7684\u52a8\u753b</li> <li>void Stop(): \u7ed3\u675f\u64ad\u653e\u52a8\u753b</li> <li>bool Animating: \u662f\u5426\u53ef\u4ee5\u64ad\u653e\u52a8\u753b</li> <li>string CurrentAnimationID: \u5f53\u524d\u52a8\u753bid</li> <li>string LastAnimationID: \u4e0a\u4e00\u4e2a\u52a8\u753bid</li> <li>int CurrentAnimationFrame: \u64ad\u653e\u5230\u5f53\u524d\u52a8\u753b\u7684\u54ea\u4e00\u5e27\u4e86</li> <li>int CurrentAnimationTotalFrames: \u5f53\u524d\u52a8\u753b\u603b\u5e27\u6570</li> <li>override float Width, Height: <code>this.width</code>, <code>this.height</code></li> <li>Sprite CreateClone(): \u521b\u5efa\u5f53\u524d<code>Sprite</code>\u7684\u4e00\u4e2a\u526f\u672c</li> <li>Sprite CloneInto(Sprite clone): \u521b\u5efa\u5f53\u524d<code>Sprite</code>\u7684\u4e00\u4e2a\u526f\u672c\u5230<code>clone</code>\u4e2d</li> <li>void DrawSubrect(Vector2 offset, Rectangle rectangle): \u7ed8\u5236\u5f53\u524dSprite\u7684\u67d0\u4e2a\u533a\u57df(\u6709\u70b9\u8499\u7248\u7684\u611f\u89c9)</li> <li>void LogAnimations(): \u8f93\u51fa\u6ce8\u518c\u8fc7\u7684\u52a8\u753b\u4fe1\u606f</li> <p>\u63a5\u4e0b\u6765\u63d0\u4f9b\u4e00\u4e2a\u64ad\u653e\u5faa\u73af\u52a8\u753b\u5c0f\u793a\u4f8b</p> <p>\u6211\u4eec\u9700\u8981\u5148\u8c03\u6574\u4e00\u4e0b\u5148\u524d\u7684\u6587\u4ef6\u7ed3\u6784</p> <pre><code>- Atlases\n    - Gameplay\n        - \u4f60\u7684mod\u540d(\u8fd9\u91cc\u5e94\u8be5\u662fMyCelesteMod)\n            - pass_by_refill\n                - img00  // \u540e\u9762\u768400, 01\u5fc5\u987b\u6309\u987a\u5e8f\u6765, \u8fd9\u91cc\u7684img\u63d0\u4f9b\u4e86\u4e4b\u524d\u7684\u6539\u8272\u7248\u672c\n                - img01\n</code></pre> <p> </p> <p>\u63a5\u7740\u6211\u4eec\u5728 <code>PassByRefill</code> \u4e2d\u628a\u8ddf <code>Image</code> \u6709\u5173\u7684\u90e8\u5206\u66ff\u6362\u4e3a <code>Sprite</code>, \u628a\u4ee5\u4e0b\u4ee3\u7801\u66ff\u6362\u4e0a\u53bb, \u7136\u540e\u4f60\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u4e00\u79d2\u4e00\u53d8\u7684\u52a8\u753b\u5566!</p> <pre><code>private Sprite sprite;\n\npublic PassByRefill(Vector2 position, int dashes)\n{\n    // ...\n\n    sprite = new Sprite(GFX.Game, \"\u4f60\u7684mod\u540d/pass_by_refill/\");\n    Add(sprite);\n    sprite.AddLoop(\"idle\", \"img\", 1);\n    sprite.Play(\"idle\");\n}\n</code></pre>"},{"location":"components/sprite_image/#gfx","title":"GFX","text":"<p>\u5e94\u8be5\u662f Graphics \u7684\u97f3\u8bd1\u7f29\u5199, \u5c31\u50cf SFX \u662f Sound Effects \u7684\u7f29\u5199\u4e00\u6837</p> <p>GFX\u4e3b\u8981\u7ba1\u7406\u6e38\u620f\u7684\u8d34\u56fe, \u5b83\u4f1a\u5728\u6e38\u620f\u5f00\u59cb\u8fd0\u884c\u7684\u65f6\u5019\u52a0\u8f7d\u6240\u9700\u8981\u7684\u8d44\u6e90, \u7136\u540e\u5c06\u5176\u5206\u95e8\u522b\u7c7b\u7684\u5f52\u5230\u5176\u5404\u4e2a\u5b57\u6bb5\u4e2d, \u5176\u4e2d\u6700\u5e38\u7528\u7684\u662f<code>GFX.Game</code>\u548c<code>GFX.SpriteBank</code>, \u6211\u4eec\u5e38\u5e38\u4f7f\u7528<code>GFX.Game[\"xx/xx/xx.png\"]</code>\u6765\u8bbf\u95ee\u76f8\u5bf9<code>Graphics/Atlases/Gameplay</code>\u6587\u4ef6\u5939\u4e0b\u7684\u5404\u79cd\u8d34\u56fe, \u6211\u4eec\u4e5f\u5e38\u5e38\u4f7f\u7528<code>GFX.SpriteBank.Create(\"xxx\");</code>\u6765\u8bbf\u95ee<code>Celeste/Content/Graphics/Sprites.xml</code>(\u4e5f\u53ef\u4ee5\u7528\u81ea\u5b9a\u4e49\u7684)\u6587\u4ef6\u91cc\u7684\u5404\u79cd\u52a8\u753b\u914d\u7f6e, \u5982player\u4ee3\u7801\u4e2d\u7684<code>this.sweatSprite = GFX.SpriteBank.Create(\"player_sweat\");</code>, \u5c31\u662f\u901a\u8fc7\u8bbf\u95ee<code>Sprites.xml</code>\u91cc<code>&lt;Sprite&gt;</code>\u8282\u70b9\u4e0b\u7684<code>&lt;player_sweat&gt;</code>\u8282\u70b9\u7684\u914d\u7f6e\u6765\u751f\u6210\u4e00\u4e2aSprite.</p>"},{"location":"components/statemachine/","title":"StateMachine","text":"<p>\u8fd9\u662f Monocle \u4e2d\u7684\u4e00\u4e2a Component \u7c7b, \u662f\u4e00\u4e2a\u72b6\u6001\u673a\u7684\u5b9e\u73b0, \u5177\u4f53\u7684\u7528\u6cd5\u6211\u4f1a\u5728 \u5e38\u89c1 Celeste, Monocle \u7c7b<sub>\u5728\u5199\u4e86.jpg</sub> \u8282\u8bf4, \u8fd9\u91cc\u4ec5\u662f\u65b9\u4fbf\u4f60\u9605\u8bfb\u4e00\u4e0b\u76f8\u5173\u7684\u4ee3\u7801:</p>"},{"location":"components/statemachine/#st","title":"<code>St*</code> \u7c7b\u5b57\u6bb5","text":"<p>\u5728\u9605\u8bfb <code>Player</code> \u7c7b\u7684\u4ee3\u7801\u65f6, \u4f60\u4f1a\u770b\u5230\u8fd9\u4e9b<code>St</code>\u5f00\u5934\u540d\u5b57\u7684\u5e38\u91cf\u4f46\u662f\u4f60\u627e\u4e0d\u5230\"\u88ab\u4f7f\u7528\"\u7684\u5730\u65b9:</p> <ul> <li>const int StNormal = 0;</li> <li>const int StClimb = 1;</li> <li>const int StDash = 2;</li> <li>const int StSwim = 3;</li> <li>const int StBoost = 4;</li> <li>......</li> </ul> <p>\u8fd9\u4e9b\u662f\u73a9\u5bb6\u72b6\u6001\u673a\u7684\u72b6\u6001\u7f16\u53f7, \u81f3\u4e8e\u4f60\u627e\u4e0d\u5230\"\u88ab\u4f7f\u7528\"\u662f\u56e0\u4e3a\u5bf9\u4e8e const \u5e38\u91cf\u6210\u5458, c# \u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u671f\u5c31\u628a\u5f15\u7528\u7684\u8fd9\u4e9b\u4e1c\u897f\u76f4\u63a5\u66ff\u6362\u4e3a\u4e86\u6570\u5b57, \u4f60\u80fd\u770b\u5230\u7684\u53ea\u6709\u4fdd\u7559\u4e0b\u6765\u7684\u8fd9\u4e9b\u5e38\u91cf\u7684\u503c\u548c\u540d\u5b57. \u90a3\u8fd9\u6837\u4ee3\u7801\u4e2d\u5c31\u4e0d\u907f\u514d\u7684\u51fa\u73b0\u4e86\u5947\u602a\u7684\u9b54\u6570, \u6bd4\u5982\u8fd9\u91cc\u7684 24: int Player.FlingBirdUpdate()<pre><code>private int FlingBirdUpdate()\n{\n    base.MoveTowardsX(this.flingBird.X, 250f * Engine.DeltaTime, null);\n    base.MoveTowardsY(this.flingBird.Y + 8f + base.Collider.Height, 250f * Engine.DeltaTime, null);\n    return 24;\n}\n</code></pre></p> <p>Info</p> <p>FlingBirdUpdate \u662f\u4e00\u4e2a\u72b6\u6001\u673a\u7684 Update \u51fd\u6570, \u6240\u6709\u8be5\u7c7b\u51fd\u6570\u7684\u8fd4\u56de\u503c\u8868\u793a\u4e0b\u4e00\u5e27\u73a9\u5bb6\u7684\u72b6\u6001\u5e94\u8be5\u662f\u4ec0\u4e48.</p> <p>\u4f60\u80af\u5b9a\u5f88\u7591\u60d1\u8fd9\u4e2a\u5947\u602a\u7684 24 \u662f\u4ec0\u4e48, \u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5b83\u662f\u4e2a\u72b6\u6001\u673a\u7f16\u53f7\u4e86, \u6211\u4eec\u53ea\u9700\u8981\u4e00\u4e0b\u8fd9\u4e2a\u7f16\u53f7\u5bf9\u5e94\u7684\u72b6\u6001. \u7ecf\u8fc7\u67e5\u8be2, \u4f60\u4f1a\u77e5\u9053\u7f16\u53f7\u4e3a 24 \u7684\u72b6\u6001\u662f <code>StFlingBird</code>, \u5373\u88ab\u9e1f\u6254\u72b6\u6001(\u7b26\u5408\u8fd9\u91cc\u7684\u51fd\u6570\u540d!):</p> <pre><code>const int StFlingBird = 24;\n</code></pre> <p>\u5728\u8fd9\u91cc\u4f1a\u7b80\u5355\u5217\u51fa\u4e00\u4e0b <code>Player</code> \u7684\u6240\u6709\u72b6\u6001\u4fbf\u4e8e\u67e5\u8be2:</p> <pre><code>const int StNormal = 0; // \u6b63\u5e38\nconst int StClimb = 1; // \u6500\u722c\nconst int StDash = 2; // \u51b2\u523a\nconst int StSwim = 3; // \u6c34\u4e2d\nconst int StBoost = 4; // \u7eff\u6ce1\u6ce1\u4e2d\nconst int StRedDash = 5; // \u7ea2\u6ce1\u6ce1\u4e2d\nconst int StHitSquash = 6; // \u7ea2\u6ce1\u6ce1\u649e\u5899\u6216\u649e\u5730\nconst int StLaunch = 7; // \u88ab \u5f39\u7403, \u9c7c \u5f39\u5f00\nconst int StPickup = 8; // \u6361\u8d77\u6293\u53d6\u7269\nconst int StDreamDash = 9; // \u7a7f\u679c\u51bb\nconst int StSummitLaunch = 10; // badeline\u6700\u540e\u4e00\u6b21\u4e0a\u629b\nconst int StDummy = 11; // \u5267\u60c5\u8fc7\u573a\u72b6\u6001\nconst int StIntroWalk = 12; // Walk \u7c7b\u578b\u7684 Intro (Intro \u5373\u73a9\u5bb6\u8fdb\u5165\u5173\u5361\u7684\u8868\u73b0\u65b9\u5f0f)\nconst int StIntroJump = 13; // Jump \u7c7b\u578b\u7684 Intro (1a)\nconst int StIntroRespawn = 14; // Respawn \u7c7b\u578b\u7684 Intro (\u91cd\u751f)\nconst int StIntroWakeUp = 15; // WakeUp \u7c7b\u578b\u7684 Intro (2a awake)\nconst int StBirdDashTutorial = 16; // \u5e8f\u7ae0\u6559\u51b2\u523a\u65f6\u51b2\u523a\u7ed3\u675f\u540e\u8fdb\u5165\u7684\u72b6\u6001\nconst int StFrozen = 17; // \u672a\u77e5\nconst int StReflectionFall = 18; // 6a-2 \u6389\u843d\u5267\u60c5\u6bb5\nconst int StStarFly = 19; // \u7fbd\u6bdb\u98de\u884c\nconst int StTempleFall = 20; // 5a \u955c\u5b50\u540e\u7684\u6389\u843d\u6bb5\nconst int StCassetteFly = 21; // \u6361\u5230\u78c1\u5e26\u540e\u7684\u6ce1\u6ce1\u5305\u88f9\u6bb5\nconst int StAttract = 22; // 6a badeline boss \u9760\u8fd1\u65f6\u7684\u5438\u5f15\u6bb5\nconst int StIntroMoonJump = 23; // 9a \u5f00\u573a\u4e0a\u5347\u5267\u60c5\u6bb5\nconst int StFlingBird = 24; // 9a \u9e1f\u6254\u72b6\u6001\nconst int StIntroThinkForABit = 25; // 9a Intro\n</code></pre>"},{"location":"extra_cmcc/","title":"\u989d\u5916 - CMCC","text":"<p>\u6b22\u8fce\u6765\u5230\u53c8\u4e00\u4e2a\u989d\u5916\u7ae0\u8282, \u4e0d\u8fc7\u8fd9\u91cc\u4e0d\u662f\u4e00\u4e2a\u65b0\u4e3b\u9898, \u53ea\u662f\u4e00\u4e2a\u7531 ForkKILLET \u5efa\u7acb\u7684\u4ed3\u5e93 CelesteMapperCooperationInChina (CMCC) \u7684\u4e00\u4e2a\u7f51\u9875\u5448\u73b0.  </p> <p>\u6e90 github \u4ed3\u5e93: https://github.com/ForkKILLET/CelesteMapperCooperationInChina </p>"},{"location":"extra_cmcc/cmcc/ReadMe/","title":"\u851a\u84dd\u5236\u56fe\u4e92\u52a9\uff08\u4e2d\u56fd\uff09 | CMCC","text":""},{"location":"extra_cmcc/cmcc/ReadMe/#_1","title":"\u80cc\u666f","text":"<p>\u4e00\u4f4d\u5236\u56fe\u7fa4\u7fa4\u53cb\uff1a</p> <p>\u8bdd\u8bf4\u6211\u6709\u4e00\u4e2a\u5c0f\u63d0\u8bae\uff0c\u4e0d\u77e5\u9053\u884c\u4e0d\u884c\uff0c\u5728\u672c\u7fa4\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u53ef\u7f16\u8f91\u7684 FAQ \u6587\u6863\uff0c\u5927\u5bb6\u53ef\u4ee5\u628a\u505amod\u65f6\u5019\u9047\u5230\u7684\u4e00\u4e9b\u5c0f\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u653e\u8fdb\u53bb\u2026\u2026</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u56fd\u5185\u851a\u84dd\uff08Celeste\uff09\u73a9\u5bb6\u5206\u4eab\u5236\u56fe\u7ecf\u9a8c\uff0c\u6211\u4eec\u5f00\u4e86\u4e00\u4e2a\u4ed3\u5e93\u5b58\u653e\u8fd9\u4e9b\u4fe1\u606f\u3002</p> <p>\u4e24\u4e2a\u6ce8\u610f\u70b9\uff1a</p> <ol> <li>\u4f18\u5148\u4f7f\u7528\u4e2d\u6587</li> <li>\u4fdd\u8bc1\u56fd\u5185\u53ef\u8bbf\u95ee\u6027</li> </ol>"},{"location":"extra_cmcc/cmcc/ReadMe/#_2","title":"\u8bbf\u95ee","text":"<ul> <li>GitHub</li> <li>Gitee \u955c\u50cf</li> </ul>"},{"location":"extra_cmcc/cmcc/ReadMe/#_3","title":"\u5185\u5bb9\u7d22\u5f15","text":"<ul> <li>FAQ\uff08\u65bd\u5de5\u4e2d\uff09</li> </ul>"},{"location":"extra_cmcc/cmcc/faq/","title":"FAQ","text":""},{"location":"extra_cmcc/cmcc/faq/#everest","title":"Everest\u6709\u4ec0\u4e48\u7528","text":"<p>\u56e0\u4e3a\u8981\u505a Mod, \u5c31\u5f97\u5bf9\u539f\u7248\u6e38\u620f\u4ee3\u7801\u4f5c\u51fa\u4fee\u6539, \u800c\u6bcf\u4e2a\u4eba\u7684\u6539\u6cd5\u4e0d\u540c, \u52bf\u5fc5\u4f1a\u4ea7\u51fa\u591a\u4e2a\u4e0d\u540c\u7684 Mod \u52a0\u8f7d\u5668(\u5982\u56fe\u4e2d\u7684Celeste0, Celeste1, Everest), \u65e2\u4e0d\u5229\u4e8e\u4f20\u64ad, \u53c8\u5f88\u6d6a\u8d39\u751f\u4ea7\u529b, \u90a3\u600e\u4e48\u529e, \u589e\u52a0\u4e00\u5c42\u62bd\u8c61, \u7531 Everest \u5e2e\u6211\u4eec\u628a\u810f\u6d3b\u7d2f\u6d3b\u513f\u5e72\u4e86, \u6211\u4eec\u53ea\u9700\u8981\u4f7f\u7528 Everest \u548c\u539f\u7248\u63d0\u4f9b\u7684\u63a5\u53e3\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0\u5404\u79cd\u529f\u80fd </p>"},{"location":"extra_cmcc/cmcc/faq/#net-core-everest","title":"\u4ec0\u4e48\u662f .NET Core Everest?","text":"<p>\u8001\u7684c#\u6846\u67b6\u79f0\u4e3a<code>.NET Framework</code>, \u53ea\u80fd\u8fd0\u884c\u5728windows\u5e73\u53f0\u4e0a</p> <p>\u800c\u65b0\u7684c#\u6846\u67b6\u79f0\u4e3a<code>.NET Core</code>, \u80fd\u8fd0\u884c\u5728\u4efb\u610f\u5e73\u53f0\u4e0a</p> <p>\u6240\u4ee5<code>.NET Core Everest</code>\u81ea\u7136\u4e5f\u5c31\u662f\u57fa\u4e8e<code>.NET Core</code>\u6846\u67b6\u5b9e\u73b0\u7684Everest(\u66f4\u65b0\u6362\u4ee3\u4e86), \u4ece 4465 \u7248\u672c\u5f80\u540e\u7684Everest\u90fd\u662f<code>.NET Core Everest</code></p>"},{"location":"extra_cmcc/cmcc/todo/","title":"Todo","text":""},{"location":"extra_cmcc/cmcc/todo/#q1-loenn","title":"Q1 \u600e\u4e48\u62d6\u52a8 Loenn \u7684\u89c6\u89d2","text":"<p>\u9f20\u6807\u957f\u6309\u53f3\u952e  </p> <p>\u9664\u6b64\u4e4b\u5916, \u5e38\u89c1\u7684 L\u00f6nn \u6309\u952e/\u5feb\u6377\u952e\u6709:</p> <ul> <li>\u901a\u7528\u6309\u952e<ul> <li>Ctrl + N: \u65b0\u5730\u56fe</li> <li>Ctrl + O: \u6253\u5f00\u5730\u56fe</li> <li>\u5c06 .bin \u62d6\u5230\u7a97\u53e3\u4e0a: \u6253\u5f00\u5730\u56fe</li> <li>Ctrl + S: \u4fdd\u5b58\u5730\u56fe</li> <li>Ctrl + Shift + S: \u53e6\u5b58\u4e3a</li> <li>Ctrl + T: \u65b0\u623f\u95f4(\u9762)</li> <li>Ctrl + Shift + T: \u6253\u5f00\u5f53\u524d\u623f\u95f4\u5c5e\u6027\u9762\u677f</li> <li>Alt + \u65b9\u5411\u952e: \u79fb\u52a8\u623f\u95f4(\u6b65\u957f 8px)</li> <li>Alt + Delete: \u5220\u9664\u623f\u95f4</li> <li>Ctrl + Z: \u64a4\u56de</li> <li>Ctrl + Shift + Z: \u91cd\u505a</li> <li>\u9f20\u6807\u6eda\u8f6e: \u7f29\u653e</li> <li>Ctrl + \u2795 (\u52a0\u53f7): \u653e\u5927</li> <li>Ctrl + \u2796 (\u51cf\u53f7): \u7f29\u5c0f</li> <li>\u53cc\u51fb\u9f20\u6807\u4e2d\u952e: \u7f29\u653e\u81f3\u53ef\u4ee5\u770b\u89c1\u6574\u4e2a\u5730\u56fe</li> <li>F11: \u5207\u6362\u5168\u5c4f</li> <li>\u65b9\u5411\u952e: \u5217\u8868\u4e2d\u5bfc\u822a</li> </ul> </li> <li>\u7269\u4f53\u653e\u7f6e<ul> <li>\u5de6\u952e: \u653e\u7f6e\u7269\u4f53 (8px \u5bf9\u9f50)</li> <li>\u6309\u4f4f Ctrl \u65f6\u5de6\u952e: \u653e\u7f6e\u7269\u4f53 (1px \u5bf9\u9f50)</li> <li>\u53f3\u952e: \u6253\u5f00\u5149\u6807\u6240\u6307\u7269\u4f53\u7684\u5c5e\u6027\u9762\u677f</li> <li>\u5de6\u952e\u5e76\u62d6\u52a8: \u5728\u653e\u7f6e\u53ef\u8c03\u6574\u5927\u5c0f\u7684\u7269\u4f53\u65f6\u8c03\u6574\u7269\u4f53\u7684\u5927\u5c0f</li> <li>\u4e2d\u952e: \u590d\u5236\u5149\u6807\u6240\u6307\u7269\u4f53</li> <li>Q, E: \u51cf\u5c0f\u5bbd\u5ea6 / \u589e\u5927\u5bbd\u5ea6</li> <li>A, D: \u51cf\u5c0f\u9ad8\u5ea6 / \u589e\u5927\u9ad8\u5ea6</li> <li>L, R: \u9006\u65f6\u9488/\u987a\u65f6\u9488 \u65cb\u8f6c\u7269\u4f53</li> <li>V, H: \u7eb5\u5411/\u6a2a\u5411 \u7ffb\u8f6c\u7269\u4f53</li> </ul> </li> <li>\u7269\u4f53\u9009\u62e9<ul> <li>\u5de6\u952e: \u9009\u62e9\u7269\u4f53</li> <li>\u5df2\u9009\u62e9\u67d0\u7269\u4f53\u65f6\u5de6\u952e: \u5faa\u73af\u9009\u62e9\u5149\u6807\u5e95\u4e0b\u7684\u7269\u4f53 (\u4ece\u5c0f\u5230\u5927)</li> <li>\u5de6\u952e\u62d6\u52a8: \u9009\u62e9\u591a\u4e2a\u7269\u4f53</li> <li>Shift + \u5de6\u952e\u5e76\u62d6\u52a8: \u52a0\u5165\u7269\u4f53\u5230\u5f53\u524d\u5df2\u9009\u62e9\u7269\u4f53\u5217\u8868\u4e2d</li> <li>Ctrl + A: \u5168\u9009\u7269\u4f53</li> <li>\u5df2\u9009\u62e9\u67d0\u7269\u4f53\u65f6\u53f3\u952e: \u6253\u5f00\u7269\u4f53\u7684\u5c5e\u6027\u9762\u677f</li> <li>\u5df2\u9009\u62e9\u67d0\u7269\u4f53\u65f6\u5de6\u952e\u5e76\u62d6\u52a8: \u62d6\u52a8\u6240\u9009\u7269\u4f53</li> <li>Shift + \u5df2\u9009\u62e9\u67d0\u7269\u4f53\u65f6\u5de6\u952e\u5e76\u62d6\u52a8: \u8f74\u5411\u62d6\u52a8\u7269\u4f53, \u5373\u4ec5\u5141\u8bb8\u7269\u4f53\u4e0a\u4e0b\u6216\u5de6\u53f3\u79fb\u52a8</li> <li>\u5df2\u9009\u62e9\u67d0\u7269\u4f53\u65f6\u65b9\u5411\u952e: \u79fb\u52a8\u6240\u9009\u7269\u4f53</li> <li>Q, E: \u51cf\u5c0f\u5bbd\u5ea6 / \u589e\u5927\u5bbd\u5ea6</li> <li>A, D: \u51cf\u5c0f\u9ad8\u5ea6 / \u589e\u5927\u9ad8\u5ea6</li> <li>Ctrl + \u4e0a\u9762\u7684\u6309\u952e: \u4f7f\u7528 1px \u5bf9\u9f50\u800c\u4e0d\u662f 8px</li> <li>L, R: \u9006\u65f6\u9488/\u987a\u65f6\u9488 \u65cb\u8f6c\u7269\u4f53</li> <li>V, H: \u7eb5\u5411/\u6a2a\u5411 \u7ffb\u8f6c\u7269\u4f53</li> <li>Shift + V / Shift + H: \u7ad6\u76f4/\u7eb5\u5411 \u7ffb\u8f6c\u9009\u5b9a\u533a\u57df</li> <li>\u5bf9 \u5b9e\u4f53/Trigger \u6309 N: \u5411 \u5b9e\u4f53/Trigger \u52a0\u5165\u7b2c\u4e00\u4e2a\u8282\u70b9</li> <li>\u5bf9\u8282\u70b9\u6309 N: \u5728\u5df2\u9009\u62e9\u7684\u8282\u70b9\u540e\u52a0\u5165\u4e00\u4e2a\u8282\u70b9</li> <li>Delete: \u5220\u9664\u6240\u9009\u7269\u4f53</li> <li>Ctrl + C: \u590d\u5236\u7269\u4f53\u5230\u526a\u5207\u677f</li> <li>Ctrl + X: \u526a\u5207\u7269\u4f53\u5230\u526a\u5207\u677f</li> <li>Ctrl + V: \u4ece\u526a\u5207\u677f\u7c98\u8d34\u7269\u4f53</li> </ul> </li> <li>Brushes<ul> <li>\u5de6\u952e: \u653e\u7f6e tile</li> <li>\u5de6\u952e\u5e76\u62d6\u52a8: \u5237 tile</li> <li>\u4e2d\u952e: \u8bbe\u7f6e\u5f53\u524d tile \u7c7b\u578b\u4e3a\u5149\u6807\u4e0b\u7684 tile \u7c7b\u578b</li> </ul> </li> <li>Stylegrounds<ul> <li>\u65b9\u5411\u952e: \u5728\u5217\u8868\u4e2d\u5bfc\u822a</li> <li>Alt + \u65b9\u5411\u952e: \u66f4\u6539\u987a\u5e8f</li> </ul> </li> <li>Debug \u6309\u952e<ul> <li>F5: \u91cd\u8f7d\u6240\u6709\u5b9e\u4f53\u548c trigger</li> <li>F6: \u6e05\u9664\u7ed8\u56fe\u7f13\u5b58\u5e76\u91cd\u7ed8\u5730\u56fe</li> <li>F7: \u91cd\u8f7d\u5de5\u5177</li> <li>Ctrl + F5: \u91cd\u8f7d\u6574\u4e2a L\u00f6nn</li> <li>Ctrl + Shift + F5: \u91cd\u542f L\u00f6nn</li> </ul> </li> </ul>"},{"location":"extra_cmcc/cmcc/todo/#q2-loenn","title":"Q2 Loenn \u600e\u4e48\u79fb\u52a8\u623f\u95f4","text":"<p>Alt + \u65b9\u5411\u952e \u5176\u4ed6\u6309\u952e/\u5feb\u6377\u952e\u89c1 Q1 \u4e2d\u7684\u5217\u8868</p>"},{"location":"extra_cmcc/cmcc/todo/#q3-loenn","title":"Q3 Loenn \u600e\u4e48\u653e\u5b9e\u4f53","text":"<p>\u5728\u53f3\u8fb9\u7684\u83dc\u5355\u7684\u5de6\u8fb9\u4e00\u5217\u4e2d\u9009\u62e9 Placements, \u518d\u5728\u4e0b\u9762\u9009\u62e9 Entities, \u5728\u53f3\u8fb9\u9009\u62e9\u4e00\u6761\u7136\u540e\u5728\u623f\u95f4\u91cc\u5de6\u952e\u5c31\u80fd\u653e\u7f6e\u4e86. \u6b64\u5916\u5728\u53f3\u8fb9\u90a3\u4e00\u5217\u7684\u5e95\u4e0b\u6709\u4e2a\u767d\u8272\u7684\u641c\u7d22\u6846, \u53ef\u4ee5\u641c\u7d20\u7269\u4f53. \u5bf9\u4e8e\u641c\u7d22\u7279\u5b9a helper \u7684\u7269\u4f53, \u53ef\u4ee5\u5728\u524d\u9762\u52a0\u4e0a <code>@helper\u540d</code>, \u4f8b\u5982\u641c\u7d22\u91cd\u529b helper \u4e2d\u7684\u5f39\u7403\u53ef\u4ee5\u952e\u5165 <code>@gravityhelper bumper</code>, \u53ef\u4ee5\u53ea\u6253\u8bcd\u5934: <code>@gra bu</code>.</p>"},{"location":"extra_cmcc/cmcc/todo/#q4-tile","title":"Q4 \u5982\u4f55\u81ea\u5b9a\u4e49 tile","text":"<p>\u53ef\u4ee5\u53c2\u8003:</p> <ul> <li>Bilibili - \u7535\u7bb1 - \u5236\u56fe\u6559\u7a0b\u7b2c\u4e94\u7ae0 \u81ea\u5b9a\u4e49 Tiles</li> <li>Bilibili - UnderDragon - tiles \u5e94\u7528\u6559\u7a0b</li> </ul>"},{"location":"extra_luacs/begin/","title":"\u989d\u5916 - LuaCutscene","text":""},{"location":"extra_luacs/begin/#_1","title":"\u524d\u8a00","text":"<p>\u6b22\u8fce\u6765\u5230\u8fd9\u4e2a\u989d\u5916\u7ae0\u8282, \u867d\u7136\u5b83\u88ab\u6211\u6254\u5230\u4e86 code mod \u6559\u7a0b\u4e4b\u4e2d, \u4f46\u662f\u5b83\u5b9e\u9645\u4e0a\u4e0d\u9700\u8981\u592a\u591a\u7684 C# \u80fd\u529b. \u5728\u8fd9\u91cc\u4f1a\u4e3b\u8981\u5305\u542b\u4e00\u4e9b LuaCutscene \u672c\u8eab\u4ee5\u53ca\u4f7f\u7528\u5176\u8c03\u7528 C# \u4ee3\u7801\u5b9e\u73b0\u7684\u6709\u8da3\u7684\u6548\u679c, \u5982\u679c\u4f60\u60f3\u8981\u4f60\u7684\u5267\u60c5\u62e5\u6709\u66f4\u591a\u7684\u70ab\u9177\u6548\u679c, \u800c\u4e0d\u662f\u5c40\u9650\u4e8e\u53ea\u6709\u5bf9\u8bdd\u6846\u548c Madeline \u65e0\u804a\u7684\u8d70\u52a8, \u6bd4\u5982\u70ab\u9177\u7684\u955c\u5934\u7f13\u52a8, \u5468\u8fb9\u5b9e\u4f53\u7684\u82b1\u6837\u8868\u6f14, \u751a\u81f3\u662f\u62e5\u6709\u6539\u53d8 gp \u80fd\u529b\u7684\u5267\u60c5! \u90a3\u4e48\u6216\u8bb8\u8fd9\u91cc\u521a\u597d\u5c31\u9002\u5408\u4f60. \u90a3\u4e48\u73b0\u5728\u5c31\u5f00\u59cb\u5427.  </p>"},{"location":"extra_luacs/begin/#_2","title":"\u914d\u7f6e\u73af\u5883","text":"<p>\u8fd9\u4e00\u6b65\u4e8b\u5b9e\u4e0a\u662f\u53ef\u9009\u7684, \u4e0d\u8fc7\u4e3a\u4e86\u66f4\u6109\u5feb\u7684 lua \u4ee3\u7801\u7684\u4e66\u5199, \u6211\u4e2a\u4eba\u8fd8\u662f\u89c9\u5f97\u633a\u6709\u5fc5\u8981\u7684. \u5728\u8fd9\u91cc\u6211\u4f1a\u63a8\u8350\u4f7f\u7528 VSCode \u914d\u4e0a Lua (sumneko.lua) \u63d2\u4ef6. </p> <p>Note</p> <p>\u6211\u4e2a\u4eba\u4e0d\u592a\u4f1a\u914d\u7f6e\u8fd9\u79cd lua \u73af\u5883, \u6240\u4ee5\u5982\u679c\u4f60\u9047\u5230\u4e86\u5927\u91cf\u7684\u672a\u5b9a\u4e49\u8b66\u544a\u4f60\u53ef\u4ee5\u9009\u62e9\u5728\u8bbe\u7f6e\u4e2d\u641c\u7d22 <code>Lua.diagnostics.enable</code> \u5e76\u5c06\u5176\u5173\u95ed.</p>"},{"location":"extra_luacs/begin/#hello-world","title":"Hello World","text":"<p>\u90a3\u4e48, \u8001\u4f20\u7edf. \u73b0\u5728, \u5728\u4f60\u7684\u5730\u56fe\u4e2d\u653e\u7f6e\u4e00\u4e2a <code>LuaCutscene</code> \u7684 <code>LuaCutscene/LuaCutsceneTrigger</code>, \u7136\u540e\u8bbe\u7f6e\u5176 <code>Filename</code> \u53c2\u6570\u4e3a\u4e00\u4e2a lua \u6587\u4ef6\u7684\u8def\u5f84\u6bd4\u5982 <code>Luas/testlua</code>(\u6ce8\u610f\u6ca1\u6709\u540e\u7f00.lua), \u7136\u540e Save Changes. \u7136\u540e\u6211\u4eec\u6839\u636e\u521a\u624d\u8bbe\u7f6e\u7684\u8def\u5f84\u6b63\u786e\u653e\u7f6e\u6211\u4eec\u7684 lua \u6587\u4ef6:</p> <ul> <li>&lt;\u4f60\u7684 mod \u540d\u5b57&gt;<ul> <li>Luas<ul> <li>testlua.lua</li> </ul> </li> </ul> </li> </ul> <p>\u7136\u540e\u5199\u4e0a\u6211\u4eec\u7684 Hello World:</p> <pre><code>function onBegin()\n    print(\"[Cutscene] Hello from the Cutscene!\")\nend\n</code></pre> <p>\u4fdd\u5b58\u540e\u6309\u4e0b F3 \u952e\u91cd\u8f7d\u4f60\u7684\u5730\u56fe, \u7136\u540e\u8d70\u8fdb\u4f60\u6446\u653e\u7684 trigger \u5185, \u4e4b\u540e, \u68c0\u67e5\u4f60\u7684\u63a7\u5236\u53f0, \u6216\u8005\u68c0\u67e5\u4f60\u6700\u65b0\u7684 log.txt, \u4f60\u5e94\u8be5\u4f1a\u5728\u832b\u832b\u65e5\u5fd7\u6d77\u4e2d\u770b\u5230\u8fd9\u4e00\u884c\u8f93\u51fa:</p> <pre><code>(12/03/2023 10:36:35) [Everest] [Info] [LevelLoader] Loading Saplonily/FunnyButFuckingMaps/MaybeAFunnyMap\n(12/03/2023 10:36:35) [Everest] [Warn] [Content] CONFLICT in C:\\Program Files (x86)\\Steam\\steamapps\\common\\Celeste\\Mods\\MaxHelpingHand v1.28.3.zip\\Graphics\\Sprites.xml: Overriding element player_playback.\n[Cutscene] Hello from the Cutscene!\n(12/03/2023 10:36:45) [Everest] [Info] [LevelLoader] Loading Saplonily/FunnyButFuckingMaps/MaybeAFunnyMapOverriding element player_playback.\n</code></pre> <p>\u9ad8\u4eae\u884c\u4fbf\u662f\u6211\u4eec\u7684 lua \u4ee3\u7801\u6253\u5370\u51fa\u6765\u7684.</p> <p>Info</p> <p>\u5728\u4e4b\u540e\u7684\u8fc7\u7a0b\u4e2d\u867d\u7136\u4f60\u53ef\u4ee5\u53cd\u590d\u7ffb\u770b log.txt \u6765\u77e5\u6653\u4f60\u7684 lua \u4ee3\u7801\u7684\u8fd0\u884c\u60c5\u51b5, \u4e0d\u8fc7\u8fd9\u663e\u7136\u4e0d\u5982\u4f60\u6709\u4e00\u4e2a\u63a7\u5236\u53f0\u7a97\u53e3\u76f4\u63a5\u80fd\u770b\u5230\u8f93\u51fa. \u5bf9\u4e8e\u5728 windows \u4e0a, \u4f60\u53ef\u4ee5\u5411\u851a\u84dd\u6839\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6 <code>everest-launch.txt</code> \u65b0\u52a0\u5165\u4e00\u884c <code>--console</code> \u6765\u5728\u851a\u84dd\u6bcf\u6b21\u542f\u52a8\u65f6\u9644\u5e26\u4e00\u4e2a\u63a7\u5236\u53f0\u7a97\u53e3.</p>"},{"location":"extra_luacs/begin/#hello-world_1","title":"\u5bf9\u8bdd Hello World","text":"<p>\u5f53\u7136, \u5728\u63a7\u5236\u53f0\u91cc\u770b\u65e0\u804a\u7684\u65e5\u5fd7\u6253\u5370\u662f\u6ca1\u610f\u601d\u7684, \u6240\u4ee5\u73b0\u5728\u6211\u4eec\u5411\u5b83\u52a0\u5165\u51e0\u6761\u5bf9\u8bdd. \u9996\u5148\u4e3a\u4f60\u8fd9\u4e00\u6bb5\u5bf9\u8bdd\u8d77\u4e00\u6bb5\u540d\u5b57, \u6bd4\u5982 <code>TESTDIALOG_HELLO</code>, \u901a\u5e38\u6211\u4eec\u5efa\u8bae\u524d\u7f00\u662f\u4f60\u7684\u5730\u56fe\u540d\u4ee5\u9632\u547d\u540d\u51b2\u7a81, \u540e\u7f00\u4f60\u53ef\u4ee5\u6839\u636e\u4f60\u7684\u7231\u597d\u6765\u53d6, \u6bd4\u5982\u52a0\u4e0a\u5267\u60c5\u6240\u5728\u9762\u540d, \u6216\u8005\u5e72\u8106\u662f\u5267\u60c5\u7684\u81ea\u589e\u5e8f\u53f7. \u7136\u540e\u65b0\u5efa\u4e00\u4e2a <code>Simplified Chinese.txt</code>, \u4e5f\u5c31\u662f\u5bf9\u8bdd\u6587\u4ef6:</p> <ul> <li>&lt;\u4f60\u7684 mod \u540d\u5b57&gt;<ul> <li>Dialog<ul> <li>Simplified Chinese.txt</li> </ul> </li> </ul> </li> </ul> <p>\u4ee5\u53ca\u5b83\u7684\u5185\u5bb9:</p> <pre><code>TESTDIALOG_HELLO=\n    [MADELINE left normal]\n    \u6211\u662f {+MADELINE}.\n</code></pre> <p>\u7136\u540e\u66f4\u6539 lua \u4ee3\u7801:</p> <pre><code>function onBegin()\n    say(\"TESTDIALOG_HELLO\")\nend\n</code></pre> <p>\u73b0\u5728\u91cd\u8f7d\u8d44\u6e90, \u8fdb\u5165 trigger, \u4f60\u5c31\u80fd\u770b\u5230 Madeline \u5fae\u7b11\u200b\u7740\u8bf4 \"\u6211\u662f &lt;\u4f60\u7684\u5b58\u6863\u540d&gt;.\" \u4e86. \u5728\u8fd9\u91cc\u5bf9\u8bdd\u72b6\u6001\u65f6\u73a9\u5bb6\u4f9d\u7136\u80fd\u52a8, \u53ef\u4ee5\u901a\u8fc7\u5c06 lua \u4ee3\u7801\u6539\u6210\u8fd9\u6837\u6765\u5728\u5bf9\u8bdd\u8fdb\u884c\u65f6\u7981\u6b62\u79fb\u52a8:</p> <pre><code>function onBegin()\n    disableMovement()\n    say(\"TESTDIALOG_HELLO\")\n    enableMovement()\nend\n</code></pre> <p>\u5bf9\u8bdd dialog \u6587\u4ef6\u7684\u76f8\u5173\u5185\u5bb9\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u5199\u4e86, \u63a8\u8350\u53c2\u8003\u851a\u84dd\u5236\u56fe\u6559\u7a0b\u7684\u51ac\u83dc\u6559\u7a0b, \u4f60\u53ef\u4ee5\u5230\u851a\u84dd\u7684\u5236\u56fe\u7fa4 (633125440) \u4e2d\u53d6\u5f97, \u6216\u8005\u4e5f\u53ef\u4ee5\u5728\u8fd9\u4e2a\u7f51\u76d8\u94fe\u63a5\u4e2d\u53d6\u5f97.</p>"},{"location":"extra_luacs/begin/#_3","title":"\u57fa\u7840\u6982\u5ff5","text":"<p>\u76f8\u4fe1\u5728\u524d\u9762\u7684\u9605\u8bfb\u4e2d\u4f60\u80af\u5b9a\u662f\u4e00\u5934\u96fe\u6c34\u7684, \u56e0\u4e3a\u4f60\u5bf9 lua \u4ee3\u7801\u901a\u5e38\u4f9d\u7136\u662f\u4e00\u65e0\u6240\u77e5\u7684, \u90a3\u5c31\u5bf9\u4e86, \u73b0\u5728\u6211\u4eec\u5c31\u6765\u4ecb\u7ecd\u51e0\u4e2a\u7b80\u5355\u7684\u6982\u5ff5.</p>"},{"location":"extra_luacs/begin/#_4","title":"\u51fd\u6570","text":"<p>\u5728\u6211\u4eec\u521a\u521a\u7684 lua \u4ee3\u7801\u4e2d, \u6700\u5916\u56f4\u7684\u7531 <code>function</code> \u5230 <code>end</code> \u56f4\u8d77\u6765\u7684\u4e1c\u897f\u6211\u4eec\u5c31\u53eb\u4e00\u4e2a\u51fd\u6570:</p> <pre><code>function onBegin()\n    disableMovement()\n    say(\"TESTDIALOG_HELLO\")\n    enableMovement()\nend\n</code></pre> <p><code>function</code> \u548c <code>end</code> \u8fd9\u79cd\u5173\u7cfb\u5230\u4ee3\u7801\u7ed3\u6784\u7684\u4e1c\u897f\u6211\u4eec\u5c31\u53eb\u5b83 '\u5173\u952e\u5b57', <code>function</code> \u5173\u952e\u5b57\u540e\u9762\u5230\u5de6\u62ec\u53f7\u4e4b\u5185\u7684\u5185\u5bb9\u5c31\u662f\u8fd9\u4e2a\u51fd\u6570\u7684\u51fd\u6570\u540d, \u5728\u8fd9\u91cc\u5373 <code>onBegin</code>, \u5728\u8fd9\u91cc\u8fd9\u4e2a\u51fd\u6570\u540d\u662f\u7279\u6b8a\u7684, \u5b83\u4f1a\u88ab LuaCutscene \u5728\u73a9\u5bb6\u8fdb\u5165 trigger \u65f6\u4e14\u5267\u60c5\u53ef\u4ee5\u64ad\u653e\u65f6 '\u8c03\u7528'. \u62ec\u53f7\u5185\u7684\u5185\u5bb9\u6211\u4eec\u53eb\u53c2\u6570, \u8fd9\u91cc LuaCutscene \u8981\u6c42\u6211\u4eec <code>onBegin</code> \u8fd9\u4e2a\u7279\u6b8a\u51fd\u6570\u4e0d\u80fd\u5e26\u53c2\u6570\u6216\u8005\u5e26\u4e00\u4e2a\u53c2\u6570, \u8fd9\u91cc\u6211\u4eec\u6682\u65f6\u7f6e\u7a7a, \u4e5f\u5c31\u662f\u53ea\u6709\u4e00\u5bf9\u62ec\u53f7, \u4e0d\u5e26\u53c2\u6570. \u800c\u8fd9\u4e4b\u4e2d\u7684\u5185\u5bb9\u4fbf\u662f\u51fd\u6570\u7684\u5185\u5bb9\u7269, \u4e5f\u5373\u4e3b\u4f53, \u5b83\u4f1a\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c\u6211\u4eec\u7684\u4ee3\u7801.  </p> <p>\u901a\u5e38\u4e3b\u4f53\u662f\u6211\u4eec\u6240\u805a\u7126\u7684\u4e1c\u897f, \u5728\u8fd9\u91cc, \u6211\u4eec\u7684\u4e3b\u4f53\u5305\u542b\u4e09\u884c\u4ee3\u7801. \u7b2c\u4e00\u884c\u4ee3\u7801\u662f <code>disableMovement()</code>, \u4e5f\u5c31\u662f\u4e00\u4e2a\u540d\u79f0\u52a0\u4e0a\u4e00\u5bf9\u62ec\u53f7, \u5b83\u8868\u793a\u8c03\u7528\u4e00\u4e2a\u540d\u4e3a <code>disableMovement</code> \u7684\u51fd\u6570, \u5e76\u4e14\u4e0d\u5e26\u53c2\u6570, \u8fd9\u548c\u521a\u624d\u51fd\u6570\u7684\u58f0\u660e\u6709\u70b9\u76f8\u50cf, <code>disableMovement</code> \u662f\u4e00\u4e2a LuaCutscene \u4e3a\u6211\u4eec\u63d0\u524d\u51c6\u5907\u597d\u7684, \u4e5f\u5373 '\u5b9a\u4e49' \u597d\u7684\u51fd\u6570, \u5b83\u7684\u4f5c\u7528\u662f\u7981\u6b62\u73a9\u5bb6\u7684\u79fb\u52a8, \u4e0e\u4e4b\u76f8\u5bf9\u7684\u5c31\u662f <code>enableMovement</code> \u51fd\u6570, \u5b83\u4f1a\u5141\u8bb8\u73a9\u5bb6\u79fb\u52a8. \u4e2d\u95f4\u7684\u7b2c\u4e8c\u884c\u4ee3\u7801\u8c03\u7528\u4e86 <code>say</code> \u8fd9\u4e2a\u51fd\u6570, \u5b83\u8868\u793a\u64ad\u653e\u4e00\u4e2a\u5bf9\u8bdd, \u90a3\u4e48\u8fd9\u91cc\u5bf9\u8bdd\u540d\u5c31\u9700\u8981\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u4e86, \u6240\u4ee5\u6211\u4eec\u5728\u62ec\u53f7\u4e2d\u5199\u5165\u521a\u624d\u6211\u4eec\u7684\u5bf9\u8bdd\u540d <code>TESTDIALOG_HELLO</code>, \u8bb0\u4f4f\u8981\u5e26\u53cc\u5f15\u53f7, \u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a '\u5b57\u7b26\u4e32'.  </p> <p>Info</p> <p><code>disableMovement</code> \u4e0e <code>enableMovement</code> \u51fd\u6570\u90fd\u662f\u77ac\u95f4\u6267\u884c\u5b8c\u6bd5\u7684, \u51fd\u6570\u4f1a\u9a6c\u4e0a\u7ee7\u7eed\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801, \u800c <code>say</code> \u51fd\u6570\u8c03\u7528\u540e\u76f4\u5230\u73a9\u5bb6\u770b\u5b8c\u5bf9\u8bdd\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801. \u5bf9\u4e8e\u540e\u8005\u6211\u4eec\u7279\u522b\u5730\u79f0\u4e3a <code>\u534f\u7a0b\u51fd\u6570</code>.</p>"},{"location":"extra_luacs/begin/#if","title":"\u53d8\u91cf, \u8fd4\u56de\u503c, if","text":"<p>\u73b0\u5728, \u6211\u4eec\u89c2\u5bdf\u4e0b\u9762\u4ee3\u7801:</p> <pre><code>function onBegin()\n    local hasFlag = getFlag(\"MY_AWESOME_FLAG\")\n    if hasFlag then\n        disableMovement()\n        say(\"TESTDIALOG_HELLO\")\n        enableMovement()\n    end\nend\n</code></pre> <p>\u5728\u51fd\u6570\u5f00\u5934\u6211\u4eec\u4f7f\u7528\u4e86 <code>local a = b()</code> \u8fd9\u79cd\u8bed\u6cd5, \u5f00\u5934\u7684 <code>local</code> \u5173\u952e\u5b57\u8868\u793a\u6211\u4eec\u8981\u58f0\u660e\u4e00\u4e2a\u53d8\u91cf, \u7d27\u8ddf\u7684 <code>hasFlag</code> \u8868\u793a\u8fd9\u4e2a\u53d8\u91cf\u7684\u540d\u79f0, \u968f\u540e\u518d\u6b21\u8ddf\u4e0a\u4e00\u4e2a <code>=</code> \u53f7, \u8fd9\u8868\u793a\u6211\u4eec\u60f3\u4ee5 <code>=</code> \u53f7\u540e\u8fb9\u7684\u503c\u4f5c\u4e3a\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c, \u5728\u8fd9\u91cc\u5b83\u662f <code>getFlag</code> \u8fd9\u4e2a\u9884\u5148\u5b9a\u4e49\u7684\u51fd\u6570\u7684\u8fd4\u56de\u503c, \u51fd\u6570\u901a\u5e38\u7528\u4e8e\u505a\u4e00\u4e9b\u4e8b\u60c5, \u800c\u5b83\u7684\u8fd4\u56de\u503c\u5c31\u8868\u793a\u8fd9\u4ef6\u4e8b\u505a\u7684\u5982\u4f55, \u5728\u8fd9\u91cc <code>getFlag</code> \u51fd\u6570\u7528\u4e8e\u68c0\u6d4b\u5b83\u7684\u53c2\u6570\u6307\u4ee3\u7684\u90a3\u4e2a flag \u662f\u5426\u5b58\u5728, \u5f53\u68c0\u6d4b\u5230 flag \u5b58\u5728\u65f6\u5b83\u4f1a\u8fd4\u56de <code>true</code>, \u5426\u4e4b\u5219\u8fd4\u56de <code>false</code>. \u8fd9\u91cc\u8fd9\u4e2a\u8fd4\u56de\u503c\u7684 '\u7c7b\u578b' \u662f <code>bool</code>, \u5b83\u53ea\u6709\u521a\u624d\u63d0\u5230\u7684\u4e24\u4e2a\u503c, \u6240\u4ee5\u540c\u6837\u5730 <code>hasFlag</code> \u8fd9\u4e2a\u53d8\u91cf\u7684\u7c7b\u578b\u662f <code>bool</code>.  </p> <p>\u5f53\u6211\u4eec\u4ece <code>getFlag</code> \u5f97\u5230\u4e86\u5bf9\u5e94 flag \u662f\u5426\u5b58\u5728\u7684\u4fe1\u606f\u540e, \u6211\u4eec\u4f7f\u7528 if \u8bed\u53e5\u6765\u68c0\u6d4b\u5b83, \u9996\u5148\u6211\u4eec\u4ee5 <code>if</code> \u5f00\u5934, \u7136\u540e\u7d27\u8ddf\u4e00\u4e2a <code>bool</code> \u7c7b\u578b\u7684\u503c, \u4e5f\u5c31\u662f\u8fd9\u91cc\u7684 <code>hasFlag</code> \u53d8\u91cf, \u7136\u540e\u518d\u8ddf\u4e0a\u4e00\u4e2a <code>then</code> \u5173\u952e\u5b57, \u968f\u540e\u518d\u6b21\u8ddf\u4e0a\u4e00\u5c0f\u6bb5\u4ee3\u7801, \u968f\u540e\u4ee5 <code>end</code> \u7ed3\u675f, \u8fd9\u91cc\u7684\u610f\u601d\u5c31\u662f\u6211\u4eec\u5e0c\u671b <code>then</code> \u5230 <code>end</code> \u6240\u5305\u56f4\u8d77\u6765 '\u4ee3\u7801\u5757' \u4ec5\u5728 <code>hasFlag</code> \u4e3a <code>true</code>, \u4e5f\u5373 <code>getFlag</code> \u8fd4\u56de <code>true</code>, \u4e5f\u5373 flag <code>MY_AWESOME_FLAG</code> \u5b58\u5728\u65f6\u6267\u884c. \u73b0\u5728\u4f60\u53ef\u4ee5\u8bd5\u8bd5\u590d\u5236\u4e0a\u8ff0\u7684\u4ee3\u7801, \u7136\u540e\u5728\u4f60\u7684\u5730\u56fe\u4e2d\u653e\u7f6e\u4e24\u4e2a flag Trigger, \u4e00\u4e2a\u5f00\u542f <code>MY_AWESOME_FLAG</code> \u8fd9\u4e2a flag, \u4e00\u4e2a\u5173\u95ed flag, \u7136\u540e\u5206\u522b\u5c1d\u8bd5\u8d70\u8fdb\u5267\u60c5 trigger, \u4f60\u5f88\u5bb9\u6613\u4f1a\u53d1\u73b0\u4ec5\u5728 <code>MY_AWESOME_FLAG</code> flag \u5f00\u542f\u65f6\u5267\u60c5\u624d\u4f1a\u88ab\u64ad\u653e, \u4e5f\u5c31\u662f\u64ad\u653e\u5267\u60c5\u7684\u90a3\u4e09\u884c\u4ee3\u7801\u624d\u4f1a\u88ab\u6267\u884c.  </p> <p>\u5b9e\u9645\u4e0a\u65e2\u7136 <code>if</code> \u5230 <code>then</code> \u4e4b\u95f4\u53ea\u9700\u8981\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>bool</code> \u7684\u503c, \u90a3\u4e48\u8fd9\u91cc\u5176\u5b9e\u4e0d\u9700\u8981 <code>hasFlag</code> \u8fd9\u4e2a\u53d8\u91cf\u4f5c\u4e3a\u8fc7\u6e21:</p> <pre><code>function onBegin()\n    if getFlag(\"MY_AWESOME_FLAG\") then\n        disableMovement()\n        say(\"TESTDIALOG_HELLO\")\n        enableMovement()\n    end\nend\n</code></pre> <p>\u8fd9\u884c\u4ee3\u7801\u4e0e\u4e0a\u9762\u662f\u7b49\u6548\u7684.  </p> <p>\u901a\u5e38\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b flag \u62e5\u6709\u60c5\u51b5\u4e0d\u4e00\u7684\u65f6\u5019\u64ad\u653e\u4e0d\u540c\u7684\u5267\u60c5, \u6bd4\u5982\u4e0a\u9762\u62e5\u6709 <code>MY_AWESOME_FLAG</code> flag \u65f6\u64ad\u653e\u5267\u60c5 A, \u800c\u6ca1\u6709\u65f6\u64ad\u653e\u5267\u60c5 B. \u9996\u5148\u6211\u4eec\u5148\u66f4\u65b0\u6211\u4eec\u7684\u5bf9\u8bdd\u6587\u4ef6:</p> <pre><code>TESTDIALOG_HELLO=\n    [MADELINE left normal]\n    \u62e5\u6709 flag\n\nTESTDIALOG_HELLO_NOFLAG=\n    [MADELINE left normal]\n    \u6ca1\u6709 flag\n</code></pre> <p>\u7136\u540e\u66f4\u65b0 lua \u4ee3\u7801:</p> <pre><code>function onBegin()\n    if getFlag(\"MY_AWESOME_FLAG\") then\n        disableMovement()\n        say(\"TESTDIALOG_HELLO\")\n        enableMovement()\n    else\n        disableMovement()\n        say(\"TESTDIALOG_HELLO_NOFLAG\")\n        enableMovement()\n    end\nend\n</code></pre> <p>\u73b0\u5728\u5728\u6e38\u620f\u4e2d\u5c1d\u8bd5\u4e00\u4e0b, \u7b26\u5408\u6211\u4eec\u7684\u671f\u671b: \u6ca1\u6709 flag \u65f6\u64ad\u653e <code>TESTDIALOG_HELLO_NOFLAG</code> \u8fd9\u4e2a\u5bf9\u8bdd, \u62e5\u6709 flag \u65f6\u64ad\u653e <code>TESTDIALOG_HELLO</code> \u8fd9\u4e2a\u5bf9\u8bdd.  </p> <p>\u89c2\u5bdf\u4e0a\u8ff0\u4ee3\u7801, \u6211\u4eec\u53d1\u73b0\u7981\u6b62\u548c\u5141\u8bb8\u79fb\u52a8\u7684\u90a3\u4e00\u5bf9\u51fd\u6570\u8c03\u7528\u6ca1\u5fc5\u8981\u91cd\u590d\u4e24\u904d\u5199\u5728 if \u91cc, \u56e0\u4e3a\u65e0\u8bba if \u7684\u6761\u4ef6\u662f\u5426\u6210\u7acb\u5b83\u4eec\u90fd\u662f\u5148\u7981\u6b62\u79fb\u52a8, \u7136\u540e\u518d\u5141\u8bb8\u79fb\u52a8, \u6240\u4ee5\u6211\u4eec\u5c06\u90a3\u4e00\u5bf9\u4ee3\u7801\u62bd\u79bb\u5e76\u653e\u7f6e\u5728\u6700\u4e0a\u4e0b:</p> <pre><code>function onBegin()\n    disableMovement()\n    if getFlag(\"MY_AWESOME_FLAG\") then\n        say(\"TESTDIALOG_HELLO\")\n    else\n        say(\"TESTDIALOG_HELLO_NOFLAG\")\n    end\n    enableMovement()\nend\n</code></pre> <p>\u5f53\u7136, \u6548\u679c\u662f\u4e00\u6837\u7684, \u4f46\u662f\u6211\u4eec\u7684\u4ee3\u7801\u7b80\u6d01\u4e86\u4e0d\u5c11.</p>"},{"location":"extra_luacs/begin/#_5","title":"\u66f4\u591a\u51fd\u6570","text":"<p>\u73b0\u5728, \u56de\u5fc6\u4e00\u4e0b\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u5230\u4e86\u54ea\u4e9b\u51fd\u6570:</p> <ul> <li>\u4e00\u4e2a\u6700\u4e0a\u9762\u4f7f\u7528\u8fc7\u7684\u51fd\u6570 <code>print</code>, \u4f5c\u7528\u4e3a\u5c06\u5b83\u7684\u53c2\u6570\u5185\u5bb9\u8f93\u51fa\u51fa\u6765</li> <li><code>disableMovement</code>, \u6ca1\u6709\u53c2\u6570, \u4f5c\u7528\u4e3a\u7981\u6b62\u73a9\u5bb6\u7684\u79fb\u52a8</li> <li><code>enableMovement</code>, \u6ca1\u6709\u53c2\u6570, \u4f5c\u7528\u4e3a\u5141\u8bb8\u73a9\u5bb6\u7684\u79fb\u52a8</li> <li><code>say</code>, \u4f5c\u7528\u4e3a\u64ad\u653e\u53c2\u6570\u6240\u6307\u7684\u5bf9\u8bdd</li> <li><code>getFlag</code>, \u4f5c\u7528\u4e3a\u68c0\u6d4b\u53c2\u6570\u6240\u6307\u7684 flag \u662f\u5426\u5b58\u5728, \u5e76\u4e14\u8fd4\u56de\u8be5\u503c</li> </ul> <p>\u5f53\u7136, \u51fd\u6570\u7684\u53c2\u6570\u4e0d\u53ef\u80fd\u53ea\u6709\u4e00\u4e2a, \u6bd4\u5982 <code>cassetteFly</code> \u51fd\u6570:</p> <pre><code>function onBegin()\n    disableMovement()\n    cassetteFly(-100, -100)\n    -- cassetteFly \u8c03\u7528\u5b8c\u540e\u5e76\u4e0d\u4f1a\u7b49\u5f85...\n    enableMovement()\nend\n</code></pre> <p>Info</p> <p>-- \u5e76\u52a0\u4e0a\u7a7a\u683c\u8d77\u5934\u7684\u4e00\u884c\u8868\u793a\u4e00\u884c\u6ce8\u91ca, \u5f53\u4ee3\u7801\u6267\u884c\u5230\u8fd9\u65f6\u4f1a\u76f4\u63a5\u5ffd\u7565\u8fd9\u4e00\u884c, \u6b64\u5916\u8fd8\u6709\u5757\u6ce8\u91ca, \u5373\u5ffd\u7565\u5757\u6240\u5305\u56f4\u7684\u4e00\u6574\u5757\u4ee3\u7801: <pre><code>function onBegin()\n    --[[\n        \u5728\u8fd9\u91cc\n        \u5199\n        \u4efb\u610f\n        \u591a\n        \u7684\u6ce8\u91ca!\n    ]]--\n    say(\"SOMETHING_INTERESTING\")\nend\n</code></pre></p> <p><code>cassetteFly</code> \u51fd\u6570\u4f5c\u7528\u4e3a\u4e58\u5750\u6ce1\u6ce1\u98de\u884c\u4e00\u6bb5\u8ddd\u79bb(\u6536\u96c6\u78c1\u5e26\u540e\u7684\u52a8\u4f5c), \u5b83\u9700\u8981\u63a5\u6536\u4e24\u4e2a\u53c2\u6570, \u5b83\u4eec\u5747\u4e3a <code>number</code> \u7c7b\u578b, \u8868\u793a\u4e00\u4e2a\u6570\u5b57, \u591a\u4e2a\u53c2\u6570\u4e4b\u95f4\u4f7f\u7528 <code>,</code> \u9017\u53f7\u5206\u9694\u5f00\u6765, \u6ce8\u610f\u8fd9\u91cc\u53c2\u6570\u7c7b\u578b\u662f\u6570\u5b57, \u6240\u4ee5\u4e0d\u9700\u8981\u52a0\u4e0a\u53cc\u5f15\u53f7\u8868\u793a\u4e3a\u5b57\u7b26\u4e32. \u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u6a2a\u5411\u7684\u76f8\u5bf9\u98de\u884c\u8ddd\u79bb, \u5355\u4f4d px, \u6b63\u503c\u5411\u53f3, \u8d1f\u503c\u5411\u5de6, \u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u7eb5\u5411\u7684\u76f8\u5bf9\u98de\u884c\u8ddd\u79bb, \u6b63\u503c\u5411\u4e0b, \u8d1f\u503c\u5411\u4e0a.  </p> <p>\u4e0d\u8fc7\u4e0d\u592a\u597d\u7684\u662f <code>cassetteFly</code> \u4e0d\u662f\u534f\u7a0b\u51fd\u6570, \u8fd9\u4f1a\u9020\u6210\u8c03\u7528\u4e86\u8be5\u51fd\u6570\u540e\u9a6c\u4e0a\u8c03\u7528 <code>enableMovement</code> \u51fd\u6570, \u8fd9\u4f1a\u6253\u65ad\u6ce1\u6ce1\u98de\u884c\u7684\u8fc7\u7a0b, \u6240\u4ee5\u6211\u4eec\u5148\u6682\u65f6\u5220\u6389 <code>enableMovement</code> \u7684\u8c03\u7528, \u4e0d\u8fc7\u4e0d\u8981\u62c5\u5fc3, \u6ce1\u6ce1\u98de\u884c\u7ed3\u675f\u540e\u4f1a\u81ea\u52a8\u5e2e\u6211\u4eec\u5141\u8bb8\u79fb\u52a8:</p> <pre><code>function onBegin()\n    disableMovement()\n    cassetteFly(-100, -100)\nend\n</code></pre> <p>\u7136\u540e\u5230\u6e38\u620f\u4e2d\u89c2\u5bdf\u8fd9\u4e2a\u6ce1\u6ce1\u98de\u884c\u8fdb\u884c\u6240\u9700\u7684\u5927\u6982\u65f6\u95f4, \u53d1\u73b0\u5927\u6982\u662f 1.5 \u79d2, \u6240\u4ee5\u6211\u4eec\u5728\u6ce1\u6ce1\u98de\u884c\u7684\u8c03\u7528\u540e\u9762\u7d27\u8ddf\u4e00\u4e2a <code>wait</code> \u7684\u8c03\u7528:</p> <pre><code>function onBegin()\n    disableMovement()\n    cassetteFly(-100, -100)\n    wait(1.5)\nend\n</code></pre> <p>\u987a\u4fbf, \u6ce1\u6ce1\u98de\u884c\u7ed3\u675f\u540e\u4f1a\u81ea\u52a8\u5141\u8bb8\u79fb\u52a8, \u6240\u4ee5\u6211\u4eec\u8fd8\u5f97\u518d\u6b21\u7981\u6389\u79fb\u52a8:</p> <pre><code>function onBegin()\n    disableMovement()\n    cassetteFly(-100, -100)\n    wait(1.5)\n    disableMovement()\nend\n</code></pre> <p>\u4ee5\u53ca, \u6211\u4eec\u8fd8\u5e0c\u671b\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e4b\u540e\u518d\u64ad\u653e\u4e00\u6bb5\u5bf9\u8bdd:</p> <pre><code>function onBegin()\n    disableMovement()\n    cassetteFly(-100, -100)\n    wait(1.5)\n    disableMovement()\n    say(\"TESTDIALOG_FLY\")\nend\n</code></pre> <p>\u8fd9\u662f\u5bf9\u5e94\u7684 dialog:</p> <pre><code>TESTDIALOG_FLY=\n    [MADELINE left normal]\n    \u563f\u6211\u521a\u624d\u5b8c\u6210\u4e86\u4e00\u6b21\u6ce1\u6ce1\u98de\u884c\u54ce\n</code></pre> <p>\u987a\u4fbf\u4e0d\u8981\u5fd8\u4e86\u518d\u5141\u8bb8\u79fb\u52a8:</p> <pre><code>function onBegin()\n    disableMovement()\n    cassetteFly(-100, -100)\n    wait(1.5)\n    disableMovement()\n    say(\"TESTDIALOG_FLY\")\n    enableMovement()\nend\n</code></pre> <p>\u73b0\u5728\u5728\u6e38\u620f\u91cc\u8bd5\u4e00\u4e0b, \u662f\u4e0d\u662f\u5148\u5411\u5de6\u4e0a\u89d2\u8fdb\u884c\u4e00\u4e2a (-100, -100) \u7684\u6ce1\u6ce1\u98de\u884c, \u7136\u540e\u8fc7\u4e86 1.5 \u79d2\u540e\u51c6\u65f6\u64ad\u653e <code>TESTDIALOG_FLY</code> \u8fd9\u4e2a\u5bf9\u8bdd, \u7136\u540e\u4ec5\u5728\u5bf9\u8bdd\u7ed3\u675f\u540e\u624d\u80fd\u79fb\u52a8?</p> <p>\u9664\u4e86\u4f7f\u7528 flag trigger \u8bbe\u7f6e flag \u4ee5\u5916, \u8fd8\u53ef\u4ee5\u5728 lua \u4e2d\u8bbe\u7f6e flag:</p> <pre><code>function onBegin()\n    setFlag(\"FLAG_FROM_LUA\", true)\nend\n</code></pre> <p><code>setFlag</code> \u51fd\u6570\u63a5\u6536\u4e24\u4e2a\u53c2\u6570, \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a string \u7c7b\u578b, \u6307\u4ee3\u4e00\u4e2a flag, \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a bool \u7c7b\u578b, \u8868\u793a\u8981\u8bbe\u7f6e\u4e3a\u5f00\u542f\u8fd8\u662f\u5173\u95ed. \u90a3\u4e48\u663e\u800c\u6613\u89c1, \u6548\u679c\u5c31\u662f\u7ecf\u8fc7\u8fd9\u4e2a \"\u5267\u60c5\" trigger \u65f6 <code>FLAG_FROM_LUA</code> \u8fd9\u4e2a flag \u4f1a\u88ab\u5f00\u542f. \u4f60\u53ef\u4ee5\u627e\u4e00\u4e9b\u5176\u4ed6\u7684 flag \u9a71\u52a8\u7684\u5b9e\u4f53\u6765\u9a8c\u8bc1\u4e00\u4e0b.  </p> <p>\u987a\u4fbf\u6211\u4eec\u8fd8\u53ef\u4ee5\u505a\u4e00\u4e2a\u6709\u8da3\u7684\u6548\u679c, \u7ecf\u8fc7 trigger \u65f6\u53cd\u8f6c\u5f00\u542f\u72b6\u6001:</p> <pre><code>function onBegin()\n    setFlag(\"FLAG_FROM_LUA\", not getFlag(\"FLAG_FROM_LUA\"))\nend\n</code></pre> <p><code>getFlag</code> \u8fd4\u56de\u4e86\u4e00\u4e2a bool \u7c7b\u578b\u7684\u503c, \u7136\u540e\u6211\u4eec\u5728\u8fd9\u4e2a\u503c, \u5728\u8fd9\u91cc\u662f\u51fd\u6570\u8c03\u7528\u7684\u8fd4\u56de\u503c\u5de6\u4fa7\u5199\u4e00\u4e2a not, \u5b83\u8868\u793a\u7ffb\u8f6c bool \u7684\u503c, \u5373 true -&gt; false, false -&gt; true, \u90a3\u4e48\u5728\u8fd9\u91cc\u5c31\u662f\u6bcf\u6b21\u89e6\u53d1 trigger \u65f6 <code>FLAG_FROM_LUA</code> \u7684\u5f00\u542f\u72b6\u6001\u88ab\u53cd\u8f6c.  </p>"},{"location":"extra_luacs/begin/#_6","title":"\u903b\u8f91\u8fd0\u7b97\u7b26","text":"<p>\u5bf9\u4e8e\u8fd9\u4e9b lua \u901a\u7528\u5185\u5bb9\u5c31\u76f4\u63a5\u4e22\u4e2a w3c \u7684\u94fe\u63a5\u4e86: Lua \u8fd0\u7b97\u7b26 w3cschool - https://www.w3cschool.cn/...</p> <p>\u8fd0\u7528\u4e0a\u9762\u7684\u77e5\u8bc6\u4f60\u53ef\u4ee5\u5199\u4e00\u4e2a if \u4f7f\u5f97\u4ec5\u5728\u4e24\u4e2a flag \u540c\u65f6\u6210\u7acb\u65f6\u624d\u6267\u884c\u5185\u90e8\u7684\u4ee3\u7801:</p> <pre><code>function onBegin()\n    local flagA = getFlag(\"MY_FLAG_A\")\n    local flagB = getFlag(\"MY_FLAG_B\")\n\n    if flagA and flagB then\n        print(\"\u540c\u65f6\u6210\u7acb!\")\n    end\nend\n</code></pre>"},{"location":"extra_luacs/begin/#_7","title":"\u5176\u4ed6\u7279\u6b8a\u51fd\u6570","text":"<p>\u9664\u4e86\u4e0a\u6587\u63d0\u5230\u7684 <code>onBegin</code> \u8fd9\u4e2a\u7279\u6b8a\u51fd\u6570\u5916, \u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u7ecf\u5e38\u7528\u5230\u7684 <code>onEnd</code> \u51fd\u6570, \u987e\u540d\u601d\u4e49, \u5c31\u662f\u5267\u60c5\u7ed3\u675f\u65f6\u88ab\u8c03\u7528\u7684\u51fd\u6570, \u5b83\u901a\u5e38\u4f1a\u5e26\u4e24\u4e2a\u53c2\u6570:</p> <pre><code>function onEnd(room, wasSkipped)\n    -- \u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c...\nend\n</code></pre> <p>\u901a\u5e38\u6211\u4eec\u53ea\u4f1a\u5728 <code>onEnd</code> \u8c03\u7528\u4e2d\u505a\u6e05\u7406\u5de5\u4f5c, \u6bd4\u5982\u8bf4\u5220\u6389\u5267\u60c5\u4e2d\u51fa\u73b0\u7684\u989d\u5916\u5b9e\u4f53, \u8bbe\u7f6e\u73a9\u5bb6\u7684\u4f4d\u7f6e\u5230\u6700\u7ec8\u4f4d\u7f6e\u7b49\u7b49, \u6ce8\u610f\u7684\u662f, \u8df3\u8fc7\u5267\u60c5\u8fd9\u4e2a\u52a8\u4f5c\u5b9e\u9645\u4e0a\u4f1a\u76f4\u63a5\u6253\u65ad <code>onBegin</code> \u7684\u6267\u884c, \u5e76\u4e14\u4e5f\u4f1a\u8c03\u7528 <code>onEnd</code>, \u8fd9\u4e2a\u6253\u65ad\u4f4d\u7f6e\u662f\u4e0d\u53ef\u9884\u77e5. \u5176\u4e2d\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f <code>Level</code> \u7c7b\u578b\u7684\u503c, \u5b83\u662f\u4e00\u4e2a\u851a\u84dd\u4ee3\u7801\u4e2d\u7684\u7c7b\u578b, \u8fd9\u91cc\u6211\u4eec\u6682\u65f6\u5ffd\u7565, \u6765\u5173\u6ce8\u7b2c\u4e8c\u4e2a\u53c2\u6570, \u5b83\u662f\u4e00\u4e2a <code>bool</code> \u7c7b\u578b\u7684\u503c, \u5b83\u8868\u793a\u8fd9\u4e2a\u5267\u60c5\u662f\u81ea\u7136\u7ed3\u675f\u7684\u8fd8\u662f\u88ab\u8df3\u8fc7\u7684, \u6bd4\u5982\u5728\u4e00\u4e9b\u79fb\u52a8\u8f83\u591a\u7684\u5267\u60c5\u4e2d<sub>~(\u591a\u52a8\u75c7)</sub>~, \u5176 <code>onEnd</code> \u5c31\u4f1a\u901a\u5e38\u662f\u8bbe\u7f6e\u73a9\u5bb6\u7684\u4f4d\u7f6e\u5230\u6700\u7ec8\u4f4d\u7f6e, \u987a\u5e26\u4e00\u63d0, \u5b98\u56fe\u4e2d\u6709\u4e9b\u5267\u60c5\u7684\u4f4d\u7f6e\u8bbe\u7f6e\u53ea\u8bbe\u7f6e\u4e86\u6a2a\u5750\u6807, \u6240\u4ee5\u6bd4\u5982 5a \u8fdb\u5165\u5185\u90e8\u90a3\u6bb5\u8def\u7684\u5728\u534a\u7a7a\u4e2d\u8df3\u8fc7\u5267\u60c5\u6765\u76f4\u63a5\u6a2a\u5411\u79fb\u52a8\u5230\u6309\u94ae\u4e0a\u7684\u901f\u901a\u6280\u5de7\u624d\u5f97\u4ee5\u5b9e\u73b0.  </p> <p>\u6ce8\u610f\u7684\u662f, <code>onEnd</code> \u51fd\u6570\u4e2d\u4e0d\u80fd\u4f7f\u7528\u534f\u7a0b\u51fd\u6570, \u5982\u679c\u4f60\u8fd9\u4e48\u505a\u4e86\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a <code>attempt to yield from outside a coroutine</code> \u7684\u62a5\u9519, \u8fd9\u662f\u56e0\u4e3a <code>onBegin</code> \u51fd\u6570\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u534f\u7a0b\u51fd\u6570, \u8fd9\u624d\u5141\u8bb8\u4f60\u5728\u5185\u90e8\u4f7f\u7528\u534f\u7a0b\u51fd\u6570.</p>"},{"location":"extra_luacs/begin/#_8","title":"\u5176\u4ed6\u51fd\u6570","text":"<p>\u9664\u4e86\u4e0a\u8ff0\u63d0\u5230\u7684 <code>say</code>, <code>getFlag</code>, <code>setFlag</code> \u7b49\u5916, \u8fd8\u6709\u975e\u5e38\u591a\u9884\u5148\u5b9a\u4e49\u597d\u7684\u51fd\u6570, \u4f60\u53ef\u4ee5\u5728\u4e0b\u9762\u8fd9\u4e2a\u94fe\u63a5\u4e2d\u627e\u5230: Lua Cutscenes Documentaion - https://maddie480.ovh/... </p> <p>\u5728\u4e0a\u9762\u8fd9\u4e2a\u6587\u6863\u4e2d\u6bd4\u5982\u8fd9\u4e2a\u51fd\u6570:</p> Function Description helpers.die([direction={0, 0}[, evenIfInvincible=false[, registerDeathInStats=true]]]) Kills the player. <p>\u5176\u4e2d <code>helpers.die</code> \u8bf4\u660e\u8fd9\u4e2a\u51fd\u6570\u540d\u662f die, \u540e\u9762\u5706\u62ec\u53f7\u56f4\u8d77\u6765\u7684\u8868\u793a\u5b83\u7684\u53c2\u6570, \u4e00\u5c42\u5c42\u4e2d\u62ec\u53f7\u56f4\u8d77\u6765\u7684\u8868\u793a\u53ef\u9009\u53c2\u6570, \u53c2\u6570\u540d\u540e\u9762\u52a0\u7b49\u4e8e\u53f7\u8868\u793a\u8be5\u53ef\u9009\u53c2\u6570\u7684\u9ed8\u8ba4\u503c, \u6bd4\u5982\u4e0a\u8ff0\u51fd\u6570\u7684\u8c03\u7528\u53ef\u4ee5\u6709:</p> \u8c03\u7528\u65b9\u5f0f \u7b49\u6548\u8c03\u7528\u65b9\u5f0f die() die(vector2(0, 0), false, true) die(vector2(1, 1)) die(vector2(1, 1), false, true) die(vector2(1, 1), true) die(vector2(1, 1), true, true) die(vector2(1, 1), true, false) die(vector2(1, 1), true, false) <p>\u987a\u4fbf, \u5176\u4e2d\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u662f\u4e2a <code>Vector2</code>, \u8868\u793a\u4e00\u4e2a\u4e8c\u7ef4\u5411\u91cf, \u8fd9\u79cd\u7c7b\u578b\u7684\u503c\u4f60\u53ef\u4ee5\u8c03\u7528 <code>vector2(1, 1)</code> \u51fd\u6570\u6765\u4ece\u8fd4\u56de\u503c\u5f97\u5230, \u987e\u540d\u601d\u4e49\u5b83\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f x \u5750\u6807, y \u5750\u6807. \u8fd9\u91cc\u5b83\u7684\u542b\u4e49\u662f\u73a9\u5bb6\u6b7b\u4ea1\u65f6\u7684\u7279\u6548\u65b9\u5411.</p>"},{"location":"extra_luacs/begin/#_9","title":"\u6700\u540e","text":"<p>\u76f8\u4fe1\u5230\u8fd9\u91cc\u4f60\u5df2\u7ecf\u4f53\u4f1a\u5230\u4e86 luacutscene, \u6216\u8005\u8bf4\u6e38\u620f\u4e2d\u5185\u5d4c lua \u4ee3\u7801\u7684\u5f3a\u5927. \u5728\u4e4b\u540e\u7684\u6587\u7ae0\u4e2d\u5c31\u4e0d\u518d\u4f1a\u63d0\u53ca\u4e0e lua \u76f8\u5173\u7684\u95ee\u9898\u4e86, \u6240\u4ee5\u5728\u4e4b\u540e\u67e5\u627e\u5916\u90e8\u7684 lua \u6559\u7a0b\u662f\u5fc5\u8981\u7684, \u6bd4\u5982 w3cschool \u7684 lua \u6559\u7a0b.</p>"},{"location":"extra_luacs/cs_access/","title":"C# \u4ea4\u4e92","text":"<p>\u4ece\u8fd9\u4e00\u5c0f\u8282\u5f00\u59cb\u5c31\u9700\u8981\u4f7f\u7528\u4e00\u5c0f\u4e9b C# \u77e5\u8bc6\u4e86, \u4e0d\u8fc7\u4e0d\u9700\u8981\u592a\u591a, \u4f60\u53ea\u9700\u8981\u80fd\u770b\u61c2 C# \u4fa7\u7684\u51fd\u6570, \u5b57\u6bb5, \u5c5e\u6027\u7b49\u7684\u5b9a\u4e49\u5c31\u884c.  </p>"},{"location":"extra_luacs/cs_access/#c_1","title":"\u5f15\u5165 C# \u7c7b","text":"<p>\u8981\u5f15\u7528\u4e00\u4e2a C# \u7c7b, \u9996\u5148\u9700\u8981\u5728\u6587\u4ef6\u9876\u90e8\u4f7f\u7528 require \u51fd\u6570:</p> <pre><code>local celeste = require(\"#Celeste.Celeste\")\n\nfunction onBegin()\n    -- ...\nend\n</code></pre> <p>\u53c2\u6570\u9700\u8981\u4ee5 \"#&lt;\u5b8c\u6574\u7c7b\u540d&gt;\" \u683c\u5f0f\u4f20\u5165, \u6bd4\u5982\u4e0a\u8ff0\u4ee3\u7801\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a C# \u7c7b <code>Celeste</code>, \u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u6765\u8c03\u7528\u4e00\u4e0b\u4ea7\u751f\u51bb\u7ed3\u5e27\u7684\u9759\u6001\u65b9\u6cd5:</p> <pre><code>local celeste = require(\"#Celeste.Celeste\")\n\nfunction onBegin()\n    celeste.Freeze(0.5)\nend\n</code></pre> <p>\u5c31\u50cf\u4f60\u5728 C# \u4e2d\u6240\u505a\u7684\u4e00\u6837, \u4e0d\u8fc7\u8fd9\u91cc\u4f7f\u7528\u4e0a\u9762\u83b7\u53d6\u5230\u7684 <code>celeste</code> \u4f5c\u4e3a\u4f60\u5728 C# \u4e2d\u4e66\u5199\u7684\u7c7b\u540d. \u4e0a\u8ff0\u4ee3\u7801\u5e94\u8be5\u4f1a\u5bfc\u81f4\u4f60\u8fdb\u5165 trigger \u65f6\u51bb\u7ed3 0.5 \u79d2.</p>"},{"location":"extra_luacs/cs_access/#_1","title":"\u65b9\u6cd5\u8c03\u7528, \u5b57\u6bb5, \u5c5e\u6027\u8bbf\u95ee","text":"<p>\u901a\u5e38, \u5982\u679c\u4f60\u9700\u8981\u8bbf\u95ee C# \u4ee3\u7801\u5bf9\u73a9\u5bb6\u505a\u4e00\u4e9b\u6709\u8da3\u7684\u53d8\u52a8, \u83b7\u53d6\u73a9\u5bb6\u7c7b\u7684\u5b9e\u4f8b\u4ee5\u53ca\u5728\u5b9e\u4f8b\u4e0a\u8c03\u7528\u65b9\u6cd5\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684.  </p> <p>\u5728 LuaCutscene \u4e2d\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u9884\u5b9a\u4e49\u548c\u8d4b\u503c\u7684 <code>player</code> \u5168\u5c40\u53d8\u91cf, \u4e5f\u5c31\u662f\u5728\u4efb\u4f55\u65b9\u6cd5\u5185\u90fd\u80fd\u4f7f\u7528\u7684\u53d8\u91cf, \u4f8b\u5982, \u5728\u8fdb\u5165 trigger \u65f6\u5c06\u73a9\u5bb6\u7684\u51b2\u523a\u8bbe\u4e3a 2:</p> <pre><code>function onBegin()\n    player.Dashes = 2\nend\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u8bbf\u95ee\u4e86 player \u5168\u5c40\u53d8\u91cf, \u5e76\u4e14\u8bbe\u7f6e\u5176 <code>Dashes</code> \u5b57\u6bb5\u4e3a 2, \u4e5f\u5c31\u662f\u8bbe\u7f6e\u51b2\u523a\u6570\u4e3a2, \u4e0d\u8fc7\u8fd9\u6837\u4f1a\u5bfc\u81f4\u5728\u7a7a\u4e2d\u4e5f\u6062\u590d\u4e3a 2, \u6240\u4ee5\u6211\u4eec\u52a0\u5165\u5728\u662f\u5426\u5728\u5b89\u5168\u5730\u9762(\u8349\u8393\u80fd\u7ed3\u7b97\u7684\u90a3\u79cd)\u4e0a\u7684\u68c0\u6d4b:</p> <pre><code>function onBegin()\n    if player.OnSafeGround then\n        player.Dashes = 2\n    end\nend\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2d <code>OnSafeGround</code> \u5c31\u662f\u4e00\u4e2a\u5c5e\u6027. \u4e0d\u8fc7\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u6709\u4e00\u4e9b\u95ee\u9898, \u5f53\u4f60\u4ece\u4e0a\u5f80\u4e0b\u6389\u5165 trigger \u65f6, \u53ea\u6709\u8fdb\u5165\u7684\u90a3\u4e00\u5e27\u624d\u4f1a\u68c0\u6d4b\u5e76\u6062\u590d\u51b2\u523a, \u8fd9\u6709\u65f6\u5019\u5c31\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c, \u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u65b0\u7684\u7279\u6b8a\u51fd\u6570 <code>onStay</code>:</p> <pre><code>function onStay()\n    if player.OnSafeGround then\n        player.Dashes = 2\n    end\nend\n</code></pre> <p>\u8fd9\u4f1a\u8ba9\u8fd9\u6bb5\u4ee3\u7801\u5728\u73a9\u5bb6\u63a5\u89e6\u5230 trigger \u7684\u6bcf\u4e00\u5e27\u90fd\u6267\u884c\u4ee3\u7801, \u7b26\u5408\u6211\u4eec\u76ee\u524d\u7684\u9700\u6c42. \u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u53e6\u5916\u4e24\u4e2a: <code>onEnter</code> \u548c <code>onLeave</code>, \u5b83\u4eec\u90fd\u4e0d\u662f\u534f\u7a0b\u51fd\u6570, \u524d\u8005\u5728\u73a9\u5bb6\u8fdb\u5165 trigger \u65f6\u89e6\u53d1(\u8fd9\u4e0e <code>onBegin</code> \u4e0d\u540c, \u6bd4\u5982\u5728\u5267\u60c5\u8fdb\u884c\u65f6\u4f60\u4f9d\u7136\u53ef\u4ee5\u63a7\u5236\u8fdb\u51fa trigger), \u540e\u8005\u5728\u73a9\u5bb6\u79bb\u5f00 trigger \u65f6\u6267\u884c.  </p> <p>\u5f53\u7136\u6211\u4eec\u8fd8\u53ef\u4ee5\u8c03\u7528\u4e00\u4e9b\u65b9\u6cd5, \u6bd4\u5982\u5267\u60c5\u5f00\u59cb\u65f6\u5f3a\u5236\u4e22\u5f03\u6293\u53d6\u7269:</p> <pre><code>function onBegin()\n    player:Throw()\nend\n</code></pre> <p>\u6ce8\u610f\u5728\u8c03\u7528\u6210\u5458\u65b9\u6cd5\u65f6\u6211\u4eec\u9700\u8981\u4f7f\u7528 : \u7b26\u53f7, \u8fd9\u662f\u5230\u76ee\u524d\u4e3a\u6b62\u7684\u4e00\u4e2a\u7279\u4f8b.  </p>"},{"location":"extra_luacs/cs_access/#_2","title":"\u79c1\u6709\u8bbf\u95ee","text":"<p>\u5bf9\u4e8e\u79c1\u6709\u6210\u5458\u7684\u8bbf\u95ee, \u5728 Everest Core (\u622a\u6b62 4446) \u4e0a\u4f3c\u4e4e\u662f\u6709\u4e00\u4e9b\u95ee\u9898\u5bfc\u81f4\u5b8c\u5168\u4e0d\u80fd\u8bbf\u95ee, \u7ecf\u8fc7\u8be2\u95ee\u4f3c\u4e4e\u662f Core \u7684\u4e00\u4e9b\u7f13\u5b58\u95ee\u9898, \u5728 Stable \u4e0a\u4e0d\u4f1a\u51fa\u73b0, \u6545\u8fd9\u91cc\u6682\u65f6\u8df3\u8fc7, \u76f8\u5173\u79c1\u6709\u6210\u5458\u8bbf\u95ee\u53ef\u5728 C# \u4fa7\u64cd\u4f5c\u4f5c\u4e3a\u66ff\u4ee3.</p>"},{"location":"extra_luacs/cs_access/#_3","title":"\u534f\u7a0b","text":"<p>lua \u4e0e c# \u4e24\u4fa7\u90fd\u6709\u534f\u7a0b\u7684\u6982\u5ff5, \u4e0d\u8fc7\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528, \u9700\u8981\u4e00\u5b9a\u7684\u8f6c\u6362, \u4f8b\u5982\u4f7f\u7528 <code>Level.ZoomTo</code> \u51fd\u6570, \u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5c06\u6444\u50cf\u673a\u7f29\u653e\u81f3\u67d0\u4e00\u70b9\u7684\u534f\u7a0b:</p> <pre><code>function onBegin()\n    disableMovement()\n    local level = player.Scene\n    local c = level:ZoomTo(vector2(160, 90), 1.5, 2.0)\n    coroutine.yield(c)\nend\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u8c03\u7528\u4e86 <code>level</code> \u7684 <code>ZoomTo</code> \u51fd\u6570, \u5e76\u5c06\u8fd4\u56de\u503c\u50a8\u5b58\u8d77\u6765, \u7136\u540e\u4f7f\u7528 <code>coroutine.yield</code> \u5c06\u5176\u8f6c\u6362\u4e3a lua \u534f\u7a0b\u5e76\u7b49\u5f85. \u6e38\u620f\u4e2d\u7684\u6548\u679c\u5219\u4e3a\u76f8\u673a\u5728 2s \u5185\u5411\u5c4f\u5e55\u4e2d\u5fc3\u653e\u5927 1.5 \u500d. \u987a\u4fbf\u8fd9\u4e2a\u51fd\u6570\u8fd8\u6709\u4e2a\u914d\u5957\u7684\u7f29\u653e\u56de\u6765\u7684\u7248\u672c:</p> <pre><code>function onBegin()\n    disableMovement()\n    local level = player.Scene;\n    coroutine.yield(level:ZoomTo(vector2(160, 90), 1.5, 2.0))\n    coroutine.yield(level:ZoomBack(2.0))\nend\n</code></pre>"},{"location":"extra_luacs/cs_access/#_4","title":"\u6700\u540e","text":"<p>\u76f8\u4fe1\u5982\u679c\u4f60\u6ca1\u6709\u592a\u591a C# \u77e5\u8bc6\u7684\u8bdd, \u8fd9\u4e00\u5c0f\u8282\u4f60\u80af\u5b9a\u662f\u5f88\u56f0\u60d1\u4e0d\u77e5\u9053\u53d1\u751f\u4e86\u4ec0\u4e48\u7684, \u4e0d\u8fc7\u6ca1\u5173\u7cfb, \u4f60\u4f9d\u7136\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u540e\u7eed\u7ed9\u51fa\u7684\u4ee3\u7801\u6bb5\u548c\u73b0\u6210\u7684\u51fd\u6570\u6765\u505a\u4f60\u60f3\u505a\u7684\u4e8b.</p>"},{"location":"extra_luacs/examples/","title":"\u4f8b\u5b50","text":"<p>\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\u4f1a\u66f4\u591a\u5730\u4ecb\u7ecd\u4e00\u4e9b\u9884\u5b9a\u4e49\u51fd\u6570, \u4ee5\u53ca\u4e00\u4e9b\u5de5\u5177\u51fd\u6570\u7b49\u7b49, \u5728\u540e\u9762\u7684\u8282\u4e2d\u8fd8\u4f1a\u5305\u542b\u4e00\u4e9b helper \u5728 C# \u4fa7\u534f\u52a9\u5b9e\u73b0\u7684\u51fd\u6570.</p>"},{"location":"extra_luacs/examples/#_2","title":"\u4e00\u4e9b\u4ecb\u7ecd","text":"<p>\u5c31\u5982\u4e4b\u524d\u6240\u8bf4\u7684, \u79fb\u52a8\u7684\u7981\u6b62\u72b6\u6001\u5e76\u4e0d\u4f1a\u5728\u5267\u60c5\u7ed3\u675f\u65f6\u81ea\u52a8\u89e3\u9664, \u5728\u5206\u652f\u590d\u6742\u5bb9\u6613\u5728\u672b\u5c3e\u5fd8\u8bb0\u8c03\u7528 <code>enableMovement</code> \u7684\u60c5\u51b5\u4e0b, \u901a\u5e38\u5efa\u8bae\u5728 <code>onEnd</code> \u51fd\u6570\u4e2d\u91cd\u65b0\u5141\u8bb8\u79fb\u52a8:</p> <pre><code>function onEnd()\n    enableMovement()\nend\n</code></pre> <p>\u5bf9\u4e8e\u90e8\u5206\u8981\u6c42\u7edd\u5bf9\u5750\u6807\u7684\u51fd\u6570, \u4f60\u53ef\u4ee5\u901a\u8fc7\u6309\u4e0b\u952e\u76d8\u4e0a\u7684 <code>~</code> \u952e\u6765\u6253\u5f00\u8c03\u8bd5\u9762\u677f, \u5728\u754c\u9762\u5de6\u4e0a\u89d2\u4f1a\u6709\u4e00\u680f\u7c7b\u4f3c\u5982\u4e0b\u7684\u4fe1\u606f:</p> <pre><code>Area: 04 @ 12 (SID: Celeste/Saplonily/Test)\nCursor @\n  screen: 792, 407\n  world:       -618, 213\n  level:       1142, 397\n  level, /8:   142, 49\n  level, snap: 1136, 392\n</code></pre> <p>\u5176\u4e2d <code>Area: 04 @ 12</code> \u4e2d\u7684 <code>04</code> \u4e3a\u5f53\u524d\u623f\u95f4\u540d, <code>12</code> \u4e3a\u5f53\u524d\u7ae0\u8282 ID, \u901a\u5e38\u5bf9\u4e8e B \u9762\u5b83\u8fd8\u4f1a\u4ee5 <code>H</code> \u7ed3\u5c3e, C \u9762\u4ee5 <code>HH</code> \u7ed3\u5c3e.  <code>screen</code> \u8868\u793a\u76ee\u524d\u5149\u6807\u6240\u5728\u7684\u5c4f\u5e55\u5750\u6807, <code>(0, 0)</code> \u8868\u793a\u5c4f\u5e55\u5de6\u4e0a\u89d2. <code>level</code> \u8868\u793a\u76ee\u524d\u5149\u6807\u6240\u5728\u7684\u4e16\u754c\u5750\u6807, \u4e5f\u5c31\u662f <code>walkTo</code> \u7b49\u51fd\u6570\u8981\u6c42\u6211\u4eec\u4f20\u5165\u7684\u7edd\u5bf9\u5750\u6807. <code>level, /8</code> \u8868\u793a\u5149\u6807\u6240\u5728\u7684\u4e16\u754c\u5750\u6807\u9664\u4ee5 8 \u53d6\u6574\u7684\u7ed3\u679c, \u8fd9\u901a\u5e38\u7528\u4e8e\u5b9a\u4f4d\u4ee5 8px \u4e3a\u5355\u4f4d\u7684 tile. <code>level, snap</code> \u7684\u503c\u4e3a <code>level, /8</code> \u7684\u503c\u4e58\u4ee5 8, \u5728\u6570\u503c\u4e0a\u8868\u73b0\u4e3a\u5149\u6807\u6240\u5728\u4e16\u754c\u5750\u6807\u4e0e 8x8 \u7f51\u683c\u8fdb\u884c\u5bf9\u9f50\u7684\u7ed3\u679c.  </p> <p>\u5728\u88c5\u4e86 <code>CelesteTAS</code> mod \u7684\u60c5\u51b5\u4e0b, \u4f60\u8fd8\u53ef\u4ee5\u5de6\u51fb\u5730\u56fe\u4e0a\u7684\u5b9e\u4f53\u6765\u83b7\u53d6\u66f4\u591a\u4fe1\u606f:</p> <pre><code>Area: 04 @ 12 (SID: Celeste/Saplonily/Test)\nCursor @\n  screen: 792, 407\n  entity type: Celeste.Glider\n  entity name: glider\n  entity id  : 04:14\n  mod name   : Celeste\n  world:       -618, 213\n  level:       1142, 397\n  level, /8:   142, 49\n  level, snap: 1136, 392\n</code></pre> <p>\u5176\u4e2d <code>entity type</code> \u4e3a\u5de6\u51fb\u5230\u7684\u5b9e\u4f53\u7684\u5b9e\u4f53\u7c7b\u540d, \u4e5f\u5373\u4ee3\u7801\u7c7b\u540d. <code>entity name</code> \u4e3a\u5b9e\u4f53\u7684\u540d\u79f0, \u4e5f\u662f\u5728\u5730\u56fe\u6587\u4ef6\u4e2d\u5b9e\u9645\u4fdd\u5b58\u7684\u540d\u5b57, \u901a\u5e38\u5728\u4e0e\u4ee3\u7801\u7c7b\u540d\u76f8\u4f3c\u7684\u4f7f\u7528\u573a\u666f\u4e2d\u4f1a\u7528\u5230. <code>entity id</code> \u4e3a\u5b9e\u4f53\u7684 ID, \u901a\u5e38\u7528\u4e8e\u67d0\u4e9b\u9700\u8981\u4f20\u5165\u5b9e\u4f53 ID \u53c2\u6570\u7684 helper \u5b9e\u4f53. <code>mod name</code> \u4e3a\u8be5\u5b9e\u4f53\u6240\u5c5e mod \u540d, \u5bf9\u4e8e\u539f\u7248\u5b9e\u4f53\u4e3a <code>Celeste</code>.</p> <p>\u4ee5\u9632\u4f60\u8fd8\u4e0d\u77e5\u9053, \u6e38\u620f\u7684\u5750\u6807\u7cfb\u4e0e\u5e38\u89c4\u7684\u6570\u5b66\u5750\u6807\u7cfb\u4e0d\u540c, \u5176 y \u5750\u6807\u7ecf\u8fc7\u4e86\u7ad6\u76f4\u7ffb\u8f6c:</p> <p></p>"},{"location":"extra_luacs/examples/#_3","title":"\u7247\u6bb5","text":""},{"location":"extra_luacs/examples/#_4","title":"\u64ad\u653e\u73a9\u5bb6\u52a8\u753b","text":"<pre><code>function playSprite(sprite, duration)\n    player.Sprite:Play(sprite, false, false)\n    if duration then\n        wait(duration)\n    end\nend\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u5c01\u88c5\u4e86\u4e00\u4e2a\u51fd\u6570, \u4f7f\u5f97\u4f60\u53ef\u4ee5\u5411\u73a9\u5bb6\u64ad\u653e\u4e00\u4e2a\u52a8\u753b\u5e76\u7b49\u5f85\u51e0\u79d2, \u4f8b\u5982\u8ba9\u73a9\u5bb6\u64ad\u653e <code>swimIdle</code>, \u4e5f\u5c31\u662f\u5728\u6c34\u4e2d\u65f6\u64ad\u653e\u7684\u52a8\u753b:</p> <pre><code>player.DummyAutoAnimate = false\nplaySprite(\"swimIdle\", 1)\nplayer.DummyAutoAnimate = true\n</code></pre> <p>\u5728\u73a9\u5bb6\u88ab\u7981\u6b62\u79fb\u52a8\u540e\u6e38\u620f\u4f9d\u7136\u4f1a\u5904\u7406\u73a9\u5bb6\u7684\u52a8\u753b, \u6240\u4ee5\u6211\u4eec\u7684 <code>swimIdle</code> \u52a8\u753b\u4f1a\u7acb\u523b\u88ab\u66ff\u6362\u4e3a\u9ed8\u8ba4\u52a8\u753b, \u8fd9\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e <code>DummyAutoAnimate</code> \u4e3a <code>false</code> \u6765\u7981\u6b62\u8fd9\u4e00\u884c\u4e3a.</p> <p>\u6b64\u5916\u8fd8\u53ef\u4ee5\u6709\u53cd\u5411\u64ad\u653e\u52a8\u753b:</p> <pre><code>function playSpriteReversed(sprite, duration, from)\n    player.Sprite:Reverse(sprite, false)\n    -- from \u8fd8\u8981\u518d +1, \u907f\u514d\u6e38\u620f\u8df3\u8fc7\u6700\u540e\u4e00\u5e27\u800c\u4ece\u5012\u6570\u7b2c\u4e8c\u5e27\u5f00\u59cb\n    player.Sprite:SetAnimationFrame(from + 1)\n    if duration then\n        wait(duration)\n    end\nend\n</code></pre> <p>\u851a\u84dd\u7684\u5f15\u64ce <code>Monocle</code> \u7684 <code>Sprite</code> \u6709\u4e2a\u53cd\u5411\u64ad\u653e\u7684\u65b9\u6cd5, \u4f46\u662f\u5b83\u53ea\u4f1a\u4fee\u6539\u65b9\u5411\u4e3a\u53cd\u65b9\u5411, \u4e0d\u4f1a\u8df3\u5230\u6700\u540e\u4e00\u5e27\u5f00\u59cb, \u6240\u4ee5\u8fd9\u91cc\u4f60\u53ef\u80fd\u9700\u8981\u624b\u52a8\u67e5\u8be2\u4f60\u60f3\u8981\u53cd\u5411\u64ad\u653e\u7684\u52a8\u753b\u7684\u6700\u540e\u4e00\u5e27\u7684\u4f4d\u7f6e.  </p> <p>\u4f8b\u5982\u8ba9\u73a9\u5bb6\u62ac\u5934, \u7ed3\u675f\u540e\u7b49\u5f85 0.5 \u79d2\u7136\u540e\u518d\u4f4e\u5934\u7136\u540e\u7ed3\u675f\u5267\u60c5:</p> <pre><code>function onBegin()\n    disableMovement()\n    local level = player.Scene;\n    player.DummyAutoAnimate = false\n    playSprite(\"lookUp\", 0.5)\n    wait(0.5)\n    -- &lt;Anim id=\"lookUp\" path=\"lookUp\" delay=\"0.1\" frames=\"2-7\"/&gt;, \u6700\u540e\u4e00\u5e27\u662f 7\n    playSpriteReversed(\"lookUp\", 0.5, 7)\n    player.DummyAutoAnimate = true\nend\n</code></pre> <p>\u6b64\u5916\u4f60\u8fd8\u4f1a\u53d1\u73b0\u6b64\u65f6\u4f9d\u7136\u6709\u91cd\u529b, \u4f46\u662f\u4f60\u4f9d\u7136\u60f3\u8ba9\u73a9\u5bb6\u5728\u7a7a\u4e2d\u6e38\u52a8(\u9646\u6e38), \u4f60\u53ef\u4ee5\u8fd9\u6837\u7981\u7528\u91cd\u529b:</p> <pre><code>function onBegin()\n    disableMovement()\n    local level = player.Scene;\n    player.DummyAutoAnimate = false\n    player.DummyGravity = false\n    playSprite(\"swimIdle\", 0.5)\n    player.DummyGravity = true\n    player.DummyAutoAnimate = true\nend\n</code></pre> <p>\u4e0a\u8ff0\u4f8b\u5b50\u7684\u5b8c\u6574 lua \u6587\u4ef6:</p> testCutscene.lua<pre><code>function playSprite(sprite, duration)\n    player.Sprite:Play(sprite, false, false)\n    if duration then\n        wait(duration)\n    end\nend\n\nfunction playSpriteReversed(sprite, duration, from)\n    player.Sprite:Reverse(sprite, false)\n    player.Sprite:SetAnimationFrame(from + 1)\n    if duration then\n        wait(duration)\n    end\nend\n\nfunction onBegin()\n    disableMovement()\n    local level = player.Scene;\n    waitUntilOnGround()\n    wait(1)\n    player.DummyAutoAnimate = false\n    player.DummyGravity = false\n    playSprite(\"swimIdle\", 0.5)\n    player.DummyGravity = true\n    player.DummyAutoAnimate = true\nend\n\nfunction onEnd()\n    enableMovement()\nend\n</code></pre>"},{"location":"extra_luacs/reference/","title":"\u53c2\u8003","text":""},{"location":"extra_luacs/reference/#luacutscene","title":"LuaCutscene \u51fd\u6570","text":"<p>\u5728\u524d\u9762\u7684\u5c0f\u8282\u4e2d\u6211\u4eec\u5df2\u7ecf\u63d0\u5230\u8fc7 LuaCutscene \u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u51fd\u6570, \u90a3\u4e48\u8fd9\u91cc\u6211\u4eec\u5c06\u4ecb\u7ecd\u5176\u4e2d\u5e38\u7528\u7684\u4e00\u90e8\u5206(\u4e4b\u524d\u5df2\u4ecb\u7ecd\u8fc7\u7684\u5c06\u4e0d\u518d\u63d0\u53ca).</p>"},{"location":"extra_luacs/reference/#wait","title":"wait","text":"<p><code>wait(duration)</code> </p> <p>\u534f\u7a0b\u51fd\u6570, \u6682\u505c\u51fd\u6570\u6267\u884c\u51e0\u79d2</p> <ul> <li>duration: \u8981\u6682\u505c\u7684\u65f6\u95f4(\u79d2)</li> </ul>"},{"location":"extra_luacs/reference/#walkto","title":"walkTo","text":"<p><code>walkTo(x, walkBackwards=false, speedMultiplier=1.0, keepWalkingIntoWalls=false)</code> </p> <p>\u534f\u7a0b\u51fd\u6570, \u8ba9\u73a9\u5bb6\u884c\u8d70\u5230\u5750\u6807 x</p> <ul> <li>x: \u76ee\u6807 x \u7edd\u5bf9\u5750\u6807, \u5355\u4f4d px</li> <li>walkBackwards: \u662f\u5426\u64ad\u653e\u4e3a\u5012\u8d70\u52a8\u753b</li> <li>speedMultiplier: \u901f\u5ea6\u500d\u7387</li> <li>keepWalkingIntoWalls: \u649e\u5899\u65f6\u662f\u5426\u4fdd\u6301\u72b6\u6001\u76f4\u5230\u5899\u88ab\u79fb\u9664</li> </ul> <p>\u5982\u679c\u5728\u884c\u8d70\u8fc7\u7a0b\u4e2d\u78b0\u5230\u5899\u90a3\u4e48\u8be5\u51fd\u6570\u4f1a\u7acb\u5373\u7ed3\u675f\u6267\u884c, \u9664\u975e <code>keepWalkingIntoWalls</code> \u88ab\u8bbe\u7f6e\u4e3a <code>true</code>, \u5982\u679c\u4e0d\u5e78\u5730\u78b0\u5230\u4e86\u4e0d\u53ef\u80fd\u4f1a\u88ab\u79fb\u9664\u7684\u5899, \u4f8b\u5982\u524d\u666f\u7816, \u90a3\u4e48\u5267\u60c5\u5c31\u4f1a\u6c38\u4e45\u5361\u4f4f.</p>"},{"location":"extra_luacs/reference/#walk","title":"walk","text":"<p><code>walkTo(x, walkBackwards=false, speedMultiplier=1.0, keepWalkingIntoWalls=false)</code> </p> <p>\u4e0e <code>walkTo</code> \u76f8\u540c, \u4f46 x \u4e3a\u76f8\u5bf9\u503c, \u4f8b\u5982 <code>100</code> \u4f1a\u4f7f\u5f97\u73a9\u5bb6\u5411\u53f3\u884c\u8d70 100 px</p>"},{"location":"extra_luacs/reference/#runto","title":"runTo","text":"<p><code>runTo(x, fastAnimation=false)</code></p> <p>\u534f\u7a0b\u51fd\u6570, \u8ba9\u73a9\u5bb6\u8dd1\u5230\u5750\u6807 x</p> <ul> <li>x: \u76ee\u6807 x \u7edd\u5bf9\u5750\u6807, \u5355\u4f4d px</li> <li>fastAnimation: \u662f\u5426\u4f7f\u7528\u5feb\u8dd1\u7684\u52a8\u753b</li> </ul> <p>\u4e0e <code>walkTo</code> \u7c7b\u4f3c, \u4f46\u662f\u52a8\u753b\u53d8\u4e3a\u8dd1\u6b65. \u6ce8\u610f\u6b64\u51fd\u6570\u6ca1\u6709\u540c\u7b49\u7684 <code>keepWalkingIntoWalls</code> \u53c2\u6570, \u5176\u7b49\u6548\u4e8e\u4e3a <code>true</code> \u7684\u60c5\u51b5, \u4e5f\u5c31\u662f\u649e\u5899\u540e\u4e0d\u4f1a\u7ed3\u675f\u8be5\u51fd\u6570\u7684\u6267\u884c.</p>"},{"location":"extra_luacs/reference/#run","title":"run","text":"<p><code>run(x, fastAnimation=false)</code></p> <p>\u4e0e <code>runTo</code> \u76f8\u540c, \u4f46 x \u4e3a\u76f8\u5bf9\u503c.</p>"},{"location":"extra_luacs/reference/#postcard","title":"postcard","text":"<p><code>postcard(dialog, sfxIn, sfxOut=nil)</code></p> <p>\u534f\u7a0b\u51fd\u6570, \u5411\u73a9\u5bb6\u663e\u793a\u660e\u4fe1\u7247</p> <ul> <li>dialog: \u660e\u4fe1\u7247\u6240\u4f7f\u7528\u7684 dialog id, \u4e0e <code>say</code> \u7684\u662f\u540c\u4e00\u79cd id</li> <li>sfxIn: \u5c55\u793a\u660e\u4fe1\u7247\u65f6\u64ad\u653e\u7684\u97f3\u9891 event id.</li> <li>sfxOut: \u660e\u4fe1\u7247\u79fb\u5f00\u65f6\u64ad\u653e\u7684\u97f3\u9891 event id.</li> </ul> <p>\u5bf9\u4e8e\u97f3\u9891\u76f8\u5173\u7684\u5185\u5bb9, \u4f8b\u5982\u83b7\u53d6 event id, \u53ef\u53c2\u8003\u7535\u7bb1\u5236\u56fe\u6559\u7a0b\u4e2d\u7684:</p> <ul> <li>av986769059 - \u81ea\u5b9a\u4e49\u97f3\u4e50(\u57fa\u7840\u7bc7)</li> <li>av604397615 - \u81ea\u5b9a\u4e49\u97f3\u4e50(\u8fdb\u9636\u7bc7)</li> <li>av517096099 - \u81ea\u5b9a\u4e49\u97f3\u4e50(\u62d3\u5c55\u7bc7)</li> </ul> <p>\u5728\u660e\u4fe1\u7247\u51fa\u73b0\u65f6\u5c1d\u8bd5\u6682\u505c\u5e76\u8df3\u8fc7\u5267\u60c5\u4f1a\u4f7f\u5173\u5361\u5904\u4e8e\u4e00\u79cd\u5f88\u5947\u602a\u7684\u72b6\u6001, \u4f60\u53ef\u4ee5\u9009\u62e9\u7981\u7528\u5173\u5361\u7684\u6682\u505c\u6765\u907f\u514d\u5b83.</p> <p>\u622a\u6b62 <code>0.2.11</code>, <code>postcard</code> \u51fd\u6570\u5b58\u5728\u7f16\u7801\u95ee\u9898, \u4e2a\u4eba\u5df2\u5f00 pr \u4fee\u590d</p>"},{"location":"extra_luacs/reference/#choice","title":"choice","text":"<p><code>choice(...)</code></p> <p>\u534f\u7a0b\u51fd\u6570, \u5411\u73a9\u5bb6\u5c55\u793a\u51e0\u4e2a\u5bf9\u8bdd\u9009\u9879(\u7c7b\u4f3c 6a \u5f00\u5934\u90a3\u79cd), \u8fd4\u56de\u73a9\u5bb6\u9009\u62e9\u7684\u5bf9\u8bdd\u5e8f\u53f7(\u6ce8\u610f\u4ece 1 \u5f00\u59cb).</p> <ul> <li>...: dialog id</li> </ul> <p>\u8fd9\u662f\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u7684\u51fd\u6570, \u4f8b\u5982\u4ee5\u4e0b\u4f7f\u7528:</p> <pre><code>local chosen = choice(\"CHOICE_1\", \"CHOICE_2\", \"CHOICE_3\");\nsay(\"CHOICE_SAY_\" .. tostring(chosen));\n</code></pre> <p>\u4f1a\u5411\u73a9\u5bb6\u5c55\u793a\u4e09\u4e2a\u9009\u9879, \u5e76\u4e14\u5728\u73a9\u5bb6\u9009\u62e9\u5b8c\u540e\u5c55\u793a\u5bf9\u5e94\u5e8f\u53f7\u5bf9\u5e94\u7684\u5bf9\u8bdd:</p> <ul> <li><code>CHOICE_1</code> -&gt; <code>CHOICE_SAY_1</code></li> <li><code>CHOICE_2</code> -&gt; <code>CHOICE_SAY_2</code></li> <li><code>CHOICE_3</code> -&gt; <code>CHOICE_SAY_3</code></li> </ul>"},{"location":"extra_luacs/reference/#die","title":"die","text":"<p><code>die(direction={0, 0}, evenIfInvincible=false, registerDeathInStats=true)</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u6740\u6b7b\u73a9\u5bb6</p> <ul> <li>direction: \u6b7b\u4ea1\u65b9\u5411, \u4f8b\u5982 <code>{1, 0}</code> \u8868\u793a\u6c34\u5e73\u5411\u53f3, <code>{-1, -1}</code> \u8868\u793a\u5de6\u4e0a\u65b9</li> <li>evenIfInvincible: \u662f\u5426\u5728\u73a9\u5bb6\u662f\u65e0\u654c\u65f6\u4e5f\u6740\u6b7b</li> <li>registerDeathInStats: \u662f\u5426\u8bb0\u5f55\u672c\u6b21\u6b7b\u4ea1, \u5426\u5219\u672c\u6b21\u6b7b\u4ea1\u4e0d\u4f1a\u589e\u52a0\u5b58\u6863\u6b7b\u4ea1\u6570</li> </ul> <p>\u5c31\u5982\u6b64\u51fd\u6570\u6240\u505a\u7684, \u76f4\u63a5\u6740\u6b7b\u73a9\u5bb6, \u4e0d\u8fc7\u6b64\u51fd\u6570\u8c03\u7528\u540e\u4f9d\u7136\u4f1a\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801, \u867d\u7136\u540c\u65f6\u540e\u9762\u7684\u4ee3\u7801\u4f1a\u88ab\u73a9\u5bb6\u6b7b\u4ea1\u540e\u7684\u81ea\u52a8\u91cd\u5f00\u76f4\u63a5\u6253\u65ad.</p>"},{"location":"extra_luacs/reference/#jump","title":"jump","text":"<p><code>jump(duration=2.0)</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u4f7f\u73a9\u5bb6\u8df3\u8dc3</p> <ul> <li>duration: \u8df3\u8dc3\u65f6\u957f, \u7b49\u4ef7\u4e8e\u4f60\u6309\u8df3\u952e\u7684\u65f6\u957f</li> </ul> <p>\u6709\u8da3\u7684\u662f, \u6b64\u51fd\u6570\u5373\u4f7f\u73a9\u5bb6\u5728\u7a7a\u4e2d\u4e5f\u4f1a\u8d77\u6548, \u4e0d\u8fc7\u6b64\u51fd\u6570\u5bfc\u81f4\u7684\u8df3\u4e0d\u4f1a\u89e6\u53d1 super \u4e0e hyper \u7b49\u673a\u5236.</p>"},{"location":"extra_luacs/reference/#waituntilonground","title":"waitUntilOnGround","text":"<p><code>waitUntilOnGround()</code></p> <p>\u534f\u7a0b\u51fd\u6570, \u7b49\u5f85\u73a9\u5bb6\u89e6\u78b0\u5230\u5730\u677f</p>"},{"location":"extra_luacs/reference/#changeroom","title":"changeRoom","text":"<p><code>changeRoom(name)</code> <code>changeRoom(name, spawnX, spawnY)</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570 ,\u66f4\u6539\u73a9\u5bb6\u6240\u5728\u9762</p> <ul> <li>name: \u76ee\u6807\u9762\u540d\u79f0</li> <li>spawnX: \u65b0\u91cd\u751f\u70b9 x \u5750\u6807</li> <li>spawnY: \u65b0\u91cd\u751f\u70b9 y \u5750\u6807</li> </ul> <p>\u5982\u679c\u4e0d\u4f20\u5165\u65b0\u91cd\u751f\u70b9\u5750\u6807\u5219\u9ed8\u8ba4\u4e3a\u623f\u95f4\u5de6\u4e0b\u89d2. \u4e0d\u8fc7\u7ecf\u4e2a\u4eba\u6d4b\u8bd5\u8fd9\u4e2a\u91cd\u751f\u70b9\u7684\u8bbe\u7f6e\u4f1a\u9a6c\u4e0a\u5c31\u88ab\u65b0\u9762\u7684\u8fdb\u5165\u800c\u8986\u76d6, \u4e0d\u8fc7\u6709\u8da3\u7684\u662f, \u6b64\u51fd\u6570\u5141\u8bb8\u4f20\u5165\u4e00\u4e2a filler \u9762, \u6b64\u65f6\u91cd\u751f\u70b9\u5c31\u4e0d\u4f1a\u88ab\u8986\u76d6\u4e86.</p>"},{"location":"extra_luacs/reference/#teleportto","title":"teleportTo","text":"<p><code>teleportTo(x, y)</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u4f20\u9001\u73a9\u5bb6\u5230\u76ee\u6807\u4f4d\u7f6e</p> <ul> <li>x: \u76ee\u6807 x \u5750\u6807</li> <li>y: \u76ee\u6807 y \u5750\u6807</li> </ul> <p>\u6b64\u5916\u8fd9\u4e2a\u51fd\u6570\u8fd8\u6709\u53e6\u5916\u4e24\u4e2a\u91cd\u8f7d, \u4e0d\u8fc7\u6211\u4e2a\u4eba\u8fd8\u6ca1\u5f04\u61c2\u5b83\u7684\u7528\u6cd5, \u6545\u8fd9\u91cc\u5c31\u4e0d\u5199\u4e86.</p>"},{"location":"extra_luacs/reference/#teleport","title":"teleport","text":"<p>\u4e0e <code>teleportTo</code> \u76f8\u540c, \u4f46\u662f\u5750\u6807\u662f\u76f8\u5bf9\u5750\u6807</p>"},{"location":"extra_luacs/reference/#instantteleportto","title":"instantTeleportTo","text":"<p><code>instantTeleportTo(x, y)</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u7acb\u5373\u4f20\u9001\u73a9\u5bb6\u5230\u76ee\u6807\u4f4d\u7f6e</p> <ul> <li>x: \u76ee\u6807 x \u5750\u6807</li> <li>y: \u76ee\u6807 y \u5750\u6807</li> </ul> <p>\u6b64\u51fd\u6570\u4e0e <code>teleportTo</code> \u7c7b\u4f3c, \u4f46\u662f\u5b83\u4f1a\u5728\u4f20\u9001\u7684\u540c\u65f6\u7acb\u5373\u8c03\u6574\u89c6\u91ce, \u4e5f\u5c31\u662f\u6444\u50cf\u673a\u7684\u4f4d\u7f6e. \u6b64\u5916\u8fd9\u4e2a\u51fd\u6570\u4e5f\u6709\u53e6\u5916\u4e00\u4e2a\u6709\u5173\u9762\u7684\u91cd\u8f7d(<code>(x, y, room)</code>), \u4f46\u662f\u4f20\u5165\u5176\u4ed6\u9762\u540e\u73a9\u5bb6\u4f1a\u8fdb\u5165\u4e00\u79cd\u5947\u602a\u7684\u5267\u60c5\u72b6\u6001.</p>"},{"location":"extra_luacs/reference/#instantteleport","title":"instantTeleport","text":"<p>\u4e0e <code>instantTeleportTo</code> \u76f8\u540c, \u4f46\u662f\u5750\u6807\u662f\u76f8\u5bf9\u5750\u6807</p>"},{"location":"extra_luacs/reference/#completearea","title":"completeArea","text":"<p><code>completeArea(spotlightWipe=false, skipScreenWipe=false, skipCompleteScreen=false)</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u7ed3\u675f\u5f53\u524d\u7ae0\u8282, \u6b64\u51fd\u6570\u8c03\u7528\u540e\u4f1a\u91cd\u65b0\u5141\u8bb8\u73a9\u5bb6\u79fb\u52a8.</p> <ul> <li><code>spotlightWipe</code>: <code>true</code> \u65f6\u4e3a\u805a\u5149\u706f\u578b\u5207\u6362\u5230\u9ed1\u5c4f, <code>false</code> \u4e3a\u6e10\u53d8\u578b.</li> <li><code>skipScreenWipe</code>: \u662f\u5426\u8df3\u8fc7\u5207\u6362\u5230\u9ed1\u5c4f\u7684\u8fc7\u7a0b</li> <li><code>skipCompleteScreen</code>: \u662f\u5426\u8df3\u8fc7\u7ed3\u7b97\u5c4f</li> </ul>"},{"location":"extra_luacs/reference/#givekey","title":"giveKey","text":"<p><code>giveKey()</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u7ed9\u4e88\u73a9\u5bb6\u4e00\u628a\u94a5\u5319.</p>"},{"location":"extra_luacs/reference/#makeunskippable","title":"makeUnskippable","text":"<p><code>makeUnskippable()</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u4f7f\u5f53\u524d\u5267\u60c5\u65e0\u6cd5\u8df3\u8fc7  </p> <p>\u6709\u4e9b\u65f6\u5019\u4f60\u7684\u5267\u60c5\u8fc7\u4e8e\u590d\u6742, \u4ee5\u81f3\u4e8e\u4f60\u65e0\u6cd5\u826f\u597d\u5730\u9884\u6d4b\u76f4\u63a5\u8df3\u8fc7\u5267\u60c5\u5e94\u8be5\u505a\u4ec0\u4e48, \u6bd4\u5982\u73a9\u5bb6\u5230\u5e95\u79fb\u52a8\u5230\u54ea\u4e86, \u90a3\u4e48\u4f7f\u5b83\u65e0\u6cd5\u8df3\u8fc7\u53ef\u80fd\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9.</p>"},{"location":"extra_luacs/reference/#disableretry-enableretry","title":"disableRetry / enableRetry","text":"<p><code>enableRetry()</code> <code>disableRetry()</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u7981\u7528 / \u542f\u7528 \u91cd\u8bd5\u529f\u80fd.  </p> <p>\u6ce8\u610f\u6b64\u51fd\u6570\u7684\u6548\u679c\u5728\u5267\u60c5\u7ed3\u675f\u540e\u4e0d\u4f1a\u6062\u590d, \u5efa\u8bae\u624b\u52a8\u5728 <code>onEnd()</code> \u5904\u91cd\u65b0\u542f\u7528.</p>"},{"location":"extra_luacs/reference/#disablepause-enablepause","title":"disablePause / enablePause","text":"<p><code>helpers.disablePause()</code> <code>helpers.enablePause()</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u7981\u7528 / \u542f\u7528 \u6682\u505c\u529f\u80fd.  </p> <p>\u6ce8\u610f\u6b64\u51fd\u6570\u7684\u6548\u679c\u5728\u5267\u60c5\u7ed3\u675f\u540e\u4e0d\u4f1a\u6062\u590d, \u5efa\u8bae\u624b\u52a8\u5728 <code>onEnd()</code> \u5904\u91cd\u65b0\u542f\u7528.</p>"},{"location":"extra_luacs/reference/#endcutscene","title":"endCutscene","text":"<p><code>endCutscene()</code></p> <p>\u975e\u534f\u7a0b\u51fd\u6570, \u7ed3\u675f\u5f53\u524d\u5267\u60c5.  </p> <p>\u6ce8\u610f\u8be5\u51fd\u6570\u8c03\u7528\u540e\u540e\u9762\u7684\u4ee3\u7801\u4f9d\u7136\u4f1a\u6267\u884c, \u76f4\u5230\u9047\u5230\u4e00\u4e2a\u534f\u7a0b\u51fd\u6570, \u6216\u8005\u51fd\u6570\u88ab\u8fd4\u56de\u6216\u5230\u8fbe\u672b\u5c3e.</p>"},{"location":"hooks/adv_hooks/","title":"IL \u94a9\u5b50\u4e0e\u968f\u610f\u94a9\u53d6","text":""},{"location":"hooks/adv_hooks/#il_1","title":"IL \u94a9\u5b50","text":""},{"location":"hooks/adv_hooks/#il_2","title":"\u63d2\u5165 IL","text":"<p>\u73b0\u5728, \u4f60\u5df2\u7ecf\u4e86\u89e3\u4e86\u57fa\u672c\u7684 IL \u77e5\u8bc6, \u7a0d\u5fae\u4f1a\u4f7f\u7528 <code>System.Reflection.Emit</code> \u5e93\u4e86, \u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528 IL \u94a9\u5b50\u4e86. IL \u94a9\u5b50\u5141\u8bb8\u4f60\u4fee\u6539\u851a\u84dd\u7684\u4ee3\u7801, \u8fd9\u662f\u4e00\u4e2a\u5f88\u5f3a\u5927\u7684\u529f\u80fd, \u90a3\u4e48\u81ea\u7136\u800c\u7136, \u5b83\u7684\u4f7f\u7528\u4e5f\u4f1a\u53d8\u5f97\u66f4\u52a0\u590d\u6742.  </p> <p>IL \u94a9\u5b50\u4e0e On \u94a9\u5b50\u7684\u4e8b\u4ef6\u8ba2\u9605\u65b9\u5f0f\u5f88\u76f8\u50cf, \u53ea\u4e0d\u8fc7\u662f\u6362\u6210\u4e86 IL \u547d\u540d\u7a7a\u95f4, \u4e0d\u8fc7\u8981\u6ce8\u610f\u7684\u662f, \u65b9\u6cd5\u7684\u53c2\u6570\u4e0d\u518d\u662f\u539f\u51fd\u6570\u59d4\u6258\u52a0\u4e0a\u5176\u5bf9\u5e94\u53c2\u6570\u4e86, \u800c\u662f\u4e00\u4e2a <code>ILContext</code> \u7c7b\u578b\u7684\u503c, \u540c\u65f6, \u65b9\u6cd5\u4e5f\u4e0d\u662f\u6bcf\u6b21\u8c03\u7528\u88ab\u94a9\u65b9\u6cd5\u65f6\u8c03\u7528, \u800c\u662f\u4ec5\u5728\u6e38\u620f\u542f\u52a8\u65f6\u8c03\u7528. \u4f8b\u5982, \u94a9\u53d6\u73a9\u5bb6\u7684 <code>SuperWallJump</code> \u65b9\u6cd5(\u5728\u73a9\u5bb6\u505a\u51fa\u4e86\u4e00\u4e2a\u8e6d\u5899\u65f6\u8c03\u7528):</p> <pre><code>public override void Load()\n{\n    IL.Celeste.Player.SuperWallJump += Player_SuperWallJump;\n}\n\nprivate void Player_SuperWallJump(ILContext il)\n{\n\n}\n\npublic override void Unload()\n{\n    IL.Celeste.Player.SuperWallJump -= Player_SuperWallJump;\n}\n</code></pre> <p>\u73b0\u5728, \u6211\u4eec\u83b7\u53d6\u5230\u4e86\u4e00\u4e2a <code>ILContext</code>, \u5b83\u8868\u793a\u8fd9\u4e2a\u65b9\u6cd5\u7684 <code>IL</code> \u4e0a\u4e0b\u6587, \u4e0d\u8fc7\u5728\u8fd9\u91cc\u4f60\u4e0d\u9700\u8981\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48, \u6211\u4eec\u901a\u5e38\u8981\u7684\u53ea\u662f\u4f7f\u7528\u5176\u521b\u5efa\u4e00\u4e2a <code>ILCursor</code>:</p> <pre><code>ILCursor cur = new(il);\n</code></pre> <p>\u987e\u540d\u601d\u4e49, \u8fd9\u662f\u4e00\u4e2a \"IL \u6307\u9488\", \u5b83 \"\u6307\u5411\" \u8fd9\u4e2a\u65b9\u6cd5\u7684 IL \u4ee3\u7801\u7684\u67d0\u4e00\u884c, \u5b83\u62e5\u6709\u5f88\u591a\u65b9\u6cd5\u4ee5\u5141\u8bb8\u6211\u4eec\u5728\u5b83\u6307\u5411\u7684\u4f4d\u7f6e\u4e0b\u6dfb\u52a0, \u4fee\u6539, \u5220\u9664 IL, \u81ea\u7136, \u5b83\u4e5f\u5e26\u6709\u5f88\u591a\u65b9\u6cd5\u6765\u79fb\u52a8\u5b83\u7684\u6307\u5411, \u6700\u5e38\u7528\u7684\u65b9\u6cd5\u4e4b\u4e00\u662f <code>TryGotoNext</code>, \u5b83\u7684\u53c2\u6570\u5217\u8868\u5305\u542b\u4e00\u7cfb\u5217\u7684 <code>predicates</code>(\u8fd9\u8bcd\u4f3c\u4e4e\u6ca1\u4e2a\u7edf\u4e00\u7684\u7ffb\u8bd1, \u4e0d\u8fc7\u7406\u89e3\u5b83\u5f88\u7b80\u5355).  </p> <p>\u73b0\u5728, \u5047\u8bbe\u6211\u4eec\u7684\u76ee\u7684\u662f\u4fee\u6539\u73a9\u5bb6\u8e6d\u5899\u8df3\u65f6\u7684\u7ad6\u76f4\u901f\u5ea6\u4e3a 2 \u500d, \u90a3\u4e48\u6211\u4eec\u627e\u5230 <code>SuperWallJump</code> \u65b9\u6cd5, \u6ce8\u610f\u5230\u7ad6\u76f4\u901f\u5ea6\u662f\u5728\u8fd9\u91cc\u8bbe\u7f6e\u7684:</p> Celeste.Player.SuperWallJump()<pre><code>...\nthis.wallSlideTimer = 1.2f;\nthis.wallBoostTimer = 0f;\nthis.Speed.X = 170f * (float)dir;\nthis.Speed.Y = -160f;\nthis.Speed += this.LiftBoost;\nthis.varJumpSpeed = this.Speed.Y;\nthis.launched = true;\n...\n</code></pre> <p>\u90a3\u4e48\u6211\u4eec\u67e5\u770b\u5b83\u9644\u8fd1 IL, \u7136\u540e\u67e5\u627e\u8fd9\u90e8\u5206 IL \u7684\u4e00\u4e2a\u7279\u5f81\u4ee5\u65b9\u4fbf\u6211\u4eec\u8fdb\u884c\u5b9a\u4f4d:</p> Celeste.Player.SuperWallJump()<pre><code>IL_0075: ldarg.1\nIL_0076: conv.r4\nIL_0077: mul\nIL_0078: stfld     float32 [FNA]Microsoft.Xna.Framework.Vector2::X\nIL_007D: ldarg.0\nIL_007E: ldflda    valuetype [FNA]Microsoft.Xna.Framework.Vector2 Celeste.Player::Speed\nIL_0083: ldc.r4    -160\nIL_0088: stfld     float32 [FNA]Microsoft.Xna.Framework.Vector2::Y\nIL_008D: ldarg.0\nIL_008E: ldarg.0\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u8fd9\u91cc\u6709\u4e00\u4e2a\u5f88\u7279\u6b8a\u7684 -160 \u6d6e\u70b9\u6570\u7684\u538b\u5165, \u5e76\u4e14\u7d27\u968f\u5176\u540e\u7684\u662f\u4e00\u4e2a <code>Vector2::Y</code> \u5b57\u6bb5\u7684\u5b58\u5165, \u90a3\u4e48\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7279\u5f81\u5c06 IL \u6307\u9488\u6307\u5411\u8fd9\u91cc:</p> <pre><code>if (cur.TryGotoNext(ins =&gt; ins.MatchLdcR4(-160f), ins =&gt; ins.MatchStfld&lt;Vector2&gt;(\"Y\")))\n{\n    // \u6307\u9488\u4f4d\u4e8e ldc.r4 \u6307\u4ee4\u4e86\n}\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6211\u4eec\u8981\u6c42 IL \u6307\u9488\u5411\u4e0b\u67e5\u627e, \u76f4\u5230\u627e\u5230\u4e00\u4e2a\u4f4d\u7f6e\u4f7f\u5f97 IL \u662f <code>ldc.r4 -160f</code> \u5e76\u4e14\u4e0b\u4e00\u884c\u662f\u50a8\u5b58\u5230 <code>Vector2</code> <code>Y</code> \u5b57\u6bb5. \u5982\u679c\u6ca1\u627e\u5230\u5219\u8fd4\u56de <code>false</code>. \u73b0\u5728, \u6211\u4eec\u7684\u6307\u9488\u5df2\u7ecf\u6307\u5411 <code>ldc.r4</code> \u4e86, \u4f46\u662f\u6b64\u65f6\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u52a0\u5165 IL \u4ee3\u7801\u5b9e\u9645\u4e0a\u4f1a\u52a0\u5230\u8fd9\u4e00\u884c\u4e0a\u9762\u53bb, \u6240\u6709\u6211\u4eec\u5f97\u5148\u8ba9\u5b83\u518d\u5411\u4e0b\u79fb\u52a8\u4e00\u884c, \u7136\u540e\u4f7f\u7528\u6211\u4eec\u7684 IL \u77e5\u8bc6, \u5c06\u5b83\u4e58\u4ee5\u4e2a 2: <pre><code>if (cur.TryGotoNext(ins =&gt; ins.MatchLdcR4(-160f), ins =&gt; ins.MatchStfld&lt;Vector2&gt;(\"Y\")))\n{\n    cur.Index++;\n    cur.Emit(OpCodes.Ldc_R4, 2.0f);\n    cur.Emit(OpCodes.Mul);\n}\n</code></pre></p> <p>Warning</p> <p>\u6ce8\u610f OpCodes \u4f4d\u4e8e <code>Mono.Cecil.Cil</code> \u800c\u4e0d\u662f <code>System.Reflection.Emit</code> \u547d\u540d\u7a7a\u95f4\u4e0b.</p> <p>\u73b0\u5728\u7f16\u8bd1\u8fd0\u884c, \u4f60\u5e94\u8be5\u80fd\u89c2\u5bdf\u5230\u8e6d\u5899\u8df3\u7684\u7ad6\u76f4\u901f\u5ea6\u53d8\u7684\u5f88\u5927!  </p> <p>\u6ce8\u610f\u7684\u662f, IL \u94a9\u5b50\u5f88\u5f3a\u5927, \u4f46\u4f7f\u7528\u5b83\u7684\u98ce\u9669\u4e5f\u5f88\u5927, \u7a0d\u6709\u4e0d\u614e\u5c31\u4f1a\u4f7f\u6574\u4e2a\u6e38\u620f\u76f4\u63a5\u5d29\u6e83. \u4f8b\u5982, \u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d, \u5982\u679c\u4f60\u5fd8\u8bb0\u4e86\u5411\u4e0b\u79fb\u52a8\u4e00\u884c, \u6211\u4eec\u5e0c\u671b\u63d2\u5165\u7684 IL \u4ee3\u7801\u5c31\u4f1a\u9519\u8bef\u5730\u88ab\u63d2\u5165\u81f3 ldc.r4 \u7684\u4e0a\u4e00\u884c, \u901a\u5e38\u8fd9\u4f1a\u5bfc\u81f4\u975e\u6cd5\u7684 IL \u4ee5\u5bfc\u81f4 JIT \u7f16\u8bd1\u5f02\u5e38, \u6216\u8005\u5176\u4ed6\u4e0d\u53ef\u9884\u77e5\u7684\u884c\u4e3a, \u4e0d\u8fc7\u5728\u8fd9\u91cc\u5b83\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u66f4\u52a0\u4e25\u91cd\u7684\u95ee\u9898, \u5b83\u4f1a\u76f4\u63a5\u5d29\u6e83\u6389\u4f60\u7684\u6e38\u620f\u5e76\u4e14\u4e0d\u52a0\u4efb\u4f55 log.txt \u7684\u8f93\u51fa\u548c error_log.txt \u7684\u5f39\u51fa! \u4f60\u53ef\u4ee5\u81ea\u5df1\u5c1d\u8bd5\u4e00\u4e0b\u6765\u611f\u53d7\u5982\u679c IL \u94a9\u5b50\u4f7f\u7528\u5931\u8bef\u7684\u60c5\u51b5.  </p> <p>\u901a\u5e38\u66f4\u5e38\u89c1\u5730, \u6211\u4eec\u5e0c\u671b\u8fd9\u4e2a\u7cfb\u6570\u662f\u53ef\u4ee5\u968f\u65f6\u4fee\u6539\u7684, \u76f8\u4fe1\u4f60\u5f88\u5feb\u5c31\u80fd\u60f3\u5230\u6bd4\u5982\u50a8\u5b58\u5230\u5b57\u6bb5\u91cc, \u7136\u540e\u63d2\u5165\u4e00\u4e9b\u590d\u6742\u7684\u5b57\u6bb5\u8bfb\u53d6\u4ee3\u7801\u6216\u8005\u590d\u6742\u7684\u65b9\u6cd5\u8c03\u7528\u4ee3\u7801, \u4e0d\u8fc7 MonoMod \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u65b9\u6cd5: <code>EmitDelegate</code>, \u5b83\u80fd\u4e00\u952e\u751f\u6210\u8fd9\u4e9b\u590d\u6742\u7684\u65b9\u6cd5\u83b7\u53d6\u548c\u8c03\u7528.  </p> <p>\u4f8b\u5982\u4f60\u6709\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5 <code>GetFactorOfWallJumpYSpeed</code>, \u5b83\u4f1a\u6839\u636e\u4e00\u4e9b\u60c5\u51b5\u8fd4\u56de\u4e0d\u540c\u7684\u503c, \u4f8b\u5982\u5728\u8fd9\u91cc\u68c0\u6d4b\u6309\u8df3\u65f6\u662f\u5426\u540c\u65f6\u6309\u4e0b\u6293\u952e, \u662f\u5219\u7ffb\u500d\u7ad6\u76f4\u901f\u5ea6, \u5426\u5219\u4e0d\u53d8:</p> <pre><code>public static float GetFactorOfWallJumpYSpeed()\n{\n    if (Input.Grab.Pressed)\n        return 2.0f;\n    else\n        return 1.0f;\n}\n</code></pre> <p>\u4e0a\u9762\u5bf9\u5e94\u7684\u4ee3\u7801:</p> <pre><code>if (cur.TryGotoNext(ins =&gt; ins.MatchLdcR4(-160f), ins =&gt; ins.MatchStfld&lt;Vector2&gt;(\"Y\")))\n{\n    cur.Index++;\n    // as easy as pi!\n    cur.EmitDelegate(GetFactorOfWallJumpYSpeed);\n    cur.Emit(OpCodes.Mul);\n}\n</code></pre>"},{"location":"hooks/adv_hooks/#il_3","title":"\u79fb\u9664 IL","text":"<p>\u901a\u5e38\u9664\u4e86\u63d2\u5165, \u6211\u4eec\u8fd8\u9700\u8981\u79fb\u9664 IL, \u5bf9\u4e8e\u4fee\u6539 IL \u7684\u60c5\u51b5\u6211\u4eec\u53ea\u9700\u8981\u5148\u79fb\u9664\u518d\u63d2\u5165\u5373\u53ef. \u8981\u79fb\u9664\u4e00\u884c IL, \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>Remove</code> \u65b9\u6cd5, <code>Remove</code> \u65b9\u6cd5\u4f1a\u79fb\u9664\u6307\u9488\u6240\u6307\u7684 IL \u884c, \u4f8b\u5982\u6211\u4eec\u4f9d\u7136\u4fee\u6539\u73a9\u5bb6\u7684\u8e6d\u5899\u8df3\u7ad6\u76f4\u901f\u5ea6, \u4f46\u662f\u5728\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u8986\u76d6\u6211\u4eec\u7684\u65b0\u503c:</p> <pre><code>if (cur.TryGotoNext(ins =&gt; ins.MatchLdcR4(-160f), ins =&gt; ins.MatchStfld&lt;Vector2&gt;(\"Y\")))\n{\n    // \u6ce8\u610f\u6ca1\u6709 cur.Index++ \u4e86, \u8bb0\u4f4f Emit \u65f6\u65b0\u4ee3\u7801\u88ab\u6dfb\u52a0\u5230\u4e0a\u4e00\u884c, \u800c Remove \u65f6\u5219\u79fb\u9664\u5f53\u524d\u884c\n    cur.Remove();\n    // \u5f53\u524d\u4e00\u884c\u7684 IL \u5df2\u7ecf\u88ab\u79fb\u9664\u4e86, \u73b0\u5728\u6307\u9488\u5b9e\u9645\u4e0a\u6307\u5411\u4e4b\u524d\u7684\u4e0b\u4e00\u884c, \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5 Emit\n    cur.Emit(OpCodes.Ldc_R4, -300.0f);\n}\n</code></pre> <p>Note</p> <p>\u5728\u63d2\u5165 IL, \u4fee\u6539 IL, \u66f4\u6539 IL \u6307\u9488\u6307\u5411\u65f6\u52a1\u5fc5\u6e05\u695a\u63d2\u5165\u4f4d\u7f6e, \u5220\u9664\u76ee\u6807, \u4ee5\u53ca\u64cd\u4f5c\u5b8c\u6210\u540e\u7684\u6307\u9488\u6307\u5411.</p>"},{"location":"hooks/adv_hooks/#_1","title":"\u4efb\u610f\u94a9\u53d6","text":"<p>\u76f8\u4fe1\u4f60\u5df2\u7ecf\u53d1\u73b0\u4e86, \u6709\u4e9b\u65b9\u6cd5\u6bd4\u5982\u53eb\u505a <code>orig_xxx</code> \u7684\u65b9\u6cd5, \u4ee5\u53ca\u5c5e\u6027\u7684 getter \u548c setter \u4f60\u90fd\u65e0\u6cd5\u5728 On. \u548c IL. \u8fd9\u4e24\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u627e\u5230, \u540c\u65f6, \u94a9\u53d6\u522b\u7684 helper \u7684\u65b9\u6cd5\u4f3c\u4e4e\u4e5f\u65e0\u6cd5\u5b8c\u6210.  </p> <p>\u8fd9\u91cc\u6211\u4eec\u5f15\u5165\u4e24\u4e2a\u65b0\u7c7b: <code>Hook</code> \u4e0e <code>ILHook</code>, \u524d\u8005\u8868\u793a\u4e00\u4e2a On \u94a9\u5b50, \u540e\u8005\u8868\u793a\u4e00\u4e2a IL \u94a9\u5b50.  </p> <p><code>Hook</code> \u7684\u6784\u9020\u51fd\u6570\u62e5\u6709\u975e\u5e38\u591a\u91cd\u8f7d, \u5728\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u90a3\u4e2a <code>(MethodBase method, Delegate to)</code> \u7684\u91cd\u8f7d, \u5b83\u8868\u793a\u6211\u4eec\u5e0c\u671b\u94a9\u53d6\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u7684\u65b9\u6cd5, \u94a9\u5b50\u65b9\u6cd5\u662f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u7684\u59d4\u6258.  </p> <p>\u4f8b\u5982, \u6211\u4eec\u5e0c\u671b\u94a9\u53d6 <code>Player.Inventory</code> \u8fd9\u4e2a\u5c5e\u6027\u7684 <code>get</code> \u65b9\u6cd5, \u4f7f\u5176\u603b\u662f\u8fd4\u56de <code>PlayerInventory.TheSummit</code>, \u4e5f\u5c31\u662f\u603b\u662f\u5177\u6709\u80cc\u5305, \u53cc\u51b2\u7b49:</p> <pre><code>// \u50a8\u5b58\u6211\u4eec\u7684 hook, \u4ee5\u4fbf\u6211\u4eec\u5728 Unload \u4e2d\u91ca\u653e\u5b83\nprivate Hook playerInventory_get_hook;\n\npublic override void Load()\n{\n    // \u5148\u4f7f\u7528\u53cd\u5c04\u627e\u5230 Player.Inventory \u5c5e\u6027\u7684 getter\n    var playerInventory_get = typeof(Player).GetProperty(\"Inventory\").GetGetMethod();\n    // \u4f7f\u7528\u5176\u521b\u5efa\u4e00\u4e2a On \u94a9\u5b50\n    playerInventory_get_hook = new(playerInventory_get, PlayerInventoryHook);\n}\n\n// \u6211\u4eec\u9700\u8981\u624b\u52a8\u58f0\u660e orig \u65b9\u6cd5\u7684\u59d4\u6258, \u56e0\u4e3a\u8fd9\u91cc\u4e0d\u518d\u662f\u65b9\u4fbf\u7684\u4e8b\u4ef6\u8ba2\u9605\u4e86\npublic delegate PlayerInventory PlayerInventory_get_orig(Player self);\npublic static PlayerInventory PlayerInventoryHook(PlayerInventory_get_orig orig, Player self)\n{\n    // \u76f4\u63a5\u5ffd\u7565 orig \u65b9\u6cd5\u7684\u8c03\u7528, \u5f3a\u5236\u8fd4\u56de 7a/b/c \u7684 Inventory\n    return PlayerInventory.TheSummit;\n}\n\npublic override void Unload()\n{\n    // \u8bb0\u5f97\u9500\u6bc1\u94a9\u5b50\n    playerInventory_get_hook.Dispose();\n}\n</code></pre> <p>\u56e0\u4e3a\u4e0d\u518d\u662f\u4e4b\u524d\u65b9\u4fbf\u7684\u4e8b\u4ef6\u8ba2\u9605, \u6240\u4ee5\u94a9\u5b50\u7684 orig \u53c2\u6570\u7684\u59d4\u6258\u539f\u578b\u4f60\u5fc5\u987b\u5f97\u81ea\u5df1\u58f0\u660e, \u6ce8\u610f\u94a9\u5b50\u65b9\u6cd5\u548c\u94a9\u5b50 orig \u53c2\u6570\u7684\u53c2\u6570\u5217\u8868\u4e00\u5b9a\u8981\u5c0f\u5fc3\u51c6\u786e\u7684\u586b\u5199, \u5426\u5219\u4f1a\u76f4\u63a5\u9020\u6210\u6e38\u620f\u5d29\u6e83. \u4e0a\u8ff0\u4ee3\u7801\u7684\u6548\u679c\u5e94\u8be5\u662f\u4f60\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u62e5\u6709 7a/b/c \u7684 Inventory, \u4e5f\u5373\u53cc\u51b2, \u5e26\u80cc\u5305\u7b49.  </p> <p>\u73b0\u5728, \u62e5\u6709\u4e86\u94a9\u5b50\u51fd\u6570, \u4f60\u53ef\u4ee5\u505a\u4efb\u4f55\u4f60\u4e4b\u524d\u4f7f\u7528\u8ba2\u9605\u4e8b\u4ef6\u6765\u521b\u5efa\u94a9\u5b50\u4e00\u6837\u7684\u4e8b. \u987a\u4fbf, \u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u5141\u8bb8\u4f60\u94a9\u53d6\u522b\u7684 helper \u7684\u65b9\u6cd5, \u751a\u81f3\u662f\u94a9\u53d6\u522b\u7684 helper \u7684\u94a9\u5b50\u65b9\u6cd5. \u4e0d\u8fc7\u5728\u6b64\u4e4b\u524d\u4f60\u9700\u8981\u4e3a\u4f60\u7684 mod \u58f0\u660e\u4f9d\u8d56\u6216\u8005\u53ef\u9009\u4f9d\u8d56, \u58f0\u660e\u53ef\u9009\u4f9d\u8d56\u540e\u53c8\u9700\u8981\u68c0\u6d4b\u5bf9\u5e94 mod \u662f\u5426\u52a0\u8f7d\u7b49\u7b49.  </p> <p>\u540c\u6837\u5730, IL \u94a9\u5b50\u7684\u521b\u5efa\u4e5f\u4e0e On \u94a9\u5b50\u76f8\u540c:</p> <pre><code>private ILHook playerInventory_get_ilhook;\n\npublic override void Load()\n{\n    var playerInventory_get = typeof(Player).GetProperty(\"Inventory\").GetGetMethod();\n    playerInventory_get_ilhook = new(playerInventory_get, PlayerInventoryILHook);\n}\n\npublic static void PlayerInventoryILHook(ILContext context)\n{\n    // \u50cf\u4e4b\u524d\u4e00\u6837\u505a\u4f60\u5728 IL \u94a9\u5b50\u4e2d\u505a\u7684\u4e8b...\n}\n\npublic override void Unload()\n{\n    playerInventory_get_ilhook.Dispose();\n}\n</code></pre> <p>\u4e0d\u8fc7\u4e0d\u518d\u9700\u8981\u624b\u52a8\u58f0\u660e orig \u59d4\u6258, \u56e0\u4e3a IL \u94a9\u5b50\u7684\u94a9\u5b50\u65b9\u6cd5\u53c2\u6570\u5217\u8868\u662f\u56fa\u5b9a\u7684.</p> <p>Note</p> <p>\u5173\u4e8e\u534f\u7a0b\u51fd\u6570\u7684\u94a9\u53d6\u4e0e\u4e0a\u8ff0\u6b65\u9aa4\u622a\u7136\u4e0d\u540c, \u8fd9\u4e00\u70b9\u6211\u4eec\u4f1a\u5728\u4e0b\u4e00\u8282\u63a2\u8ba8.</p>"},{"location":"hooks/adv_hooks/#helper","title":"\u94a9\u53d6\u5176\u4ed6 helper","text":"<p>Note</p> <p>\u53c2\u8003 Everest Wiki </p> <p>\u9996\u5148\u6211\u4eec\u5728\u94a9\u53d6\u524d\u9700\u8981\u786e\u4fdd\u5bf9\u5e94 helper \u5df2\u88ab\u52a0\u8f7d, \u90a3\u4e48\u6211\u4eec\u5148\u5728 <code>everest.yaml</code> \u6587\u4ef6\u91cc\u52a0\u4e0a\u5bf9\u5e94\u7684\u53ef\u9009\u4f9d\u8d56, \u8fd9\u6837 Everest \u4f1a\u786e\u4fdd\u5b58\u5728\u8be5\u4f9d\u8d56\u65f6\u603b\u662f\u5728\u8be5\u4f9d\u8d56\u52a0\u8f7d\u4e4b\u540e\u518d\u52a0\u8f7d\u6211\u4eec\u7684 mod.</p> everest.yaml<pre><code>- Name: MyCelesteMod\n  Version: 0.1.0\n  DLL: Code/MyCelesteMod.dll\n  Dependencies:\n    - Name: EverestCore\n      Version: 1.4465.0\n    - Name: CommunalHelper\n      Version: 1.20.4\n</code></pre> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u4ee5 <code>CommunalHelper</code> \u91cc\u7684 <code>Chain</code> \u5b9e\u4f53\u4e3a\u4f8b, \u94a9\u53d6\u5b83\u7684 <code>Update</code>:</p> <pre><code>private static Hook chainUpdateHook;\n\nprivate delegate void chainUpdateHookDelegate(Entity self);\n\npublic static void Load()\n{\n    EverestModuleMetadata communalHelper = new()\n    {\n        Name = \"CommunalHelper\",\n        Version = new Version(\"1.20.4\")\n    };\n\n    // \u5c1d\u8bd5\u83b7\u53d6 CommunalHelper \u7684 Module \u5b9e\u4f8b\n    if (Everest.Loader.TryGetDependency(communalHelper, out EverestModule communalModule))  \n    {\n        Assembly communalAssembly = communalModule.GetType().Assembly;  // \u62ff\u5230 communalHelper \u7684\u7a0b\u5e8f\u96c6\n        Type chain = communalAssembly.GetType(\"Celeste.Mod.CommunalHelper.Entities.Chain\");  // \u62ff\u5230 Chain \u7684 Type\n        MethodInfo method = chain.GetMethod(\"Update\", BindingFlags.Instance | BindingFlags.Public);  // \u62ff\u5230 Update \u51fd\u6570\n        chainUpdateHook = new Hook(method, ChainOnUpdate);\n        // Logger.Log(LogLevel.Info, \"Test\", \"HookChainOnUpdate OK\");\n    }\n}\n\npublic static void Unload()\n{\n    chainUpdateHook.Dispose();\n}\n\nprivate static void ChainOnUpdate(chainUpdateHookDelegate orig, Entity chain)\n{\n    orig(chain);\n    // \u505a\u4e00\u4e9b\u4e8b\n    // Logger.Log(LogLevel.Info, \"Test\", \"123\");\n}\n</code></pre> <p>\u4f46\u662f\u8fd9\u4e48\u5199\u5c31\u5f88\u96be\u53d7, \u800c\u4e14 chain \u7684\u7c7b\u578b\u4e3a Entity \u4e0d\u4e3a Chain \u4e86, \u60f3\u7c7b\u578b\u8f6c\u6210 Chain \u6211\u4eec\u53c8\u62ff\u4e0d\u5230 Chain, \u8fd9\u65f6\u5c31\u9700\u8981\u6211\u4eec\u6dfb\u52a0 <code>CommunalHelper</code> \u7a0b\u5e8f\u96c6\u7684\u4f9d\u8d56(\u50cf\u4e00\u5f00\u59cb\u914d\u7f6e\u851a\u84dd code \u73af\u5883\u90a3\u6837)  </p> <p></p> <p>dc \u793e\u533a\u4e60\u60ef\u7684\u505a\u6cd5\u662f\u5c06\u8fd9\u4e2a dll \u7684 ref \u7248\u672c (\u4e5f\u5c31\u662f stripped \u540e\u7684\u7248\u672c, \u5220\u9664\u4e86\u6240\u6709\u65b9\u6cd5\u7684\u5b9e\u73b0, \u53ea\u4fdd\u7559\u4e86\u5143\u6570\u636e) \u653e\u5230 mod \u76ee\u5f55\u5916\u9762\u7684 lib-stripped \u76ee\u5f55\u91cc\u7136\u540e\u5f15\u7528. \u53c2\u8003\u8349\u8393\u9171\u7684\u6e90\u7801. strip \u7684\u65b9\u6cd5\u4e0d\u552f\u4e00, \u4f8b\u5982\u4f60\u53ef\u4ee5\u4f7f\u7528 mono \u7684 strip \u5de5\u5177 <code>mono-cil-strip</code>, \u6216\u8005 <code>NStrip</code> \u8fd9\u4e2a\u5de5\u5177, \u5177\u4f53\u5728\u8fd9\u91cc\u5c31\u4e0d\u8bf4\u660e\u4e86.  </p> <p>\u6211\u4e2a\u4eba\u4e60\u60ef\u76f4\u63a5\u5f15\u7528 \u851a\u84dd\u6839\u76ee\u5f55/Mods/Cache/xxx.xxx.dll \u8fd9\u91cc\u7684 dll, \u5982\u679c\u4f60\u7684\u6a21\u677f\u662f\u6700\u65b0\u7684\u8bdd, \u4f60\u53ef\u4ee5\u4f7f\u7528 <code>CelesteModReference</code> \u9879\u6765\u5f15\u7528, \u4f8b\u5982 BetterFreezeFrames \u4e2d\u7684\u4f7f\u7528\u4f8b\u5b50:</p> BetterFreezeFrames.csproj<pre><code>&lt;ItemGroup&gt;\n    &lt;CelesteModReference Include=\"FemtoHelper\" /&gt;\n    &lt;CelesteModReference Include=\"IsaGrabBag\" AssemblyName=\"IsaMods\" /&gt;\n    &lt;CelesteModReference Include=\"VivHelper\" /&gt;\n    &lt;CelesteModReference Include=\"FlaglinesAndSuch\" /&gt;\n    &lt;CelesteModReference Include=\"VortexHelper\" /&gt;\n&lt;/ItemGroup&gt;\n</code></pre> <p>\u6bcf\u4e00\u9879\u7684 <code>Include</code> \u8868\u793a mod \u540d\u79f0, \u53ef\u9009\u7684 <code>AssemblyName</code> \u8868\u793a\u7a0b\u5e8f\u96c6\u540d\u79f0, \u9ed8\u8ba4\u4e3a <code>Include</code> \u7684\u503c, \u8fd9\u6837\u5728\u6784\u5efa\u9879\u76ee\u65f6\u6a21\u677f\u4f1a\u81ea\u52a8\u5f15\u7528 Mods/Cache/(Include).(AssemblyName).dll \u8fd9\u4e2a\u7a0b\u5e8f\u96c6. \u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5f15\u7528\u597d\u4e86\u4f9d\u8d56\u4e86: <pre><code>private static Hook chainUpdateHook;\n\nprivate delegate void chainUpdateHookDelegate(Chain self);\n\npublic static void Load()\n{\n    EverestModuleMetadata communalHelper = new()\n    {\n        Name = \"CommunalHelper\",\n        Version = new Version(\"1.20.4\")\n    };\n    bool isLoaded = Everest.Loader.DependencyLoaded(communalHelper);\n    if (isLoaded)\n    {\n        chainUpdateHook = new Hook(typeof(Chain).GetMethod(\"Update\"), ChainOnUpdate);\n    }\n}\n\nprivate static void ChainOnUpdate(chainUpdateHookDelegate orig, Chain chain)\n{\n    orig(chain);\n    Logger.Log(LogLevel.Info, \"Test\", \"123\");\n}\n\npublic static void Unload()\n{\n    chainUpdateHook.Dispose();\n}\n</code></pre></p>"},{"location":"hooks/adv_hooks2/","title":"\u534f\u7a0b\u7684\u94a9\u53d6\u4e0e\u79c1\u6709\u8bbf\u95ee","text":""},{"location":"hooks/adv_hooks2/#_2","title":"\u534f\u7a0b\u7684\u94a9\u53d6","text":""},{"location":"hooks/adv_hooks2/#_3","title":"\u8fed\u4ee3\u5668\u51fd\u6570","text":"<p>\u8fed\u4ee3\u5668\u51fd\u6570, \u4e5f\u5373\u65b9\u6cd5\u4f53\u5e26 <code>yield return</code> \u6216 <code>yield break</code> \u8bed\u53e5\u5e76\u8fd4\u56de <code>IEnumerable</code> \u6216 <code>IEnumerator</code> \u7684\u51fd\u6570, \u5b83\u5141\u8bb8\u4f60 \"\u4e2d\u65ad\" \u51fd\u6570\u7684\u8fd0\u884c\u5e76\u4e2d\u9014 \"\u8fd4\u56de\" \u4e00\u4e2a\u503c. \u7ecf\u8fc7\u524d\u9762 Alarm, Tween, Coroutine \u8282\u7684\u4ecb\u7ecd\u76f8\u4fe1\u4f60\u4e5f\u77e5\u9053\u5230\u4e86\u534f\u7a0b\u4e4b\u4e8e\u8fed\u4ee3\u5668\u51fd\u6570\u7684\u5f3a\u5927. \u4e0d\u8fc7\u5bf9\u4e8e\u534f\u7a0b\u51fd\u6570\u7684\u94a9\u53d6\u5e76\u4e0d\u662f\u90a3\u4e48\u7b80\u5355, \u9700\u8981\u4e00\u4e9b\u989d\u5916\u6b65\u9aa4.  </p> <p>\u5982\u679c\u4f60\u76f8\u5bf9\u4e86\u89e3\u4e00\u70b9 C# \u7684\u5e95\u5c42\u7684\u8bdd, \u4f60\u5e94\u8be5\u4f1a\u77e5\u9053\u8fed\u4ee3\u5668\u51fd\u6570\u6700\u7ec8\u4f1a\u88ab\u7f16\u8bd1\u4e3a\u4e00\u4e2a\u72b6\u6001\u673a\u7c7b, \u800c\u539f\u51fd\u6570\u53ea\u662f\u505a\u4e86\u4e00\u4e2a new \u5e76\u8fd4\u56de\u7684\u5de5\u4f5c. \u4e3a\u4e86\u5728\u53cd\u7f16\u8bd1\u5668\u6bd4\u5982 dnspy \u4e2d\u6d4f\u89c8\u8fd9\u4e2a\u72b6\u6001\u673a\u7c7b, \u4f60\u9700\u8981\u5173\u95ed\u7c7b\u4f3c\u7684 \u89c6\u56fe -&gt; \u9009\u9879 -&gt; \u53cd\u7f16\u8bd1\u5668 -&gt; \u53cd\u7f16\u8bd1\u679a\u4e3e\u5668 \u8fd9\u4e2a\u529f\u80fd, \u8fd9\u6837\u53cd\u7f16\u8bd1\u5668\u624d\u4f1a\u5c55\u793a\u9690\u85cf\u7684\u72b6\u6001\u673a\u7c7b.  </p> <p>\u6bd4\u5982 <code>FinalBoss.Attack01Sequence</code> \u65b9\u6cd5:</p> <p>\u539f\u65b9\u6cd5:</p> <pre><code>private IEnumerator Attack01Sequence()\n{\n    this.StartShootCharge();\n    for (;;)\n    {\n        yield return 0.5f;\n        this.Shoot(0f);\n        yield return 1f;\n        this.StartShootCharge();\n        yield return 0.15f;\n        yield return 0.3f;\n    }\n    yield break;\n}\n</code></pre> <p>\u5173\u95ed \u53cd\u7f16\u8bd1\u679a\u4e3e\u5668 \u9009\u9879\u540e:</p> <pre><code>private IEnumerator Attack01Sequence()\n{\n    FinalBoss.&lt;Attack01Sequence&gt;d__49 &lt;Attack01Sequence&gt;d__ = new FinalBoss.&lt;Attack01Sequence&gt;d__49(0);\n    &lt;Attack01Sequence&gt;d__.&lt;&gt;4__this = this;\n    return &lt;Attack01Sequence&gt;d__;\n}\n</code></pre> <p>\u5176\u4e2d <code>&lt;Attack01Sequence&gt;d__49</code> \u8fd9\u4e2a\u53e4\u602a\u7684\u7c7b\u540d\u5c31\u662f\u80cc\u540e\u751f\u6210\u7684\u72b6\u6001\u673a\u7c7b, \u800c\u65b9\u6cd5\u4f53\u7684\u5b9e\u9645\u5185\u5bb9\u5219\u5728\u8be5\u7c7b\u7684 <code>MoveNext</code> \u65b9\u6cd5\u4e2d:</p> <pre><code>bool IEnumerator.MoveNext()\n{\n    int num = this.&lt;&gt;1__state;\n    FinalBoss finalBoss = this.&lt;&gt;4__this;\n    switch (num)\n    {\n    case 0:\n        this.&lt;&gt;1__state = -1;\n        finalBoss.StartShootCharge();\n        break;\n    case 1:\n        this.&lt;&gt;1__state = -1;\n        finalBoss.Shoot(0f);\n        this.&lt;&gt;2__current = 1f;\n        this.&lt;&gt;1__state = 2;\n        return true;\n    case 2:\n        this.&lt;&gt;1__state = -1;\n        finalBoss.StartShootCharge();\n        this.&lt;&gt;2__current = 0.15f;\n        this.&lt;&gt;1__state = 3;\n        return true;\n    case 3:\n        this.&lt;&gt;1__state = -1;\n        this.&lt;&gt;2__current = 0.3f;\n        this.&lt;&gt;1__state = 4;\n        return true;\n    case 4:\n        this.&lt;&gt;1__state = -1;\n        break;\n    default:\n        return false;\n    }\n    this.&lt;&gt;2__current = 0.5f;\n    this.&lt;&gt;1__state = 1;\n    return true;\n}\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2d <code>&lt;&gt;2__current</code> \u8fd9\u4e2a\u53e4\u602a\u7684\u5b57\u6bb5\u7528\u6765\u50a8\u5b58\u8fd4\u56de\u503c, <code>&lt;&gt;1__state</code> \u5219\u7528\u6765\u50a8\u5b58\u534f\u7a0b\u8fd0\u884c\u7684\u8fdb\u5ea6.</p>"},{"location":"hooks/adv_hooks2/#on","title":"On \u534f\u7a0b\u94a9\u5b50","text":"<p>\u5bf9\u534f\u7a0b\u4f7f\u7528 On \u94a9\u5b50\u76f8\u5bf9\u7b80\u5355\u4e00\u70b9 ,\u4f8b\u5982\u94a9\u53d6 <code>Celeste.NPC01_Theo.Talk</code> \u8fd9\u4e2a\u534f\u7a0b\u51fd\u6570, \u4e5f\u5c31\u662f 1a 6zb \u9762\u7684 theo \u7684\u5bf9\u8bdd\u7684\u534f\u7a0b, \u5982\u679c\u4f60\u76f4\u63a5\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801(\u65b9\u6cd5 1):</p> <pre><code>public override void Load()\n{\n    On.Celeste.NPC01_Theo.Talk += NPC01_Theo_Talk;\n}\n\nprivate IEnumerator NPC01_Theo_Talk(On.Celeste.NPC01_Theo.orig_Talk orig, NPC01_Theo self, Player player)\n{\n    var it = orig(self, player);\n    Logger.Log(LogLevel.Info, \"Test\", \"not the right time.\");\n    return it;\n}\n\npublic override void Unload()\n{\n    On.Celeste.NPC01_Theo.Talk -= NPC01_Theo_Talk;\n}\n</code></pre> <p>\u4f60\u4f1a\u53d1\u73b0\u5b83\u5b9e\u9645\u4e0a\u662f\u5728\u5bf9\u8bdd\u5f00\u59cb\u524d\u8f93\u51fa\u7684, \u8fd9\u5e76\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u65f6\u673a, \u540c\u6837\u8fd9\u4e5f\u5f88\u597d\u7406\u89e3\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837, \u56e0\u4e3a\u539f\u51fd\u6570\u53ea\u662f\u8fd4\u56de\u4e86\u4e00\u4e2a\u80cc\u540e\u72b6\u6001\u673a\u7c7b\u7684\u65b0\u5b9e\u4f8b. \u4e3a\u4e86\u8fbe\u6210\u8fd9\u4e2a\u76ee\u7684, \u6211\u4eec\u9700\u8981\u8fd9\u4e48\u505a(\u65b9\u6cd5 2):</p> <pre><code>private IEnumerator NPC01_Theo_Talk(On.Celeste.NPC01_Theo.orig_Talk orig, NPC01_Theo self, Player player)\n{\n    IEnumerator origEnum = orig(self, player);\n    while (origEnum.MoveNext()) yield return origEnum.Current;\n    Logger.Log(LogLevel.Info, \"Test\", \"the right time.\");\n}\n</code></pre> <p>\u4e5f\u5c31\u662f\u5c06\u5bf9\u5e94\u7684\u534f\u7a0b\u5305\u88c5\u8d77\u6765\u5e76\u5728\u6700\u540e\u9644\u52a0\u6211\u4eec\u7684\u4ee3\u7801. \u8bf4\u5230\u8fd9\u4e2a, \u4f60\u53ef\u80fd\u4f1a\u60f3\u5230\u8fd9\u6bb5\u4ee3\u7801\u53ef\u4ee5\u7b80\u5316\u6210\u8fd9\u6837(\u65b9\u6cd5 3):</p> <pre><code>private IEnumerator NPC01_Theo_Talk(On.Celeste.NPC01_Theo.orig_Talk orig, NPC01_Theo self, Player player)\n{\n    yield return orig(self, player);\n    Logger.Log(LogLevel.Info, \"Test\", \"does not execute.\");\n}\n</code></pre> <p>\u76f4\u63a5\u5c06\u534f\u7a0b\u8fd4\u56de\u5e76\u5728\u5176\u6267\u884c\u5b8c\u540e\u505a\u4e00\u4e9b\u4e8b, \u770b\u8d77\u6765\u4f3c\u4e4e\u6ca1\u4ec0\u4e48\u95ee\u9898? \u4f46\u662f! \u5982\u679c\u4f60\u770b\u8fc7 <code>Coroutine</code> \u7684\u5b9e\u73b0\u7684\u8bdd, \u4f60\u4f1a\u53d1\u73b0\u534f\u7a0b\u8fd4\u56de\u53e6\u4e00\u4e2a\u534f\u7a0b\u65f6, \u53e6\u4e00\u4e2a\u534f\u7a0b\u5e76\u4e0d\u662f\u9a6c\u4e0a\u6267\u884c\u7684, \u800c\u662f\u7b49\u5230\u4e86\u4e0b\u4e00\u5e27, \u4e3a\u4e86\u66f4\u597d\u7684\u517c\u5bb9 tas, \u6211\u4eec\u8981\u4e48\u4f7f\u7528\u65b9\u6cd5 2, \u8981\u4e48\u4f7f\u7528\u5982\u4e0b\u7c7b\u4f3c\u7684\u4ee3\u7801(\u65b9\u6cd5 4):</p> <pre><code>private IEnumerator OuiFileSelect_Leave(On.Celeste.OuiFileSelect.orig_Leave orig, OuiFileSelect self, Oui next) \n{\n    yield return new SwapImmediately(orig(self, next));\n    Logger.Log(\"TestMod\", \"I left file select!\");\n}\n</code></pre> <p>\u4e5f\u5c31\u662f\u5728\u83b7\u53d6\u534f\u7a0b\u540e\u518d\u7528 everest \u4e3a\u6211\u4eec\u63d0\u4f9b\u7684 <code>SwapImmediately</code> \u5305\u8d77\u6765, \u8fd9\u4f1a\u8ba9\u5185\u90e8\u7684\u534f\u7a0b\u7acb\u523b\u524d\u8fdb\u4e00\u6b21. \u800c\u4e0d\u4f1a\u7b49\u5f85\u591a\u4f59\u7684 1 \u5e27.</p> <p>Info</p> <p>\u5177\u4f53\u4e0a\u8ff0\u65b9\u6cd5\u7684\u884c\u4e3a\u63cf\u8ff0\u7684\u53ef\u80fd\u5e76\u4e0d\u662f\u5f88\u51c6\u786e, \u56e0\u4e3a\u6211\u4e2a\u4eba\u5f88\u5c11\u4f1a\u51fa\u73b0\u9700\u8981\u94a9\u53d6\u534f\u7a0b\u7684\u6848\u4f8b, \u5f88\u611f\u8c22\u5982\u679c\u4f60\u80fd\u5b8c\u5584\u5b83\u7684\u8bdd!</p>"},{"location":"hooks/adv_hooks2/#il","title":"IL \u534f\u7a0b\u94a9\u5b50","text":"<p>\u5bf9\u534f\u7a0b\u4f7f\u7528 IL \u94a9\u5b50\u76f8\u5bf9\u4f1a\u590d\u6742\u5f88\u591a, \u56e0\u4e3a\u5bf9\u539f\u51fd\u6570\u4f7f\u7528 IL \u94a9\u5b50\u901a\u5e38\u662f\u6ca1\u6709\u610f\u4e49\u7684, \u4e3a\u6b64, \u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230\u80cc\u540e\u5b9e\u9645\u50a8\u5b58\u65b9\u6cd5\u4f53\u7684\u72b6\u6001\u673a\u7684 <code>MoveNext</code> \u65b9\u6cd5:</p> <pre><code>var methodInfo = typeof(Player).GetMethod(\"DashCoroutine\", BindingFlags.NonPublic | BindingFlags.Instance).GetStateMachineTarget();\nILHook dashCoroutineHook = new ILHook(methodInfo, ILHookDashCoroutine);\n</code></pre> <p>\u5728\u8fd9\u91cc, MonoMod \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f88\u65b9\u4fbf\u7684\u62d3\u5c55\u65b9\u6cd5 <code>GetStateMachineTarget</code>, \u5b83\u4f1a\u83b7\u53d6\u8fd9\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u7684\u72b6\u6001\u673a\u7684 <code>MoveNext</code> \u65b9\u6cd5, \u968f\u540e\u6211\u4eec\u624b\u52a8\u6784\u9020\u4e00\u4e2a IL \u94a9\u5b50, \u7136\u540e\u5c31\u50cf\u5f80\u5e38\u4e00\u6837\u5b9e\u73b0\u6211\u4eec\u7684\u94a9\u5b50. \u4e0d\u8fc7\u5f53\u7136, \u96be\u5ea6\u4f1a\u975e\u5e38\u5927, \u56e0\u4e3a\u901a\u5e38\u8fd9\u4e2a\u65b9\u6cd5\u662f\u975e\u5e38\u6df7\u4e71\u7684.</p>"},{"location":"hooks/adv_hooks2/#_4","title":"\u79c1\u6709\u8bbf\u95ee","text":"<p>\u901a\u5e38, \u4f60\u53ef\u80fd\u9700\u8981\u8bbf\u95ee\u4e00\u4e2a\u79c1\u6709\u65b9\u6cd5\u6216\u8005\u79c1\u6709\u5b57\u6bb5, \u9996\u5148\u6700\u5bb9\u6613\u60f3\u5230\u7684\u5f53\u7136\u662f\u53cd\u5c04, \u4e0d\u8fc7 MonoMod \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u597d\u7684\u4e1c\u897f: <code>DynamicData</code> \u7c7b, \u4f8b\u5982\u8bbf\u95ee\u73a9\u5bb6\u7684\u79c1\u6709\u5b57\u6bb5 <code>onGround</code>:</p> <pre><code>DynamicData playerData = DynamicData.For(player);\nbool onGround = playerData.Get&lt;bool&gt;(\"onGround\");\n</code></pre> <p>\u4fee\u6539\u4e5f\u5341\u5206\u7b80\u5355, \u4f8b\u5982\u4fee\u6539\u73a9\u5bb6\u7684\u6700\u5927\u4e0b\u843d\u901f\u5ea6:</p> <pre><code>playerData.Set(\"maxFall\", 660f);\n</code></pre> <p>\u8c03\u7528\u79c1\u6709\u65b9\u6cd5\u540c\u7406, \u53c2\u6570\u4e5f\u53ea\u9700\u4f5c\u4e3a params \u53c2\u6570\u4f20\u9012:</p> <pre><code>playerData.Invoke(\"Duck\");\n\nbool checkResult = (bool)playerData.Invoke(\"DreamDashCheck\", Vector2.UnitX);\n</code></pre> <p>\u5bf9\u4e8e\u9759\u6001\u7c7b, \u53ea\u9700\u8981\u7b80\u5355\u7684\u66f4\u6539\u83b7\u53d6 <code>DynamicData</code> \u7684\u65b9\u5f0f:</p> <pre><code>DynamicData inputData = new DynamicData(typeof(Input));\n</code></pre> <p>\u968f\u540e\u9759\u6001\u65b9\u6cd5, \u5b57\u6bb5, \u5c5e\u6027\u7684\u8bbf\u95ee\u4e5f\u4e0e\u5b9e\u4f8b\u7684\u76f8\u540c.  </p> <p>\u5f53\u5b57\u7b26\u4e32\u6307\u5b9a\u7684\u6210\u5458\u4e0d\u5b58\u5728\u65f6, \u6ce8\u610f\u5e76\u4e0d\u4f1a\u62a5\u9519, \u5bf9\u4e8e\u5176\u7684\u975e\u6cdb\u578b <code>Get</code> \u65b9\u6cd5\u4f1a\u7b80\u5355\u5730\u8fd4\u56de null \u503c, \u5bf9\u4e8e\u503c\u7c7b\u578b\u6cdb\u578b <code>Get</code> \u65b9\u6cd5\u4f1a\u5f15\u53d1\u7a7a\u5f15\u7528\u5f02\u5e38, \u5bf9\u4e8e\u5f15\u7528\u7c7b\u578b\u6cdb\u578b <code>Get</code> \u65b9\u6cd5\u8fd4\u56de null. \u4e0d\u8fc7\u5bf9\u4e8e <code>Set</code> \u65b9\u6cd5, \u5982\u679c\u6307\u5b9a\u7684\u6210\u5458\u4e0d\u5b58\u5728\u65f6\u5b83\u4f1a\u5c06\u8fd9\u4e2a\u6210\u5458 \"\u7c98\u9644\" \u5230\u5bf9\u8c61\u4e0a, \u5c31\u50cf\u7ed9\u5bf9\u8c61\u52a8\u6001\u52a0\u4e86\u4e00\u6761\u5b57\u6bb5\u4e00\u6837, \u968f\u540e\u4f7f\u7528 <code>Get</code> \u65b9\u6cd5\u4e5f\u80fd\u83b7\u53d6\u5230\u8fd9\u4e2a\u503c, \u4f60\u53ef\u4ee5\u4f7f\u7528\u5c06\u8fd9\u4e2a\u884c\u4e3a\u5f53 \"\u52a8\u6001\u6dfb\u52a0\u5b57\u6bb5\" \u4e00\u6837\u4f7f\u7528. \u4f8b\u5982:</p> <pre><code>DynamicData dd = DynamicData.For(player);\ndd.Set(\"mcm_attached\", \"some attached data...\");\n\n\n// ...\u4e00\u4e9b\u5176\u4ed6\u5730\u65b9\nstring data = dd.Get&lt;string&gt;(\"mcm_attached\");\nLogger.Log(LogLevel.Info, \"MyCelesteMod\", $\"data is {data}\");\n</code></pre> <p>\u4e0d\u8fc7\u8bb0\u5f97\u6dfb\u52a0\u81ea\u5df1 mod \u72ec\u7279\u7684\u547d\u540d\u524d\u7f00\u4ee5\u9632\u91cd\u540d, <code>DynamicData</code> \u5728\u4e0d\u540c mod \u95f4\u662f\u5171\u4eab\u7684.</p>"},{"location":"hooks/hook/","title":"\u94a9\u5b50","text":""},{"location":"hooks/hook/#_2","title":"\u524d\u8a00","text":"<p>\u5728\u8fd9\u4e00\u8282, \u6211\u4eec\u4f1a\u4ecb\u7ecd\u5728\u5236\u4f5c mod \u4e2d\u7684\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6280\u672f: \u94a9\u5b50(Hook), \u6211\u4eec\u4e3b\u8981\u4ecb\u7ecd On \u94a9\u5b50, \u5728\u4e4b\u540e\u6211\u4eec\u4f1a\u9605\u8bfb\u851a\u84dd\u7684\u4ee3\u7801, \u6700\u540e\u6211\u4eec\u4f1a\u5236\u4f5c\u4e00\u4e2a\u4fee\u6539\u73a9\u5bb6\u51b2\u523a\u6570\u7684\u5c0f demo.</p>"},{"location":"hooks/hook/#on","title":"\u94a9\u5b50 (\u7279\u6307 On \u94a9\u5b50)","text":"<p>\u5bf9\u4e8e C# \u7684\u4e00\u4e2a\u666e\u901a\u7684\u51fd\u6570\u6765\u8bf4, \u5b83\u88ab\u8c03\u7528\u65f6\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684:</p> <p><pre><code>void Method(){}  // \u539f\u51fd\u6570(\u4e0d\u53ef\u968f\u610f\u4fee\u6539)\n\nvoid Caller()  // \u8c03\u7528\u65b9\n{\n    Method();\n}\n</code></pre> <pre><code>\ngraph LR\n    A[\u8c03\u7528\u65b9] --&gt; B[\u5373\u5c06\u8c03\u7528\u8be5\u51fd\u6570];\n    subgraph \u8be5\u51fd\u6570\n    B --&gt; C[\u8be5\u51fd\u6570\u4e3b\u4f53];\n    C --&gt; D[\u7ed3\u675f\u8c03\u7528\u8be5\u51fd\u6570];\n    end\n    D --&gt; E[\u8c03\u7528\u65b9];\n</code></pre></p> <p>\u5f53\u6211\u4eec\u5f15\u5165\u94a9\u5b50\u6280\u672f\u540e, \u8fd9\u4e2a\u51fd\u6570\u8c03\u7528\u65f6\u4f1a\u50cf\u88ab\"\u94a9\"\u4f4f\u4e00\u6837\u8f6c\u8eab\u53bb\u8c03\u7528\u6211\u4eec\u7684\u51fd\u6570:</p> \u4e00\u4e2aHook\u591a\u4e2aHook <pre><code>void Method(){}  // \u539f\u51fd\u6570(\u4e0d\u53ef\u968f\u610f\u4fee\u6539)\n\nvoid Hook(Action method){}  // \u6211\u4eec\u7684\u51fd\u6570(\u53ef\u968f\u610f\u4fee\u6539), \u53ef\u4ee5\u4efb\u610f\u64cd\u63a7method\u7684\u8c03\u7528\u65f6\u673a\u751a\u81f3\u4e0d\u8c03\u7528\n\nvoid Caller()  // \u8c03\u7528\u65b9\n{\n    Hook(Method);\n}\n</code></pre> <pre><code>void Method(){}\n\nvoid Hook(Action method){}\n\nvoid Hook1(Action hook){ Hook(Method) }  // \u4e0d\u65ad\u5957\u5a03, \u540e\u7eed\u6211\u4eec\u5bf9\u851a\u84dd\u4ee3\u7801\u7684hook\u4e5f\u662f\u7c7b\u4f3c\u7684\n\nvoid Caller()  // \u8c03\u7528\u65b9\n{\n    Hook1(Hook);\n}\n</code></pre> <pre><code>\ngraph LR\n    A[\u8c03\u7528\u65b9]; B[\u5373\u5c06\u8c03\u7528\u8be5\u51fd\u6570];\n    F[\u94a9\u5b50]; G[\u6211\u4eec\u7684\u51fd\u6570];\n    H[\u8be5\u51fd\u6570\u4e3b\u4f53];\n    D[\u7ed3\u675f\u8c03\u7528\u8be5\u51fd\u6570];\n    E[\u8c03\u7528\u65b9];\n    subgraph \u8be5\u51fd\u6570\n    B; H; D;\n    end\n    A --&gt; B;\n    B --&gt; F;\n    F --&gt; G;\n    H --&gt; D;\n    G --&gt; H;\n    G -.\u6216\u8005.-&gt; D;\n    D --&gt; E;\n</code></pre> <p>\u5982\u56fe\u6240\u89c1, \u8be5\u94a9\u5b50\u5141\u8bb8\u4f60\u5728\u8c03\u7528\u67d0\u4e2a\u51fd\u6570\u65f6\u8f6c\u8eab\u53bb\u8c03\u7528\u6211\u4eec\u7684\u51fd\u6570, \u540c\u65f6\u4f60\u80fd\u9009\u62e9\u6211\u4eec\u7684\u51fd\u6570\u6267\u884c\u5b8c\u540e\u662f\u5426\u518d\u6267\u884c\u56de\u539f\u51fd\u6570.</p> <p>\u5728 Everest \u4e2d, \u501f\u52a9\u4e8e MonoMod \u7684\u6280\u672f, \u521b\u5efa\u4e00\u4e2a On \u94a9\u5b50\u7b80\u5355\u7684\u5c31\u50cf:</p> \u7b80\u5355\u7684\u94a9\u53d6...<pre><code>public override void Load()\n{\n    On.Celeste.Player.Update += Player_Update;\n}\n\nprivate void Player_Update(On.Celeste.Player.orig_Update orig, Player self)\n{\n    orig(self);\n}\n\npublic override void Unload()\n{\n    On.Celeste.Player.Update -= Player_Update;\n}\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u6211\u4eec\u4f7f\u7528\u7c7b\u4f3c\u8ba2\u9605\u4e8b\u4ef6\u7684\u8bed\u6cd5\u53bb\u94a9\u4f4f\u4e86 <code>Player</code> \u7c7b\u7684 <code>Update</code> \u65b9\u6cd5(\u8be5\u65b9\u6cd5\u6bcf\u5e27\u90fd\u4f1a\u8c03\u7528\u4e00\u904d), Everest \u4e3a\u6211\u4eec\u628a\u51e0\u4e4e\u6240\u6709\u53ef\u80fd\u94a9\u53d6\u7684\u51fd\u6570\u653e\u5230\u4e86\u547d\u540d\u7a7a\u95f4 <code>On</code> \u4e2d, \u5f53\u4f60\u60f3\u94a9\u53d6\u67d0\u4e2a\u65b9\u6cd5\u65f6\u53ea\u9700\u901a\u8fc7 <code>On</code> \u547d\u540d\u7a7a\u95f4\u4e00\u8def\"\u70b9\"\u5230\u4f60\u60f3\u8981\u7684\u65b9\u6cd5\u4e0a, \u7136\u540e\u4f7f\u7528\u4e00\u4e2a\u94a9\u5b50\u51fd\u6570\u4ee5\u50cf\u4e8b\u4ef6\u4e00\u6837\u7684\u8bed\u6cd5\"\u8ba2\u9605\"\u5c31\u80fd\u94a9\u4f4f\u5b83! \u5728\u8fd9\u91cc\u6211\u4eec\u7684\u94a9\u5b50\u51fd\u6570\u5c31\u662f<code>Player_Update</code>, \u4f60\u53ef\u80fd\u6ce8\u610f\u5230\u53c2\u6570\u5f88\u590d\u6742, \u662f\u7684, \u6240\u4ee5\u4e00\u822c\u6765\u8bf4\u6211\u90fd\u662f\u4f9d\u8d56 IDE \u5e2e\u6211\u81ea\u52a8\u586b\u5199\u8fd9\u4e9b\u53c2\u6570\u5c31\u50cf:  </p> <p> </p> <p></p> <p>Note</p> <p>\u6ce8\u610f IDE \u751f\u6210\u7684\u51fd\u6570\u9ed8\u8ba4\u5305\u542b\u4e00\u53e5\u629b\u51fa\u5f02\u5e38\u8bed\u53e5, \u662f\u4e3a\u4e86\u9632\u6b62\u4f60\u5fd8\u4e86\u5199\u5b9e\u73b0\u7684, \u8bb0\u5f97\u628a\u5b83\u6539\u6389</p> <p><code>orig</code> \u53c2\u6570\u662f\u4e00\u4e2a\u59d4\u6258, \u8c03\u7528\u5b83\u5c31\u76f8\u5f53\u4e8e\u8c03\u7528\u8fd9\u4e2a\u94a9\u5b50\u94a9\u4f4f\u7684\u539f\u51fd\u6570, \u4e5f\u5c31\u662f\u8bf4\u4f60\u53ef\u4ee5\u5728\u8be5\u51fd\u6570\u8c03\u7528\u524d\u505a\u4e9b\u4e8b, \u4e5f\u53ef\u4ee5\u5728\u8be5\u51fd\u6570\u8c03\u7528\u540e\u505a\u4e9b\u4e8b, \u6216\u8005\u5e72\u8106\u4e0d\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570, \u751a\u81f3\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u591a\u6b21. \u901a\u5e38\u6765\u8bf4\u6211\u4eec\u90fd\u4f1a\u5728\u672b\u5c3e\u7b80\u5355\u7684\u8c03\u7528\u56de\u53bb\u907f\u514d\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6.</p> \u4e00\u4e9b\u94a9\u5b50\u672c\u8eab...<pre><code>private void Player_Update(On.Celeste.Player.orig_Update orig, Player self)\n{\n    // \u5728\u8fd9\u4e4b\u524d\u505a\u4e00\u4e9b\u4e8b...\n\n    // \u5f53\u67d0\u4e9b\u5947\u602a\u7684\u6761\u4ef6\u4e0d\u6210\u7acb\u65f6\u6211\u4eec\u624d\u8c03\u7528\u56de\u53bb\u539f\u6765\u7684\u51fd\u6570...\n    if (!xxx)\n        orig(self);\n\n    // \u5728\u8fd9\u4e4b\u540e\u505a\u4e00\u4e9b\u4e8b...\n}\n</code></pre> <p>\u5982\u679c\u4f60\u94a9\u53d6\u5230\u7684\u662f\u4e00\u4e2a\u6210\u5458\u51fd\u6570(\u4e5f\u53eb\u6210\u5458\u65b9\u6cd5), \u90a3\u4e48\u53c2\u6570\u901a\u5e38\u4f1a\u5e26\u6709\u4e00\u4e2a <code>self</code>, \u5b83\u8868\u793a\u6267\u884c\u8fd9\u4e2a\u6210\u5458\u65b9\u6cd5\u65f6\u5bf9\u5e94\u7684\u5b9e\u4f8b <code>this</code> , \u90a3\u4e48\u81ea\u7136\u5730\u5982\u679c\u4f60\u94a9\u53d6\u7684\u662f\u4e00\u4e2a\u9759\u6001\u51fd\u6570\u90a3\u4e48\u662f\u6ca1\u6709\u8fd9\u4e2a\u53c2\u6570\u7684. \u5982\u679c\u4f60\u94a9\u53d6\u7684\u51fd\u6570\u662f\u5e26\u53c2\u6570\u7684, \u90a3\u4e48\u53c2\u6570\u5217\u8868\u4f1a\u539f\u5c01\u4e0d\u52a8\u7684\u6392\u5217\u5728\u524d\u9762\u63d0\u5230\u7684\u53c2\u6570\u7684\u540e\u9762.  </p> <p>\u6bd4\u5982\u4f60\u5c1d\u8bd5\u94a9\u53d6 <code>Player.Jump</code> \u51fd\u6570\u65f6, \u5b83\u7684\u4e09\u4e2a\u53c2\u6570\u4f1a\u8fd9\u6837\u4f20\u9012\u7ed9\u4f60:</p> <pre><code>private void Player_Jump(On.Celeste.Player.orig_Jump orig, Player self, bool particles, bool playSfx)\n</code></pre> <p>\u6700\u540e, \u4e0d\u8981\u5fd8\u8bb0\u5728 <code>Unload</code> \u65b9\u6cd5\u91cc\u53d6\u6d88\u6389\u6211\u4eec\u7684\u94a9\u5b50(\u901a\u8fc7<code>-=</code>), \u9632\u6b62\u6211\u4eec\u7684\u94a9\u5b50\u5728\u4e0d\u5fc5\u8981\u7684\u5730\u65b9\u4ea7\u751f\u4e0d\u597d\u7684\u5f71\u54cd: \u53d6\u6d88\u94a9\u5b50<pre><code>public override void Unload()\n{\n    On.Celeste.Player.Update -= Player_Update;\n}\n</code></pre></p>"},{"location":"hooks/hook/#monocle-ec","title":"Monocle, EC \u67b6\u6784","text":"<p>\u5728\u8fd9\u91cc\u6211\u4f1a\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u6574\u4e2a\u851a\u84dd\u662f\u600e\u4e48\u7ec4\u7ec7\u8d77\u6765\u7684. \u9996\u5148\u851a\u84dd\u57fa\u4e8e <code>Monocle</code> \u5f15\u64ce, \u8fd9\u662f <code>matt</code> \u81ea\u5df1\u5f00\u53d1\u7684\u4e00\u4e2a\u5f15\u64ce, \u6240\u4ee5\u522b\u6307\u671b\u4f60\u80fd\u5728\u7f51\u4e0a\u627e\u5230\u5b83\u7684\u6559\u7a0b(, \u5176\u6b21 <code>Monocle</code> \u4f9d\u8d56\u4e8e <code>XNA</code> (\u5df2\u505c\u6b62\u7ef4\u62a4) \u6216\u8005 <code>FNA</code> (<code>XNA</code> \u6846\u67b6\u7684\u91cd\u65b0\u5b9e\u73b0), \u800c<code>XNA</code> \u63d0\u4f9b\u7684 api \u90fd\u975e\u5e38\u539f\u59cb, \u751a\u81f3\u8fde\u6700\u57fa\u672c\u7684\u573a\u666f\u7ec4\u7ec7\u4e4b\u7c7b\u7684\u90fd\u6ca1\u6709, \u6240\u4ee5 <code>Monocle</code> \u5c31\u662f\u6765\u5b9e\u73b0\u8fd9\u4e9b\u7684.  </p> <p>\u901a\u5e38\u6765\u8bf4\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684 <code>Monocle</code> \u6e38\u620f\u7684\u7ed3\u6784\u5c31\u50cf: <pre><code>graph LR\nR[Engine] --- A;\n\nA[Scene] --- B[Entity A];\nA --- C[Entity B];\nA --- E[Entity ...];\nB --- F[Component A];\nB --- G[Component B];\nC --- H[Component A];\nC --- I[Component C];\nC --- J[Component ...];</code></pre></p> <ul> <li><code>Scene</code> \u8868\u793a\u4e00\u4e2a\u573a\u666f, \u6bd4\u5982\u4e3b\u754c\u9762\u573a\u666f, pico8 \u573a\u666f, \u4ee5\u53ca\u6700\u5e38\u89c1\u7684 gameplay \u573a\u666f.  </li> <li><code>Entity</code> \u8868\u793a\u4e00\u4e2a\u5b9e\u4f53, \u6bd4\u5982\u8bf4\u739b\u5fb7\u7433\u5c31\u662f\u4e00\u4e2a\u5b9e\u4f53, \u4e00\u4e2a\u5f39\u7403\u662f\u4e00\u4e2a\u5b9e\u4f53, \u4e00\u4e2a\u6ce1\u6ce1\u662f\u4e00\u4e2a\u5b9e\u4f53.</li> <li><code>Component</code> \u8868\u793a\u4e00\u4e2a\u7ec4\u4ef6, \u5b83\u9644\u52a0\u4e0e\u5b9e\u4f53\u4e4b\u4e0a, \u901a\u5e38\u6211\u4eec\u80fd\u76f4\u63a5\u770b\u5230\u7684\u53ea\u6709\u56fe\u7247\u7ec4\u4ef6, \u6bd4\u5982\u5ca9\u6d46\u5757\u7684\u8d34\u56fe\u5c31\u662f\u7531 <code>Image</code> \u7ec4\u4ef6\u6765\u5c55\u73b0\u7684, \u73a9\u5bb6\u7684\u52a8\u753b\u7531 <code>Sprite</code> \u7ec4\u4ef6\u5c55\u73b0.  </li> </ul> <p>Info</p> <p>\u4ee5\u4e0a\u8fd9\u4e2a\u67b6\u6784\u6211\u4eec\u5c31\u79f0\u4e3a <code>EC</code> \u67b6\u6784, \u5b83\u662f\u6e38\u620f\u7684\u4e00\u79cd\u7ec4\u7ec7\u65b9\u5f0f\u7684\u5b9e\u73b0.  </p> <p>\u901a\u5e38\u5730, \u6bcf\u8fc7 <code>1/60</code> \u79d2, <code>Engine</code> \u5c31\u4f1a\u88ab\u8c03\u7528\u5b83\u7684 <code>Update()</code> \u51fd\u6570\u7528\u6765\u66f4\u65b0\u6e38\u620f\u903b\u8f91, <code>Engine.Update()</code> \u5185\u90e8\u4f1a\u518d\u6b21\u8c03\u7528 <code>Scene</code> \u7684 <code>Update()</code> \u51fd\u6570, <code>Scene.Update()</code> \u5185\u90e8\u4f1a\u904d\u5386\u5b83\u6240\u6709\u7684 <code>Entity</code> \u5e76\u8c03\u7528\u5b83\u4eec\u7684 <code>Update()</code> \u51fd\u6570, <code>Entity.Update()</code> \u5185\u90e8\u8fd8\u4f1a\u904d\u5386\u5b83\u6240\u6709\u7684 <code>Component</code> \u5e76\u8c03\u7528\u5b83\u4eec\u7684 <code>Update()</code> \u51fd\u6570.  </p> <p>\u90a3\u4e48\u81ea\u7136, <code>Player.Update()</code> \u5c31\u662f\u739b\u5fb7\u7433\u6bcf\u5e27\u7684\u66f4\u65b0\u903b\u8f91\u6240\u5728\u7684\u5730\u65b9\u4e86. \u73b0\u5728\u6211\u4eec\u505a\u4e00\u4e2a\u5c0f demo, \u5c06\u73a9\u5bb6\u7684\u51b2\u523a\u6570\u91cf\u9501\u6b7b\u4e3a\u5355\u51b2.  </p>"},{"location":"hooks/hook/#_3","title":"\u9501\u5b9a\u5355\u51b2","text":"<p>\u901a\u8fc7\u7b80\u5355\u7684\u6d4f\u89c8\u851a\u84dd\u7684\u4ee3\u7801, \u4f60\u4e86\u89e3\u5230(\u6ca1\u4e86\u89e3\u5230\u4e5f\u6b63\u5e38, \u540e\u9762\u4f1a\u8bf4\u4e00\u4e9b\u5e38\u89c1\u7c7b\u548c\u7ed3\u6784\u5e2e\u52a9\u4f60\u7406\u89e3) <code>Player.Dashes</code> \u8fd9\u4e2a\u5b57\u6bb5\u50a8\u5b58\u4e86\u73a9\u5bb6\u7684\u51b2\u523a\u6570\u91cf, \u90a3\u4e48\u73b0\u5728\u6211\u4eec\u5c06\u5b83\u9501\u5b9a\u4e3a 1, \u4e5f\u5c31\u662f\u5355\u51b2. \u9996\u5148\u6211\u4eec\u94a9\u53d6 <code>Player.Update()</code>, \u7136\u540e\u5728\u786e\u4fdd\u8c03\u7528\u56de\u539f\u6765\u7684\u51fd\u6570\u524d\u5c06 <code>Dashes</code> \u5f3a\u5236\u4fee\u6539\u4e3a 1.</p> \u9501\u5b9a\u51b2\u523a\u4e3a1!<pre><code>public override void Load()\n{\n    On.Celeste.Player.Update += Player_Update;\n}\n\nprivate void Player_Update(On.Celeste.Player.orig_Update orig, Player self)\n{\n    self.Dashes = 1;\n    orig(self);\n}\n\npublic override void Unload()\n{\n    On.Celeste.Player.Update -= Player_Update;\n}\n</code></pre> <p>\u90a3\u4e48\u73b0\u5728\u7f16\u8bd1, \u6309\u4e4b\u524d\u7684\u5185\u5bb9\u64cd\u4f5c, \u5e76\u91cd\u542f\u851a\u84dd, \u4f60\u5e94\u8be5\u5c31\u4f1a\u770b\u5230\u4f60\u7684\u739b\u5fb7\u7433\u6c38\u8fdc\u90fd\u4f1a\u6709\u5355\u51b2\u4e86(\u5373\u4f7f\u662f\u5728\u7a7a\u4e2d!).</p>"},{"location":"hooks/hook/#_4","title":"\u94a9\u5b50\u7684\u6700\u4f73\u5b9e\u8df5","text":"<p>\u6211\u4eec\u5e94\u8be5\u5c3d\u53ef\u80fd\u4e00\u6b21\u6027\u5730\u5c31\u5c06\u6211\u4eec\u6240\u9700\u8981\u7684\u6240\u6709\u94a9\u5b50\u5728 <code>Load</code> \u91cc\u52a0\u8f7d\u5b8c, \u56e0\u4e3a\u521b\u5efa\u94a9\u5b50\u5b9e\u9645\u4e0a\u7684\u5f00\u9500\u5e76\u4e0d\u5c0f, \u5982\u679c\u4f60\u9700\u8981\u67d0\u4e9b \"\u67d0\u4e9b\u6761\u4ef6\u4e0d\u6210\u7acb\u4e0d\u542f\u52a8\u94a9\u5b50, \u6761\u4ef6\u6210\u7acb\u518d\u542f\u52a8\u94a9\u5b50\" \u7684\u903b\u8f91\u7684\u8bdd, \u6211\u5efa\u8bae\u4f60\u5e94\u8be5\u59cb\u7ec8\u4fdd\u6301\u94a9\u5b50, \u7136\u540e\u5728\u94a9\u5b50\u5185\u90e8\u5224\u65ad\u4f60\u7684\u6761\u4ef6, \u4e0d\u6210\u7acb\u65f6\u4f60\u5e94\u8be5\u76f4\u63a5\u56de\u8c03\u539f\u6765\u7684\u65b9\u6cd5\u5e76\u4e0d\u505a\u4efb\u4f55\u5176\u4ed6\u4e8b\u60c5.</p>"},{"location":"hooks/il/","title":"IL","text":"<p>Info</p> <p>\u5982\u679c\u4f60\u5728\u4e4b\u524d\u5df2\u7ecf\u5b66\u4e60\u8fc7 <code>IL</code> \u5e76\u4e14\u4f7f\u7528\u8fc7\u7c7b\u4f3c\u7684 <code>System.Reflection.Emit</code> \u8fd9\u4e9b api \u7684\u8bdd\u4f60\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u8282.</p>"},{"location":"hooks/il/#_1","title":"\u7b80\u4ecb","text":"<p><code>IL</code> \u5168\u79f0 <code>Intermediate Language</code>, \u5373\u4e2d\u95f4\u8bed\u8a00, \u5728\u4e00\u4e9b\u8f83\u8001\u7684\u6587\u6863\u91cc\u9762\u5b83\u53ef\u80fd\u4e5f\u4f1a\u88ab\u53eb\u505a <code>MSIL</code>, \u5373 <code>Microsoft Intermediate Language</code>, \u5076\u5c14\u8fd8\u4f1a\u6709\u4e00\u4e9b\u5730\u65b9\u53eb\u505a <code>CIL</code>, \u5373 <code>Common Intermediate Language</code>, \u8fd9\u4e09\u79cd\u53eb\u6cd5\u901a\u5e38\u610f\u4e49\u4e0a\u90fd\u662f\u6307\u4e00\u4e2a\u4e1c\u897f. <code>IL</code> \u901a\u5e38\u6765\u8bf4\u53ef\u4ee5\u7406\u89e3\u6210\u4e24\u4e2a\u90e8\u5206, \u4e00\u4e2a \"\u6267\u884c\" \u90e8\u5206, \u4e00\u4e2a \"\u58f0\u660e\" \u90e8\u5206, \"\u6267\u884c\" \u90e8\u5206\u89c4\u5b9a\u4e86\u4e00\u4e2a\u51fd\u6570\u5185\u90e8\u7684\u4ee3\u7801\u5e94\u8be5\u600e\u4e48\u64cd\u63a7\u6211\u4eec\u7684\u7a0b\u5e8f, \u800c \"\u58f0\u660e\" \u90e8\u5206\u5219\u89c4\u5b9a\u4e86\u4e00\u4e2a\u51fd\u6570\u7684\u8fd4\u56de\u503c, \u53c2\u6570\u5217\u8868, \u8bbf\u95ee\u4fee\u9970\u7b26, \u6240\u5728\u7c7b, \u7c7b\u7684\u8bbf\u95ee\u4fee\u9970\u7b26, \u540d\u79f0\u7b49\u8fd9\u4e9b\u5143\u6570\u636e, \u83b7\u53d6\u8fd9\u4e9b\u5143\u6570\u636e\u5176\u5b9e\u4f60\u65e9\u5728\u5b66\u4e60\u53cd\u5c04\u7684\u65f6\u5019\u5c31\u8fdb\u884c\u8fc7. \u540c\u65f6\u4fee\u6539\u6216\u751f\u6210\u8fd9\u4e9b\u5143\u6570\u636e\u4e5f\u4e0d\u56f0\u96be, \u4f46\u662f\u5728\u8fdb\u884c\u851a\u84dd modding \u65f6\u4fee\u6539\u6216\u751f\u6210\u8fd9\u4e9b\u5143\u6570\u636e\u7684\u64cd\u4f5c\u51e0\u4e4e\u4e0d\u4f1a\u88ab\u4f7f\u7528\u5230, \u6240\u4ee5\u8fd9\u4e00\u8282\u6211\u4eec\u805a\u7126\u4e8e <code>IL</code> \u7684 \"\u6267\u884c\" \u90e8\u5206, \u8bb2\u8ff0\u5176\u57fa\u672c\u7ed3\u6784, \u57fa\u7840\u8bed\u6cd5\u7b49\u5185\u5bb9.   </p>"},{"location":"hooks/il/#_2","title":"\u521d\u5370\u8c61","text":"<p>HelloWorld!<pre><code>namespace DynamicAssemblyTest;\n\npublic static class Program\n{\n    public static void Main()\n    {\n        Console.WriteLine(\"Hello world!\");\n    }\n}\n</code></pre> \u73b0\u5728, \u8bd5\u7740\u7f16\u8bd1\u4e0a\u8ff0\u5f88\u7b80\u5355\u7684 HelloWorld \u7a0b\u5e8f, \u627e\u5230\u5176\u7a0b\u5e8f\u96c6, \u7136\u540e\u7528 <code>dnSpy</code>(\u6216\u8005 <code>ILSpy</code> \u4e5f\u884c) \u6253\u5f00\u5b83. \u4e0d\u8fc7\u8fd9\u6b21\u6211\u4eec\u4e0d\u662f\u5728\u770b <code>C#</code> \u4ee3\u7801\u4e86, \u6211\u4eec\u9700\u8981\u770b <code>IL</code> \u4ee3\u7801, \u6240\u4ee5\u6211\u4eec\u5728\u5982\u4e0b\u56fe\u7684\u8fd9\u4e2a\u4e0b\u62c9\u6846\u4e2d\u9009\u62e9 <code>IL</code>:</p> <p></p> <p>\u5728\u56fe\u4e2d\u7684\u90a3\u4e00\u5768\u4f60\u53ef\u80fd\u4e0d\u77e5\u6240\u63aa\u7684\u4ee3\u7801\u5c31\u662f <code>IL</code> \u4ee3\u7801\u4e86, \u5728\u4e0a\u8ff0 <code>IL</code> \u4ee3\u7801\u4e2d <code>.method</code> <code>.class</code> \u8fd9\u4e00\u7c7b\u5b57\u6837\u5c31\u8868\u793a\u58f0\u660e\u4e00\u4e2a \u65b9\u6cd5/\u7c7b, \u800c\u5176\u540e\u9762\u6240\u8ddf\u7684\u4e00\u5927\u957f\u4e32\u5173\u952e\u5b57\u5c31\u662f\u4e00\u4e9b\u5143\u6570\u636e, \u6bd4\u5982\u7c7b\u540d, \u8bbf\u95ee\u4fee\u9970\u7b26\u7b49\u6211\u4eec\u4e4b\u524d\u8c08\u8bba\u8fc7\u7684\u4e1c\u897f, \u540e\u9762\u7684\u5927\u62ec\u53f7\u5c31\u8868\u793a\u8fd9\u4e2a\u58f0\u660e\u7684 \"\u5185\u5bb9\u7269\", \u901a\u5e38\u7c7b\u7684 \"\u5185\u5bb9\u7269\" \u6709\u5185\u90e8\u7c7b, \u65b9\u6cd5, \u6784\u9020\u5668, \u5b57\u6bb5, \u5c5e\u6027\u7b49, \u90a3\u4e48\u663e\u800c\u6613\u89c1\u8fd9\u91cc\u5c31\u6beb\u65e0\u7591\u95ee\u5c31\u662f <code>IL</code> \u7684\u58f0\u660e\u90e8\u5206\u4e86. \u73b0\u5728\u6211\u4eec\u5173\u6ce8 <code>.method</code> \u58f0\u660e, \u5176\u7684 \"\u5185\u5bb9\u7269\" \u5c31\u662f\u6211\u4eec\u63a5\u4e0b\u6765\u8981\u805a\u7126\u7684, \u5373 <code>IL</code> \u7684 \"\u6267\u884c\" \u90e8\u5206. \u5728\u4e0a\u56fe\u4e2d dnSpy \u5e2e\u6211\u4eec\u5c06\u524d\u9762\u52a0\u4e0a\u4e86\u5b57\u8282\u5185\u5b58\u504f\u79fb\u7684\u90a3\u6bcf\u4e00\u884c\u5c31\u662f\u6211\u4eec\u7684 <code>IL</code> \u4ee3\u7801\u4e86, \u4e0d\u8fc7\u8fd9\u91cc\u6211\u4eec\u4e0d\u592a\u4f1a\u9700\u8981\u8fd9\u4e2a\u504f\u79fb\u91cf, \u56e0\u4e3a\u5927\u591a\u6570\u6d89\u53ca\u64cd\u4f5c <code>IL</code> \u7684\u5e93\u90fd\u4f1a\u4e3a\u6211\u4eec\u81ea\u52a8\u5b8c\u6210\u8fd9\u4e2a\u504f\u79fb\u7684\u8ba1\u7b97.</p>"},{"location":"hooks/il/#_3","title":"\u5207\u6362\u73af\u5883 &amp; \u52a8\u6001\u7a0b\u5e8f\u96c6","text":"<p>\u73b0\u5728\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u73af\u5883\u6765\u4e66\u5199\u6211\u4eec\u7684 <code>IL</code> \u4ee3\u7801, \u5f53\u7136\u4f60\u867d\u7136\u5b8c\u5168\u53ef\u4ee5\u5c31\u5728 dnSpy \u5bf9\u7740\u90a3\u4e00\u5927\u5806 <code>C#</code> \u7f16\u8bd1\u540e\u7684 <code>IL</code> \u8fdb\u884c\u4fee\u6539,  \u5e76\u9891\u7e41\u4fdd\u5b58\u4fee\u6539\u7136\u540e\u8fd0\u884c\u6765\u67e5\u770b\u6548\u679c, \u4f46\u662f\u8fd9\u603b\u5f52\u6ca1\u6709\u6211\u4eec\u76f4\u63a5\u5728 <code>C#</code> \u4ee3\u7801\u91cc\u5199 <code>IL</code> \u4ee3\u7801\u91cc\u65b9\u4fbf!</p> <p>\u9996\u5148, \u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u4e0d\u518d\u5728 mod \u5de5\u7a0b\u91cc\u5de5\u4f5c\u4e86, \u8fd9\u90e8\u5206\u5185\u5bb9\u662f\u72ec\u7acb\u5f00\u6765\u7684, \u6240\u4ee5\u6211\u4f1a\u63a8\u8350\u4f60\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\u6765\u505a\u8fd9\u4e9b. \u8fd9\u91cc\u6211\u7ed9\u9879\u76ee\u53d6\u7684\u540d\u662f <code>DynamicAssemblyTest</code>, \u76ee\u6807\u6846\u67b6\u662f <code>.net 8</code>. \u5b8c\u6210\u540e, \u590d\u5236\u7c98\u8d34\u4ee5\u4e0b\u4ee3\u7801(\u4e4b\u540e\u6211\u4eec\u4f1a\u6162\u6162\u89e3\u91ca\u7684): <pre><code>using System.Reflection;\nusing System.Reflection.Emit;\n\nnamespace DynamicAssemblyTest;\n\npublic static class Program\n{\n    public static MethodInfo GenerateMethod(Action&lt;ILGenerator&gt; generateAction)\n    {\n        AssemblyBuilder asmBuilder = AssemblyBuilder.DefineDynamicAssembly(new(\"MyAssembly\"), AssemblyBuilderAccess.RunAndCollect);\n        ModuleBuilder moduleBuilder = asmBuilder.DefineDynamicModule(\"MyTestModule\");\n        TypeBuilder typeBuilder = moduleBuilder.DefineType(\"MyType\");\n        MethodBuilder methodBuilder = typeBuilder.DefineMethod(\"MyMethod\", MethodAttributes.Public | MethodAttributes.Static);\n        generateAction(methodBuilder.GetILGenerator());\n        return typeBuilder.CreateType().GetMethod(\"MyMethod\")!;\n    }\n\n    public static void Main()\n    {\n        MethodInfo methodInfo = GenerateMethod(il =&gt;\n        {\n            il.Emit(OpCodes.Ldstr, \"Hello Dynamic Method!\");\n            il.Emit(OpCodes.Call, typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!);\n            il.Emit(OpCodes.Ret);\n        });\n        Action action = methodInfo.CreateDelegate&lt;Action&gt;();\n        action();\n    }\n}\n</code></pre></p> <p>Note</p> <p>\u6211\u9ed8\u8ba4\u542f\u7528\u4e86\u9690\u5f0f\u547d\u540d\u7a7a\u95f4, \u5982\u679c\u4f60\u9047\u5230\u4e86\u7c7b\u578b\u672a\u627e\u5230\u7684\u62a5\u9519\u90a3\u4f60\u5c31\u5f97\u624b\u52a8 using \u4e00\u4e0b\u5269\u4f59\u7684\u90a3\u4e9b\u547d\u540d\u7a7a\u95f4\u4e86.</p> <p>\u73b0\u5728\u8fd0\u884c\u4f60\u7684\u7a0b\u5e8f, \u4f60\u5e94\u8be5\u4f1a\u5f97\u5230\u4e00\u53e5\u8f93\u51fa: <code>Hello Dynamic Method!</code>. \u4e0a\u8ff0\u4ee3\u7801\u5176\u5b9e\u662f\u5728\u5728\u4ee3\u7801\u4e2d\u52a8\u6001\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7a0b\u5e8f\u96c6, \u7136\u540e\u52a8\u6001\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b, \u5e76\u5411\u91cc\u9762\u52a8\u6001\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>MyMethod</code> \u65b9\u6cd5, \u4e4b\u540e\u6211\u4eec\u52a8\u6001\u5730 \"\u7f16\u8bd1\" \u4e86\u8fd9\u4e2a\u7a0b\u5e8f\u96c6\u5e76\u5c06\u5176\u88c5\u8f7d\u5230\u6211\u4eec\u7684\u7a0b\u5e8f\u96c6\u57df\u4e2d, \u5176\u4e2d, <code>MyMethod</code> \u65b9\u6cd5\u7684 <code>IL</code> \u7684\u5185\u5bb9\u5c31\u662f\u5728\u6211\u4eec\u7684 <code>Main</code> \u65b9\u6cd5\u4e2d <code>GenerateMethod</code> \u53c2\u6570\u4e2d\u7684\u59d4\u6258\u5b9a\u4e49\u7684. \u5f80\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u53cd\u5c04\u521b\u5efa\u4e86\u4e00\u6bb5\u65b0\u7684\u4ee3\u7801\u5e76\u6267\u884c, \u8fd9\u542c\u8d77\u6765\u662f\u4e0d\u662f\u9177\u6781\u4e86? \u4e0a\u9762\u8fd9\u4e2a\u52a8\u6001\u5b9a\u4e49\u7a0b\u5e8f\u96c6\u7684\u5e93\u53eb\u505a <code>System.Reflection.Emit</code>, \u5728\u8fd9\u91cc\u6211\u4eec\u53ea\u662f\u4e3a\u4e86\u5b66\u4e60\u4e00\u70b9 <code>IL</code> \u77e5\u8bc6\u800c\u4f7f\u7528, \u5230\u540e\u9762\u4fee\u6539\u851a\u84dd\u7684\u7a0b\u5e8f\u96c6\u65f6\u6211\u4eec\u9700\u8981\u4f7f\u7528 Everest \u5e26\u7684 <code>Mono.Cecil</code> \u5e93, \u4e0d\u8fc7\u4ed6\u4eec\u5927\u540c\u5c0f\u5f02.</p>"},{"location":"hooks/il/#il_1","title":"\u57fa\u672c <code>IL</code>","text":"<pre><code>IL_0000: nop\nIL_0001: ldstr     \"Hello world!\"\nIL_0006: call      void [System.Console]System.Console::WriteLine(string)\nIL_000B: nop\nIL_000C: ret\n</code></pre> <p>\u901a\u5e38\u6765\u8bf4, \u4e00\u6bb5 <code>IL</code> \u5305\u542b\u591a\u884c <code>IL</code>, \u6bcf\u4e00\u884c <code>IL</code>(\u6211\u5076\u5c14\u4e5f\u4f1a\u79f0\u4e3a\u4e00\u53e5 <code>IL</code>) \u90fd\u5305\u542b\u4e00\u4e2a\u64cd\u4f5c\u7801(OpCode)\u4ee5\u53ca\u53ef\u4ee5\u6ca1\u6709\u7684\u53c2\u6570. \u6bd4\u5982\u4e0a\u8ff0\u6bb5 <code>IL</code>, \u5176\u5305\u542b\u4e94\u884c <code>IL</code>:</p> <ul> <li>\u7b2c\u4e00\u884c <code>IL</code> \u7684\u64cd\u4f5c\u7801\u662f <code>nop</code>, \u6ca1\u6709\u53c2\u6570</li> <li>\u7b2c\u4e8c\u884c <code>IL</code> \u7684\u64cd\u4f5c\u7801\u662f <code>ldstr</code>, \u53c2\u6570\u662f\u4e00\u4e32\u5b57\u7b26\u4e32, \u6216\u8005\u4e25\u8c28\u7684\u8bf4, \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684 <code>token</code>, \u5b83\u5f15\u7528\u4e86\u7a0b\u5e8f\u96c6\u5143\u6570\u636e\u4e2d\u5b58\u653e\u5b57\u7b26\u4e32\u672c\u4f53\u7684\u4f4d\u7f6e,  \u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u5ffd\u7565\u8fd9\u4e2a\u7ec6\u8282, \u56e0\u4e3a\u6211\u4eec\u4e0d\u4f1a\u6d89\u53ca\u5230 <code>IL</code> \u7684\u5177\u4f53\u5b57\u8282\u5c42\u9762\u7684\u4e1c\u897f.</li> <li>\u7b2c\u4e09\u884c <code>IL</code> \u7684\u64cd\u4f5c\u7801\u662f <code>call</code>, \u53c2\u6570\u662f\u4e00\u4e2a\u65b9\u6cd5, \u5b83\u4e5f\u662f\u4e00\u4e2a <code>token</code>, \u5176\u4e5f\u662f\u5f15\u7528\u4e86\u5143\u6570\u636e\u4e2d\u5b58\u653e\u65b9\u6cd5\u672c\u4f53\u7684\u4f4d\u7f6e</li> <li>\u7b2c\u56db\u884c <code>IL</code> \u7684\u64cd\u4f5c\u7801\u662f <code>nop</code>, \u6ca1\u6709\u53c2\u6570</li> <li>\u7b2c\u4e94\u884c <code>IL</code> \u7684\u64cd\u4f5c\u7801\u662f <code>ret</code>, \u6ca1\u6709\u53c2\u6570</li> </ul> <p>\u90a3\u4e48, \u5728\u77e5\u9053 <code>IL</code> \u7684\u57fa\u672c\u7ed3\u6784\u540e, \u6211\u4eec\u5c31\u53ef\u4ee5\u5177\u4f53\u5b66\u4e60 <code>IL</code> \u8fd9\u4e9b\u64cd\u4f5c\u7801\u5230\u5e95\u5e72\u4e86\u4ec0\u4e48\u4e86.</p>"},{"location":"hooks/il/#_4","title":"\u8bc4\u4f30\u6808","text":"<p>Note</p> <p>\u5982\u679c\u4f60\u5728\u8fd9\u91cc\u4e0d\u77e5\u9053\u6808\u662f\u4ec0\u4e48\u7684\u8bdd, \u4f60\u5c31\u8be5\u53bb\u590d\u4e60\u4e00\u4e0b\u4f60\u4e4b\u524d\u5b66\u4e60\u7684\u6570\u636e\u7ed3\u6784\u4e4b\u6808\u4e86.</p> <p>\u5728 <code>IL</code> \u4ee3\u7801\u4e2d, \u5927\u91cf\u64cd\u4f5c\u7b26\u672c\u8d28\u4e0a\u90fd\u662f\u5728\u64cd\u4f5c\u4e00\u4e2a\u53eb\u505a <code>\u8bc4\u4f30\u6808</code> \u7684\u4e1c\u897f, \u4ece\u5b57\u9762\u4e0a\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u5b83\u662f\u4e00\u4e2a\u6808, \u90a3\u4e48\u65e2\u7136\u662f\u6808, \u90a3\u4e48\u901a\u5e38\u5c31\u6709 <code>\u538b\u5165</code> \u548c <code>\u5f39\u51fa</code> \u4e24\u79cd\u64cd\u4f5c, <code>\u8bc4\u4f30\u6808</code> \u4e5f\u662f\u5982\u6b64. \u6bd4\u5982\u5982\u4e0b <code>C#</code> \u65b9\u6cd5: <pre><code>static int Add(int a, int b, int c) \n{\n    return a + b + c;\n}\n</code></pre></p> <p>\u5b83\u5728\u7f16\u8bd1\u5668\u7684 <code>Release</code> \u4f18\u5316\u4e0b\u4f1a\u7f16\u8bd1\u6210\u5982\u4e0b <code>IL</code>:</p> <p>Info</p> <p>\u7f16\u8bd1\u5668\u7684 <code>Debug</code> \u7f16\u8bd1\u4e0b\u4f1a\u4ea7\u751f\u5f88\u591a\u7528\u4e8e\u8c03\u8bd5\u4ee3\u7801\u7684 <code>IL</code>, \u76f8\u5bf9\u6765\u8bf4\u4f1a\u590d\u6742\u5f88\u591a, \u6240\u4ee5\u6211\u4eec\u4f7f\u7528 <code>Release</code> \u7f16\u8bd1\u6765\u5c3d\u53ef\u80fd\u7b80\u5316</p> <pre><code>.method private hidebysig static \n        int32 Add (\n            int32 a,\n            int32 b,\n            int32 c\n        ) cil managed \n    {\n        .maxstack 8\n\n        IL_0000: ldarg.0\n        IL_0001: ldarg.1\n        IL_0002: add\n        IL_0003: ldarg.2\n        IL_0004: add\n        IL_0005: ret\n    } // end of method Program::Add\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u628a\u4e00\u90e8\u5206\u58f0\u660e\u90e8\u5206\u653e\u51fa\u6765\u4e86, \u4e0d\u8fc7\u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\u8fd9\u4e00\u884c: <code>.maxstack 8</code>, \u5b83\u8868\u793a\u8bf7\u6c42\u5728\u8fd9\u4e2a\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u8bc4\u4f30\u6808\u6709\u786e\u4fdd 8 \u4e2a\u5927\u5c0f\u7684\u7a7a\u95f4\u53ef\u4ee5\u4f7f\u7528. \u7528\u56fe\u8868\u7684\u65b9\u6cd5\u5927\u6982\u662f(\u6700\u5de6\u4fa7\u6808\u9ad8\u5ea6\u6700\u4f4e, \u5411\u53f3\u6808\u9ad8\u5ea6\u9010\u6e10\u589e\u52a0, \u7ea2\u8272\u8868\u793a\u76ee\u524d\u4f7f\u7528\u4e86\u7684\u6808\u4f4d, \u4e4b\u540e\u7684\u56fe\u8868\u540c):</p> <p> <pre><code>flowchart LR\n    S1 --- S2 --- S3 --- S4 --- S5 --- S6 --- S7 --- S8\n    style S1 stroke:red</code></pre> </p> <p>\u9996\u5148\u6211\u4eec\u4f1a\u4ecb\u7ecd\u4e00\u4e2a\u7cfb\u5217\u7684\u64cd\u4f5c\u7b26 <code>ldarg.*</code>, \u5b83\u8868\u793a\u5c06\u65b9\u6cd5\u53c2\u6570\u5217\u8868\u4e2d\u7684\u7b2c *-1 \u4e2a\u53c2\u6570\u538b\u5165\u8bc4\u4f30\u6808\u4e2d, \u4e0d\u5e26\u53c2\u6570(<code>ldarg.0</code> \u4e0e <code>ldarg.1</code> \u91cc\u7684\u6570\u5b57\u662f\u64cd\u4f5c\u7b26\u672c\u8eab, \u4e0d\u8981\u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a\u53c2\u6570\u4e86),  \u6ce8\u610f\u8fd9\u662f\u5728\u9759\u6001\u65b9\u6cd5\u4e2d\u800c\u8a00\u7684, \u5982\u679c\u8be5\u65b9\u6cd5\u662f\u6210\u5458\u65b9\u6cd5, \u90a3\u4e48 <code>ldarg.0</code> \u5b9e\u9645\u4e0a\u538b\u5165\u7684\u662f <code>this</code> \u7684\u503c, \u800c <code>ldarg.1</code> \u624d\u662f\u7b2c\u4e00\u4e2a\u53c2\u6570.  </p> <p>\u5728\u4e0a\u8ff0\u6bb5 <code>IL</code> \u4e2d, \u8be5\u65b9\u6cd5\u662f\u4e2a\u9759\u6001\u65b9\u6cd5, \u6240\u4ee5\u524d\u4e24\u884c <code>ldarg.0</code> \u4e0e <code>ldarg.1</code> \u4f1a\u5c06\u7b2c\u4e00\u4e2a\u53c2\u6570\u548c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u538b\u5165\u8bc4\u4f30\u6808\u4e2d. \u73b0\u5728\u5047\u8bbe\u6211\u4eec\u8c03\u7528\u4f20\u5165\u7684\u53c2\u6570\u5206\u522b\u662f <code>1, 2, 3</code>(Sn\u8868\u793a\u672a\u4f7f\u7528\u7684\u6808\u4f4d, a:b \u8868\u793a\u8be5\u4f4d\u7f6e\u5b58\u5165\u4e86\u4e00\u4e2aa\u7c7b\u578b\u7684b\u503c, \u540e\u540c):</p> <p> <pre><code>flowchart \n    subgraph start\n    direction LR\n    S1_3[\"S1\"] --- S2_3[\"S2\"] --- S3_3[\"S3\"] --- S4_3[\"S4\"]\n    end\n\n    subgraph ldarg.0\n    direction LR\n    S1[\"int32: 1\"] --- S2 --- S3 --- S4\n    style S1 stroke:red\n    end\n\n    subgraph ldarg.1\n    direction LR\n    S1_2[\"int32: 1\"] --- S2_2[\"int32: 2\"] --- S3_2[\"S3\"] --- S4_2[\"S4\"]\n    style S1_2 stroke:red\n    style S2_2 stroke:red\n    end\n\n    start --&gt; ldarg.0 --&gt; ldarg.1</code></pre> </p> <p>\u7136\u540e\u8981\u4ecb\u7ecd\u7684\u662f <code>add</code> \u64cd\u4f5c\u7b26, <code>add</code> \u64cd\u4f5c\u7b26\u4f1a\u5f39\u51fa\u8bc4\u4f30\u6808\u4e0a\u7684\u4e24\u4e2a\u5143\u7d20, \u7136\u540e\u5c06\u5b83\u4eec\u76f8\u52a0, \u7136\u540e\u5c06\u7ed3\u679c\u538b\u5165\u8bc4\u4f30\u6808. \u5f53\u8fd9\u4e24\u4e2a\u5143\u7d20\u4efb\u610f\u4e00\u4e2a\u4e0d\u662f\u57fa\u672c\u6570\u5b57\u7c7b\u578b\u65f6 jit \u5c31\u4f1a\u629b\u51fa <code>InvalidProgramException</code> \u5f02\u5e38. \u540c\u65f6\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282, \u4f60\u4e3a\u7c7b\u91cd\u8f7d\u7684\u52a0\u53f7\u8fd0\u7b97\u7b26\u5e76\u4e0d\u662f\u4f7f\u7528\u7684\u8fd9\u4e2a\u64cd\u4f5c\u7b26, \u800c\u662f\u8c03\u7528\u7684\u4e00\u4e2a\u7279\u6b8a\u7684\u540d\u4e3a <code>op_Add</code> \u7684\u5e26\u6709 <code>special name</code> \u6807\u8bb0\u7684\u65b9\u6cd5. \u6700\u540e\u662f <code>ret</code> \u64cd\u4f5c\u7b26, \u5f53\u65b9\u6cd5\u6ca1\u6709\u8fd4\u56de\u503c\u65f6\u5b83\u4f1a\u5c06\u63a7\u5236\u6743\u4ea4\u56de\u7ed9\u8c03\u7528\u8005, \u540c\u65f6 jit \u4f1a\u4e3a\u6211\u4eec\u68c0\u67e5\u8bc4\u4f30\u6808\u662f\u5426\u6e05\u7a7a, \u5982\u679c\u8bc4\u4f30\u6808\u4e0a\u8fd8\u6709\u4e1c\u897f\u90a3\u4e48\u540c\u6837 jit \u4f1a\u629b\u51fa\u5f02\u5e38. \u5f53\u65b9\u6cd5\u62e5\u6709\u8fd4\u56de\u503c\u65f6\u5b83\u4f1a\u786e\u4fdd\u8bc4\u4f30\u6808\u4e0a\u6709\u4e14\u53ea\u5269\u4e00\u4e2a\u5143\u7d20, \u7136\u540e\u5c06\u8fd9\u4e2a\u503c\u5f39\u51fa\u5e76\u538b\u5165\u8c03\u7528\u8005\u7684\u8bc4\u4f30\u6808\u4e0a(\u8bc4\u4f30\u6808\u662f\u65b9\u6cd5\u72ec\u7acb\u5730). \u90a3\u4e48\u81ea\u7136\u800c\u7136, \u6211\u4eec\u6700\u521d\u7684\u90a3 6 \u53e5 <code>IL</code> \u5927\u6982\u4f1a\u662f\u8fd9\u4e2a\u5de5\u4f5c\u6d41\u7a0b:</p> <p> <pre><code>flowchart \n    subgraph start\n    direction LR\n    S1 --- S2 --- S3 --- S4\n    end\n\n    subgraph ldarg.0\n    direction LR\n    S1_2[\"int32: 1\"] --- S2_2[\"S2\"] --- S3_2[\"S3\"] --- S4_2[\"S4\"]\n    style S1_2 stroke:red\n    end\n\n    subgraph ldarg.1\n    direction LR\n    S1_3[\"int32: 1\"] --- S2_3[\"int32: 2\"] --- S3_3[\"S3\"] --- S4_3[\"S4\"]\n    style S1_3 stroke:red\n    style S2_3 stroke:red\n    end\n\n    subgraph add\n    direction LR\n    S1_4[\"int32: 3\"] --- S2_4[\"S2\"] --- S3_4[\"S3\"] --- S4_4[\"S4\"]\n    style S1_4 stroke:red\n    end\n\n    subgraph ldarg.2\n    direction LR\n    S1_5[\"int32: 3\"] --- S2_5[\"int32: 3\"] --- S3_5[\"S3\"] --- S4_5[\"S4\"]\n    style S1_5 stroke:red\n    style S2_5 stroke:red\n    end\n\n    subgraph 2ndadd [\"2nd add\"]\n    direction LR\n    S1_6[\"int32: 6\"] --- S2_6[\"S2\"] --- S3_6[\"S3\"] --- S4_6[\"S4\"]\n    style S1_6 stroke:red\n    end\n\n    start --&gt; ldarg.0 --&gt; ldarg.1 --&gt; add --&gt; ldarg.2 --&gt; 2ndadd --&gt; ret</code></pre> </p> <p><sub>\u8fd9\u56fe\u505a\u5b8c\u540e\u770b\u4e0a\u53bb\u597d\u50cf\u4e0d\u662f\u60f3\u8c61\u4e2d\u7684\u90a3\u4e48\u76f4\u89c2...</sub></p>"},{"location":"hooks/il/#il_2","title":"\u4e66\u5199 <code>IL</code>","text":"<p>\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86\u4e00\u5c0f\u4e9b <code>IL</code> \u7684\u77e5\u8bc6, \u73b0\u5728\u6211\u4eec\u56de\u5230\u4e4b\u524d\u7684\u5de5\u7a0b\u4e2d, \u66f4\u6539\u4e3a\u4ee5\u4e0b\u4ee3\u7801: <pre><code>using System.Reflection;\nusing System.Reflection.Emit;\n\nnamespace DynamicAssemblyTest;\n\npublic static class Program\n{\n    public static MethodInfo GenerateMethod(Action&lt;ILGenerator&gt; generateAction)\n    {\n        AssemblyBuilder asmBuilder = AssemblyBuilder.DefineDynamicAssembly(new(\"MyAssembly\"), AssemblyBuilderAccess.RunAndCollect);\n        ModuleBuilder moduleBuilder = asmBuilder.DefineDynamicModule(\"MyTestModule\");\n        TypeBuilder typeBuilder = moduleBuilder.DefineType(\"MyType\");\n        MethodBuilder methodBuilder = typeBuilder.DefineMethod(\"MyMethod\", MethodAttributes.Public | MethodAttributes.Static\n            , typeof(int), new Type[] { typeof(int), typeof(int), typeof(int) });\n        generateAction(methodBuilder.GetILGenerator());\n        return typeBuilder.CreateType().GetMethod(\"MyMethod\")!;\n    }\n\n    public static void Main()\n    {\n        MethodInfo methodInfo = GenerateMethod(il =&gt;\n        {\n            il.Emit(OpCodes.Ldarg_0);\n            il.Emit(OpCodes.Ldarg_1);\n            il.Emit(OpCodes.Add);\n            il.Emit(OpCodes.Ldarg_2);\n            il.Emit(OpCodes.Add);\n            il.Emit(OpCodes.Ret);\n        });\n        var func = methodInfo.CreateDelegate&lt;Func&lt;int, int, int, int&gt;&gt;();\n        var result = func(1, 2, 3);\n        Console.WriteLine($\"result is {result}\");\n    }\n}\n</code></pre></p> <p>\u8fd9\u91cc\u6211\u4eec\u5728\u4e0a\u9762\u66f4\u6539\u4e86\u65b9\u6cd5\u7684\u5b9a\u4e49, \u4f7f\u5b83\u53d8\u4e3a\u5e26\u6709 <code>int</code> \u8fd4\u56de\u503c\u4e14\u63a5\u6536 3 \u4e2a\u53c2\u6570\u7684\u65b9\u6cd5, \u7136\u540e\u9002\u5f53\u4fee\u6539\u6211\u4eec\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5730\u65b9, \u7136\u540e\u8fd0\u7528\u6211\u4eec\u521a\u624d\u7684 <code>IL</code> \u77e5\u8bc6\u5b9e\u73b0\u8fd9\u4e2a\u65b9\u6cd5. \u73b0\u5728, \u8fd0\u884c\u5b83, \u4f60\u5e94\u8be5\u4f1a\u5f97\u5230 <code>result is 6</code> \u7684\u8f93\u51fa, \u4f46\u662f\u6211\u4eec\u5168\u7a0b\u90fd\u6ca1\u6709\u5728 <code>C#</code> \u4ee3\u7801\u4e2d\u4f7f\u7528 <code>+</code> \u8fd0\u7b97\u7b26, \u800c\u662f\u76f4\u63a5\u5728 <code>IL</code> \u4e2d\u8c03\u7528 <code>add</code> \u64cd\u4f5c\u7b26, \u4ece\u67d0\u4e9b\u65b9\u9762\u6765\u8bf4\u8fd9\u633a\u6709\u8da3\u7684.</p> <p>\u73b0\u5728, \u8bd5\u7740\u5b8c\u6210\u4e00\u4e2a\u5c0f\u7ec3\u4e60, \u5c06\u4e0a\u9762 <code>GenerateMethod</code> \u65b9\u6cd5\u91cc\u5bf9 <code>MyMethod</code> \u7684\u5b9e\u73b0\u4ece <code>a + b + c</code> \u66f4\u6539\u4e3a <code>a + b * c</code>.</p> \u63d0\u793a\u7b54\u6848 <p>\u4e58\u6cd5\u7684\u64cd\u4f5c\u7b26\u4e3a <code>mul</code>, \u5176\u4f7f\u7528\u65b9\u6cd5\u4e0e <code>add</code> \u4e00\u81f4.</p> \u65b9\u6cd5\u4e00\u65b9\u6cd5\u4e8c\u89e3\u91ca <pre><code>il.Emit(OpCodes.Ldarg_1);\nil.Emit(OpCodes.Ldarg_2);\nil.Emit(OpCodes.Mul);\nil.Emit(OpCodes.Ldarg_0);\nil.Emit(OpCodes.Add);\nil.Emit(OpCodes.Ret);\n</code></pre> <pre><code>il.Emit(OpCodes.Ldarg_0);\nil.Emit(OpCodes.Ldarg_1);\nil.Emit(OpCodes.Ldarg_2);\nil.Emit(OpCodes.Mul);\nil.Emit(OpCodes.Add);\nil.Emit(OpCodes.Ret);\n</code></pre> <p>\u5728\u65b9\u6cd5\u4e00\u4e2d\u6211\u4eec\u7684\u601d\u8def\u5f88\u81ea\u7136, \u5148\u538b\u5165\u540e\u4e24\u4e2a\u53c2\u6570\u4f7f\u5176\u76f8\u4e58\u540e\u518d\u4e0e\u7b2c\u4e00\u4e2a\u53c2\u6570\u76f8\u52a0. \u4e5f\u5c31\u662f\u5b9e\u73b0\u7684\u662f <code>(b * c) + a</code>. \u5728\u65b9\u6cd5\u4e8c\u4e2d\u5c31\u9700\u8981\u52a8\u70b9\u8111\u5b50, \u6211\u4eec\u4e00\u6b21\u6027\u5c06\u4e09\u4e2a\u53c2\u6570\u538b\u5165\u4e86\u6808\u4e2d, \u7136\u540e\u6267\u884c\u4e00\u4e2a <code>mul</code> \u64cd\u4f5c, \u5b83\u4f1a\u628a\u6700\u540e\u538b\u5165\u7684\u4e24\u4e2a\u5143\u7d20\u5f39\u51fa\u76f8\u4e58\u540e\u538b\u5165, \u7136\u540e\u6211\u4eec\u9a6c\u4e0a\u518d\u6267\u884c\u4e00\u4e2a <code>add</code> \u64cd\u4f5c, \u5c06\u521a\u521a\u88ab\u538b\u5165\u7684\u5143\u7d20\u4e0e\u6700\u5f00\u59cb\u88ab\u538b\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u76f8\u52a0, \u4e5f\u5c31\u662f\u5b9e\u73b0\u7684\u662f <code>a + (b * c)</code>.</p> <p>\u73b0\u5728\u4f60\u53ef\u4ee5\u8bd5\u7740\u73a9\u4e00\u4e9b\u6709\u8da3\u7684\u4e1c\u897f, \u6bd4\u5982\u8bd5\u7740\u7528 <code>ldarg.3</code> \u538b\u5165\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u7b2c\u56db\u4e2a\u53c2\u6570, \u6216\u8005\u5728 <code>ret</code> \u65f6\u8bc4\u4f30\u6808\u4e0a\u6ca1\u6709\u5143\u7d20\u6216\u8005\u6709\u5f88\u591a\u4e2a\u5143\u7d20. \u2003\u2014\u2014\u2014\u2014 \u5b83\u4eec\u90fd\u4f1a\u8ff7\u60d1 jit \u7136\u540e\u4e0d\u77e5\u6240\u63aa\u5730\u6254\u7ed9\u4f60\u4e00\u4e2a <code>InvalidProgramException</code>.</p> <p>\u90a3\u4e48\u518d\u6765\u8bd5\u8bd5 <code>a - b + c</code>:</p> \u63d0\u793a\u7b54\u6848 <p>\u51cf\u6cd5\u7684\u64cd\u4f5c\u7b26\u4e3a <code>sub</code>, \u5b83\u4f1a\u5f39\u51fa\u4e24\u4e2a\u503c, \u5c06\u540e\u5f39\u51fa\u7684\u503c\u51cf\u53bb\u5148\u5f39\u51fa\u7684\u503c\u540e\u5c06\u7ed3\u679c\u538b\u5165\u8bc4\u4f30\u6808.</p> <p><pre><code>il.Emit(OpCodes.Ldarg_0);\nil.Emit(OpCodes.Ldarg_1);\nil.Emit(OpCodes.Sub);\nil.Emit(OpCodes.Ldarg_2);\nil.Emit(OpCodes.Add);\nil.Emit(OpCodes.Ret);\n</code></pre> \u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u7684\u4e00\u4e2a\u6bd4\u8f83\u8212\u670d\u7684\u70b9\u662f, \u76f8\u51cf\u7684\u987a\u5e8f\u521a\u597d\u5c31\u662f\u538b\u5165\u7684\u987a\u5e8f, \u4e5f\u5373\u5f39\u51fa\u7684\u9006\u987a\u5e8f, \u8fd9\u70b9\u4f1a\u8ba9\u6211\u4eec\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u624b\u5199 <code>IL</code> \u7684\u66f4\u7b26\u5408\u76f4\u89c9\u4e00\u70b9.</p>"},{"location":"hooks/il/#_5","title":"\u65b9\u6cd5\u7684\u8c03\u7528","text":"<p>\u73b0\u5728\u6211\u4eec\u7684 <code>IL</code> \u6307\u4ee4\u53ea\u80fd\u505a\u4e9b\u52a0\u52a0\u51cf\u51cf\u662f\u4e0d\u662f\u5f88\u65e0\u804a? \u90a3\u4e48\u73b0\u5728\u6211\u4eec\u6765\u8bd5\u8bd5\u5728 <code>IL</code> \u4e2d\u8c03\u7528\u65b9\u6cd5. \u5728 <code>IL</code> \u4e2d\u6709\u4e09\u79cd\u8c03\u7528\u65b9\u6cd5\u6307\u4ee4:</p> \u64cd\u4f5c\u7b26 \u53c2\u6570 \u63cf\u8ff0 <code>call</code> \u65b9\u6cd5 token \u6839\u636e\u65b9\u6cd5\u7684\u53c2\u6570\u5217\u8868(\u5305\u542b <code>this</code>, \u5982\u679c\u5176\u662f\u6210\u5458\u65b9\u6cd5\u65f6)\u9006\u987a\u5e8f\u5f39\u51fa\u5bf9\u5e94\u6570\u91cf\u53c2\u6570\u5e76\u4ee5\u6b64\u8c03\u7528\u5bf9\u5e94\u65b9\u6cd5 <code>callvirt</code> \u65b9\u6cd5 token \u540c <code>call</code>, \u4f46\u662f\u8be5\u6307\u4ee4\u5728\u5bf9\u5e94\u65b9\u6cd5\u4e3a\u865a\u65b9\u6cd5\u65f6\u4f1a\u5411\u4e0b\u5bfb\u627e\u91cd\u5199\u540e\u7684\u65b9\u6cd5 <code>calli</code> callsite \u63cf\u8ff0 \u6839\u636e callsite \u63cf\u8ff0 \u5f39\u51fa\u5bf9\u5e94\u53c2\u6570\u5e76\u518d\u6b21\u5f39\u51fa\u6240\u9700\u7684\u51fd\u6570\u6307\u9488\u5e76\u8c03\u7528 <p>\u5176\u4e2d\u7528\u7684\u6700\u591a\u7684\u662f <code>call</code> \u548c <code>callvirt</code>, \u6700\u540e\u4e00\u4e2a <code>calli</code> \u5728\u505a\u4e0e\u672c\u673a\u4ea4\u4e92\u65f6\u624d\u5e38\u7528,  \u56e0\u4e3a\u5b83\u8981\u6c42\u6211\u4eec\u6709\u5bf9\u5e94\u7684\u51fd\u6570\u6307\u9488(\u51fd\u6570\u6307\u9488\u53ef\u80fd\u5f88\u591a\u6559\u7a0b\u4e0d\u4f1a\u63d0\u53ca, \u4f60\u53ef\u4ee5\u5728MSDN \u4e0a\u7684\u4e0d\u5b89\u5168\u4ee3\u7801\u3001\u6570\u636e\u6307\u9488\u548c\u51fd\u6570\u6307\u9488\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u4e86\u89e3).  </p> <p><code>call</code> \u4e0e <code>callvirt</code> \u6700\u4e3b\u8981\u7684\u533a\u522b\u662f, <code>call</code> \u6307\u4ee4\u4e00\u65e6\u6307\u5b9a\u4e86\u5bf9\u5e94\u65b9\u6cd5, \u90a3\u4e48\u5728\u8fd0\u884c\u65f6\u8c03\u7528\u7684\u65b9\u6cd5\u662f\u4e0d\u4f1a\u53d8\u7684, \u6240\u4ee5\u5b83\u901a\u5e38\u751f\u6210\u4e8e\u9759\u6001\u65b9\u6cd5\u7684\u8c03\u7528\u4e2d, \u800c <code>callvirt</code> \u5728\u8fd0\u884c\u65f6\u4f1a\u68c0\u6d4b\u76ee\u6807\u7c7b\u578b, \u5e76\u5411\u4e0b\u67e5\u627e\u53ef\u80fd\u7684\u88ab\u91cd\u5199\u540e\u7684\u65b9\u6cd5, \u6240\u4ee5\u6309\u5b57\u9762\u610f\u601d\u5b83\u7ecf\u5e38\u751f\u6210\u4e8e\u865a\u65b9\u6cd5\u7684\u8c03\u7528\u4e2d, \u4e0d\u8fc7\u4e00\u822c\u5bf9\u4e8e\u666e\u901a\u6210\u5458\u65b9\u6cd5\u7684\u8c03\u7528, <code>C#</code> \u7f16\u8bd1\u5668\u4e5f\u4f1a\u751f\u6210 <code>callvirt</code> \u6307\u4ee4, \u8fd9\u662f\u56e0\u4e3a <code>callvirt</code> \u9700\u8981\u68c0\u67e5\u76ee\u6807\u7c7b\u578b, \u5728\u8c03\u7528\u5bf9\u8c61\u4e3a <code>null</code> \u65f6\u5c31\u629b\u51fa <code>NullReferenceException</code>, \u800c <code>call</code> \u6307\u4ee4\u53ef\u80fd\u76f4\u5230\u65b9\u6cd5\u8c03\u7528\u4e00\u534a\u65f6\u624d\u5bdf\u89c9 <code>this</code> \u4e3a <code>null</code>, \u8fd9\u662f\u4e00\u4e2a\u5f88\u5371\u9669\u7684\u884c\u4e3a.</p> <p>\u5728\u6211\u4eec\u5e9f\u8bdd\u5b8c\u4e4b\u540e, \u662f\u65f6\u5019\u505a\u4e00\u70b9\u5b9e\u9645\u7684\u4e86. \u73b0\u5728, \u6211\u4eec\u4e0d\u9700\u8981\u6211\u4eec\u4e4b\u524d\u6d4b\u8bd5 <code>add</code>, <code>ret</code>, <code>mul</code>, <code>sub</code> \u6307\u4ee4\u65f6\u58f0\u660e\u7684\u65b9\u6cd5\u7b7e\u540d\u4e86, \u6240\u4ee5\u6211\u4eec\u66f4\u6539\u5982\u4e0b\u4ee3\u7801, \u4f7f\u5f97\u6211\u4eec\u7684\u52a8\u6001\u65b9\u6cd5 <code>MyMethod</code> \u8fd4\u56de <code>void</code> \u5e76\u4e14\u4e0d\u63a5\u6536\u53c2\u6570: <pre><code>public static MethodInfo GenerateMethod(Action&lt;ILGenerator&gt; generateAction)\n{\n    AssemblyBuilder asmBuilder = AssemblyBuilder.DefineDynamicAssembly(new(\"MyAssembly\"), AssemblyBuilderAccess.RunAndCollect);\n    ModuleBuilder moduleBuilder = asmBuilder.DefineDynamicModule(\"MyTestModule\");\n    TypeBuilder typeBuilder = moduleBuilder.DefineType(\"MyType\");\n    MethodBuilder methodBuilder = typeBuilder.DefineMethod(\"MyMethod\", MethodAttributes.Public | MethodAttributes.Static\n        , typeof(void), Type.EmptyTypes);\n    generateAction(methodBuilder.GetILGenerator());\n    return typeBuilder.CreateType().GetMethod(\"MyMethod\")!;\n}\n</code></pre></p> <p>\u987a\u4fbf\u628a\u4e0b\u9762\u4e5f\u6539\u6210\u8fd9\u6837, \u4ee5\u8d34\u5408\u6211\u4eec\u5728\u4e0a\u9762\u7684\u5b9a\u4e49, \u987a\u4fbf\u6e05\u7a7a\u4e00\u4e0b\u6211\u4eec\u7684\u65b9\u6cd5\u4f53: <pre><code>MethodInfo methodInfo = GenerateMethod(il =&gt;\n{\n    il.Emit(OpCodes.Ret);\n});\nvar action = methodInfo.CreateDelegate&lt;Action&gt;();\naction();\n</code></pre></p> <p>\u73b0\u5728, \u6211\u4eec\u6253\u7b97\u4f7f\u7528 <code>IL</code> \u5199\u4e00\u4e2a HelloWorld \u7a0b\u5e8f, \u90a3\u4e48\u5c31\u9700\u8981\u8c03\u7528 <code>System.Console.WriteLine(string)</code> \u8fd9\u4e2a\u65b9\u6cd5, \u6ce8\u610f\u6b64\u65f6\u6211\u4eec\u5fc5\u987b\u6e05\u695a\u6211\u4eec\u8c03\u7528\u7684\u65b9\u6cd5\u7684\u5177\u4f53\u67d0\u4e2a\u91cd\u8f7d, \u73b0\u5728\u4f7f\u7528\u53cd\u5c04\u77e5\u8bc6, \u83b7\u53d6\u8fd9\u4e2a\u9759\u6001\u65b9\u6cd5\u7684 <code>MethodInfo</code>: <pre><code>var cws = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\n</code></pre></p> <p>\u7136\u540e\u6211\u4eec\u89c2\u5bdf\u5b83\u7684\u53c2\u6570, \u53d1\u73b0\u9700\u8981\u4e00\u4e2a <code>string</code>, \u6240\u4ee5\u6211\u4eec\u5f97\u4f7f\u7528 <code>ldstr</code> <code>IL</code> \u6307\u4ee4, \u5b83\u4f1a\u5c06\u5b83\u53c2\u6570 token \u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u538b\u5165\u8bc4\u4f30\u6808, \u5728\u8fd9\u91cc\u6211\u4eec\u4e0d\u9700\u8981\u5173\u5fc3\u8fd9\u4e2a token \u5982\u4f55\u751f\u6210, <code>System.Reflection.Emit</code> \u4f1a\u5e2e\u6211\u4eec\u505a\u597d\u8fd9\u4e9b, \u5728\u8fd9\u91cc\u53ea\u9700\u8981\u4f20\u5165 <code>string</code>: <pre><code>il.Emit(OpCodes.Ldstr, \"Hello World in IL!\");\n</code></pre></p> <p>\u4e00\u5207\u5c31\u7eea, \u8c03\u7528\u6211\u4eec\u7684\u65b9\u6cd5:</p> <pre><code>il.Emit(OpCodes.Call, cws);\n</code></pre> <p>\u603b\u7684\u4ee3\u7801\u5982\u4e0b: <pre><code>var cws = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nil.Emit(OpCodes.Ldstr, \"Hello World in IL!\");\nil.Emit(OpCodes.Call, cws);\nil.Emit(OpCodes.Ret);\n</code></pre></p> <p>\u73b0\u5728, \u8fd0\u884c\u7a0b\u5e8f, \u4f60\u5e94\u8be5\u4f1a\u770b\u5230\u5982\u4e0b\u8f93\u51fa: \u54c7\u4f60\u592a\u5f3a\u4e86\u4f60\u505a\u5230\u4e86\u8fd9\u4e2a\u795e\u4ed9\u64cd\u4f5c\u4f60\u600e\u4e48\u53ef\u4ee5\u8fd9\u4e48\u5f3a\uff01\uff01\uff01\u2003\u5f85\u4f1a\u513f\u6211\u8bf4\u6211\u81ea\u5df1\u5462<pre><code>Hello World in IL!\n</code></pre></p> <p>\u5bf9\u4e8e\u6709\u8fd4\u56de\u503c\u7684\u65b9\u6cd5, <code>call</code> \u8c03\u7528\u5b8c\u540e\u4f1a\u5c06\u8fd4\u56de\u503c\u538b\u5165\u5806\u6808, \u6bd4\u5982\u8981\u5c06\u4ee5\u4e0b <code>C#</code> \u4ee3\u7801\u8f6c\u4e3a <code>IL</code> \u4ee3\u7801: <pre><code>Console.WriteLine(Console.ReadLine());\n</code></pre></p> <p>\u53ea\u9700\u8981\u8fd9\u6837: <pre><code>var cws = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar cr = typeof(Console).GetMethod(\"ReadLine\")!;\nil.Emit(OpCodes.Call, cr);\nil.Emit(OpCodes.Call, cws);\nil.Emit(OpCodes.Ret);\n</code></pre></p> <p>\u5f53\u6211\u4eec\u4e0d\u9700\u8981\u8fd4\u56de\u503c\u65f6, \u6211\u4eec\u5fc5\u987b\u663e\u5f0f\u4f7f\u7528 <code>pop</code> \u6307\u4ee4\u820d\u5f03\u5b83, \u9632\u6b62\u5b83\"\u6c61\u67d3\"\u6211\u4eec\u7684\u8bc4\u4f30\u6808: <pre><code>// \u7b49\u5f85\u7528\u6237\u7684\u4e00\u4e2a\u56de\u8f66\u8f93\u5165\nConsole.ReadLine();\nConsole.WriteLine(\"Hey, I see you pressed the Enter!\");\n</code></pre></p> <pre><code>var cws = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar cr = typeof(Console).GetMethod(\"ReadLine\")!;\nil.Emit(OpCodes.Call, cr);\nil.Emit(OpCodes.Pop);\nil.Emit(OpCodes.Ldstr, \"Hey, I see you pressed the Enter!\");\nil.Emit(OpCodes.Call, cws);\nil.Emit(OpCodes.Ret);\n</code></pre> <p>\u65b9\u6cd5\u7684\u53c2\u6570\u5217\u8868\u987a\u5e8f\u548c\u538b\u6808\u987a\u5e8f\u4e00\u81f4, \u8c03\u7528\u591a\u53c2\u6570\u65b9\u6cd5\u4e5f\u4f1a\u663e\u5f97\u5f88\u81ea\u7136: <pre><code>double a = Math.Pow(123, 4);\nConsole.WriteLine(a);\n</code></pre></p> <pre><code>var cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(double) })!;\nvar powMethod = typeof(Math).GetMethod(\"Pow\")!;\nil.Emit(OpCodes.Ldc_R8, 123.0);\nil.Emit(OpCodes.Ldc_R8, 4.0);\nil.Emit(OpCodes.Call, powMethod);\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre> <p><code>ldc.r8</code> \u6307\u4ee4\u5c06\u53c2\u6570\u4e2d\u7684 <code>float64</code>, \u5373 <code>double</code> \u5b57\u9762\u91cf\u538b\u5165\u8bc4\u4f30\u6808\u4e2d, \u7c7b\u4f3c\u7684\u64cd\u4f5c\u7b26\u8fd8\u6709 <code>ldc.i4</code>, \u5b83\u5c06\u53c2\u6570\u4e2d\u7684 <code>int32</code> \u5373 <code>int</code> \u5b57\u9762\u91cf\u538b\u5165\u8bc4\u4f30\u6808\u4e2d, \u6ce8\u610f\u5728\u8fd9\u91cc\u4f20\u53c2\u6211\u4eec\u5fc5\u987b\u660e\u786e\u5199\u660e\u53c2\u6570\u7c7b\u578b, \u6bd4\u5982\u4e0a\u9762\u7684 <code>IL</code> \u5982\u679c\u4f7f\u7528 <code>123</code> \u800c\u4e0d\u662f <code>123.0</code> \u4f1a\u53d1\u751f jit \u5f02\u5e38\u6216\u884c\u4e3a\u975e\u671f\u671b, \u56e0\u4e3a\u53c2\u6570\u7c7b\u578b\u4e0d\u5339\u914d, <code>123</code> \u5339\u914d\u5230\u4e86 <code>il.Emit</code> \u7684 <code>int</code> \u91cd\u8f7d, \u800c\u6211\u4eec\u9700\u8981\u7684\u662f <code>double</code> \u91cd\u8f7d, \u6240\u4ee5\u6211\u4eec\u5199\u660e <code>123.0</code> \u6216 <code>123d</code> \u4ee5\u4f7f\u5176\u6210\u4e3a <code>double</code> \u7c7b\u578b\u7684\u5b57\u9762\u91cf. \u5bf9\u4e8e <code>float</code> <code>long</code> <code>double</code> \u7b49\u8fd9\u4e9b\u6709\u5bf9\u5e94\u5b57\u9762\u91cf\u540e\u7f00\u7684(<code>f</code>, <code>l</code>, <code>d</code>) \u7c7b\u578b\u6211\u4eec\u76f4\u63a5\u52a0\u540e\u7f00\u5c31\u884c\u4e86, \u4f46\u5bf9\u4e8e <code>short</code> \u548c <code>byte</code> \u8fd9\u4e9b, \u6211\u4eec\u5fc5\u987b\u8fdb\u884c\u663e\u5f0f\u5f3a\u8f6c:</p> <pre><code>public static void Main()\n{\n    MethodInfo methodInfo = GenerateMethod(il =&gt;\n    {\n        // il \u4e2d\u6ca1\u6709\u5bf9\u5e94\u7684\u52a0\u8f7d `int16` \u548c `int8` \u7684\u6307\u4ee4, \u6211\u4eec\u5f97\u4f7f\u7528 `ldc.i4`, \n        // \u867d\u7136\u5b83\u672c\u6765\u662f\u7528\u6765\u52a0\u8f7d `int32` \u7684, \u4f46 jit \u4f1a\u77e5\u9053\u6211\u4eec\u60f3\u8981\u5e72\u4ec0\u4e48\n        // \u5bf9\u4e8e\u5c0f\u4e00\u70b9\u7684\u6574\u6570\u5b57\u9762\u91cf IL \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a `ldc.i4.s` \u6307\u4ee4\n        // \u5176\u53c2\u6570\u4e3a `int8` \u5373 `byte` \u6216 `sbyte` \u7c7b\u578b\n        var printByte = typeof(Program).GetMethod(\"PrintByte\")!;\n        il.Emit(OpCodes.Ldc_I4_S, (byte)12);\n        il.Emit(OpCodes.Call, printByte);\n        il.Emit(OpCodes.Ldc_I4, (int)12);\n        il.Emit(OpCodes.Call, printByte);\n        il.Emit(OpCodes.Ret);\n    });\n    var action = methodInfo.CreateDelegate&lt;Action&gt;();\n    action();\n\n}\n\npublic static void PrintByte(byte v)\n{\n    Console.WriteLine($\"Your byte is {v}\");\n}\n</code></pre>"},{"location":"hooks/il/#_6","title":"\u5bf9\u8c61\u5b9e\u4f8b\u5316","text":"<p>\u8fd9\u4e00\u6b65\u5f88\u7b80\u5355, \u4e3a\u4e86\u5b9e\u4f8b\u5316\u4e00\u4e2a\u5bf9\u8c61, \u6211\u4eec\u9700\u8981\u4f7f\u7528 <code>newobj</code> \u64cd\u4f5c\u7b26, \u5176\u53c2\u6570\u4e3a\u5bf9\u5e94\u5bf9\u8c61\u7684\u4e00\u4e2a\u6784\u9020\u5668, \u8be5\u6307\u4ee4\u6267\u884c\u540e\u4f1a\u5c06\u6211\u4eec\u8981\u7684\u5bf9\u8c61\u538b\u5165\u8bc4\u4f30\u6808, \u6bd4\u5982\u5982\u4e0b <code>C#</code> \u4ee3\u7801:</p> <pre><code>new StringBuilder();\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u8fd9\u6837\u751f\u6210\u5b83\u7684 <code>IL</code>:</p> <pre><code>var sbctor = typeof(StringBuilder).GetConstructor(Type.EmptyTypes)!;\nil.Emit(OpCodes.Newobj, sbctor);\n</code></pre>"},{"location":"hooks/il/#_7","title":"\u6210\u5458\u65b9\u6cd5\u7684\u8c03\u7528","text":"<p>\u73b0\u5728, \u6211\u4eec\u5728\u8bc4\u4f30\u6808\u4e0a\u6709\u4e86\u4e00\u4e2a\u5bf9\u8c61, \u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u5b83\u8c03\u7528\u5b83\u7684\u6210\u5458\u65b9\u6cd5\u4e86. \u6210\u5458\u65b9\u6cd5\u7684\u8c03\u7528\u4e0e\u9759\u6001\u65b9\u6cd5\u8c03\u7528\u57fa\u672c\u4e00\u81f4, \u4f46\u662f\u6bcf\u6b21\u8c03\u7528\u4e4b\u524d\u6211\u4eec\u90fd\u5fc5\u987b\u8bb0\u5f97\u5c06 <code>this</code> \u7684\u503c\u4f5c\u4e3a\u7b2c0\u4e2a\u53c2\u6570\u538b\u5165\u5806\u6808, \u987a\u4fbf, \u8bb0\u4f4f\u8fd9\u91cc\u7684 <code>this</code> \u662f\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7684, \u6bcf\u6b21\u8c03\u7528\u90fd\u4f1a\u88ab\u5f39\u51fa\u8bc4\u4f30\u6808, \u6240\u4ee5\u5728\u8fde\u7eed\u8c03\u7528\u5b83\u7684\u6210\u5458\u65b9\u6cd5\u65f6\u8bb0\u5f97\u5c06 <code>this</code> \u518d\u6b21\u538b\u5165. \u901a\u5e38\u6211\u4eec\u4f1a\u4f7f\u7528 <code>callvirt</code> \u6765\u8c03\u7528\u6210\u5458\u65b9\u6cd5, \u4e00\u65b9\u9762\u4e3a\u4e86\u786e\u4fdd\u8c03\u7528\u5230\u4e86\u91cd\u5199\u540e\u7684\u865a\u51fd\u6570, \u4e00\u65b9\u9762\u4e3a\u4e86\u5c3d\u53ef\u80fd\u65e9\u7684\u68c0\u6d4b\u51fa <code>this</code> \u4e3a null.</p> <pre><code>Console.WriteLine(new StringBuilder().Append(\"abc\").Append(\"def\").Append(\"ghi\").ToString());\n</code></pre> <pre><code>var cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar sbctor = typeof(StringBuilder).GetConstructor(Type.EmptyTypes)!;\nvar appendMethod = typeof(StringBuilder).GetMethod(\"Append\", new Type[] { typeof(string) })!;\nvar toStringMethod = typeof(StringBuilder).GetMethod(\"ToString\", Type.EmptyTypes)!;\n// StringBuilder.Append \u65b9\u6cd5\u4f1a\u8fd4\u56de\u81ea\u8eab, \u6240\u4ee5\u8fd9\u91cc\u7684 `this` \u5728\u65b9\u6cd5\u88ab\u8c03\u7528\u540e\u53c8\u88ab\u5f39\u51fa\u53c8\u88ab\u538b\u5165\nil.Emit(OpCodes.Newobj, sbctor);\nil.Emit(OpCodes.Ldstr, \"abc\");\nil.Emit(OpCodes.Callvirt, appendMethod);\nil.Emit(OpCodes.Ldstr, \"def\");\nil.Emit(OpCodes.Callvirt, appendMethod);\nil.Emit(OpCodes.Ldstr, \"ghi\");\nil.Emit(OpCodes.Callvirt, appendMethod);\nil.Emit(OpCodes.Callvirt, toStringMethod);\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre> <p>\u4f46\u662f\u5b9e\u9645\u4e0a, \u6211\u4eec\u660e\u786e\u77e5\u9053 <code>StringBuilder</code> \u662f\u5bc6\u5c01\u7684, \u6ca1\u4eba\u4f1a\u91cd\u5199\u5b83\u7684\u865a\u65b9\u6cd5, \u4ee5\u53ca\u8fd9\u91cc\u6211\u4eec\u660e\u786e\u77e5\u9053\u8fd9\u91cc\u7684 <code>this</code> \u4e0d\u4e3a null, \u6240\u4ee5\u5b9e\u9645\u4e0a\u4e0a\u9762\u7684 <code>callvirt</code> \u90fd\u80fd\u6362\u6210 <code>call</code>:</p> <pre><code>var cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar sbctor = typeof(StringBuilder).GetConstructor(Type.EmptyTypes)!;\nvar appendMethod = typeof(StringBuilder).GetMethod(\"Append\", new Type[] { typeof(string) })!;\nvar toStringMethod = typeof(StringBuilder).GetMethod(\"ToString\", Type.EmptyTypes)!;\n// StringBuilder.Append \u65b9\u6cd5\u4f1a\u8fd4\u56de\u81ea\u8eab, \u6240\u4ee5\u8fd9\u91cc\u7684 `this` \u5728\u65b9\u6cd5\u88ab\u8c03\u7528\u540e\u53c8\u88ab\u5f39\u51fa\u53c8\u88ab\u538b\u5165\nil.Emit(OpCodes.Newobj, sbctor);\nil.Emit(OpCodes.Ldstr, \"abc\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Ldstr, \"def\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Ldstr, \"ghi\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Call, toStringMethod);\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre>"},{"location":"hooks/il/#_8","title":"\u5c40\u90e8\u53d8\u91cf","text":"<p>\u4e5f\u8bb8\u4f60\u4e5f\u53d1\u73b0\u4e86, \u6211\u4eec\u4e0a\u9762\u7684\u4ee3\u7801\u90fd\u6709\u4e9b\"\u618b\u5c48\", \u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u6ca1\u6709\u7528\u5230\u5c40\u90e8\u53d8\u91cf. \u5728 <code>System.Reflection.Emit</code> \u4e2d, \u6211\u4eec\u5fc5\u987b\u663e\u5f0f\u6307\u5b9a\u6211\u4eec\u53ef\u80fd\u7528\u5230\u51e0\u4e2a\u5c40\u90e8\u53d8\u91cf\u4ee5\u53ca\u5bf9\u5e94\u7684\u7c7b\u578b, \u6bd4\u5982\u5982\u4e0b C# \u4ee3\u7801: <pre><code>StringBuilder sb = new();\nsb.Append(\"abc\");\nsb.Append(\"def\");\nsb.Append(\"ghi\");\nstring str = sb.ToString();\nConsole.WriteLine(str);\n</code></pre></p> <p>\u6211\u4eec\u8fdb\u884c\u5206\u6790, \u53d1\u73b0\u5b83\u4f7f\u7528\u4e86\u4e24\u4e2a\u5c40\u90e8\u53d8\u91cf: <code>sb</code> \u548c <code>str</code>, \u6240\u4ee5\u6211\u4eec\u5728\u8c03\u7528 <code>il.Emit</code> \u4e4b\u524d\u8c03\u7528 <code>il.DeclareLocal</code>:</p> <pre><code>il.DeclareLocal(typeof(StringBuilder)); // 0\nil.DeclareLocal(typeof(string)); // 1\n</code></pre> <p>\u6ce8\u610f\u6211\u4eec\u8c03\u7528 <code>DeclareLocal</code> \u7684\u987a\u5e8f, \u8fd9\u4e2a\u987a\u5e8f\u6211\u4eec\u5728\u4e0b\u9762\u7684 <code>IL</code> \u4e2d\u5c31\u4f1a\u4f7f\u7528\u5b83:</p> \u54e6\u5929\u54ea\u5b83\u771f\u7684\u592a\u957f\u4e86<pre><code>var cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar sbctor = typeof(StringBuilder).GetConstructor(Type.EmptyTypes)!;\nvar appendMethod = typeof(StringBuilder).GetMethod(\"Append\", new Type[] { typeof(string) })!;\nvar toStringMethod = typeof(StringBuilder).GetMethod(\"ToString\", Type.EmptyTypes)!;\n\nil.DeclareLocal(typeof(StringBuilder)); // 0\nil.DeclareLocal(typeof(string)); // 1\n\nil.Emit(OpCodes.Newobj, sbctor);\n// \u5c06\u6211\u4eec\u7684 StringBuilder \u5bf9\u8c61\u5b58\u5230 0 \u53f7\u4f4d\u7684\u5c40\u90e8\u53d8\u91cf\u4e0a\nil.Emit(OpCodes.Stloc_0); \n// \u628a\u6211\u4eec\u4e4b\u524d\u5728 0 \u53f7\u4f4d\u5c40\u90e8\u53d8\u91cf\u4e0a\u5b58\u7684 StringBuilder \u5bf9\u8c61\u8bfb\u53d6\u51fa\u6765\u5e76\u538b\u5165\u8bc4\u4f30\u6808\u4e0a\nil.Emit(OpCodes.Ldloc_0); \n// \u51c6\u5907 StringBuilder.Append \u7684\u90a3\u4e2a\u53c2\u6570\u4f5c\u4e3a\u5176\u5185\u90e8 ldarg.1 \u4f1a\u8bfb\u53d6\u7684\u503c(ldarg.0 \u662f this)\nil.Emit(OpCodes.Ldstr, \"abc\");\nil.Emit(OpCodes.Call, appendMethod);\n// \u6211\u4eec\u5728\u8fd9\u91cc\u4e0d\u4f1a\u4f7f\u7528 StringBuilder.Append \u7684\u90a3\u4e2a\u7528\u4e8e\u94fe\u5f0f\u8c03\u7528\u7684\u8fd4\u56de\u503c\n// \u6240\u4ee5\u6211\u4eec\u4f7f\u7528 `pop` \u5f39\u51fa\u5b83\u907f\u514d\"\u6c61\u67d3\"\u6211\u4eec\u7684\u8bc4\u4f30\u6808.\nil.Emit(OpCodes.Pop);\nil.Emit(OpCodes.Ldloc_0);\nil.Emit(OpCodes.Ldstr, \"def\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Pop);\nil.Emit(OpCodes.Ldloc_0);\nil.Emit(OpCodes.Ldstr, \"ghi\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Pop);\nil.Emit(OpCodes.Ldloc_0);\nil.Emit(OpCodes.Call, toStringMethod);\nil.Emit(OpCodes.Stloc_1);\nil.Emit(OpCodes.Ldloc_1);\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre> <p>\u5728\u4e0a\u9762\u7684 <code>IL</code> \u4e2d, <code>stloc.0</code> \u5c06\u6808\u9876\u7684\u503c\u5f39\u51fa\u5e76\u5b58\u5230\u5c40\u90e8\u53d8\u91cf 0 \u53f7\u4f4d\u4e0a, <code>ldloc.0</code> \u8bfb\u53d6\u5c40\u90e8\u53d8\u91cf 0 \u53f7\u4f4d\u7684\u503c\u7136\u540e\u5c06\u5176\u538b\u5165\u8bc4\u4f30\u6808\u4e0a. \u4e0d\u8fc7\u5b9e\u9645\u4e0a\u8fd9\u91cc\u7528\u4e0d\u7740\u5c40\u90e8\u53d8\u91cf, \u9664\u4e86\u4f7f\u7528 <code>Append</code> \u8fd4\u56de\u7684 <code>this</code> \u4e4b\u5916, \u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>dup</code> \u6307\u4ee4\u6765\u7b80\u5316\u5927\u91cf\u7684 <code>ldloc.0</code> \u64cd\u4f5c. \u9664\u6b64\u4e4b\u5916 <code>string</code> \u90a3\u4e2a\u5c40\u90e8\u53d8\u91cf\u4e5f\u7528\u4e0d\u7740, \u6211\u4eec\u5728 <code>ToString</code> \u540e\u76f4\u63a5\u8c03\u7528 <code>Console.WriteLine</code> \u5373\u53ef, \u56e0\u4e3a\u8fd9\u65f6\u7684 <code>string</code> \u521a\u597d\u5c31\u5728\u6808\u9876.</p> <pre><code>il.Emit(OpCodes.Newobj, sbctor);\n\nil.Emit(OpCodes.Dup);\nil.Emit(OpCodes.Ldstr, \"abc\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Pop);\n\nil.Emit(OpCodes.Dup);\nil.Emit(OpCodes.Ldstr, \"def\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Pop);\n\nil.Emit(OpCodes.Dup);\nil.Emit(OpCodes.Ldstr, \"ghi\");\nil.Emit(OpCodes.Call, appendMethod);\nil.Emit(OpCodes.Pop);\n\nil.Emit(OpCodes.Dup);\nil.Emit(OpCodes.Call, toStringMethod);\nil.Emit(OpCodes.Call, cw);\n\n// \u8bb0\u5f97\u5f39\u51fa\u6700\u521d newobj \u6307\u4ee4\u538b\u5165\u7684\u90a3\u4e2a\u5143\u7d20, \u5426\u5219\u6b64\u65f6 ret \u6808\u5c31\u4e0d\u662f\u7a7a\u7684\u4e86\n// \u8fd9\u4f1a\u5bfc\u81f4 jit \u629b\u51fa InvalidProgramException\nil.Emit(OpCodes.Pop);\n\nil.Emit(OpCodes.Ret);\n</code></pre> <p><code>dup</code> \u6307\u4ee4\u5f39\u51fa\u6808\u9876\u7684\u5143\u7d20, \u7136\u540e\u538b\u5165\u4e24\u904d\u8fd9\u4e2a\u5143\u7d20, \u4e5f\u5c31\u662f\u5b83\u4f1a\u590d\u5236\u6808\u9876\u7684\u5143\u7d20\u4e00\u904d\u5e76\u538b\u5165, \u5728\u8fd9\u91cc,  \u6211\u4eec\u4f7f\u7528 <code>dup</code> \u6307\u4ee4\u5728\u6bcf\u6b21\u9700\u8981 <code>this</code> \u5bf9\u8c61\u65f6\u590d\u5236\u6700\u521d <code>newobj</code> \u6307\u4ee4\u538b\u5165\u7684\u5143\u7d20, \u8fd9\u6837\u5c31\u65e0\u9700\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u800c\u590d\u6742\u5316\u6211\u4eec\u7684 <code>IL</code> \u4e86.</p>"},{"location":"hooks/il/#_9","title":"\u5c5e\u6027\u7684\u8bbf\u95ee","text":"<p>\u5728 <code>IL</code> \u4e2d, \u5176\u5b9e\u6ca1\u6709\u4e00\u6761\u6307\u4ee4\u662f\u5173\u4e8e\u5c5e\u6027\u7684, \u56e0\u4e3a\u6211\u4eec\u77e5\u9053\u5c5e\u6027\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u5bf9 getter \u548c setter \u800c\u5df2. \u901a\u5e38, \u4e00\u4e2a\u540d\u4e3a <code>MyProp</code> \u7684\u5c5e\u6027\u7684 getter \u65b9\u6cd5\u53eb\u505a <code>get_MyProp</code>, setter \u65b9\u6cd5\u53eb\u505a <code>set_MyProp</code>, \u5982\u679c\u4f60\u5728 C# \u4e2d\u5c1d\u8bd5\u7ed9\u65b9\u6cd5\u8fd9\u6837\u8d77\u540d\u4f60\u4f1a\u53d1\u73b0\u7f16\u8bd1\u5668\u4f1a\u4e3a\u4e86\u9632\u6b62\u65b9\u6cd5\u91cd\u540d\u800c\u62a5\u9519, \u987a\u4fbf, \u8fd9\u4e00\u5bf9\u65b9\u6cd5\u5b83\u4eec\u5404\u81ea\u90fd\u6709\u4e00\u4e2a <code>special name</code> \u7684\u7279\u6b8a\u6807\u8bb0\u4ee5\u4fbf\u7f16\u8bd1\u5668\u77e5\u6653\u5b83\u4eec\u5f52\u5c5e\u4e8e\u4e00\u4e2a\u5c5e\u6027.  </p> <p>\u6bd4\u5982\u5982\u4e0b <code>C#</code> \u4ee3\u7801:</p> <pre><code>Console.WriteLine(\"123\".Length);\n</code></pre> <pre><code>var cwInt = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(int) })!;\nvar stringGetLength = typeof(string).GetMethod(\"get_Length\")!;\nil.Emit(OpCodes.Ldstr, \"123\");\nil.Emit(OpCodes.Call, stringGetLength);\nil.Emit(OpCodes.Call, cwInt);\nil.Emit(OpCodes.Ret);\n</code></pre> <p>\u5728\u8fd9\u91cc\u6211\u4eec\u8c03\u7528\u7684\u5c31\u662f <code>string</code> \u7684 <code>get_Length</code> \u65b9\u6cd5. \u5c31\u662f\u8fd9\u4e48\u7b80\u5355.</p>"},{"location":"hooks/il/#_10","title":"\u5b57\u6bb5\u7684\u8bbf\u95ee","text":"<p>\u5bf9\u4e8e\u9759\u6001\u5b57\u6bb5\u7684\u8bbf\u95ee, \u6211\u4eec\u9700\u8981\u4f7f\u7528 <code>ldsfld</code> \u64cd\u4f5c\u7b26, \u6bd4\u5982 <code>Path.DirectorySeparatorChar</code> \u8fd9\u4e2a\u9759\u6001\u5b57\u6bb5: <pre><code>Console.WriteLine(Path.DirectorySeparatorChar);\n</code></pre></p> <pre><code>// \u6ce8\u610f\u4e0b\u8fd9\u91cc WriteLine \u7684\u91cd\u8f7d\u6362\u4e86, \u56e0\u4e3a Path.DirectorySeparatorChar \u662f char \u7c7b\u578b\u7684\nvar cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(char) })!;\nvar pathStfld = typeof(Path).GetField(\"DirectorySeparatorChar\")!;\nil.Emit(OpCodes.Ldsfld, pathStfld);\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre> <p><code>ldsfld</code> \u4f1a\u5c06\u53c2\u6570\u4e2d\u7684\u9759\u6001\u5b57\u6bb5\u7684 token \u5bf9\u5e94\u7684\u9759\u6001\u5b57\u6bb5\u7684\u503c\u538b\u5165\u8bc4\u4f30\u6808\u4e0a.</p> <p>\u5bf9\u4e8e\u6210\u5458\u5b57\u6bb5\u7684\u8bbf\u95ee\u4e5f\u662f\u7c7b\u4f3c\u7684, \u4e0d\u8fc7\u5b83\u4f1a\u9700\u8981\u5f39\u51fa\u4e00\u4e2a <code>this</code> \u5143\u7d20, \u6bd4\u5982\u5bf9\u4e8e\u5982\u4e0b C# \u7c7b:  </p> <p><sub>\u5176\u5b9e\u662f\u627e\u4e0d\u5230\u00a0bcl\u00a0\u91cc\u7ecf\u5e38\u8bbf\u95ee\u6210\u5458\u5b57\u6bb5\u7684\u4f8b\u5b50\u624d\u88ab\u8feb\u58f0\u660e\u65b0\u7c7b\u7684</sub></p> <pre><code>public class SomeClass\n{\n    public string SomeString;\n    public SomeClass()\n        =&gt; SomeString = \"\u8fd9\u91cc\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32!\";\n}\n</code></pre> <pre><code>var someClassCtor = typeof(SomeClass).GetConstructor(Type.EmptyTypes)!;\nvar cwString = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar someClassFld = typeof(SomeClass).GetField(\"SomeString\")!;\nil.Emit(OpCodes.Newobj, someClassCtor);\nil.Emit(OpCodes.Ldfld, someClassFld);\nil.Emit(OpCodes.Call, cwString);\nil.Emit(OpCodes.Ret);\n</code></pre>"},{"location":"hooks/il/#_11","title":"\u8df3\u8f6c\u6307\u4ee4","text":"<p>\u5728\u8fd9\u91cc\u6211\u4eec\u4f1a\u4ecb\u7ecd\u8fd9\u4e00\u8282\u7684\u6700\u540e\u4e00\u4e2a\u4e1c\u897f \u2014\u2014 \u8df3\u8f6c\u6307\u4ee4. \u5b83\u662f C# \u4e2d <code>if</code> <code>switch</code> <code>for</code> <code>while</code> <code>goto</code> \u7b49\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u90fd\u5341\u5206\u4f9d\u8d56\u7684\u4e1c\u897f.  </p> <p>\u5728 <code>IL</code> \u4e2d, \u4e3a\u4e86\u65b9\u4fbf \u5927\u4e8e, \u5c0f\u4e8e, \u5927\u4e8e\u7b49\u4e8e, \u5c0f\u4e8e\u7b49\u4e8e, \u662f\u5426 null, \u662f\u5426\u975e0 \u7b49\u4f17\u591a\u6761\u4ef6\u8868\u8fbe\u5f0f\u7684\u5224\u65ad, <code>IL</code> \u5f15\u5165\u4e86\u5927\u91cf\u6709\u5173\u7684\u6307\u4ee4, \u5177\u4f53\u5982\u4e0b\u8868(\u6458\u81ea MSDN):</p> \u6307\u4ee4 \u63cf\u8ff0 beq\u00a0\u00a0\u00a0 \u5982\u679c\u4e24\u4e2a\u503c\u76f8\u7b49, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. beq.s\u00a0\u00a0 \u5982\u679c\u4e24\u4e2a\u503c\u76f8\u7b49, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. bge\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. bge.s\u00a0\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. bge.un\u00a0\u00a0\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. bge.un.s\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. bgt\u00a0\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. bgt.s\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. bgt.un\u00a0\u00a0\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. bgt.un.s\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5927\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. ble\u00a0\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. ble.s\u00a0\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. ble.un\u00a0\u00a0\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. ble.un.s\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u6743\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. blt\u00a0\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. blt.s\u00a0\u00a0\u00a0 \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. blt.un\u00a0\u00a0\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. blt.un.s\u00a0 \u5f53\u6bd4\u8f83\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u65f6, \u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u503c, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. bne.un\u00a0\u00a0\u00a0 \u5f53\u4e24\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u4e0d\u76f8\u7b49\u65f6, \u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. bne.un.s\u00a0 \u5f53\u4e24\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\u503c\u6216\u4e0d\u53ef\u6392\u5e8f\u7684\u6d6e\u70b9\u578b\u503c\u4e0d\u76f8\u7b49\u65f6, \u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. br\u00a0\u00a0\u00a0\u00a0 \u65e0\u6761\u4ef6\u5730\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. br.s\u00a0\u00a0\u00a0\u00a0 \u65e0\u6761\u4ef6\u5730\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. brfalse\u00a0\u00a0 \u5982\u679c value \u4e3a false\u3001\u7a7a\u5f15\u7528\uff08Visual Basic \u4e2d\u7684 Nothing\uff09\u6216\u96f6, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. brfalse.s \u5982\u679c value \u4e3a false\u3001\u7a7a\u5f15\u7528\u6216\u96f6, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. brtrue\u00a0\u00a0\u00a0 \u5982\u679c value \u4e3a true\u3001\u975e\u7a7a\u6216\u975e\u96f6, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4. brtrue.s\u00a0 \u5982\u679c value \u4e3a true\u3001\u975e\u7a7a\u6216\u975e\u96f6, \u5219\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u76ee\u6807\u6307\u4ee4\uff08\u77ed\u683c\u5f0f\uff09. <p>\u53ef\u4ee5\u53d1\u73b0, \u57fa\u672c\u90fd\u662f\u5404\u79cd\u5927\u4e8e\u5c0f\u4e8e\u7b49\u4e8e\u975e\u7a7a\u975e0\u7b49\u4ee5\u53ca\u6709\u7b26\u53f7\u65e0\u7b26\u53f7\u8fd9\u4e9b\u60c5\u51b5\u7684\u6392\u5217\u7ec4\u5408. \u4e0a\u8868\u4e2d\u6211\u4eec\u79f0\u9664\u4e86 <code>br</code> \u4e0e <code>br.s</code> \u6307\u4ee4\u5916\u7684\u6307\u4ee4\u4e3a \"\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\", \u53cd\u4e4b\u6211\u4eec\u79f0\u4e3a \"\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\". \u8fd9\u91cc\u6211\u4eec\u53ea\u4f1a\u7b80\u5355\u4e3e\u4f8b <code>br</code> <code>brfalse</code> \u8fd9\u4e24\u4e2a\u6307\u4ee4\u7684\u4f7f\u7528. \u5176\u4ed6\u6307\u4ee4\u57fa\u672c\u53ea\u662f\u51e0\u4e2a\u6761\u4ef6\u4e0d\u540c\u7c7b\u578b\u4e0d\u540c\u7684\u5dee\u522b.</p> <p><code>brfalse</code> \u6307\u4ee4\u4f1a\u4ece\u8bc4\u4f30\u6808\u4e0a\u5f39\u51fa\u4e00\u4e2a\u503c, \u7136\u540e\u67e5\u770b\u8be5\u503c\u662f\u5426\u4e3a <code>false</code> \u6216\u8005 <code>null</code> \u6216\u8005 <code>0</code>, \u5982\u679c\u662f\u5219\u8df3\u8f6c\u5230\u53c2\u6570\u6240\u6307\u7684\u76ee\u6807\u4f4d\u7f6e, \u5426\u5219\u4e0d\u505a\u4efb\u4f55\u4e8b. \u6bd4\u5982\u5982\u4e0b C# \u4ee3\u7801:</p> <pre><code>public static void MyMethod(int value)\n{\n    if (value == 0)\n    {\n        Console.WriteLine(\"value is 0!\");\n    }\n    else\n    {\n        Console.WriteLine(\"value is not 0.\");\n    }\n}\n</code></pre> <p>\u987a\u4fbf\u8bb0\u5f97\u66f4\u6539\u6211\u4eec\u7684\u65b9\u6cd5\u5b9a\u4e49:</p> <pre><code>public static MethodInfo GenerateMethod(Action&lt;ILGenerator&gt; generateAction)\n{\n    AssemblyBuilder asmBuilder = AssemblyBuilder.DefineDynamicAssembly(new(\"MyAssembly\"), AssemblyBuilderAccess.RunAndCollect);\n    ModuleBuilder moduleBuilder = asmBuilder.DefineDynamicModule(\"MyTestModule\");\n    TypeBuilder typeBuilder = moduleBuilder.DefineType(\"MyType\");\n    MethodBuilder methodBuilder = typeBuilder.DefineMethod(\"MyMethod\", MethodAttributes.Public | MethodAttributes.Static\n        , typeof(void), new Type[] { typeof(int) });\n    generateAction(methodBuilder.GetILGenerator());\n    return typeBuilder.CreateType().GetMethod(\"MyMethod\")!;\n}\n\npublic static void Main()\n{\n    MethodInfo methodInfo = GenerateMethod(il =&gt;\n    {\n        // TODO implement the IL body\n    });\n    var action = methodInfo.CreateDelegate&lt;Action&lt;int&gt;&gt;();\n    action(1);\n}\n</code></pre> <p>\u5176\u5bf9\u5e94 <code>IL</code> \u4e3a:</p> <pre><code>var cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar valueIs0Target = il.DefineLabel();\nil.Emit(OpCodes.Ldarg_0);\nil.Emit(OpCodes.Brfalse, valueIs0Target);\nil.Emit(OpCodes.Ldstr, \"value is not 0.\");\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\nil.MarkLabel(valueIs0Target);\nil.Emit(OpCodes.Ldstr, \"value is 0!\");\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre> <p>\u5728\u8fd9\u91cc, \u5728\u4f7f\u7528 <code>System.Reflection.Emit</code> \u5e93\u7684\u60c5\u51b5\u4e0b, \u6211\u4eec\u5728\u4ee3\u7801\u7684\u7b2c 2 \u884c\u5b9a\u4e49\u4e86\u4e00\u4e2a Label, \u7528\u6765\u4e4b\u540e\u4f5c\u4e3a\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u7684\u53c2\u6570\u4f20\u5165, \u4e0d\u8fc7\u76ee\u524d\u8fd9\u4e2a Label \u6ca1\u6709\u6307\u5411\u4efb\u4f55 <code>IL</code> \u6307\u4ee4\u4f4d\u7f6e, \u6240\u4ee5\u6211\u4eec\u5728\u7b2c 8 \u884c\u8c03\u7528 <code>MarkLabel</code> \u65b9\u6cd5, \u8c03\u7528\u5b8c\u8be5\u65b9\u6cd5\u540e\u7684\u4e0b\u4e00\u6b21 <code>Emit</code> \u7684 <code>IL</code> \u6307\u4ee4\u7684\u4f4d\u7f6e\u4fe1\u606f\u5c31\u4f1a\u88ab\u8bbe\u7f6e\u5230 Label \u4e2d, \u89c2\u5bdf\u4e0a\u8ff0\u4ee3\u7801\u4e0d\u96be\u53d1\u73b0, \u6211\u4eec\u8bfb\u53d6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570, \u5982\u679c\u4e3a 0 \u90a3\u4e48\u8df3\u8f6c\u5230\u8f93\u51fa <code>value is 0!</code> \u7684 <code>IL</code> \u6307\u4ee4\u6bb5\u524d, \u800c\u5f53\u975e 0 \u65f6\u4e0d\u505a\u4efb\u4f55\u4e8b\u8ba9\u5176\u81ea\u7136\u6267\u884c\u5230\u8f93\u51fa <code>value is not 0.</code> \u7684 <code>IL</code> \u6307\u4ee4\u6bb5\u524d, \u4f60\u53ef\u4ee5\u66f4\u6539\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4ee3\u7801\u7684\u5730\u65b9\u4f20\u5165\u7684\u53c2\u6570\u6765\u89c2\u5bdf\u5b83\u7684\u8f93\u51fa(\u6bd4\u5982\u5c06 <code>action(1)</code> \u6539\u4e3a <code>action(0)</code>). \u987a\u4fbf, \u5728\u8fd9\u4e2a\u6307\u4ee4\u6bb5\u540e\u9762\u7d27\u8ddf\u4e00\u4e2a <code>ret</code> \u6307\u4ee4\u76f4\u63a5\u8fd4\u56de\u8be5\u65b9\u6cd5\u9632\u6b62\u8bef\u6267\u884c\u5230\u540e\u9762\u7684 <code>IL</code> \u6bb5. \u4e0d\u8fc7\u8fd9\u53ea\u5728\u540e\u9762\u6ca1\u6709\u4ee3\u7801\u9700\u8981\u6267\u884c\u7684\u60c5\u51b5\u4e0b\u594f\u6548,  \u5982\u679c\u540e\u9762\u4f9d\u7136\u6709\u4ee3\u7801\u7684\u8bdd\u6211\u4eec\u5c31\u5f97\u4f7f\u7528 <code>br</code> \u6307\u4ee4\u4e86.</p> <p><code>br</code> \u6307\u4ee4\u6267\u884c\u540e\u4f1a\u5c06\u76ee\u524d\u7684\u6267\u884c\u4f4d\u7f6e\u65e0\u6761\u4ef6\u7684\u8df3\u8f6c\u5230\u5bf9\u5e94\u4f4d\u7f6e, \u6bd4\u5982\u521a\u624d\u4ecb\u7ecd <code>brfalse</code> \u6307\u4ee4\u672b\u5c3e\u7684\u4e00\u70b9\u5c0f\u95ee\u9898, \u5373\u6bd4\u5982\u5982\u4e0b C# \u4ee3\u7801:</p> <pre><code>if (value == 0)\n{\n    Console.WriteLine(\"value is 0!\");\n}\nelse\n{\n    Console.WriteLine(\"value is not 0.\");\n}\nConsole.WriteLine(\"always execute me!\");\n</code></pre> <p>\u5728\u672b\u5c3e\u6211\u4eec\u6709\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\u662f\u65e0\u5173 <code>value</code> \u7684\u503c\u7684, \u4e4b\u524d\u7684\u4ee3\u7801\u6211\u4eec\u4e3a\u4e86\u9632\u6b62\u8bef\u6267\u884c <code>IL</code> \u6211\u4eec\u4f7f\u7528\u4e86 <code>ret</code> \u6307\u4ee4\u76f4\u63a5\u8fd4\u56de\u6574\u4e2a\u65b9\u6cd5, \u4f46\u662f\u73b0\u5728\u8fd9\u91cc\u6211\u4eec\u65e0\u6cd5\u8fd9\u4e48\u5e72, \u4e0d\u8fc7\u73b0\u5728\u6709 <code>br</code> \u6307\u4ee4\u53ef\u4ee5\u4f7f\u7528\u4e86:</p> <pre><code>var cw = typeof(Console).GetMethod(\"WriteLine\", new Type[] { typeof(string) })!;\nvar valueIs0Target = il.DefineLabel();\nvar afterIfTarget = il.DefineLabel();\nil.Emit(OpCodes.Ldarg_0);\nil.Emit(OpCodes.Brfalse, valueIs0Target);\nil.Emit(OpCodes.Ldstr, \"value is not 0.\");\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Br, afterIfTarget);\nil.MarkLabel(valueIs0Target);\nil.Emit(OpCodes.Ldstr, \"value is 0!\");\nil.Emit(OpCodes.Call, cw);\nil.MarkLabel(afterIfTarget);\nil.Emit(OpCodes.Ldstr, \"always execute me!\");\nil.Emit(OpCodes.Call, cw);\nil.Emit(OpCodes.Ret);\n</code></pre>"},{"location":"hooks/il/#s","title":"<code>.s</code> \u7cfb\u6307\u4ee4","text":"<p>\u4f60\u53ef\u80fd\u53d1\u73b0\u4e86\u5c31\u662f\u4e00\u4e9b <code>IL</code> \u6307\u4ee4\u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u5e26 <code>.s</code> \u540e\u7f00\u7684\u7248\u672c, \u8fd9\u4e2a\u6211\u4eec\u4e00\u822c\u53eb\u5b83\u7684 \"\u77ed\u683c\u5f0f\" \u7248\u672c, \u53cd\u4e4b\u53eb \"\u957f\u683c\u5f0f\" \u7248\u672c, \u6bd4\u5982\u5c31\u521a\u624d\u7684 <code>br</code> \u5bf9\u5e94\u7684 <code>br.s</code>, \u901a\u5e38\u7c7b\u4f3c\u8fd9\u4e00\u5bf9 <code>IL</code> \u6307\u4ee4\u7684\u533a\u522b\u5c31\u662f <code>.s</code> \u7248\u672c\u7684\u53c2\u6570\u4f1a\u77ed\u4e00\u70b9, \u6bd4\u5982\u957f\u683c\u5f0f\u7248\u672c\u7684\u53c2\u6570\u957f\u5ea6\u662f 4 \u5b57\u8282, \u800c\u77ed\u683c\u5f0f\u7248\u672c\u7684\u53c2\u6570\u957f\u5ea6\u53ef\u80fd\u5c31\u662f 2 \u5b57\u8282, \u6ce8\u610f\u8fd9\u91cc\u4e0d\u662f\u8bf4\u7684\u662f\u538b\u5165\u8bc4\u4f30\u6808\u7684\u503c\u7684\u7c7b\u578b, \u957f\u77ed\u683c\u5f0f\u7248\u672c\u6240\u505a\u7684\u4e8b\u60c5\u662f\u5b8c\u5168\u4e00\u6837\u7684, \u53ea\u662f\u4f20\u53c2\u5141\u8bb8\u4f60\u7528\u77ed\u4e00\u70b9\u7684\u53c2\u6570. \u8fd9\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5bf9 <code>IL</code> \u6307\u4ee4\u7684\u5927\u5c0f\u4f18\u5316, \u7f16\u8bd1\u5668\u901a\u5e38\u5c31\u4f1a\u80fd\u7528 <code>.s</code> \u7248\u672c\u5c31\u7528 <code>.s</code> \u7248\u672c, \u5f53\u53c2\u6570\u9700\u6c42\u8d85\u8fc7\u77ed\u683c\u5f0f\u53c2\u6570\u8868\u8fbe\u8303\u56f4\u65f6\u624d\u4f1a\u4f7f\u7528\u957f\u683c\u5f0f, \u5bf9\u4e8e\u6211\u4eec\u7684\u8bdd\u5982\u679c\u4f60\u60f3\u5fae\u5fae\u7684\u4f18\u5316\u4e00\u4e0b\u4f60\u7684 <code>IL</code> \u7684\u5927\u5c0f\u7684\u8bdd, \u4f60\u53ef\u4ee5\u9009\u62e9\u5728\u53c2\u6570\u8303\u56f4\u591f\u7528\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528 <code>.s</code> \u7248\u672c.</p>"},{"location":"hooks/il/#_12","title":"\u7ed3\u5c3e","text":"<p>\u81f3\u6b64, \u4e00\u4e9b\u57fa\u672c\u7684 <code>IL</code> \u4f60\u5df2\u4e86\u89e3, \u6211\u4eec\u5728\u8fd9\u91cc\u4ecb\u7ecd\u7684 <code>IL</code> \u6307\u4ee4\u4e0d\u8fc7\u662f\u51b0\u5c71\u4e00\u89d2, \u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684 <code>IL</code> \u6307\u4ee4\u6ca1\u6709\u4ecb\u7ecd, \u4e0d\u8fc7\u5b83\u4eec\u5927\u540c\u5c0f\u5f02, \u57fa\u672c\u90fd\u662f\u5bf9\u8bc4\u4f30\u6808\u7684\u5404\u79cd\u5404\u6837\u7684\u64cd\u4f5c, \u6211\u4eec\u53ea\u9700\u8981\u5728\u7528\u5230\u65f6\u6216\u8005\u5076\u5c14\u7ffb\u9605\u4e00\u4e0b <code>IL</code> \u6307\u4ee4\u8868\u5c31\u80fd\u4e86\u89e3. \u6b64\u5916, \u8fd8\u6709\u5f88\u591a\u6bd4\u5982\u65b9\u6cd5\u7684\u7b7e\u540d, <code>fixed</code>, <code>try-catch</code> \u7b49\u5185\u5bb9\u6211\u4eec\u8fd8\u6ca1\u6709\u6d89\u53ca\u5230, \u4e0d\u8fc7\u5230\u76ee\u524d\u4e3a\u6b62\u5bf9\u4e8e\u851a\u84dd modding \u5df2\u7ecf\u52c9\u5f3a\u591f\u7528\u4e86. \u518d\u6b64\u5916, \u5728 dnSpy \u7684 <code>IL</code> \u4ee3\u7801\u7684\u89c6\u89d2\u65f6, \u70b9\u51fb <code>IL</code> \u64cd\u4f5c\u7b26\u7684\u540d\u79f0\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8df3\u8f6c\u5230 msdn \u4e0a\u5bf9\u8fd9\u4e2a\u6307\u4ee4\u7684\u63cf\u8ff0. \u90a3\u4e48, \u5728\u4e86\u89e3\u4f7f\u7528 <code>System.Reflection.Emit</code> \u5e93\u540e, \u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>Mono.Cecil</code> \u5728\u851a\u84dd\u4e2d\u66f4\u6539\u851a\u84dd\u7684\u7a0b\u5e8f\u96c6\u4e86.  </p> <p>\u4e00\u4e9b\u53ef\u80fd\u6709\u7528\u7684\u8d44\u6e90:</p> <ul> <li>OpCodes Fields - Microsoft Learn (https://learn.microsoft.com/...)</li> <li>\u7406\u89e3IL - Rorschach - \u77e5\u4e4e (https://zhuanlan.zhihu.com/...)</li> <li>IL\u6307\u4ee4\u8be6\u7ec6 - Zery - \u535a\u5ba2\u56ed (https://www.cnblogs.com/...)</li> </ul>"},{"location":"loenn/basic_configurations/","title":"Loenn \u57fa\u7840\u914d\u7f6e","text":""},{"location":"loenn/basic_configurations/#lua","title":"Lua","text":""},{"location":"loenn/basic_configurations/#entitydata","title":"EntityData","text":""},{"location":"loenn/basic_configurations/#_1","title":"\u57fa\u7840\u7ed3\u6784","text":""},{"location":"loenn/effect_structs/","title":"Effect \u7ed3\u6784","text":""},{"location":"loenn/entity_structs/","title":"Entity \u7ed3\u6784","text":""},{"location":"loenn/folder_structure/","title":"Loenn \u76ee\u5f55\u7ed3\u6784","text":""},{"location":"loenn/nodes/","title":"Loenn \u8282\u70b9","text":""},{"location":"loenn/rendering/","title":"Loenn \u7ed8\u5236","text":""},{"location":"loenn/rendering/#sprite","title":"sprite \u51fd\u6570","text":""},{"location":"loenn/rendering/#loenn_1","title":"Loenn \u7ed8\u5236\u76f8\u5173\u63d2\u4ef6","text":""},{"location":"loenn/rendering/#structdrawable_line","title":"struct.drawable_line","text":""},{"location":"loenn/rendering/#structdrawable_rectangle","title":"struct.drawable_rectangle","text":""},{"location":"loenn/rendering/#structdrawable_sprite","title":"struct.drawable_sprite","text":""},{"location":"loenn/rendering/#structdrawable_nine_patch","title":"struct.drawable_nine_patch","text":""},{"location":"loenn/rendering/#structdrawable_text","title":"struct.drawable_text","text":""},{"location":"loenn/trigger_structs/","title":"Trigger \u7ed3\u6784","text":""},{"location":"misc/change_log/","title":"ChangeLog","text":""},{"location":"misc/change_log/#_1","title":"\u524d\u8a00","text":"<p>\u603b\u4e4b, \u8fd9\u91cc\u662f\u66f4\u6539\u65e5\u5fd7 \u867d\u7136\u8bf4\u7ffb github \u4e5f\u80fd\u7ffb\u5230\u5c31\u662f\u4e86, \u4e0d\u8fc7\u8fd8\u662f\u5199\u51fa\u6765\u66f4\u65b9\u4fbf(?</p> <p>\u4e00\u4e9b\u6bd4\u8f83\u5927\u7684\u6539\u52a8\u548c\u7ea0\u9519\u4f1a\u8bb0\u5f55\u5728\u8fd9, \u81f3\u4e8e\u4e00\u4e9b\u91cd\u5199\u4e86\u7684\u9875\u9762\u4f1a\u6254\u8fdb\u5386\u53f2\u5f52\u6863\u4e2d \u56e0\u4e3a\u65f6\u95f4\u6bd4\u8f83\u4e45\u8fdc, \u66f4\u6539\u65e5\u5fd7\u4ece AppleSheep \u91cd\u6784\u6574\u4e2a\u6559\u7a0b\u5f00\u59cb</p>"},{"location":"misc/change_log/#changelog_1","title":"ChangeLog","text":""},{"location":"misc/change_log/#20241210","title":"2024.12.10","text":"<ul> <li>\u91cd\u6784\u6574\u4e2a\u9879\u76ee\u7ed3\u6784 \u6307\u5404\u79cd\u4e71\u98de\u7684png</li> <li>\u4f18\u5316\u7ec6\u5206\u4e86\u6392\u7248</li> <li>\u6dfb\u52a0 ChangeLog \u548c ToDoList</li> </ul>"},{"location":"misc/change_log/#20241211","title":"2024.12.11","text":"<ul> <li>\u6dfb\u52a0\u591c\u95f4\u6a21\u5f0f</li> <li>\u5206\u79bb\u9605\u8bfb\u4ee3\u7801</li> <li>\u5206\u79bb StateMachine</li> </ul>"},{"location":"misc/change_log/#20241216","title":"2024.12.16","text":"<ul> <li>\u6dfb\u52a0\u8de8 Mod \u4ea4\u4e92</li> </ul>"},{"location":"misc/change_log/#20241221","title":"2024.12.21","text":"<ul> <li>\u66f4\u65b0\u9879\u76ee\u6a21\u677f</li> <li>\u5f52\u6863\u5e76\u91cd\u5199\u57fa\u7840\u73af\u5883\u914d\u7f6e - \u901a\u8fc7\u6a21\u677f\u521b\u5efa\u9879\u76ee</li> <li>\u6dfb\u52a0\u6d4b\u8bd5\u5730\u56fe</li> <li>\u5b8c\u5584\u8de8 Mod \u4ea4\u4e92</li> </ul>"},{"location":"misc/change_log/#20251","title":"2025.1.","text":"<ul> <li>\u5b8c\u5584\u8c03\u8bd5</li> <li>\u5b8c\u5584\u8de8 Mod \u4ea4\u4e92 - ModInterop</li> </ul>"},{"location":"misc/to_do_list/","title":"ToDoList","text":""},{"location":"misc/to_do_list/#_1","title":"\u524d\u8a00","text":"<p>\u8fd9\u91cc\u662f AppleSheep, \u672c\u6559\u7a0b\u540e\u7eed\u7684\u7ef4\u62a4\u5e94\u8be5\u90fd\u7531\u6211\u8d1f\u8d23</p> <p>\u8fd9\u91cc\u5217\u51fa\u4e86\u81ea\u5df1\u7684\u4e00\u4e9b\u4ee3\u529e\u4e8b\u9879, \u5982\u679c\u6709\u4ec0\u4e48\u60f3\u6cd5\u6216\u5efa\u8bae\u53ef\u4ee5QQ\u79c1\u804a\u6211(\u53ef\u4ee5\u5728\u4e8c\u7fa4 962344157 \u6216\u662f coder \u7fa4 550358997 \u627e\u5230\u6211)</p>"},{"location":"misc/to_do_list/#todolist_1","title":"ToDoList","text":"\u8ba1\u5212 \u72b6\u6001 \u5206\u79bb Loenn \u8282\u53ca\u8865\u5145 \u8fdb\u884c\u4e2d \u91cd\u5199 EC \u67b6\u6784\u76f8\u5173 \u51c6\u5907\u4e2d everest \u81ea\u5e26\u4e8b\u4ef6 \u8ba1\u5212\u4e2d \u5206\u79bb\u5df2\u6709\u7684\u7ec4\u4ef6\u8fdb\u884c\u91cd\u5199 \u8ba1\u5212\u4e2d \u5b8c\u5584 VisualStudio C# \u8c03\u8bd5 \u8ba1\u5212\u4e2d \u91cd\u6784 Hook \u8282 \u8ba1\u5212\u4e2d \u5206\u79bb DynamicData \u76f8\u5173 \u8ba1\u5212\u4e2d \u5b8c\u5584 StateMachine \u8ba1\u5212\u4e2d \u6dfb\u52a0 Effect \u76f8\u5173 \u8ba1\u5212\u4e2d \u6dfb\u52a0 Collider \u76f8\u5173 \u8ba1\u5212\u4e2d"},{"location":"other/xml-speedrun/","title":"XML \u7b80\u5355\u4ecb\u7ecd","text":"<p>\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u67d0\u4e9b\u6ca1\u542c\u8bf4\u8fc7 XML \u7684\u4eba\u5feb\u901f\u4e86\u89e3 XML \u7684\u5927\u81f4\u8bed\u6cd5\u662f\u4ec0\u4e48, \u6240\u4ee5\u5f88\u591a\u7ec6\u8282\u65b9\u9762\u7684\u95ee\u9898\u6211\u4f1a\u76f4\u63a5\u5ffd\u7565, \u90a3\u4e48, \u5c31\u6b64\u5f00\u59cb\u5427:</p>"},{"location":"other/xml-speedrun/#_1","title":"\u5b9a\u4e49","text":"<p>\u8fd9\u91cc\u6458\u6284\u4e00\u4e0b:</p> <p>XML \u6307\u53ef\u6269\u5c55\u6807\u8bb0\u8bed\u8a00(Extensible Markup Language). XML \u88ab\u8bbe\u8ba1\u7528\u6765\u4f20\u8f93\u548c\u5b58\u50a8\u6570\u636e, \u4e0d\u7528\u4e8e\u8868\u73b0\u548c\u5c55\u793a\u6570\u636e, HTML \u5219\u7528\u6765\u8868\u73b0\u6570\u636e.</p> <p>XML \u662f\u4e00\u79cd\u4ee5\u683c\u5f0f\u5316\u50a8\u5b58\u6570\u636e\u7684\u8bed\u8a00, \u5728 <code>msbuild</code> \u4e2d\u5b83\u5c31\u88ab\u7528\u6765\u4ee5\u683c\u5f0f\u5316\u7684\u65b9\u5f0f\u63cf\u8ff0\u6574\u4e2a\u9879\u76ee\u7684\u4fe1\u606f.</p>"},{"location":"other/xml-speedrun/#_2","title":"\u8282\u70b9, \u7279\u6027","text":"<p>\u4e00\u6bb5\u5f88\u57fa\u7840\u7684 XML \u53ef\u80fd\u662f\u8fd9\u4e2a\u6837\u5b50\u7684:</p> <pre><code>&lt;books&gt;\n    &lt;book id=\"123\"&gt;\u8fd9\u662f\u7b2c\u4e00\u672c\u4e66&lt;/book&gt;\n    &lt;book id=\"456\"&gt;\u8fd9\u662f\u7b2c\u4e8c\u672c\u4e66&lt;/book&gt;\n    &lt;book id=\"114\"&gt;\u8fd9\u662f\u7b2c\u4e09\u672c\u4e66&lt;/book&gt;\n    &lt;book id=\"514\"&gt;\u8fd9\u662f\u4e0d\u77e5\u9053\u7b2c\u51e0\u672c\u4e66&lt;/book&gt;\n&lt;/books&gt;\n</code></pre> <p>\u8fd9\u6bb5 XML \u7528\u4e2d\u6587\u89e3\u91ca\u8d77\u6765\u662f\u8fd9\u6837\u7684:</p> <p>\u9996\u5148\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u8282\u70b9, \u5b83\u7684\u540d\u5b57\u53eb\u505a \"books\", \u5b83\u6709\u5f88\u591a\u5b50\u8282\u70b9, \u5206\u522b\u662f:</p> <ul> <li>\u4e00\u4e2a \"book\" \u8282\u70b9, \u5b83\u7684 id \u7279\u6027\u662f 123, \u5b83\u7684\u5185\u5bb9\u662f \"\u8fd9\u662f\u7b2c\u4e00\u672c\u4e66\"</li> <li>\u4e00\u4e2a \"book\" \u8282\u70b9, \u5b83\u7684 id \u7279\u6027\u662f 456, \u5b83\u7684\u5185\u5bb9\u662f \"\u8fd9\u662f\u7b2c\u4e8c\u672c\u4e66\"</li> <li>\u4e00\u4e2a \"book\" \u8282\u70b9, \u5b83\u7684 id \u7279\u6027\u662f 114, \u5b83\u7684\u5185\u5bb9\u662f \"\u8fd9\u662f\u7b2c\u4e09\u672c\u4e66\"</li> <li>\u4e00\u4e2a \"book\" \u8282\u70b9, \u5b83\u7684 id \u7279\u6027\u662f 514, \u5b83\u7684\u5185\u5bb9\u662f \"\u8fd9\u662f\u4e0d\u77e5\u9053\u7b2c\u51e0\u672c\u4e66\"</li> </ul> <p>\u5728\u8fd9\u91cc, \u6700\u5916\u5c42\u7684 \"books\" \u4ee5\u53ca\u91cc\u9762\u7684 \"book\" \u90fd\u79f0\u4e3a\u8282\u70b9, \u5176\u4e2d \"books\" \u8282\u70b9\u5185\u90e8\u6709\u5f88\u591a \"book\" \u8282\u70b9, \u800c \"book\" \u8282\u70b9\u5185\u90e8\u53ea\u6709\u4e00\u4e32\u6587\u672c. \u6bcf\u4e2a \"book\" \u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u53eb\u505a id \u7684\u7279\u6027(\u6709\u65f6\u4e5f\u53eb\u505a\u5c5e\u6027, \u4e0d\u8fc7\u6ce8\u610f\u522b\u4e0e C# \u7684\u5c5e\u6027/\u7279\u6027\u76f8\u6df7\u6dc6).  </p> <p>\u5728\u8bed\u6cd5\u5c42\u9762\u4e0a, \u4e00\u4e2a\u8282\u70b9\u4ee5 &lt;\u540d\u5b57&gt; \u5f00\u59cb\u58f0\u660e, \u5728\u53d9\u8ff0\u5b8c\u5b83\u7684\u5185\u5bb9\u540e\u4ee5 &lt;/\u540d\u5b57&gt; \u7ed3\u675f. \u5c5e\u6027\u5219\u5728\u8282\u70b9\u540d\u79f0\u4e4b\u540e\u4ee5\u7a7a\u683c\u5206\u9694\u6392\u5217: &lt;\u540d\u5b57 \u5c5e\u60271=\"\u503c1\" \u5c5e\u60272=\"\u503c2\"&gt;, \u5c5e\u6027\u7684\u503c\u9700\u8981\u7531 <code>\"</code> \u5305\u88f9. \u5bf9\u4e8e\u4e00\u4e9b\u6ca1\u6709\u5185\u90e8\u5185\u5bb9\u7684\u8282\u70b9, \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u81ea\u7ed3\u675f\u8bed\u6cd5: <pre><code>&lt;columns&gt;\n    &lt;column id=\"xxx\"/&gt;\n    &lt;column qwq=\"6\" awa=\"4\"/&gt;\n    &lt;column/&gt;\n    &lt;column/&gt;\n    &lt;column/&gt;\n&lt;/columns&gt;\n</code></pre></p> <p>XML \u5141\u8bb8\u4ee5\u4efb\u610f\u6df1\u5ea6\u6765\u5d4c\u5957, \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u6765\u7ec4\u88c5\u4e00\u4e2a\u5f88\u590d\u6742\u7684 XML:</p> <pre><code>&lt;books&gt;\n    &lt;book id=\"123\"&gt;\n        &lt;bookmarks page=\"1\"&gt;114514&lt;/bookmarks&gt;\n        &lt;bookmarks page=\"2\"&gt;2333&lt;/bookmarks&gt;\n        &lt;bookmarks page=\"123\"&gt;838&lt;/bookmarks&gt;\n    &lt;/book&gt;\n    &lt;book id=\"456\"&gt;\n        &lt;bookmarks page=\"1\"&gt;\n            &lt;picture src=\"http://example.com\"&gt;\n                this is alt\n            &lt;/picture&gt;\n            &lt;text content=\"text here!\"/&gt;\n        &lt;/bookmarks&gt;\n        &lt;bookmarks page=\"2\"&gt;2333&lt;/bookmarks&gt;\n    &lt;/book&gt;\n&lt;/books&gt;\n</code></pre>"}]}